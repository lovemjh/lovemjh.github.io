<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="tk-æœåŠ¡ç½‘å…³ã€Sentinelã€Sleuth - https://lovemjh.github.io/posts/project/20220528224436/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>tk-æœåŠ¡ç½‘å…³ã€Sentinelã€Sleuth</title>
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    <link rel="stylesheet" href="https://lovemjh.github.io/style.min.824365c118b34524ce845ac2a294220354719cca11af5b27a81b04c173bbba57.css">
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate cool">
        <div id="header"><div class="container-header">
    <div id="vars" class="container-vars" style="display: none;">
	{
		"hasFoldAllCodeBlocks": false,
		"svgColor": "#6c757d",
		"en": false,
		"dark": false
	}
</div>
    <h1 class="title">
        
            tk-æœåŠ¡ç½‘å…³ã€Sentinelã€Sleuth
            
        
    </h1>

    <div class="container-breadcrumb-nav">
    
    <div class="breadcrumb-nav-bar">
        <div><a href="/"><svg t="1656411084410" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2954" width="16" height="16"><path d="M947.5 390.6l-377-290c-34.5-26.5-82.6-26.5-117.1 0l-377 290c-14 10.8-16.6 30.9-5.9 44.9 10.8 14 30.9 16.6 44.9 5.9l28.5-21.9V768c0 88.2 71.8 160 160 160h80c35.3 0 64-28.7 64-64V640c0-17.6 14.4-32 32-32h64c17.6 0 32 14.4 32 32v224c0 35.3 28.7 64 64 64h80c88.2 0 160-71.8 160-160V419.4l28.5 21.9c5.8 4.5 12.7 6.6 19.5 6.6 9.6 0 19.1-4.3 25.4-12.5 10.8-13.9 8.2-34-5.8-44.8zM816 768c0 52.9-43.1 96-96 96h-80V640c0-52.9-43.1-96-96-96h-64c-52.9 0-96 43.1-96 96v224h-80c-52.9 0-96-43.1-96-96V370.2l284.5-218.8c11.5-8.8 27.5-8.8 39 0L816 370.2V768z" fill=#6c757d p-id="2955"></path></svg></a></div>
        <div><a href="/nav"><svg t="1656411531924" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5827" width="16" height="16"><path d="M849.59197473 125.23018519L139.22930586 391.72854662a23.35052669 23.35052669 0 0 0-14.95414244 21.65490745c-0.12257519 9.70384955 5.61801843 18.46795771 14.40255493 22.04306141l318.42928099 129.25528056 119.51057092 320.39047893c3.06437293 8.23295069 10.35758221 13.89182751 18.7335381 14.87242563l2.7170774 0.14300521a22.79893918 22.79893918 0 0 0 21.20546682-15.36272638l259.51158924-729.54564933a23.8612558 23.8612558 0 0 0-5.31158128-24.55584682 22.3290685 22.3290685 0 0 0-23.9021142-5.43415649zM793.65694081 211.64552314l-196.63064161 552.75171747-91.91077952-246.37564122-253.62799211-102.96295445 542.16941324-203.4131218z" p-id="5828" fill=#6c757d></path></svg></a></div>
        <div><a href="/search"><svg t="1656411627509" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1730" width="14" height="14"><path d="M469.333333 85.333333c211.968 0 384 172.032 384 384s-172.032 384-384 384-384-172.032-384-384 172.032-384 384-384z m0 682.666667c164.992 0 298.666667-133.674667 298.666667-298.666667 0-165.034667-133.674667-298.666667-298.666667-298.666666-165.034667 0-298.666667 133.632-298.666666 298.666666 0 164.992 133.632 298.666667 298.666666 298.666667z m362.026667 3.029333l120.704 120.661334-60.373333 60.373333-120.661334-120.704 60.330667-60.330667z" p-id="1731" fill=#6c757d></path></svg></a></div>
        <div><a href="/posts"><svg t="1656411724198" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5655" width="12" height="12"><path d="M811.705761 1024H212.294239c-93.1199 0-174.823046-87.570975-174.823046-187.387854V162.322018C37.471193 69.776145 112.604921 0 212.294239 0H596.190595l7.015883 5.93161c111.74388 95.479788 185.857116 170.741078 279.614824 266.093304 29.65805 30.040735 61.165743 62.122454 96.436499 97.393211l7.271006 7.334787v459.859234c-0.063781 99.816879-81.703145 187.387854-174.823046 187.387854zM212.294239 49.94033c-72.391155 0-124.882716 47.261538-124.882716 112.381688v674.290128c0 71.94469 59.507443 137.383743 124.882716 137.383743h599.411522c65.311492 0 124.882716-65.439053 124.882716-137.383743V397.417876c-32.528184-32.464404-61.73977-62.250016-89.356836-90.377328-90.951355-92.418312-163.278729-165.957521-269.601245-257.163999H212.294239z" fill=#6c757d p-id="5656"></path><path d="M936.588477 449.526752h-212.326129c-99.753099 0-187.324073-81.703145-187.324073-174.823046V49.94033a25.002055 25.002055 0 0 1 49.94033 0v224.763376c0 65.311492 65.502834 124.882716 137.383743 124.882716h212.326129a25.002055 25.002055 0 1 1 0 49.94033z" fill=#6c757d p-id="5657"></path></svg></a></div>
        <div><a href="/archive"><svg t="1656411795742" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7334" width="12" height="12"><path d="M884.224 522.24H504.32V141.824c0-16.896-13.824-30.72-30.72-30.72-120.32 0-233.472 47.616-317.952 134.144S26.112 445.952 29.184 566.784c2.56 114.688 49.152 222.72 131.072 304.128 81.92 81.408 189.952 128 304.64 130.56h10.24c117.76 0 227.84-45.568 312.32-128.512 86.528-85.504 133.632-199.68 132.608-321.024-0.512-2.048-1.536-29.696-35.84-29.696z m-140.288 307.712c-74.752 73.728-173.056 112.64-277.504 110.592-205.824-4.608-370.688-169.472-375.296-374.784-3.072-104.448 35.84-202.752 108.544-277.504 65.536-67.072 151.552-107.52 243.712-114.688v378.88c0 16.896 13.824 30.72 30.72 30.72 129.024 0 311.296 0 382.976 0.512-6.144 93.184-46.08 179.712-113.152 246.272z" fill=#6c757d p-id="7335"></path><path d="M603.136 11.264c-8.192-0.512-15.872 3.072-22.016 8.704-5.632 5.632-9.216 13.824-9.216 22.016v378.88c0 16.896 13.824 30.72 30.72 30.72h378.88c16.896 0 30.72-13.824 30.72-30.72 0-223.744-183.808-407.552-409.088-409.6z m30.208 378.88V74.24c167.424 16.384 301.056 150.016 315.904 315.904h-315.904z" fill=#6c757d p-id="7336"></path></svg></a></div>
        <div id="light-dark" style="cursor: pointer;"><a><svg t="1656411842215" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5086" width="12" height="12"><path d="M1007.492874 384.513055c-8.795694-34.58307-21.189627-67.666874-36.682043-99.05151-2.698679-5.397358-10.894667-3.498287-10.894666 2.598728v0.299853c0 32.484098-6.896624 63.868734-19.890263 92.554691-10.694764 23.488501-25.487523 45.077933-43.978471 64.068635-41.779547 42.679107-99.05151 66.967217-158.722299 67.26707-61.869712 0.299853-119.941284-24.188159-162.920244-68.966238-40.280281-41.979449-62.56937-98.251902-62.269516-156.323473 0.399804-59.270984 23.588452-114.94373 65.567901-156.823229 19.59041-19.59041 42.179351-35.082826 66.667364-46.077443C672.956643 71.166451 704.041426 64.469729 736.125719 64.469729h1.299364c6.097015 0 8.096037-8.096037 2.598728-10.794715C708.739126 37.982696 675.655322 25.488812 641.172203 16.493216 599.492607 5.598549 555.714038-0.098662 510.536154 0.001289 222.37722 0.700947-7.41029 237.38508 0.185992 525.444064c7.096526 271.667008 225.889418 490.559851 497.456474 497.856279 287.559228 7.796183 524.14341-220.891864 525.842579-508.551044 0.299853-44.977981-5.297407-88.656599-15.992171-130.236244z m-83.15929 301.552378c-22.588942 53.27392-54.873137 101.250434-95.953027 142.330323-41.179841 41.179841-89.056403 73.464036-142.330324 95.953027-55.172991 23.288599-113.744317 35.182777-174.314666 35.182777s-119.141675-11.794226-174.314666-35.182777c-53.27392-22.588942-101.250434-54.873137-142.330323-95.953027-41.179841-41.179841-73.464036-89.056403-95.953027-142.330323C75.749001 630.892442 63.954774 572.221164 63.954774 511.750767s11.794226-119.141675 35.182777-174.314666c22.588942-53.27392 54.873137-101.250434 95.953027-142.330323 41.179841-41.179841 89.056403-73.464036 142.330323-95.953027C392.593892 75.7642 451.26517 63.969974 511.735567 63.969974c13.99315 0 27.886348 0.599706 41.679596 1.89907C489.246577 118.643209 448.266638 198.704016 448.266638 288.360126c0 159.022152 128.836929 287.859081 287.859081 287.859081 89.156354 0 168.817357-40.580134 221.691473-104.149015 1.099462 13.09359 1.699168 26.387082 1.699168 39.680575 0 60.470397-11.794226 119.141675-35.182776 174.314666z" p-id="5087" fill=#6c757d></path></svg></a></div>
        
    </div>

    
</div>

            <div id="toc">ğŸ“œ</div>
        
    
    
</div>
</div>
        <div id="content">












<div class="container-main 
     container-page 
">

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7409" width="12" height="12"><path d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z" p-id="7410" fill="#adb5bd"></path></svg>
            2022-05-28&nbsp;
        </span>
        <span>
            
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="23838" width="11" height="11"><path d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z" p-id="23839" fill="#adb5bd"></path></svg>
            2022-05-28&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="33866" width="12" height="12"><path d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z" fill="#adb5bd" p-id="33867"></path><path d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z" fill="#adb5bd" p-id="33868"></path></svg>
            11421 å­—</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="32892" width="12" height="12"><path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z" p-id="32893" fill="#adb5bd"></path><path d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z" p-id="32894" fill="#adb5bd"></path></svg>
            23 åˆ†é’Ÿ</span><div class="container-ctgtag">
	<div class="taxonomy">
		
		<div class="ctg">
			
			
			<a href="/categories/"></a>
			
		</div>
		<div class="tag">
			
			 - 
			
			<a href="/tags/"></a>
			
		</div>
	</div>
</div>
    </div>
    
    <div class="toc">
        
        <div class="page-operation">
            <div><a href="#"><img src="/imgs/icons/arrow-up-circle.svg" alt=""></a></div>
            <div><a href="https://lovemjh.github.io/posts/project/20220528222829/"><img src="/imgs/icons/arrow-left-circle.svg" alt=""></a></div>
            <div><a href="https://lovemjh.github.io/posts/project/20220528231163/"><img src="/imgs/icons/arrow-right-circle.svg" alt=""></a></div>
        </div>
        
        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#å­¦ä¹ ç›®æ ‡">å­¦ä¹ ç›®æ ‡</a></li>
      </ul>
    </li>
    <li><a href="#1-æœåŠ¡ç½‘å…³gateway">1. æœåŠ¡ç½‘å…³Gateway</a>
      <ul>
        <li><a href="#11-å¿«é€Ÿå¼€å§‹">1.1. å¿«é€Ÿå¼€å§‹</a>
          <ul>
            <li><a href="#111-å¼•å…¥ä¾èµ–">1.1.1. å¼•å…¥ä¾èµ–</a></li>
            <li><a href="#112-ç¼–å†™è·¯ç”±è§„åˆ™">1.1.2. ç¼–å†™è·¯ç”±è§„åˆ™</a></li>
            <li><a href="#113-å¯åŠ¨æµ‹è¯•">1.1.3. å¯åŠ¨æµ‹è¯•</a></li>
          </ul>
        </li>
        <li><a href="#12-è·¯ç”±è§„åˆ™è¯¦è§£">1.2. è·¯ç”±è§„åˆ™è¯¦è§£</a>
          <ul>
            <li><a href="#121-æ–­è¨€å·¥å‚">1.2.1. æ–­è¨€å·¥å‚</a></li>
            <li><a href="#122-è¿‡æ»¤å™¨å·¥å‚">1.2.2. è¿‡æ»¤å™¨å·¥å‚</a></li>
          </ul>
        </li>
        <li><a href="#13-é¢å‘æœåŠ¡çš„è·¯ç”±">1.3. é¢å‘æœåŠ¡çš„è·¯ç”±</a>
          <ul>
            <li><a href="#131-æŠŠç½‘å…³æœåŠ¡æ³¨å†Œåˆ°nacos">1.3.1. æŠŠç½‘å…³æœåŠ¡æ³¨å†Œåˆ°nacos</a></li>
            <li><a href="#132-ä¿®æ”¹é…ç½®é€šè¿‡æœåŠ¡åè·¯ç”±">1.3.2. ä¿®æ”¹é…ç½®ï¼Œé€šè¿‡æœåŠ¡åè·¯ç”±</a></li>
          </ul>
        </li>
        <li><a href="#14-è·¯ç”±çš„javaä»£ç é…ç½®æ–¹å¼äº†è§£">1.4. è·¯ç”±çš„javaä»£ç é…ç½®æ–¹å¼ï¼ˆäº†è§£ï¼‰</a></li>
        <li><a href="#15-ç½‘å…³å…¨å±€è¿‡æ»¤äº†è§£">1.5. ç½‘å…³å…¨å±€è¿‡æ»¤ï¼ˆäº†è§£ï¼‰</a>
          <ul>
            <li><a href="#151-è¿‡æ»¤å™¨ç”Ÿå‘½å‘¨æœŸ">1.5.1 è¿‡æ»¤å™¨ç”Ÿå‘½å‘¨æœŸ</a></li>
            <li><a href="#152-åˆ›å»ºå…¨å±€è¿‡æ»¤å™¨">1.5.2 åˆ›å»ºå…¨å±€è¿‡æ»¤å™¨</a></li>
            <li><a href="#153-æµ‹è¯•å…¨å±€è¿‡æ»¤å™¨">1.5.3 æµ‹è¯•å…¨å±€è¿‡æ»¤å™¨</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#2-sentinel">2. Sentinel</a>
      <ul>
        <li><a href="#21æœåŠ¡é›ªå´©å®¹é”™æ–¹æ¡ˆ">2.1ã€æœåŠ¡é›ªå´©ã€å®¹é”™æ–¹æ¡ˆ</a>
          <ul>
            <li><a href="#211æœåŠ¡é›ªå´©">2.1.1ã€æœåŠ¡é›ªå´©</a></li>
            <li><a href="#212å®¹é”™æ–¹æ¡ˆ">2.1.2ã€å®¹é”™æ–¹æ¡ˆ</a>
              <ul>
                <li><a href="#1éš”ç¦»æ–¹æ¡ˆ">1ï¼‰éš”ç¦»æ–¹æ¡ˆ</a></li>
                <li><a href="#2è¶…æ—¶æ–¹æ¡ˆ">2ï¼‰è¶…æ—¶æ–¹æ¡ˆ</a></li>
                <li><a href="#3é™æµæ–¹æ¡ˆ">3ï¼‰é™æµæ–¹æ¡ˆ</a></li>
                <li><a href="#4ç†”æ–­æ–¹æ¡ˆ">4ï¼‰ç†”æ–­æ–¹æ¡ˆ</a></li>
                <li><a href="#5é™çº§æ–¹æ¡ˆ">5ï¼‰é™çº§æ–¹æ¡ˆ</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#22-sentinel-æ˜¯ä»€ä¹ˆ">2.2. Sentinel æ˜¯ä»€ä¹ˆï¼Ÿ</a></li>
        <li><a href="#23-åŸºæœ¬æ¦‚å¿µåŠä½œç”¨">2.3. åŸºæœ¬æ¦‚å¿µåŠä½œç”¨</a></li>
        <li><a href="#24-å¿«é€Ÿå¼€å§‹">2.4. å¿«é€Ÿå¼€å§‹</a>
          <ul>
            <li><a href="#241-æ­å»ºdashboardæ§åˆ¶å°">2.4.1. æ­å»ºDashboardæ§åˆ¶å°</a></li>
            <li><a href="#242-æ”¹é€ nacos-consumer">2.4.2. æ”¹é€ nacos-consumer</a></li>
          </ul>
        </li>
        <li><a href="#25-æ•´åˆfeignç»„ä»¶">2.5. æ•´åˆFeignç»„ä»¶</a></li>
        <li><a href="#26-æµé‡æ§åˆ¶">2.6. æµé‡æ§åˆ¶</a>
          <ul>
            <li><a href="#261-ä»€ä¹ˆæ˜¯æµé‡æ§åˆ¶">2.6.1. ä»€ä¹ˆæ˜¯æµé‡æ§åˆ¶</a></li>
            <li><a href="#262-qpsæµé‡æ§åˆ¶">2.6.2. QPSæµé‡æ§åˆ¶</a>
              <ul>
                <li><a href="#2621-ç›´æ¥æ‹’ç»">2.6.2.1. ç›´æ¥æ‹’ç»</a></li>
                <li><a href="#2622-warm-upé¢„çƒ­">2.6.2.2. Warm Upï¼ˆé¢„çƒ­ï¼‰</a></li>
                <li><a href="#2623-åŒ€é€Ÿæ’é˜Ÿ">2.6.2.3. åŒ€é€Ÿæ’é˜Ÿ</a></li>
              </ul>
            </li>
            <li><a href="#263-å…³è”é™æµ">2.6.3. å…³è”é™æµ</a></li>
            <li><a href="#264-é“¾è·¯é™æµ">2.6.4. é“¾è·¯é™æµ</a></li>
            <li><a href="#265-çº¿ç¨‹æ•°é™æµ">2.6.5. çº¿ç¨‹æ•°é™æµ</a></li>
          </ul>
        </li>
        <li><a href="#27-ç†”æ–­é™çº§">2.7. ç†”æ–­é™çº§</a>
          <ul>
            <li><a href="#271-å¹³å‡å“åº”æ—¶é—´rt">2.7.1. å¹³å‡å“åº”æ—¶é—´ï¼ˆRTï¼‰</a></li>
            <li><a href="#272-å¼‚å¸¸æ¯”ä¾‹">2.7.2. å¼‚å¸¸æ¯”ä¾‹</a></li>
            <li><a href="#273-å¼‚å¸¸æ•°">2.7.3. å¼‚å¸¸æ•°</a></li>
          </ul>
        </li>
        <li><a href="#28-è§„åˆ™æŒä¹…åŒ–">2.8. è§„åˆ™æŒä¹…åŒ–</a></li>
      </ul>
    </li>
    <li><a href="#3-sleuth">3. Sleuth</a>
      <ul>
        <li><a href="#31-zipkinåˆ†å¸ƒå¼ç›‘æ§å®¢æˆ·ç«¯">3.1. zipkinåˆ†å¸ƒå¼ç›‘æ§å®¢æˆ·ç«¯</a></li>
        <li><a href="#32-æ”¹é€ consumerproviderå·¥ç¨‹">3.2. æ”¹é€ consumer/providerå·¥ç¨‹</a></li>
        <li><a href="#33-åŸºæœ¬æ¦‚å¿µ">3.3. åŸºæœ¬æ¦‚å¿µ</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>

    <div class='content  content '>
        <h1 align = "center">ç¬¬2ç« </h1>
<h1 align = "center">æœåŠ¡ç½‘å…³ã€Sentinelã€Sleuth</h1>
<h3 align="center">ä¼˜å°±ä¸š.JAVAæ•™ç ”å®¤</h3>
<h2 id="å­¦ä¹ ç›®æ ‡">å­¦ä¹ ç›®æ ‡</h2>
<ul>
<li>äº†è§£ SpringCloudGateWay</li>
<li>ç†è§£ SpringCloudGateWayè·¯ç”±é…ç½®</li>
<li>ç†è§£SpringCloudGateWayå…¨å±€è¿‡æ»¤</li>
<li>ç†è§£Sentinelä»‹ç»</li>
<li>æŒæ¡Sentinelå¿«é€Ÿå¼€å§‹</li>
<li>æŒæ¡Sentinelæ•´åˆFeign</li>
<li>æŒæ¡Sentinelæµé‡æ§åˆ¶</li>
<li>æŒæ¡Sentinelç†”æ–­é™çº§</li>
<li>æŒæ¡Sentinelè§„åˆ™æŒä¹…åŒ–</li>
<li>æŒæ¡Slethä»‹ç»</li>
<li>æŒæ¡SlethåŸºæœ¬ä½¿ç”¨</li>
</ul>
<h1 id="1-æœåŠ¡ç½‘å…³gateway">1. æœåŠ¡ç½‘å…³Gateway</h1>
<p>API ç½‘å…³å‡ºç°çš„åŸå› æ˜¯å¾®æœåŠ¡æ¶æ„çš„å‡ºç°ï¼Œä¸åŒçš„å¾®æœåŠ¡ä¸€èˆ¬ä¼šæœ‰ä¸åŒçš„ç½‘ç»œåœ°å€ï¼Œè€Œå¤–éƒ¨å®¢æˆ·ç«¯å¯èƒ½éœ€è¦è°ƒç”¨å¤šä¸ªæœåŠ¡çš„æ¥å£æ‰èƒ½å®Œæˆä¸€ä¸ªä¸šåŠ¡éœ€æ±‚ï¼Œå¦‚æœè®©å®¢æˆ·ç«¯ç›´æ¥ä¸å„ä¸ªå¾®æœåŠ¡é€šä¿¡ï¼Œä¼šæœ‰ä»¥ä¸‹çš„é—®é¢˜ï¼š</p>
<ol>
<li>
<p>ç ´åäº†æœåŠ¡æ— çŠ¶æ€ç‰¹ç‚¹ã€‚</p>
<p>ä¸ºäº†ä¿è¯å¯¹å¤–æœåŠ¡çš„å®‰å…¨æ€§ï¼Œæˆ‘ä»¬éœ€è¦å®ç°å¯¹æœåŠ¡è®¿é—®çš„æƒé™æ§åˆ¶ï¼Œè€Œå¼€æ”¾æœåŠ¡çš„æƒé™æ§åˆ¶æœºåˆ¶å°†ä¼šè´¯ç©¿å¹¶æ±¡æŸ“æ•´ä¸ªå¼€æ”¾æœåŠ¡çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿™ä¼šå¸¦æ¥çš„æœ€ç›´æ¥é—®é¢˜æ˜¯ï¼Œç ´åäº†æœåŠ¡é›†ç¾¤ä¸­REST APIæ— çŠ¶æ€çš„ç‰¹ç‚¹ã€‚</p>
<pre><code> ä»å…·ä½“å¼€å‘å’Œæµ‹è¯•çš„è§’åº¦æ¥è¯´ï¼Œåœ¨å·¥ä½œä¸­é™¤äº†è¦è€ƒè™‘å®é™…çš„ä¸šåŠ¡é€»è¾‘ä¹‹å¤–ï¼Œè¿˜éœ€è¦é¢å¤–è€ƒè™‘å¯¹æ¥å£è®¿é—®çš„æ§åˆ¶å¤„ç†ã€‚
</code></pre>
</li>
<li>
<p>æ— æ³•ç›´æ¥å¤ç”¨æ—¢æœ‰æ¥å£ã€‚</p>
<p>å½“æˆ‘ä»¬éœ€è¦å¯¹ä¸€ä¸ªå³æœ‰çš„é›†ç¾¤å†…è®¿é—®æ¥å£ï¼Œå®ç°å¤–éƒ¨æœåŠ¡è®¿é—®æ—¶ï¼Œæˆ‘ä»¬ä¸å¾—ä¸é€šè¿‡åœ¨åŸæœ‰æ¥å£ä¸Šå¢åŠ æ ¡éªŒé€»è¾‘ï¼Œæˆ–å¢åŠ ä¸€ä¸ªä»£ç†è°ƒç”¨æ¥å®ç°æƒé™æ§åˆ¶ï¼Œæ— æ³•ç›´æ¥å¤ç”¨åŸæœ‰çš„æ¥å£ã€‚</p>
</li>
</ol>
<p>ä»¥ä¸Šè¿™äº›é—®é¢˜å¯ä»¥å€ŸåŠ© API ç½‘å…³è§£å†³ã€‚API ç½‘å…³æ˜¯ä»‹äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä¹‹é—´çš„ä¸­é—´å±‚ï¼Œæ‰€æœ‰çš„å¤–éƒ¨è¯·æ±‚éƒ½ä¼šå…ˆç»è¿‡ API ç½‘å…³è¿™ä¸€å±‚ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒAPI çš„å®ç°æ–¹é¢æ›´å¤šçš„è€ƒè™‘ä¸šåŠ¡é€»è¾‘ï¼Œè€Œå®‰å…¨ã€æ€§èƒ½ã€ç›‘æ§å¯ä»¥äº¤ç”± API ç½‘å…³æ¥åšï¼Œè¿™æ ·æ—¢æé«˜ä¸šåŠ¡çµæ´»æ€§åˆä¸ç¼ºå®‰å…¨æ€§ï¼Œå…¸å‹çš„æ¶æ„å›¾å¦‚å›¾æ‰€ç¤ºï¼š
<img src="/posts/project/20220528224436/image-20220528224632921.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="11-å¿«é€Ÿå¼€å§‹">1.1. å¿«é€Ÿå¼€å§‹</h2>
<p>åˆ›å»ºç½‘å…³moduleï¼š
<img src="/posts/project/20220528224436/image-20220528224643473.png"
    
    
    
    loading="lazy"
    
    
></p>
<p><img src="/posts/project/20220528224436/image-20220528224649999.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>å®Œæˆåï¼š
<img src="/posts/project/20220528224436/image-20220528224657590.png"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="111-å¼•å…¥ä¾èµ–">1.1.1. å¼•å…¥ä¾èµ–</h3>
<p>å·²å¼•å…¥ï¼Œå¦‚ä¸‹ã€‚pom.xmlä¸­çš„ä¾èµ–ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;dependencies&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>org.springframework.cloud<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>spring-cloud-starter-gateway<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>spring-boot-starter-test<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;scope&gt;</span>test<span style="color:#000080">&lt;/scope&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/dependencies&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;dependencyManagement&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependencies&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;groupId&gt;</span>org.springframework.cloud<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;artifactId&gt;</span>spring-cloud-dependencies<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;version&gt;</span>Hoxton.SR2<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;type&gt;</span>pom<span style="color:#000080">&lt;/type&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;scope&gt;</span>import<span style="color:#000080">&lt;/scope&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependencies&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/dependencyManagement&gt;</span>
</span></span></code></pre></div><h3 id="112-ç¼–å†™è·¯ç”±è§„åˆ™">1.1.2. ç¼–å†™è·¯ç”±è§„åˆ™</h3>
<p>ä¸ºäº†æ¼”ç¤ºè·¯ç”±åˆ°ä¸åŒæœåŠ¡ï¼Œè¿™é‡ŒæŠŠæ¶ˆè´¹è€…å’Œç”Ÿäº§è€…éƒ½é…ç½®åœ¨ç½‘å…³ä¸­</p>
<p>application.yml</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#000080">server</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">port</span>:<span style="color:#bbb"> </span><span style="color:#099">18090</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">spring</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">cloud</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">gateway</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">routes</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>- <span style="color:#000080">id</span>:<span style="color:#bbb"> </span>nacos-consumer<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">uri</span>:<span style="color:#bbb"> </span>http://127.0.0.1:18080<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">predicates</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- Path=/hi<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>- <span style="color:#000080">id</span>:<span style="color:#bbb"> </span>nacos-provider<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">uri</span>:<span style="color:#bbb"> </span>http://127.0.0.1:18070<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">predicates</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- Path=/hello<span style="color:#bbb">
</span></span></span></code></pre></div><h3 id="113-å¯åŠ¨æµ‹è¯•">1.1.3. å¯åŠ¨æµ‹è¯•</h3>
<p>é€šè¿‡ç½‘å…³è·¯å¾„è®¿é—®æ¶ˆè´¹è€…æˆ–è€…ç”Ÿäº§è€…ã€‚
<img src="/posts/project/20220528224436/image-20220528224708096.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="12-è·¯ç”±è§„åˆ™è¯¦è§£">1.2. è·¯ç”±è§„åˆ™è¯¦è§£</h2>
<p><img src="/posts/project/20220528224436/image-20220528224713415.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>åŸºæœ¬æ¦‚å¿µï¼š</p>
<ul>
<li><strong>Route</strong>ï¼šè·¯ç”±ç½‘å…³çš„åŸºæœ¬æ„å»ºå—ã€‚å®ƒç”±IDï¼Œç›®çš„URIï¼Œæ–­è¨€ï¼ˆPredicateï¼‰é›†åˆå’Œè¿‡æ»¤å™¨ï¼ˆfilterï¼‰é›†åˆç»„æˆã€‚å¦‚æœæ–­è¨€èšåˆä¸ºçœŸï¼Œåˆ™åŒ¹é…è¯¥è·¯ç”±ã€‚</li>
<li><strong>Predicate</strong>ï¼šè¿™æ˜¯ä¸€ä¸ª Java 8å‡½æ•°å¼æ–­è¨€ã€‚å…è®¸å¼€å‘äººå‘˜åŒ¹é…æ¥è‡ªHTTPè¯·æ±‚çš„ä»»ä½•å†…å®¹ï¼Œä¾‹å¦‚è¯·æ±‚å¤´æˆ–å‚æ•°ã€‚</li>
<li><strong>è¿‡æ»¤å™¨</strong>ï¼šå¯ä»¥åœ¨å‘é€ä¸‹æ¸¸è¯·æ±‚ä¹‹å‰æˆ–ä¹‹åä¿®æ”¹è¯·æ±‚å’Œå“åº”ã€‚</li>
</ul>
<p><strong>è·¯ç”±æ ¹æ®æ–­è¨€è¿›è¡ŒåŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸå°±ä¼šè½¬å‘è¯·æ±‚ç»™URIï¼Œåœ¨è½¬å‘è¯·æ±‚ä¹‹å‰æˆ–è€…ä¹‹åå¯ä»¥æ·»åŠ è¿‡æ»¤å™¨ã€‚</strong></p>
<h3 id="121-æ–­è¨€å·¥å‚">1.2.1. æ–­è¨€å·¥å‚</h3>
<p>Spring Cloud GatewayåŒ…å«è®¸å¤šå†…ç½®çš„Route Predicateå·¥å‚ã€‚æ‰€æœ‰è¿™äº›æ–­è¨€éƒ½åŒ¹é…HTTPè¯·æ±‚çš„ä¸åŒå±æ€§ã€‚å¤šè·¯ç”±æ–­è¨€å·¥å‚é€šè¿‡<code>and</code>ç»„åˆã€‚</p>
<p>å®˜æ–¹æä¾›çš„è·¯ç”±å·¥å‚ï¼š
<img src="/posts/project/20220528224436/image-20220528224720715.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>è¿™äº›æ–­è¨€å·¥å‚çš„é…ç½®æ–¹å¼ï¼Œå‚ç…§å®˜æ–¹æ–‡æ¡£ï¼šhttps://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.1.0.RELEASE/single/spring-cloud-gateway.html
<img src="/posts/project/20220528224436/image-20220528224727916.png"
    
    
    
    loading="lazy"
    
    
></p>
<p><img src="/posts/project/20220528224436/image-20220528224735481.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>è¿™é‡Œé‡ç‚¹æŒæ¡è¯·æ±‚è·¯å¾„è·¯ç”±æ–­è¨€çš„é…ç½®æ–¹å¼ï¼š
<img src="/posts/project/20220528224436/image-20220528224740985.png"
    
    
    
    loading="lazy"
    
    
></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#000080">spring</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">cloud</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">gateway</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">routes</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>- <span style="color:#000080">id</span>:<span style="color:#bbb"> </span>host_route<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#000080">uri</span>:<span style="color:#bbb"> </span>http://example.org<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#000080">predicates</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>- Path=/foo/{segment},/bar/{segment}<span style="color:#bbb">
</span></span></span></code></pre></div><p>è¿™ä¸ªè·¯ç”±åŒ¹é…ä»¥/fooæˆ–è€…/barå¼€å¤´çš„è·¯å¾„ï¼Œè½¬å‘åˆ°http:example.orgã€‚ä¾‹å¦‚ <code>/foo/1</code> or <code>/foo/bar</code> or <code>/bar/baz</code>.</p>
<p>/foo/1 &mdash;&mdash;&gt;è½¬å‘åœ°å€  <a class="link" href="/posts/project/http://example.org/foo/1"  target="_blank" rel="noopener"
    >http://example.org/foo/1</a></p>
<p>/foo/bar&mdash;&ndash;&gt;è½¬å‘åœ°å€ <a class="link" href="/posts/project/http://example.org/foo/bar"  target="_blank" rel="noopener"
    >http://example.org/foo/bar</a></p>
<h3 id="122-è¿‡æ»¤å™¨å·¥å‚">1.2.2. è¿‡æ»¤å™¨å·¥å‚</h3>
<p>è·¯ç”±è¿‡æ»¤å™¨å…è®¸ä»¥æŸç§æ–¹å¼ä¿®æ”¹ä¼ å…¥çš„HTTPè¯·æ±‚æˆ–ä¼ å‡ºçš„HTTPå“åº”ã€‚è·¯å¾„è¿‡æ»¤å™¨çš„èŒƒå›´é™å®šä¸ºç‰¹å®šè·¯ç”±ã€‚Spring Cloud GatewayåŒ…å«è®¸å¤šå†…ç½®çš„GatewayFilterå·¥å‚ã€‚
<img src="/posts/project/20220528224436/image-20220528224748329.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>è¿™äº›è¿‡æ»¤å™¨å·¥å‚çš„é…ç½®æ–¹å¼ï¼ŒåŒæ ·å‚ç…§å®˜æ–¹æ–‡æ¡£ï¼šhttps://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.1.0.RELEASE/single/spring-cloud-gateway.html
<img src="/posts/project/20220528224436/image-20220528224754825.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>è¿‡æ»¤å™¨ æœ‰ 20 å¤šä¸ª å®ç°ç±»,æ ¹æ®è¿‡æ»¤å™¨å·¥å‚çš„ç”¨é€”æ¥åˆ’åˆ†ï¼Œå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼šHeaderã€Parameterã€Pathã€Bodyã€Statusã€Sessionã€Redirectã€Retryã€RateLimiterå’ŒHystrix
<img src="/posts/project/20220528224436/image-20220528224800921.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>è¿™é‡Œé‡ç‚¹æŒæ¡PrefixPath GatewayFilter Factory
<img src="/posts/project/20220528224436/image-20220528224808553.png"
    
    
    
    loading="lazy"
    
    
></p>
<pre tabindex="0"><code>ä¸Šé¢çš„é…ç½®ä¸­ï¼Œæ‰€æœ‰çš„`/foo/**`å¼€å§‹çš„è·¯å¾„éƒ½ä¼šå‘½ä¸­é…ç½®çš„routerï¼Œå¹¶æ‰§è¡Œè¿‡æ»¤å™¨çš„é€»è¾‘ï¼Œåœ¨æœ¬æ¡ˆä¾‹ä¸­é…ç½®äº†RewritePathè¿‡æ»¤å™¨å·¥å‚ï¼Œæ­¤å·¥å‚å°†`/foo/(?.*)`é‡å†™ä¸º{segment}ï¼Œç„¶åè½¬å‘åˆ°http://example.orgã€‚æ¯”å¦‚åœ¨ç½‘é¡µä¸Šè¯·æ±‚localhost:8090/foo/forezpï¼Œæ­¤æ—¶ä¼šå°†è¯·æ±‚è½¬å‘åˆ°http://example.org/forezpçš„é¡µé¢

(?&lt;segment&gt;/?.*)ï¼šåŒ¹é… /ä»»æ„å­—ç¬¦ï¼Œæ­¤å¤„/å‡ºç°0æ¬¡æˆ–1æ¬¡ã€‚å°†åŒ¹é…åˆ°çš„ç»“æœæ•è·åˆ°åç§°ä¸ºsegmentçš„ç»„ä¸­
$\{segment}ï¼šå°† segmentæ‰€æ•è·åˆ°çš„æ–‡æœ¬ç½®æ¢åˆ°æ­¤å¤„ï¼Œæ³¨æ„ï¼Œ\çš„å‡ºç°æ˜¯ç”±äºé¿å…yamlè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå˜é‡ï¼Œåœ¨gatewayè¿›è¡Œè§£ææ—¶ï¼Œä¼šè¢«æ›¿æ¢ä¸º${segment}


â€‹		åœ¨å¼€å‘ä¸­ç”±äºæ‰€æœ‰å¾®æœåŠ¡çš„è®¿é—®éƒ½è¦ç»è¿‡ç½‘å…³ï¼Œä¸ºäº†åŒºåˆ†ä¸åŒçš„å¾®æœåŠ¡ï¼Œé€šå¸¸ä¼šåœ¨è·¯å¾„å‰åŠ ä¸Šä¸€ä¸ªæ ‡è¯†ï¼Œä¾‹å¦‚ï¼šè®¿é—®æœåŠ¡æä¾›æ–¹ï¼š`http://localhost:18090/provider/hello` ï¼›è®¿é—®æœåŠ¡æ¶ˆè´¹æ–¹ï¼š`http://localhost:18090/consumer/hi`  å¦‚æœä¸é‡å†™åœ°å€ï¼Œç›´æ¥è½¬å‘çš„è¯ï¼Œè½¬å‘åçš„è·¯å¾„ä¸ºï¼š`http://localhost:18070/provider/hello`å’Œ`http://localhost:18080/consumer/hi`æ˜æ˜¾å¤šäº†ä¸€ä¸ªprovideræˆ–è€…consumerï¼Œå¯¼è‡´è½¬å‘å¤±è´¥ã€‚
</code></pre><p>è¿™æ—¶ï¼Œæˆ‘ä»¬å°±ç”¨ä¸Šäº†è·¯å¾„é‡å†™ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">server</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">port</span>:<span style="color:#bbb"> </span><span style="color:#099">18090</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">spring</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">cloud</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">gateway</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">routes</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>- <span style="color:#000080">id</span>:<span style="color:#bbb"> </span>nacos-consumer<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">uri</span>:<span style="color:#bbb"> </span>http://127.0.0.1:18080<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">predicates</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- Path=/consumer/**<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">filters</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- RewritePath=/consumer/(?&lt;segment&gt;.*),/$\{segment}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>- <span style="color:#000080">id</span>:<span style="color:#bbb"> </span>nacos-provider<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">uri</span>:<span style="color:#bbb"> </span>http://127.0.0.1:18070<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">predicates</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- Path=/provider/**<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">filters</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- RewritePath=/provider/(?&lt;segment&gt;.*),/$\{segment}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">#           - StripPrefix=1</span><span style="color:#bbb">
</span></span></span></code></pre></div><p><strong>æ³¨æ„</strong>ï¼š<code>Path=/consumer/**</code>åŠ<code>Path=/provider/**</code>çš„å˜åŒ–</p>
<p>RewritePathå¯ä»¥å®ç°åŸæ¥çš„zuulçš„StripPrefixçš„æ•ˆæœï¼Œè€Œä¸”åŠŸèƒ½æ›´å¼ºå¤§!</p>
<p>æµ‹è¯•ï¼š
<img src="/posts/project/20220528224436/image-20220528224916919.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="13-é¢å‘æœåŠ¡çš„è·¯ç”±">1.3. é¢å‘æœåŠ¡çš„è·¯ç”±</h2>
<p><img src="/posts/project/20220528224436/image-20220528224923282.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>å¦‚æœè¦åšåˆ°è´Ÿè½½å‡è¡¡ï¼Œåˆ™å¿…é¡»æŠŠç½‘å…³å·¥ç¨‹æ³¨å†Œåˆ°nacosæ³¨å†Œä¸­å¿ƒï¼Œç„¶åé€šè¿‡æœåŠ¡åè®¿é—®ã€‚</p>
<h3 id="131-æŠŠç½‘å…³æœåŠ¡æ³¨å†Œåˆ°nacos">1.3.1. æŠŠç½‘å…³æœåŠ¡æ³¨å†Œåˆ°nacos</h3>
<ol>
<li>
<p>å¼•å…¥nacosçš„ç›¸å…³ä¾èµ–ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;groupId&gt;</span>com.alibaba.cloud<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- SpringCloudçš„ä¾èµ– --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;dependencyManagement&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependencies&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;groupId&gt;</span>org.springframework.cloud<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;artifactId&gt;</span>spring-cloud-dependencies<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;version&gt;</span>Hoxton.SR2<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;type&gt;</span>pom<span style="color:#000080">&lt;/type&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;scope&gt;</span>import<span style="color:#000080">&lt;/scope&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&lt;!-- åœ¨ä¾èµ–ç®¡ç†ä¸­åŠ å…¥springCloud-alibabaç»„ä»¶çš„ä¾èµ– --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;groupId&gt;</span>com.alibaba.cloud<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;artifactId&gt;</span>spring-cloud-alibaba-dependencies<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;version&gt;</span>2.2.0.RELEASE<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;type&gt;</span>pom<span style="color:#000080">&lt;/type&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;scope&gt;</span>import<span style="color:#000080">&lt;/scope&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependencies&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/dependencyManagement&gt;</span>
</span></span></code></pre></div></li>
<li>
<p>é…ç½®nacosæœåŠ¡åœ°å€åŠæœåŠ¡åï¼š
<img src="/posts/project/20220528224436/image-20220528224932309.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>application.ymlä¸­çš„é…ç½®ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">server</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">port</span>:<span style="color:#bbb"> </span><span style="color:#099">18090</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">spring</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">application</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>gateway<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">cloud</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">nacos</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">discovery</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#000080">server-addr</span>:<span style="color:#bbb"> </span><span style="color:#099">127.0.0.1</span>:<span style="color:#099">8848</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">gateway</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">routes</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>- <span style="color:#000080">id</span>:<span style="color:#bbb"> </span>nacos-consumer<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">uri</span>:<span style="color:#bbb"> </span>http://127.0.0.1:18080<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">predicates</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- Path=/consumer/**<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">filters</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- RewritePath=/consumer/(?&lt;segment&gt;.*),/$\{segment}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>- <span style="color:#000080">id</span>:<span style="color:#bbb"> </span>nacos-provider<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">uri</span>:<span style="color:#bbb"> </span>http://127.0.0.1:18070<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">predicates</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- Path=/provider/**<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">filters</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- RewritePath=/provider/(?&lt;segment&gt;.*),/$\{segment}<span style="color:#bbb">
</span></span></span></code></pre></div></li>
<li>
<p>æŠŠç½‘å…³æ³¨å…¥åˆ°nacos</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@SpringBootApplication</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@EnableDiscoveryClient</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">GatewayDemoApplication</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        SpringApplication<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">run</span><span style="color:#000;font-weight:bold">(</span>GatewayDemoApplication<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span> args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div></li>
</ol>
<h3 id="132-ä¿®æ”¹é…ç½®é€šè¿‡æœåŠ¡åè·¯ç”±">1.3.2. ä¿®æ”¹é…ç½®ï¼Œé€šè¿‡æœåŠ¡åè·¯ç”±</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">server</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">port</span>:<span style="color:#bbb"> </span><span style="color:#099">18090</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">spring</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">application</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>gateway<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">cloud</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">nacos</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">discovery</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#000080">server-addr</span>:<span style="color:#bbb"> </span><span style="color:#099">127.0.0.1</span>:<span style="color:#099">8848</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">gateway</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">routes</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>- <span style="color:#000080">id</span>:<span style="color:#bbb"> </span>nacos-consumer<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">uri</span>:<span style="color:#bbb"> </span>lb://nacos-consumer<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">predicates</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- Path=/consumer/**<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">filters</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- RewritePath=/consumer/(?&lt;segment&gt;.*),/$\{segment}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>- <span style="color:#000080">id</span>:<span style="color:#bbb"> </span>nacos-provider<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">uri</span>:<span style="color:#bbb"> </span>lb://nacos-provider<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">predicates</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- Path=/provider/**<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">filters</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- RewritePath=/provider/(?&lt;segment&gt;.*),/$\{segment}<span style="color:#bbb">
</span></span></span></code></pre></div><p>è¯­æ³•ï¼šlb://æœåŠ¡å</p>
<p>lbï¼šLoadBalanceï¼Œä»£è¡¨è´Ÿè½½å‡è¡¡çš„æ–¹å¼</p>
<p>æœåŠ¡åå–å†³äºnacosçš„æœåŠ¡åˆ—è¡¨ä¸­çš„æœåŠ¡å
<img src="/posts/project/20220528224436/image-20220528224944491.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="14-è·¯ç”±çš„javaä»£ç é…ç½®æ–¹å¼äº†è§£">1.4. è·¯ç”±çš„javaä»£ç é…ç½®æ–¹å¼ï¼ˆäº†è§£ï¼‰</h2>
<p>å‚è§å®˜æ–¹æ–‡æ¡£ï¼š</p>
<p><img src="/posts/project/20220528224436/image-20220528224953375.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">RouteLocatorConfig</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> RouteLocator <span style="color:#900;font-weight:bold">customRouteLocator</span><span style="color:#000;font-weight:bold">(</span>RouteLocatorBuilder builder<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> builder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">routes</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">route</span><span style="color:#000;font-weight:bold">(</span>r <span style="color:#000;font-weight:bold">-&gt;</span> r<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">path</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/api/hello/**&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>                             <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">filters</span><span style="color:#000;font-weight:bold">(</span>f <span style="color:#000;font-weight:bold">-&gt;</span> f<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">stripPrefix</span><span style="color:#000;font-weight:bold">(</span><span style="color:#099">1</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>                             <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">uri</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;lb://nacos-provider&#34;</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">route</span><span style="color:#000;font-weight:bold">(</span>r <span style="color:#000;font-weight:bold">-&gt;</span> r<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">path</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/ujiuye/hello/**&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">filters</span><span style="color:#000;font-weight:bold">(</span>f <span style="color:#000;font-weight:bold">-&gt;</span> f<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">rewritePath</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/ujiuye/(?&lt;segment&gt;.*)&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;/${segment}&#34;</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">uri</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;lb://nacos-provider&#34;</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">build</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="15-ç½‘å…³å…¨å±€è¿‡æ»¤äº†è§£">1.5. ç½‘å…³å…¨å±€è¿‡æ»¤ï¼ˆäº†è§£ï¼‰</h2>
<p>å…¨å±€è¿‡æ»¤å™¨ä½œç”¨äºæ‰€æœ‰çš„è·¯ç”±ï¼Œä¸éœ€è¦å•ç‹¬é…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥å®ç°å¾ˆå¤šç»Ÿä¸€åŒ–å¤„ç†çš„ä¸šåŠ¡éœ€æ±‚ï¼Œæ¯”å¦‚æƒé™è®¤è¯ï¼ŒIP è®¿é—®é™åˆ¶ç­‰ç­‰ã€‚</p>
<h3 id="151-è¿‡æ»¤å™¨ç”Ÿå‘½å‘¨æœŸ">1.5.1 è¿‡æ»¤å™¨ç”Ÿå‘½å‘¨æœŸ</h3>
<p><img src="/posts/project/20220528224436/0.webp"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="152-åˆ›å»ºå…¨å±€è¿‡æ»¤å™¨">1.5.2 åˆ›å»ºå…¨å±€è¿‡æ»¤å™¨</h3>
<p>å®ç° <code>GlobalFilter</code>, <code>Ordered</code> æ¥å£å¹¶åœ¨ç±»ä¸Šå¢åŠ  <code>@Component</code> æ³¨è§£å°±å¯ä»¥ä½¿ç”¨è¿‡æ»¤åŠŸèƒ½äº†ï¼Œéå¸¸ç®€å•æ–¹ä¾¿</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">package</span> <span style="color:#555">com.offcn.filter</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.fasterxml.jackson.core.JsonProcessingException</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.fasterxml.jackson.databind.ObjectMapper</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.google.common.collect.Maps</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.cloud.gateway.filter.GatewayFilterChain</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.cloud.gateway.filter.GlobalFilter</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.core.Ordered</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.core.io.buffer.DataBuffer</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.http.HttpStatus</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.http.server.reactive.ServerHttpResponse</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.stereotype.Component</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.web.server.ServerWebExchange</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">reactor.core.publisher.Mono</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.Map</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">AuthFilter</span> <span style="color:#000;font-weight:bold">implements</span> GlobalFilter<span style="color:#000;font-weight:bold">,</span> Ordered <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> Mono<span style="color:#000;font-weight:bold">&lt;</span>Void<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">filter</span><span style="color:#000;font-weight:bold">(</span>ServerWebExchange exchange<span style="color:#000;font-weight:bold">,</span> GatewayFilterChain chain<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        String token <span style="color:#000;font-weight:bold">=</span> exchange<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getRequest</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">getQueryParams</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">getFirst</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;token&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>token <span style="color:#000;font-weight:bold">==</span> <span style="color:#000;font-weight:bold">null</span> <span style="color:#000;font-weight:bold">||</span> token<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">isEmpty</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            ServerHttpResponse response <span style="color:#000;font-weight:bold">=</span> exchange<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getResponse</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">// å°è£…é”™è¯¯ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">&gt;</span> responseData <span style="color:#000;font-weight:bold">=</span> Maps<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">newHashMap</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            responseData<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;code&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#099">401</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            responseData<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;message&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;éæ³•è¯·æ±‚&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            responseData<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;cause&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;Token is empty&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">// å°†ä¿¡æ¯è½¬æ¢ä¸º JSON
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                ObjectMapper objectMapper <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> ObjectMapper<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>                <span style="color:#458;font-weight:bold">byte</span><span style="color:#000;font-weight:bold">[]</span> data <span style="color:#000;font-weight:bold">=</span> objectMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">writeValueAsBytes</span><span style="color:#000;font-weight:bold">(</span>responseData<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">// è¾“å‡ºé”™è¯¯ä¿¡æ¯åˆ°é¡µé¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                DataBuffer buffer <span style="color:#000;font-weight:bold">=</span> response<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">bufferFactory</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">wrap</span><span style="color:#000;font-weight:bold">(</span>data<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>                response<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setStatusCode</span><span style="color:#000;font-weight:bold">(</span>HttpStatus<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">UNAUTHORIZED</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>                response<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getHeaders</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Content-Type&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;application/json;charset=UTF-8&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">return</span> response<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">writeWith</span><span style="color:#000;font-weight:bold">(</span>Mono<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">just</span><span style="color:#000;font-weight:bold">(</span>buffer<span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>JsonProcessingException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> chain<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">filter</span><span style="color:#000;font-weight:bold">(</span>exchange<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">getOrder</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#099">1</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="153-æµ‹è¯•å…¨å±€è¿‡æ»¤å™¨">1.5.3 æµ‹è¯•å…¨å±€è¿‡æ»¤å™¨</h3>
<p>æµ‹è¯•è®¿é—®åœ°å€ï¼šhttp://localhost:18090/consumer/hi
<img src="/posts/project/20220528224436/image-20220528225107797.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>å¢åŠ tokenæµ‹è¯•è®¿é—®åœ°å€ï¼šhttp://localhost:18090/consumer/hi?token=aaaa
<img src="/posts/project/20220528224436/image-20220528225116000.png"
    
    
    
    loading="lazy"
    
    
></p>
<h1 id="2-sentinel">2. Sentinel</h1>
<p>åˆ†å¸ƒå¼ç³»ç»Ÿçš„æµé‡é˜²å«å…µ</p>
<h2 id="21æœåŠ¡é›ªå´©å®¹é”™æ–¹æ¡ˆ">2.1ã€æœåŠ¡é›ªå´©ã€å®¹é”™æ–¹æ¡ˆ</h2>
<p>åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´è®¸å¤šé—®é¢˜ï¼Œå…¶ä¸­æœåŠ¡é›ªå´©ã€å®¹é”™éƒ½æ˜¯å¸¸é—®åˆ°çš„é—®é¢˜ã€‚</p>
<hr>
<p>åˆ†å¸ƒå¼ä½“ç³»ç»“æ„ä¸­çš„åº”ç”¨ç¨‹åºæœ‰å¾ˆå¤šä¾èµ–å…³ç³»ï¼Œæ¯ä¸ªä¾èµ–å…³ç³»åœ¨æŸäº›æ—¶å€™å°†ä¸å¯é¿å…åœ°å¤±è´¥ã€‚</p>
<h3 id="211æœåŠ¡é›ªå´©">2.1.1ã€æœåŠ¡é›ªå´©</h3>
<p><img src="/posts/project/20220528224436/image-20220528225124876.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>å½“æœåŠ¡Açš„æµé‡çªç„¶å¢åŠ ï¼ŒæœåŠ¡Aæ‰›å¾—ä½è¯·æ±‚ï¼ŒæœåŠ¡Bå’ŒæœåŠ¡Cæœªå¿…èƒ½æ‰›å¾—ä½è¿™çªå‘çš„è¯·æ±‚ã€‚</p>
<p>å¦‚æœæœåŠ¡Cå› ä¸ºæŠ—ä¸ä½è¯·æ±‚ï¼Œå˜å¾—ä¸å¯ç”¨ã€‚é‚£ä¹ˆæœåŠ¡Bçš„è¯·æ±‚ä¹Ÿä¼šé˜»å¡ï¼Œæ…¢æ…¢è€—å°½æœåŠ¡Bçš„çº¿ç¨‹èµ„æºï¼ŒæœåŠ¡Bå°±ä¼šå˜å¾—ä¸å¯ç”¨ã€‚ç´§æ¥ç€ï¼ŒæœåŠ¡ Aä¹Ÿä¼šä¸å¯ç”¨
<img src="/posts/project/20220528224436/image-20220528225133321.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ä¸€ä¸ªæœåŠ¡å¤±è´¥ï¼Œå¯¼è‡´æ•´æ¡é“¾è·¯çš„æœåŠ¡éƒ½å¤±è´¥çš„æƒ…å½¢ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<strong>æœåŠ¡é›ªå´©</strong></p>
<p>å¯¹äºé«˜æµé‡çš„åº”ç”¨æ¥è¯´ï¼Œå•ä¸€çš„åç«¯ä¾èµ–å¯èƒ½ä¼šå¯¼è‡´æ‰€æœ‰æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰èµ„æºéƒ½åœ¨å‡ ç§’é’Ÿå†…é¥±å’Œï¼Œä¸ºäº†å¯¹æ•…éšœå’Œå»¶è¿Ÿè¿›è¡Œéš”ç¦»å’Œç®¡ç†ï¼Œä»¥ä¾¿å•ä¸ªä¾èµ–å…³ç³»çš„å¤±è´¥ï¼Œä¸èƒ½å–æ¶ˆæ•´ä¸ªåº”ç”¨ç¨‹åºæˆ–ç³»ç»Ÿã€‚</p>
<h3 id="212å®¹é”™æ–¹æ¡ˆ">2.1.2ã€å®¹é”™æ–¹æ¡ˆ</h3>
<p>æƒ³è¦é˜²æ­¢é›ªå´©çš„æ‰©æ•£ï¼Œå°±è¦åšå¥½æœåŠ¡çš„å®¹é”™ï¼Œå®¹é”™è¯´ç™½äº†å°±æ˜¯ä¿æŠ¤è‡ªå·±ä¸è¢«å…¶ä»–é˜Ÿå‹å‘ï¼é‚£æˆ‘ä»¬æœ‰å“ªäº›å®¹é”™çš„æ€è·¯å‘¢ï¼Ÿ</p>
<h4 id="1éš”ç¦»æ–¹æ¡ˆ">1ï¼‰éš”ç¦»æ–¹æ¡ˆ</h4>
<p>å®ƒæ˜¯æŒ‡å°†ç³»ç»ŸæŒ‰ç…§ä¸€å®šçš„åŸåˆ™åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªæœåŠ¡æ¨¡å—ï¼Œå„ä¸ªæ¨¡å—ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œæ— å¼ºä¾èµ–ã€‚å½“æœ‰æ•…éšœå‘ç”Ÿæ—¶ï¼Œèƒ½å°†é—®é¢˜å’Œå½±å“éš”ç¦»åœ¨æŸä¸ªæ¨¡å—å†…éƒ¨ï¼Œè€Œä¸æ‰©æ•£é£é™©ï¼Œä¸æ¶‰åŠå…¶ä»–æ¨¡å—ï¼Œä¸å½±å“æ•´ä½“çš„ç³»ç»ŸæœåŠ¡ã€‚å¸¸è§çš„éš”ç¦»æ–¹å¼æœ‰ï¼š<strong>çº¿ç¨‹éš”ç¦»</strong> å’Œä¿¡å·é‡éš”ç¦»ï¼š</p>
<p><img src="/posts/project/20220528224436/image-20220528225146200.png"
    
    
    
    loading="lazy"
    
    
></p>
<h4 id="2è¶…æ—¶æ–¹æ¡ˆ">2ï¼‰è¶…æ—¶æ–¹æ¡ˆ</h4>
<p>åœ¨ä¸Šæ¸¸æœåŠ¡è°ƒç”¨ä¸‹æ¸¸æœåŠ¡çš„æ—¶å€™ï¼Œè®¾ç½®ä¸€ä¸ªæœ€å¤§å“åº”æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´ä¸‹æ¸¸æœåŠ¡è¿˜æ²¡å“åº”ï¼Œé‚£ä¹ˆå°±æ–­å¼€è¿æ¥ï¼Œé‡Šæ”¾æ‰çº¿ç¨‹</p>
<p><img src="/posts/project/20220528224436/image-20220528225155959.png"
    
    
    
    loading="lazy"
    
    
></p>
<h4 id="3é™æµæ–¹æ¡ˆ">3ï¼‰é™æµæ–¹æ¡ˆ</h4>
<p>é™æµå°±æ˜¯é™åˆ¶ç³»ç»Ÿçš„è¾“å…¥å’Œè¾“å‡ºæµé‡å·²è¾¾åˆ°ä¿æŠ¤ç³»ç»Ÿçš„ç›®çš„ã€‚ä¸ºäº†ä¿è¯ç³»ç»Ÿçš„ç¨³å›ºè¿è¡Œï¼Œä¸€æ—¦è¾¾åˆ°éœ€è¦é™åˆ¶çš„é˜ˆå€¼ï¼Œå°±éœ€è¦é™åˆ¶æµé‡å¹¶é‡‡ç”¨å°‘é‡æªæ–½å®Œæˆé™åˆ¶æµé‡çš„ç›®çš„</p>
<p><img src="/posts/project/20220528224436/image-20220528225206798.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>é™æµç­–ç•¥æœ‰å¾ˆå¤šï¼šç¨åæˆ‘ä»¬è¯¦ç»†ä»‹ç»ï¼</p>
<h4 id="4ç†”æ–­æ–¹æ¡ˆ">4ï¼‰ç†”æ–­æ–¹æ¡ˆ</h4>
<p>åœ¨äº’è”ç½‘ç³»ç»Ÿä¸­ï¼Œå½“ä¸‹æ¸¸æœåŠ¡å› è®¿é—®å‹åŠ›è¿‡å¤§è€Œç›¸åº”å˜æ…¢æˆ–å¤±è´¥çš„æ—¶å€™ï¼Œä¸Šæ¸¸æœåŠ¡ä¸ºäº†ä¿æŠ¤ç³»ç»Ÿæ•´ä½“çš„å¯ç”¨æ€§ï¼Œå¯ä»¥æš‚æ—¶åˆ‡æ–­å¯¹ä¸‹æ¸¸æœåŠ¡çš„è°ƒç”¨ã€‚è¿™ç§ç‰ºç‰²å±€éƒ¨ï¼Œä¿å…¨æ•´ä½“çš„æªæ–½å°±å«åšç†”æ–­</p>
<p><img src="/posts/project/20220528224436/image-20220528225217730.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>å…¶ä¸­ç†”æ–­æœ‰åˆ†ä¸ºä¸‰ç§çŠ¶æ€ï¼š</p>
<ul>
<li>ç†”æ–­å…³é—­çŠ¶æ€ï¼ˆClosedï¼‰</li>
</ul>
<p>æœåŠ¡æ²¡æœ‰æ•…éšœæ—¶ï¼Œç†”æ–­å™¨æ‰€å¤„çš„çŠ¶æ€ï¼Œå¯¹è°ƒç”¨æ–¹çš„è°ƒç”¨ä¸åšä»»ä½•é™åˆ¶</p>
<ul>
<li>ç†”æ–­å¼€å¯çŠ¶æ€ï¼ˆOpenï¼‰</li>
</ul>
<p>åç»­å¯¹è¯¥æœåŠ¡æ¥å£çš„è°ƒç”¨ä¸å†ç»è¿‡ç½‘ç»œï¼Œç›´æ¥æ‰§è¡Œæœ¬åœ°çš„ <strong>fallback</strong> æ–¹æ³•</p>
<ul>
<li>åŠç†”æ–­çŠ¶æ€ï¼ˆHalf-Openï¼‰</li>
</ul>
<p>å°è¯•æ¢å¤æœåŠ¡è°ƒç”¨ï¼Œå…è®¸æœ‰é™çš„æµé‡è°ƒç”¨è¯¥æœåŠ¡ï¼Œå¹¶ç›‘æ§æˆåŠŸç‡ã€‚å¦‚æœæˆåŠŸç‡è¾¾åˆ°é¢„æœŸï¼Œåˆ™è¯´æ˜æœåŠ¡å·²ç»æ¢å¤ï¼Œè¿›å…¥ç†”æ–­å…³é—­çŠ¶æ€ï¼›å¦‚æœæˆåŠŸç‡ä¾ç„¶å¾ˆä½ï¼Œåˆ™é‡æ–°è¿›å…¥ç†”æ–­å…³é—­çŠ¶æ€</p>
<h4 id="5é™çº§æ–¹æ¡ˆ">5ï¼‰é™çº§æ–¹æ¡ˆ</h4>
<p>é™çº§å…¶å®å°±æ˜¯ä¸ºæœåŠ¡æä¾›ä¸€ä¸ª <strong>Bè®¡åˆ’</strong>ï¼Œä¸€æ—¦æœåŠ¡æ— æ³•æ­£å¸¸ï¼Œå°±å¯ç”¨ <strong>Bè®¡åˆ’</strong></p>
<p><img src="/posts/project/20220528224436/image-20220528225254214.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>æ–¹æ¡ˆå…¶å®æœ‰å¾ˆå¤šï¼Œä½†æ˜¯å¾ˆéš¾è¯´æ˜é‚£ç§æ–¹æ¡ˆæ˜¯æœ€å¥½çš„ã€‚åœ¨å¼€å‘è€…çš„ä¸–ç•Œä¸­ï¼Œæ²¡æœ‰æœ€å¥½ï¼Œåªæœ‰æœ€é€‚åˆã€‚é‚£å¦‚æœè‡ªå·±å†™ä¸€ä¸ªå®¹é”™æ–¹æ¡ˆå¾€å¾€æ˜¯æ¯”è¾ƒå®¹æ˜“å‡ºé”™çš„ï¼ˆåŠŸåŠ›é«˜æ·±è€…é™¤å¤–ï¼‰ï¼Œé‚£ä¹ˆä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¸å¦¨ç”¨ç¬¬ä¸‰æ–¹å·²ç»ä¸ºæˆ‘å®ç°å¥½çš„ç»„ä»¶ï¼</p>
<h2 id="22-sentinel-æ˜¯ä»€ä¹ˆ">2.2. Sentinel æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>éšç€å¾®æœåŠ¡çš„æµè¡Œï¼ŒæœåŠ¡å’ŒæœåŠ¡ä¹‹é—´çš„ç¨³å®šæ€§å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚Sentinel ä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰å¤šä¸ªç»´åº¦ä¿æŠ¤æœåŠ¡çš„ç¨³å®šæ€§ã€‚</p>
<p>Sentinel çš„å†å²ï¼š</p>
<ul>
<li>2012 å¹´ï¼ŒSentinel è¯ç”Ÿï¼Œä¸»è¦åŠŸèƒ½ä¸ºå…¥å£æµé‡æ§åˆ¶ã€‚</li>
<li>2013-2017 å¹´ï¼ŒSentinel åœ¨é˜¿é‡Œå·´å·´é›†å›¢å†…éƒ¨è¿…é€Ÿå‘å±•ï¼Œæˆä¸ºåŸºç¡€æŠ€æœ¯æ¨¡å—ï¼Œè¦†ç›–äº†æ‰€æœ‰çš„æ ¸å¿ƒåœºæ™¯ã€‚Sentinel ä¹Ÿå› æ­¤ç§¯ç´¯äº†å¤§é‡çš„æµé‡å½’æ•´åœºæ™¯ä»¥åŠç”Ÿäº§å®è·µã€‚</li>
<li>2018 å¹´ï¼ŒSentinel å¼€æºï¼Œå¹¶æŒç»­æ¼”è¿›ã€‚</li>
<li>2019 å¹´ï¼ŒSentinel æœç€å¤šè¯­è¨€æ‰©å±•çš„æ–¹å‘ä¸æ–­æ¢ç´¢ï¼Œæ¨å‡º C++ åŸç”Ÿç‰ˆæœ¬ï¼ŒåŒæ—¶é’ˆå¯¹ Service Mesh åœºæ™¯ä¹Ÿæ¨å‡ºäº† Envoy é›†ç¾¤æµé‡æ§åˆ¶æ”¯æŒï¼Œä»¥è§£å†³ Service Mesh æ¶æ„ä¸‹å¤šè¯­è¨€é™æµçš„é—®é¢˜ã€‚</li>
<li>2020 å¹´ï¼Œæ¨å‡º Sentinel Go ç‰ˆæœ¬ï¼Œç»§ç»­æœç€äº‘åŸç”Ÿæ–¹å‘æ¼”è¿›ã€‚</li>
</ul>
<p>Sentinel åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†:</p>
<ul>
<li>æ ¸å¿ƒåº“ï¼ˆJava å®¢æˆ·ç«¯ï¼‰ä¸ä¾èµ–ä»»ä½•æ¡†æ¶/åº“ï¼Œèƒ½å¤Ÿè¿è¡Œäºæ‰€æœ‰ Java è¿è¡Œæ—¶ç¯å¢ƒï¼ŒåŒæ—¶å¯¹ Dubbo / Spring Cloud ç­‰æ¡†æ¶ä¹Ÿæœ‰è¾ƒå¥½çš„æ”¯æŒã€‚</li>
<li>æ§åˆ¶å°ï¼ˆDashboardï¼‰åŸºäº Spring Boot å¼€å‘ï¼Œæ‰“åŒ…åå¯ä»¥ç›´æ¥è¿è¡Œï¼Œä¸éœ€è¦é¢å¤–çš„ Tomcat ç­‰åº”ç”¨å®¹å™¨ã€‚</li>
</ul>
<p>Sentinel å¯ä»¥ç®€å•çš„åˆ†ä¸º Sentinel æ ¸å¿ƒåº“å’Œ Dashboardã€‚æ ¸å¿ƒåº“ä¸ä¾èµ– Dashboardï¼Œä½†æ˜¯ç»“åˆ Dashboard å¯ä»¥å–å¾—æœ€å¥½çš„æ•ˆæœã€‚</p>
<h2 id="23-åŸºæœ¬æ¦‚å¿µåŠä½œç”¨">2.3. åŸºæœ¬æ¦‚å¿µåŠä½œç”¨</h2>
<p>åŸºæœ¬æ¦‚å¿µï¼š</p>
<p><strong>èµ„æº</strong>ï¼šæ˜¯ Sentinel çš„å…³é”®æ¦‚å¿µã€‚å®ƒå¯ä»¥æ˜¯ Java åº”ç”¨ç¨‹åºä¸­çš„ä»»ä½•å†…å®¹ï¼Œä¾‹å¦‚ï¼Œç”±åº”ç”¨ç¨‹åºæä¾›çš„æœåŠ¡ï¼Œæˆ–ç”±åº”ç”¨ç¨‹åºè°ƒç”¨çš„å…¶å®ƒåº”ç”¨æä¾›çš„æœåŠ¡ï¼Œç”šè‡³å¯ä»¥æ˜¯ä¸€æ®µä»£ç ã€‚åœ¨æ¥ä¸‹æ¥çš„æ–‡æ¡£ä¸­ï¼Œæˆ‘ä»¬éƒ½ä¼šç”¨èµ„æºæ¥æè¿°ä»£ç å—ã€‚</p>
<p>åªè¦é€šè¿‡ Sentinel API å®šä¹‰çš„ä»£ç ï¼Œå°±æ˜¯èµ„æºï¼Œèƒ½å¤Ÿè¢« Sentinel ä¿æŠ¤èµ·æ¥ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨æ–¹æ³•ç­¾åï¼ŒURLï¼Œç”šè‡³æœåŠ¡åç§°ä½œä¸ºèµ„æºåæ¥æ ‡ç¤ºèµ„æºã€‚</p>
<p><strong>è§„åˆ™</strong>ï¼šå›´ç»•èµ„æºçš„å®æ—¶çŠ¶æ€è®¾å®šçš„è§„åˆ™ï¼Œå¯ä»¥åŒ…æ‹¬æµé‡æ§åˆ¶è§„åˆ™ã€ç†”æ–­é™çº§è§„åˆ™ä»¥åŠç³»ç»Ÿä¿æŠ¤è§„åˆ™ã€‚æ‰€æœ‰è§„åˆ™å¯ä»¥åŠ¨æ€å®æ—¶è°ƒæ•´ã€‚</p>
<p>ä¸»è¦ä½œç”¨ï¼š</p>
<ol>
<li>æµé‡æ§åˆ¶</li>
<li>ç†”æ–­é™çº§</li>
<li>ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤</li>
</ol>
<p>æˆ‘ä»¬è¯´çš„èµ„æºï¼Œå¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ï¼ŒæœåŠ¡ï¼ŒæœåŠ¡é‡Œçš„æ–¹æ³•ï¼Œç”šè‡³æ˜¯ä¸€æ®µä»£ç ã€‚ä½¿ç”¨ Sentinel æ¥è¿›è¡Œèµ„æºä¿æŠ¤ï¼Œä¸»è¦åˆ†ä¸ºå‡ ä¸ªæ­¥éª¤:</p>
<ol>
<li>å®šä¹‰èµ„æº</li>
<li>å®šä¹‰è§„åˆ™</li>
<li>æ£€éªŒè§„åˆ™æ˜¯å¦ç”Ÿæ•ˆ</li>
</ol>
<p>å…ˆæŠŠå¯èƒ½éœ€è¦ä¿æŠ¤çš„èµ„æºå®šä¹‰å¥½ï¼Œä¹‹åå†é…ç½®è§„åˆ™ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸ºï¼Œåªè¦æœ‰äº†èµ„æºï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ä»»ä½•æ—¶å€™çµæ´»åœ°å®šä¹‰å„ç§æµé‡æ§åˆ¶è§„åˆ™ã€‚åœ¨ç¼–ç çš„æ—¶å€™ï¼Œåªéœ€è¦è€ƒè™‘è¿™ä¸ªä»£ç æ˜¯å¦éœ€è¦ä¿æŠ¤ï¼Œå¦‚æœéœ€è¦ä¿æŠ¤ï¼Œå°±å°†ä¹‹å®šä¹‰ä¸ºä¸€ä¸ªèµ„æºã€‚</p>
<h2 id="24-å¿«é€Ÿå¼€å§‹">2.4. å¿«é€Ÿå¼€å§‹</h2>
<p>å®˜æ–¹æ–‡æ¡£ï¼šhttps://github.com/alibaba/spring-cloud-alibaba/wiki/Sentinel</p>
<h3 id="241-æ­å»ºdashboardæ§åˆ¶å°">2.4.1. æ­å»ºDashboardæ§åˆ¶å°</h3>
<p>æ‚¨å¯ä»¥ä» release é¡µé¢ ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„æ§åˆ¶å° jar åŒ…ã€‚</p>
<p><a class="link" href="/posts/project/https://github.com/alibaba/Sentinel/releases"  target="_blank" rel="noopener"
    >https://github.com/alibaba/Sentinel/releases</a></p>
<p>ä¸‹è½½çš„jaråŒ…ï¼ˆè¯¾å‰èµ„æ–™å·²ä¸‹å‘ï¼‰ï¼Œcopyåˆ°ä¸€ä¸ªæ²¡æœ‰ç©ºæ ¼æˆ–è€…ä¸­æ–‡çš„è·¯å¾„ä¸‹ï¼Œæ‰“å¼€dosçª—å£åˆ‡æ¢åˆ°jaråŒ…æ‰€åœ¨ç›®å½•ã€‚</p>
<p>æ‰§è¡Œï¼šjava -jar sentinel-dashboard-xxx.jar</p>
<p><img src="/posts/project/20220528224436/image-20220528225321956.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>åœ¨æµè§ˆå™¨ä¸­è®¿é—®sentinelæ§åˆ¶å°ï¼Œé»˜è®¤ç«¯å£å·æ˜¯8080ã€‚</p>
<p>è¿›å…¥ç™»å½•é¡µé¢(http://localhost:8080/#/dashboard)ï¼Œ</p>
<p>ç®¡ç†é¡µé¢ç”¨æˆ·åå’Œå¯†ç ï¼šsentinel/sentinel</p>
<p><img src="/posts/project/20220528224436/image-20220528225412388.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>æ­¤æ—¶é¡µé¢ä¸ºç©ºï¼Œè¿™æ˜¯å› ä¸ºè¿˜æ²¡æœ‰ç›‘æ§ä»»ä½•æœåŠ¡ã€‚å¦å¤–ï¼Œsentinelæ˜¯æ‡’åŠ è½½çš„ï¼Œå¦‚æœæœåŠ¡æ²¡æœ‰è¢«è®¿é—®ï¼Œä¹Ÿçœ‹ä¸åˆ°è¯¥æœåŠ¡ä¿¡æ¯ã€‚</p>
<h3 id="242-æ”¹é€ nacos-consumer">2.4.2. æ”¹é€ nacos-consumer</h3>
<ol>
<li>å¼•å…¥ sentinel ä¾èµ–</li>
</ol>
<p>ä½¿ç”¨ group ID ä¸º <code>com.alibaba.cloud</code> å’Œ artifact ID ä¸º <code>spring-cloud-starter-alibaba-sentinel</code> çš„ starterã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;groupId&gt;</span>com.alibaba.cloud<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-sentinel<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start="2">
<li>åœ¨application.ymlä¸­æ·»åŠ é…ç½®</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#008080">spring</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008080">cloud</span><span style="color:#000;font-weight:bold">:</span>    
</span></span><span style="display:flex;"><span>    <span style="color:#008080">sentinel</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#008080">transport</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#008080">dashboard</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">192.168.188.138:8080</span>
</span></span><span style="display:flex;"><span>        <span style="color:#008080">port</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">8719</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># æš´éœ²/actuator/sentinelç«¯ç‚¹</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">management</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008080">endpoints</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">web</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#008080">exposure</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#008080">include</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;*&#39;        </span>
</span></span></code></pre></div><p>æ³¨æ„ï¼šå¿…é¡»æš´éœ² /actuator/sentinelç«¯ç‚¹ï¼›ï¼ˆhttp://localhost:8000/actuator/sentinelï¼‰</p>
<p>é‡å¯nacos-consumerå·¥ç¨‹ï¼Œåœ¨æµè§ˆå™¨ä¸­åå¤è®¿é—®ï¼šhttp://localhost:18080/hi</p>
<p>å†æ¬¡æŸ¥çœ‹sentinelæ§åˆ¶å°é¡µé¢ï¼š</p>
<p><img src="/posts/project/20220528224436/image-20220528225446243.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>äº†è§£ä¸€ä¸‹æ§åˆ¶å°çš„ä½¿ç”¨åŸç†ï¼š</p>
<p><img src="/posts/project/20220528224436/image-20220528225459655.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>å½“ Sentinelåº”ç”¨å¯åŠ¨åï¼Œæˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬çš„å¾®æœåŠ¡ç¨‹åºæ³¨å†Œåˆ°æ§åˆ¶å°ä¸Šï¼Œä¹Ÿå°±æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šæ§åˆ¶å°çš„åœ°å€ï¼Œè¿™ä¸ªæ˜¯è‚¯å®šçš„ã€‚ä½†æ˜¯æ‰€è°“ç”¨æ¥è·Ÿæ§åˆ¶å°äº¤æµçš„ç«¯å£ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ¯ä¸ªæœåŠ¡éƒ½ä¼šé€šè¿‡è¿™ä¸ªç«¯å£è·Ÿæ§åˆ¶å°ä¼ é€’æ•°æ®ï¼Œæ§åˆ¶å°ä¹Ÿå¯ä»¥é€šè¿‡æ­¤ç«¯å£è°ƒç”¨å¾®æœåŠ¡ä¸­çš„ç›‘æ§ç¨‹åºæ¥è·å–å¾®æœåŠ¡çš„å„ç§ä¿¡æ¯ã€‚</p>
<h2 id="25-æ•´åˆfeignç»„ä»¶">2.5. æ•´åˆFeignç»„ä»¶</h2>
<p>Sentinel é€‚é…äº† Feign ç»„ä»¶ã€‚ä½¿ç”¨åˆ†ä¸‰æ­¥ï¼š</p>
<ol>
<li>å¼•å…¥ä¾èµ–ï¼š</li>
</ol>
<p>å¼•å…¥feignåŠsentinelçš„ä¾èµ–</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;groupId&gt;</span>com.alibaba.cloud<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-sentinel<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;groupId&gt;</span>org.springframework.cloud<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;artifactId&gt;</span>spring-cloud-starter-openfeign<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>æ³¨æ„ï¼šspringCloudçš„ç‰ˆæœ¬å…¼å®¹é—®é¢˜ä½¿ç”¨çš„æ˜¯Hoxton.SR2  å…¼å®¹çš„cloud alibabaç‰ˆæœ¬æ˜¯:2.2.0.RELEASE</p>
<p>æ³¨æ„:spring-cloud-starter-openfeign  2.2.6RELEASE æœ€é«˜ä¸èƒ½è¶…è¿‡</p>
<ol>
<li>å¼€å¯sentinelç›‘æ§åŠŸèƒ½</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#000080">feign</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">sentinel</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">enabled</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">
</span></span></span></code></pre></div><ol start="3">
<li>ä»£ç å®ç°
<img src="/posts/project/20220528224436/image-20220528225705379.png"
    
    
    
    loading="lazy"
    
    
></li>
</ol>
<p>æ·»åŠ feignæ¥å£çš„ç†”æ–­ç±»ProviderFallbackï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">ProviderFallback</span> <span style="color:#000;font-weight:bold">implements</span> ProviderClient <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> String <span style="color:#900;font-weight:bold">hello</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">&#34;ç°åœ¨æœåŠ¡å™¨å¿™ï¼Œè¯·ç¨åå†è¯•ï¼&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>åœ¨feignæ¥å£ProviderClientä¸­æŒ‡å®šç†”æ–­ç±»ï¼š
<img src="/posts/project/20220528224436/image-20220528225722495.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>æµ‹è¯•ä¹‹å‰ï¼Œå…ˆåœ¨æœåŠ¡æä¾›æ–¹çš„controlleræ–¹æ³•ä¸­æ·»åŠ å¼‚å¸¸ï¼š
<img src="/posts/project/20220528224436/image-20220528225736337.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>å†é‡å¯nacos-providerå’Œnacos-consumeræœåŠ¡ã€‚åœ¨æµè§ˆå™¨ä¸­åœ°å€æ è®¿é—®æ¶ˆè´¹æ–¹æµ‹è¯•ï¼š
<img src="/posts/project/20220528224436/image-20220528225744021.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="26-æµé‡æ§åˆ¶">2.6. æµé‡æ§åˆ¶</h2>
<h3 id="261-ä»€ä¹ˆæ˜¯æµé‡æ§åˆ¶">2.6.1. ä»€ä¹ˆæ˜¯æµé‡æ§åˆ¶</h3>
<p>æµé‡æ§åˆ¶åœ¨ç½‘ç»œä¼ è¾“ä¸­æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„æ¦‚å¿µï¼Œå®ƒç”¨äºè°ƒæ•´ç½‘ç»œåŒ…çš„å‘é€æ•°æ®ã€‚ç„¶è€Œï¼Œä»ç³»ç»Ÿç¨³å®šæ€§è§’åº¦è€ƒè™‘ï¼Œåœ¨å¤„ç†è¯·æ±‚çš„é€Ÿåº¦ä¸Šï¼Œä¹Ÿæœ‰éå¸¸å¤šçš„è®²ç©¶ã€‚ä»»æ„æ—¶é—´åˆ°æ¥çš„è¯·æ±‚å¾€å¾€æ˜¯éšæœºä¸å¯æ§çš„ï¼Œè€Œç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›æ˜¯æœ‰é™çš„ã€‚æˆ‘ä»¬éœ€è¦æ ¹æ®ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›å¯¹æµé‡è¿›è¡Œæ§åˆ¶ã€‚Sentinel ä½œä¸ºä¸€ä¸ªè°ƒé…å™¨ï¼Œå¯ä»¥æ ¹æ®éœ€è¦æŠŠéšæœºçš„è¯·æ±‚è°ƒæ•´æˆåˆé€‚çš„å½¢çŠ¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="/posts/project/20220528224436/limitflow.gif"
    
    
    
    loading="lazy"
    
    
>
æµé‡æ§åˆ¶æœ‰ä»¥ä¸‹å‡ ä¸ªè§’åº¦:</p>
<ul>
<li>èµ„æºçš„è°ƒç”¨å…³ç³»ï¼Œä¾‹å¦‚èµ„æºçš„è°ƒç”¨é“¾è·¯ï¼Œèµ„æºå’Œèµ„æºä¹‹é—´çš„å…³ç³»ï¼›</li>
<li>è¿è¡ŒæŒ‡æ ‡ï¼Œä¾‹å¦‚ QPSã€çº¿ç¨‹æ•°ç­‰ï¼›</li>
<li>æ§åˆ¶çš„æ•ˆæœï¼Œä¾‹å¦‚ç›´æ¥é™æµï¼ˆå¿«é€Ÿå¤±è´¥ï¼‰ã€å†·å¯åŠ¨ï¼ˆWarm Upï¼‰ã€åŒ€é€Ÿæ’é˜Ÿï¼ˆæ’é˜Ÿç­‰å¾…ï¼‰ç­‰ã€‚</li>
</ul>
<p>Sentinel çš„è®¾è®¡ç†å¿µæ˜¯è®©æ‚¨è‡ªç”±é€‰æ‹©æ§åˆ¶çš„è§’åº¦ï¼Œå¹¶è¿›è¡Œçµæ´»ç»„åˆï¼Œä»è€Œè¾¾åˆ°æƒ³è¦çš„æ•ˆæœã€‚</p>
<p>é…ç½®å¦‚ä¸‹ï¼š
<img src="/posts/project/20220528224436/image-20220528225825213.png"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="262-qpsæµé‡æ§åˆ¶">2.6.2. QPSæµé‡æ§åˆ¶</h3>
<p>QPSï¼šæ¯ç§’é’Ÿå¤„ç†è¯·æ±‚æ¬¡æ•°.</p>
<p>å½“ QPS è¶…è¿‡æŸä¸ªé˜ˆå€¼çš„æ—¶å€™ï¼Œåˆ™é‡‡å–æªæ–½è¿›è¡Œæµé‡æ§åˆ¶ã€‚æµé‡æ§åˆ¶çš„æ•ˆæœåŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š<strong>ç›´æ¥æ‹’ç»</strong>ã€<strong>Warm Up</strong>ã€<strong>åŒ€é€Ÿæ’é˜Ÿ</strong>ã€‚</p>
<h4 id="2621-ç›´æ¥æ‹’ç»">2.6.2.1. ç›´æ¥æ‹’ç»</h4>
<p><strong>ç›´æ¥æ‹’ç»</strong>ï¼ˆ<code>RuleConstant.CONTROL_BEHAVIOR_DEFAULT</code>ï¼‰æ–¹å¼æ˜¯é»˜è®¤çš„æµé‡æ§åˆ¶æ–¹å¼ï¼Œå½“QPSè¶…è¿‡ä»»æ„è§„åˆ™çš„é˜ˆå€¼åï¼Œæ–°çš„è¯·æ±‚å°±ä¼šè¢«ç«‹å³æ‹’ç»ï¼Œæ‹’ç»æ–¹å¼ä¸ºæŠ›å‡º<code>FlowException</code>ã€‚è¿™ç§æ–¹å¼é€‚ç”¨äºå¯¹ç³»ç»Ÿå¤„ç†èƒ½åŠ›ç¡®åˆ‡å·²çŸ¥çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚é€šè¿‡å‹æµ‹ç¡®å®šäº†ç³»ç»Ÿçš„å‡†ç¡®æ°´ä½æ—¶ã€‚</p>
<p><img src="/posts/project/20220528224436/image-20220528225839893.png"
    
    
    
    loading="lazy"
    
    
></p>
<p><img src="/posts/project/20220528224436/image-20220528225850724.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>è¿™é‡Œåšä¸€ä¸ªæœ€ç®€å•çš„é…ç½®ï¼š</p>
<p>â€‹    é˜ˆå€¼ç±»å‹é€‰æ‹©ï¼šQPS</p>
<p>â€‹    å•æœºé˜ˆå€¼ï¼š2</p>
<p>ç»¼åˆèµ·æ¥çš„é…ç½®æ•ˆæœå°±æ˜¯ï¼Œè¯¥æ¥å£çš„é™æµç­–ç•¥æ˜¯æ¯ç§’æœ€å¤šå…è®¸2ä¸ªè¯·æ±‚è¿›å…¥ã€‚</p>
<p>ç‚¹å‡»æ–°å¢æŒ‰é’®ä¹‹åï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç•Œé¢ï¼š
<img src="/posts/project/20220528224436/image-20220528225902063.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>åœ¨æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:18080/hiï¼Œå¹¶ç–¯ç‹‚åˆ·æ–°ï¼Œå‡ºç°å¦‚ä¸‹ä¿¡æ¯ï¼š
<img src="/posts/project/20220528224436/image-20220528225909623.png"
    
    
    
    loading="lazy"
    
    
></p>
<h4 id="2622-warm-upé¢„çƒ­">2.6.2.2. Warm Upï¼ˆé¢„çƒ­ï¼‰</h4>
<p>Warm Upï¼ˆ<code>RuleConstant.CONTROL_BEHAVIOR_WARM_UP</code>ï¼‰æ–¹å¼ï¼Œå³é¢„çƒ­/å†·å¯åŠ¨æ–¹å¼ã€‚å½“ç³»ç»Ÿé•¿æœŸå¤„äºä½æ°´ä½çš„æƒ…å†µä¸‹ï¼Œå½“æµé‡çªç„¶å¢åŠ æ—¶ï¼Œç›´æ¥æŠŠç³»ç»Ÿæ‹‰å‡åˆ°é«˜æ°´ä½å¯èƒ½ç¬é—´æŠŠç³»ç»Ÿå‹å®ã€‚é€šè¿‡&quot;å†·å¯åŠ¨&quot;ï¼Œè®©é€šè¿‡çš„æµé‡ç¼“æ…¢å¢åŠ ï¼Œåœ¨ä¸€å®šæ—¶é—´å†…é€æ¸å¢åŠ åˆ°é˜ˆå€¼ä¸Šé™ï¼Œç»™å†·ç³»ç»Ÿä¸€ä¸ªé¢„çƒ­çš„æ—¶é—´ï¼Œé¿å…å†·ç³»ç»Ÿè¢«å‹å®ã€‚
<img src="/posts/project/20220528224436/image-20220528225924720.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ç–¯ç‹‚è®¿é—®ï¼šhttp://localhost:18080/hi
<img src="/posts/project/20220528224436/warm_up.gif"
    
    
    
    loading="lazy"
    
    
>
å¯ä»¥å‘ç°å‰å‡ ç§’ä¼šå‘ç”Ÿç†”æ–­ï¼Œå‡ ç§’é’Ÿä¹‹åå°±å®Œå…¨æ²¡æœ‰é—®é¢˜äº†
<img src="/posts/project/20220528224436/image-20220528225942722.png"
    
    
    
    loading="lazy"
    
    
></p>
<h4 id="2623-åŒ€é€Ÿæ’é˜Ÿ">2.6.2.3. åŒ€é€Ÿæ’é˜Ÿ</h4>
<p>åŒ€é€Ÿæ’é˜Ÿï¼ˆ<code>RuleConstant.CONTROL_BEHAVIOR_RATE_LIMITER</code>ï¼‰æ–¹å¼ä¼šä¸¥æ ¼æ§åˆ¶è¯·æ±‚é€šè¿‡çš„é—´éš”æ—¶é—´ï¼Œä¹Ÿå³æ˜¯è®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œå¯¹åº”çš„æ˜¯æ¼æ¡¶ç®—æ³•ã€‚</p>
<p>æµ‹è¯•é…ç½®å¦‚ä¸‹ï¼š1så¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œæ’é˜Ÿç­‰å¾…ï¼Œç­‰å¾…æ—¶é—´20sã€‚</p>
<p><img src="/posts/project/20220528224436/image-20220528230014350.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>åœ¨postmanä¸­ï¼Œæ–°å»ºä¸€ä¸ªcollectionï¼ˆè¿™é‡Œcollectionåç§°æ˜¯sentinelï¼‰ï¼Œå¹¶æŠŠä¸€ä¸ªè¯·æ±‚æ·»åŠ åˆ°è¯¥collection</p>
<p><img src="/posts/project/20220528224436/image-20220528230030090.png"
    
    
    
    loading="lazy"
    
    
>
<img src="/posts/project/20220528224436/image-20220528230042324.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>è¯·æ±‚æ·»åŠ æˆåŠŸåï¼Œç‚¹å‡»runæŒ‰é’®ï¼š</p>
<p><img src="/posts/project/20220528224436/image-20220528230057200.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>é…ç½®æ¯éš”100mså‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œä¸€å…±å‘é€20ä¸ªè¯·æ±‚ï¼š
<img src="/posts/project/20220528224436/image-20220528230119814.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ç‚¹å‡»â€œrun sentinelâ€æŒ‰é’®</p>
<p><img src="/posts/project/20220528224436/image-20220528230130309.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>æŸ¥çœ‹æ§åˆ¶å°ï¼Œæ•ˆæœå¦‚ä¸‹ï¼šå¯ä»¥çœ‹åˆ°åŸºæœ¬æ¯éš”1sæ‰“å°ä¸€æ¬¡
<img src="/posts/project/20220528224436/image-20220528230152865.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>æ³¨æ„ï¼Œåœ¨æ¶ˆè´¹è€…æ‰“å°å½“å‰æ¯«ç§’å€¼ã€‚System.out.println(System.currentTimeMillis());</p>
<h3 id="263-å…³è”é™æµ">2.6.3. å…³è”é™æµ</h3>
<p>å…³è”é™æµï¼šå½“å…³è”çš„èµ„æºè¯·æ±‚è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±ã€‚</p>
<p>é…ç½®å¦‚ä¸‹ï¼š/hi2çš„å…³è”èµ„æº/hiï¼Œå¹¶å‘æ•°è¶…è¿‡/hiçš„é™æµæ—¶ï¼Œ/hi2å°±é™æµè‡ªå·±
<img src="/posts/project/20220528224436/image-20220528230200963.png"
    
    
    
    loading="lazy"
    
    
></p>
<p><img src="/posts/project/20220528224436/image-20220528230207374.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ç»™æ¶ˆè´¹è€…æ·»åŠ ä¸€ä¸ªcontrolleræ–¹æ³•ï¼š</p>
<p><img src="/posts/project/20220528224436/image-20220528230221374.png"
    
    
    
    loading="lazy"
    
    
></p>
<p><em><strong>ç”±äºå¯¹/hi2çš„é™æµæ§åˆ¶é‡‡ç”¨QPS<code>å…³è”</code>ï¼Œæ‰€ä»¥ç›´æ¥è®¿é—®ä¸ä¼šè¢«é™æµï¼Œä¼šå‘ç°ä¸€ç›´åˆ·æ–°<code>/hi2</code>ä¸ä¼šå‡ºç°é™æµ</strong></em></p>
<p><em><strong>æµ‹è¯•è®¿é—®/hiï¼Œè¶…è¿‡é™æµé˜€å€¼ï¼Œåœ¨æµè§ˆå™¨è®¿é—®/hi2å‘ç°é™æµäº†ï¼š</strong></em></p>
<p>postmané…ç½®å¦‚ä¸‹ï¼šæ¯ä¸ª400mså‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œä¸€å…±å‘é€50ä¸ªã€‚æ¯ç§’é’Ÿè¶…è¿‡äº†2æ¬¡</p>
<p><img src="/posts/project/20220528224436/image-20220528230231620.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>åœ¨æµè§ˆå™¨ä¸­è®¿é—®/hi2  å·²ç»è¢«é™æµã€‚
<img src="/posts/project/20220528224436/image-20220528230242809.png"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="264-é“¾è·¯é™æµ">2.6.4. é“¾è·¯é™æµ</h3>
<p>ä¸€æ£µå…¸å‹çš„è°ƒç”¨æ ‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<pre tabindex="0"><code>     	          machine-root
                    /       \
                   /         \
             Entrance1     Entrance2
                /             \
               /               \
      DefaultNode(nodeA)   DefaultNode(nodeA)
</code></pre><p>ä¸Šå›¾ä¸­æ¥è‡ªå…¥å£ <code>Entrance1</code> å’Œ <code>Entrance2</code> çš„è¯·æ±‚éƒ½è°ƒç”¨åˆ°äº†èµ„æº <code>NodeA</code>ï¼ŒSentinel å…è®¸åªæ ¹æ®æŸä¸ªå…¥å£çš„ç»Ÿè®¡ä¿¡æ¯å¯¹èµ„æºé™æµã€‚</p>
<p>é…ç½®å¦‚ä¸‹ï¼šè¡¨ç¤ºåªé’ˆå¯¹Entrance1è¿›æ¥çš„è¯·æ±‚åšé™æµé™åˆ¶
<img src="/posts/project/20220528224436/image-20220528230251440.png"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="265-çº¿ç¨‹æ•°é™æµ">2.6.5. çº¿ç¨‹æ•°é™æµ</h3>
<p>**å¹¶å‘çº¿ç¨‹æ•°é™æµç”¨äºä¿æŠ¤ä¸šåŠ¡çº¿ç¨‹æ•°ä¸è¢«è€—å°½ã€‚**ä¾‹å¦‚ï¼Œå½“åº”ç”¨æ‰€ä¾èµ–çš„ä¸‹æ¸¸åº”ç”¨ç”±äºæŸç§åŸå› å¯¼è‡´æœåŠ¡ä¸ç¨³å®šã€å“åº”å»¶è¿Ÿå¢åŠ ï¼Œå¯¹äºè°ƒç”¨è€…æ¥è¯´ï¼Œæ„å‘³ç€ååé‡ä¸‹é™å’Œæ›´å¤šçš„çº¿ç¨‹æ•°å ç”¨ï¼Œæç«¯æƒ…å†µä¸‹ç”šè‡³å¯¼è‡´çº¿ç¨‹æ± è€—å°½ã€‚ä¸ºåº”å¯¹å¤ªå¤šçº¿ç¨‹å ç”¨çš„æƒ…å†µï¼Œä¸šå†…æœ‰ä½¿ç”¨éš”ç¦»çš„æ–¹æ¡ˆï¼Œæ¯”å¦‚é€šè¿‡ä¸åŒä¸šåŠ¡é€»è¾‘ä½¿ç”¨ä¸åŒçº¿ç¨‹æ± æ¥éš”ç¦»ä¸šåŠ¡è‡ªèº«ä¹‹é—´çš„èµ„æºäº‰æŠ¢ï¼ˆçº¿ç¨‹æ± éš”ç¦»ï¼‰ã€‚è¿™ç§éš”ç¦»æ–¹æ¡ˆè™½ç„¶éš”ç¦»æ€§æ¯”è¾ƒå¥½ï¼Œä½†æ˜¯ä»£ä»·å°±æ˜¯çº¿ç¨‹æ•°ç›®å¤ªå¤šï¼Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„ overhead æ¯”è¾ƒå¤§ï¼Œç‰¹åˆ«æ˜¯å¯¹ä½å»¶æ—¶çš„è°ƒç”¨æœ‰æ¯”è¾ƒå¤§çš„å½±å“ã€‚Sentinel å¹¶å‘çº¿ç¨‹æ•°é™æµä¸è´Ÿè´£åˆ›å»ºå’Œç®¡ç†çº¿ç¨‹æ± ï¼Œè€Œæ˜¯ç®€å•ç»Ÿè®¡å½“å‰è¯·æ±‚ä¸Šä¸‹æ–‡çš„çº¿ç¨‹æ•°ç›®ï¼Œå¦‚æœè¶…å‡ºé˜ˆå€¼ï¼Œæ–°çš„è¯·æ±‚ä¼šè¢«ç«‹å³æ‹’ç»ï¼Œæ•ˆæœç±»ä¼¼äºä¿¡å·é‡éš”ç¦»ã€‚</p>
<p>é…ç½®å¦‚ä¸‹ï¼šå¦‚æœè¯·æ±‚çš„å¹¶å‘æ•°è¶…è¿‡ä¸€ä¸ªå°±é™æµ
<img src="/posts/project/20220528224436/image-20220528230300763.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>æ”¹é€ controllerä¸­çš„hiæ–¹æ³•ï¼š
<img src="/posts/project/20220528224436/image-20220528230314313.png"
    
    
    
    loading="lazy"
    
    
></p>
<p><strong>æµ‹è¯•</strong></p>
<p>postmainé…ç½®å¦‚ä¸‹ï¼š
<img src="/posts/project/20220528224436/image-20220528230321130.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>åŒæ—¶åœ¨æµè§ˆå™¨è®¿é—®ï¼š</p>
<p><img src="/posts/project/20220528224436/image-20220528230353346.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="27-ç†”æ–­é™çº§">2.7. ç†”æ–­é™çº§</h2>
<p>Sentinelé™¤äº†æµé‡æ§åˆ¶ä»¥å¤–ï¼Œå¯¹è°ƒç”¨é“¾è·¯ä¸­ä¸ç¨³å®šçš„èµ„æºè¿›è¡Œç†”æ–­é™çº§ä¹Ÿæ˜¯ä¿éšœé«˜å¯ç”¨çš„é‡è¦æªæ–½ä¹‹ä¸€ã€‚</p>
<p>Sentinel <strong>ç†”æ–­é™çº§</strong>ä¼šåœ¨è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç°ä¸ç¨³å®šçŠ¶æ€æ—¶ï¼ˆä¾‹å¦‚è°ƒç”¨è¶…æ—¶æˆ–å¼‚å¸¸æ¯”ä¾‹å‡é«˜ï¼‰ï¼Œå¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œé™åˆ¶ï¼Œè®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“åˆ°å…¶å®ƒçš„èµ„æºè€Œå¯¼è‡´çº§è”é”™è¯¯ã€‚å½“èµ„æºè¢«é™çº§åï¼Œåœ¨æ¥ä¸‹æ¥çš„é™çº§æ—¶é—´çª—å£ä¹‹å†…ï¼Œå¯¹è¯¥èµ„æºçš„è°ƒç”¨éƒ½è‡ªåŠ¨ç†”æ–­ï¼ˆé»˜è®¤è¡Œä¸ºæ˜¯æŠ›å‡º <code>DegradeException</code>ï¼‰ã€‚</p>
<p>Sentinel å’Œ Hystrix çš„åŸåˆ™æ˜¯ä¸€è‡´çš„: å½“è°ƒç”¨é“¾è·¯ä¸­æŸä¸ªèµ„æºå‡ºç°ä¸ç¨³å®šï¼Œä¾‹å¦‚ï¼Œè¡¨ç°ä¸º timeoutï¼Œå¼‚å¸¸æ¯”ä¾‹å‡é«˜çš„æ—¶å€™ï¼Œåˆ™å¯¹è¿™ä¸ªèµ„æºçš„è°ƒç”¨è¿›è¡Œé™åˆ¶ï¼Œå¹¶è®©è¯·æ±‚å¿«é€Ÿå¤±è´¥ï¼Œé¿å…å½±å“åˆ°å…¶å®ƒçš„èµ„æºï¼Œæœ€ç»ˆäº§ç”Ÿé›ªå´©çš„æ•ˆæœã€‚</p>
<p>é™æµé™çº§æŒ‡æ ‡æœ‰ä¸‰ä¸ªï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<ol>
<li>
<p>å¹³å‡å“åº”æ—¶é—´ï¼ˆRTï¼‰</p>
</li>
<li>
<p>å¼‚å¸¸æ¯”ä¾‹</p>
</li>
<li>
<p>å¼‚å¸¸æ•°
<img src="/posts/project/20220528224436/image-20220528230439042.png"
    
    
    
    loading="lazy"
    
    
></p>
</li>
</ol>
<h3 id="271-å¹³å‡å“åº”æ—¶é—´rt">2.7.1. å¹³å‡å“åº”æ—¶é—´ï¼ˆRTï¼‰</h3>
<p><strong>å¹³å‡å“åº”æ—¶é—´</strong> (<code>DEGRADE_GRADE_RT</code>)ï¼š<strong>å½“èµ„æºçš„å¹³å‡å“åº”æ—¶é—´è¶…è¿‡é˜ˆå€¼</strong>ï¼ˆ<code>DegradeRule</code> ä¸­çš„ <code>count</code>ï¼Œä»¥ <strong>ms</strong> ä¸ºå•ä½ï¼Œé»˜è®¤ä¸Šé™æ˜¯4900msï¼‰ä¹‹åï¼Œèµ„æºè¿›å…¥å‡†é™çº§çŠ¶æ€ã€‚å¦‚æœ<strong>1sä¹‹å†…æŒç»­è¿›å…¥ 5 ä¸ªè¯·æ±‚</strong>ï¼Œå®ƒä»¬çš„ RT éƒ½æŒç»­è¶…è¿‡è¿™ä¸ªé˜ˆå€¼ï¼Œé‚£ä¹ˆåœ¨<strong>æ¥ä¸‹æ¥çš„æ—¶é—´çª—å£</strong>ï¼ˆ<code>DegradeRule</code> ä¸­çš„ <code>timeWindow</code>ï¼Œä»¥ s ä¸ºå•ä½ï¼‰ä¹‹å†…ï¼Œå¯¹è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šè‡ªåŠ¨åœ°è¿”å›ï¼ˆæŠ›å‡º <code>DegradeException</code>ï¼‰ã€‚åœ¨ä¸‹ä¸€ä¸ªæ—¶é—´çª—å£åˆ°æ¥æ—¶, ä¼šæ¥ç€å†æ”¾å…¥5ä¸ªè¯·æ±‚, å†é‡å¤ä¸Šé¢çš„åˆ¤æ–­ã€‚</p>
<p>é…ç½®å¦‚ä¸‹ï¼šè¶…æ—¶æ—¶é—´100msï¼Œç†”æ–­æ—¶é—´10s</p>
<p><img src="/posts/project/20220528224436/image-20220528230450969.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ä»£ç ä¸­ä¾ç„¶ç¡äº†1s</p>
<p><img src="/posts/project/20220528224436/image-20220528230604936.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ä¹Ÿå°±æ˜¯è¯´è¯·æ±‚è‚¯å®šéƒ½ä¼šè¶…æ—¶ã€‚</p>
<p>å…ˆæ‰§è¡Œpostmainï¼Œé…ç½®å¦‚ä¸‹ï¼š</p>
<p><img src="/posts/project/20220528224436/image-20220528230615102.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>å†æ¬¡è§åˆ°äº†ç†Ÿæ‚‰çš„ç•Œé¢ï¼š</p>
<p><img src="/posts/project/20220528224436/image-20220528230623406.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>10sä¹‹å†…ï¼Œéƒ½æ˜¯ç†”æ–­ç•Œé¢</p>
<h3 id="272-å¼‚å¸¸æ¯”ä¾‹">2.7.2. å¼‚å¸¸æ¯”ä¾‹</h3>
<p><strong>å¼‚å¸¸æ¯”ä¾‹</strong> (<code>DEGRADE_GRADE_EXCEPTION_RATIO</code>)ï¼š<strong>å½“èµ„æºçš„æ¯ç§’è¯·æ±‚é‡ &gt;= 5ï¼Œä¸”æ¯ç§’å¼‚å¸¸æ€»æ•°å é€šè¿‡é‡çš„æ¯”å€¼è¶…è¿‡é˜ˆå€¼</strong>ï¼ˆ<code>DegradeRule</code> ä¸­çš„ <code>count</code>ï¼‰ä¹‹åï¼Œèµ„æºè¿›å…¥é™çº§çŠ¶æ€ï¼Œå³åœ¨æ¥ä¸‹çš„æ—¶é—´çª—å£ï¼ˆ<code>DegradeRule</code>ä¸­çš„ <code>timeWindow</code>ï¼Œä»¥ s ä¸ºå•ä½ï¼‰ä¹‹å†…ï¼Œå¯¹è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šè‡ªåŠ¨åœ°è¿”å›ã€‚å¼‚å¸¸æ¯”ç‡çš„é˜ˆå€¼èŒƒå›´æ˜¯ <code>[0.0, 1.0]</code>ï¼Œä»£è¡¨ 0% - 100%ã€‚</p>
<h3 id="273-å¼‚å¸¸æ•°">2.7.3. å¼‚å¸¸æ•°</h3>
<p><strong>å¼‚å¸¸æ•°</strong> (<code>DEGRADE_GRADE_EXCEPTION_COUNT</code>)ï¼šå½“èµ„æºè¿‘ 1 åˆ†é’Ÿçš„å¼‚å¸¸æ•°ç›®è¶…è¿‡é˜ˆå€¼ä¹‹åä¼šè¿›è¡Œç†”æ–­ã€‚</p>
<h2 id="28-è§„åˆ™æŒä¹…åŒ–">2.8. è§„åˆ™æŒä¹…åŒ–</h2>
<p>æ— è®ºæ˜¯é€šè¿‡ç¡¬ç¼–ç çš„æ–¹å¼æ¥æ›´æ–°è§„åˆ™ï¼Œè¿˜æ˜¯é€šè¿‡æ¥å…¥ Sentinel Dashboard åï¼Œåœ¨é¡µé¢ä¸Šæ“ä½œæ›´æ–°è§„åˆ™ï¼Œéƒ½æ— æ³•é¿å…ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯æœåŠ¡é‡å¯åï¼Œè§„åˆ™å°±ä¸¢å¤±äº†ï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹è§„åˆ™æ˜¯ä¿å­˜åœ¨å†…å­˜ä¸­çš„ã€‚</p>
<p>æˆ‘ä»¬åœ¨ Dashboard ä¸Šä¸ºå®¢æˆ·ç«¯é…ç½®å¥½äº†è§„åˆ™ï¼Œå¹¶æ¨é€ç»™äº†å®¢æˆ·ç«¯ã€‚è¿™æ—¶ç”±äºä¸€äº›å› ç´ å®¢æˆ·ç«¯å‡ºç°å¼‚å¸¸ï¼ŒæœåŠ¡ä¸å¯ç”¨äº†ï¼Œå½“å®¢æˆ·ç«¯æ¢å¤æ­£å¸¸å†æ¬¡è¿æ¥ä¸Š Dashboard åï¼Œè¿™æ—¶æ‰€æœ‰çš„è§„åˆ™éƒ½ä¸¢å¤±äº†ï¼Œæˆ‘ä»¬è¿˜éœ€è¦é‡æ–°é…ç½®ä¸€éè§„åˆ™ï¼Œè¿™è‚¯å®šä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p>
<p>æŒä¹…åŒ–é…ç½®åˆ†ä»¥ä¸‹3æ­¥ï¼š</p>
<ol>
<li>å¼•å…¥ä¾èµ–</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;groupId&gt;</span>com.alibaba.csp<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;artifactId&gt;</span>sentinel-datasource-nacos<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/dependency&gt;</span>
</span></span></code></pre></div><ol start="2">
<li>æ·»åŠ é…ç½®ï¼š</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#008080">spring</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008080">cloud</span><span style="color:#000;font-weight:bold">:</span>    
</span></span><span style="display:flex;"><span>    <span style="color:#008080">sentinel</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#008080">transport</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#008080">dashboard</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">192.168.188.138:8080</span>
</span></span><span style="display:flex;"><span>        <span style="color:#008080">port</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">8719</span>
</span></span><span style="display:flex;"><span>      <span style="color:#008080">datasource</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#008080">consumer</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">nacos</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#008080">server-addr</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">192.168.188.138:8848</span>
</span></span><span style="display:flex;"><span>            <span style="color:#008080">dataId</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">${spring.application.name}-sentinel-rules</span>
</span></span><span style="display:flex;"><span>            <span style="color:#008080">groupId</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">SENTINEL_GROUP</span>
</span></span><span style="display:flex;"><span>            <span style="color:#008080">data-type</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">json</span>
</span></span><span style="display:flex;"><span>            <span style="color:#008080">rule_type</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">flow</span>
</span></span></code></pre></div><ol start="3">
<li>nacosä¸­åˆ›å»ºæµæ§è§„åˆ™
<img src="/posts/project/20220528224436/image-20220528230644314.png"
    
    
    
    loading="lazy"
    
    
></li>
</ol>
<p>é…ç½®å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&#34;resource&#34;</span>: <span style="color:#d14">&#34;/hi&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&#34;limitApp&#34;</span>: <span style="color:#d14">&#34;default&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&#34;grade&#34;</span>: <span style="color:#099">1</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&#34;count&#34;</span>: <span style="color:#099">2</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&#34;strategy&#34;</span>: <span style="color:#099">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&#34;controlBehavior&#34;</span>: <span style="color:#099">0</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&#34;clusterMode&#34;</span>: <span style="color:#000;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>resourceï¼šèµ„æºåç§°</p>
<p>limitAppï¼šé™æµåº”ç”¨ï¼Œå°±æ˜¯ç”¨é»˜è®¤å°±å¯ä»¥</p>
<p>gradeï¼šé˜ˆå€¼ç±»å‹ï¼Œ0è¡¨ç¤ºçº¿ç¨‹æ•°ï¼Œ1è¡¨ç¤ºQps</p>
<p>countï¼šå•æœºé˜ˆå€¼</p>
<p>strategyï¼šæµæ§æ¨¡å¼ï¼Œ0-ç›´æ¥ï¼Œ1-å…³è”ï¼Œ 2-é“¾è·¯</p>
<p>controlBehaviorï¼šæµæ§æ•ˆæœã€‚0-å¿«é€Ÿå¤±è´¥ï¼Œ1-warm up 2-æ’é˜Ÿç­‰å¾…</p>
<p>clusterModeï¼šæ˜¯å¦é›†ç¾¤</p>
<p>é‡å¯consumserï¼Œå¹¶å¤šæ¬¡è®¿é—®ï¼šhttp://localhost:18080/hiã€‚</p>
<p>æŸ¥çœ‹sentinelå®¢æˆ·ç«¯ï¼šå°±æœ‰äº†é™æµé…ç½®äº†</p>
<p><img src="/posts/project/20220528224436/image-20220528230702298.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ç°åœ¨ä½ å¯ä»¥å°è¯•æµ‹è¯•ä¸€ä¸‹é™æµé…ç½®äº†</p>
<h1 id="3-sleuth">3. Sleuth</h1>
<p>â€‹		Spring Cloud Sleuthä¸ºspringCloudå®ç°äº†ä¸€ä¸ªåˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªè§£å†³æ–¹æ¡ˆï¼Œå¤§é‡å€Ÿé‰´äº†Dapperï¼ŒZipkinå’ŒHTraceç­‰é“¾è·¯è¿½è¸ªæŠ€æœ¯ã€‚å¯¹äºå¤§å¤šæ•°ç”¨æˆ·è€Œè¨€ï¼ŒSleuthåº”è¯¥æ˜¯ä¸å¯è§çš„ï¼Œå¹¶ä¸”æ‚¨ä¸å¤–éƒ¨ç³»ç»Ÿçš„æ‰€æœ‰äº¤äº’éƒ½åº”è‡ªåŠ¨è¿›è¡Œæ£€æµ‹ã€‚æ‚¨å¯ä»¥ç®€å•åœ°åœ¨æ—¥å¿—ä¸­æ•è·æ•°æ®ï¼Œä¹Ÿå¯ä»¥å°†å…¶å‘é€åˆ°è¿œç¨‹æ”¶é›†å™¨æœåŠ¡ã€‚</p>
<p>â€‹		éšç€åˆ†å¸ƒå¼ç³»ç»Ÿè¶Šæ¥è¶Šå¤æ‚ï¼Œä½ çš„ä¸€ä¸ªè¯·æ±‚å‘è¿‡å‘è¿‡å»ï¼Œå„ä¸ªå¾®æœåŠ¡ä¹‹é—´çš„è·³è½¬ï¼Œæœ‰å¯èƒ½æŸä¸ªè¯·æ±‚æŸä¸€å¤©å‹åŠ›å¤ªå¤§äº†ï¼Œä¸€ä¸ªè¯·æ±‚è¿‡å»æ²¡å“åº”ï¼Œä¸€ä¸ªè¯·æ±‚ä¸‹å»ä¾èµ–äº†ä¸‰å››ä¸ªæœåŠ¡ï¼Œä½†æ˜¯ä½ å»ä¸çŸ¥é“å“ªä¸€ä¸ªæœåŠ¡å‡ºæ¥é—®é¢˜ï¼Œè¿™æ—¶å€™æˆ‘æ˜¯ä¸æ˜¯éœ€è¦å¯¹å¾®æœåŠ¡è¿›è¡Œè¿½è¸ªå‘€ï¼Ÿç›‘æ§ä¸€ä¸ªè¯·æ±‚çš„å‘èµ·ï¼Œä»æœåŠ¡ä¹‹é—´ä¼ é€’ä¹‹é—´çš„è¿‡ç¨‹ï¼Œæˆ‘æœ€å¥½è®°å½•ä¸€ä¸‹ï¼Œè®°å½•æ¯ä¸€ä¸ªçš„è€—æ—¶å¤šä¹…ï¼Œä¸€æ—¦å‡ºäº†é—®é¢˜ï¼Œæˆ‘ä»¬å°±å¯ä»¥é’ˆå¯¹æ€§çš„è¿›è¡Œä¼˜åŒ–ï¼Œæ˜¯è¦å¢åŠ èŠ‚ç‚¹ï¼Œå‡è½»å‹åŠ›ï¼Œè¿˜æ˜¯æœåŠ¡ç»§ç»­æ‹†åˆ†ï¼Œè®©é€»è¾‘æ›´åŠ ç®€å•ç‚¹å‘¢ï¼Ÿè¿™æ—¶å€™<strong>springcloud-sleuthé›†æˆzipkin</strong>èƒ½å¸®æˆ‘ä»¬è§£å†³è¿™äº›æœåŠ¡è¿½è¸ªé—®é¢˜ã€‚</p>
<h2 id="31-zipkinåˆ†å¸ƒå¼ç›‘æ§å®¢æˆ·ç«¯">3.1. zipkinåˆ†å¸ƒå¼ç›‘æ§å®¢æˆ·ç«¯</h2>
<p>Zipkinæ˜¯ä¸€ç§åˆ†å¸ƒå¼è·Ÿè¸ªç³»ç»Ÿã€‚å®ƒæœ‰åŠ©äºæ”¶é›†è§£å†³å¾®æœåŠ¡æ¶æ„ä¸­çš„å»¶è¿Ÿé—®é¢˜æ‰€éœ€çš„æ—¶åºæ•°æ®ã€‚å®ƒç®¡ç†è¿™äº›æ•°æ®çš„æ”¶é›†å’ŒæŸ¥æ‰¾ã€‚Zipkinçš„è®¾è®¡åŸºäºGoogle Dapperè®ºæ–‡ã€‚åº”ç”¨ç¨‹åºç”¨äºå‘ZipkinæŠ¥å‘Šæ—¶åºæ•°æ®ã€‚Zipkin UIè¿˜æä¾›äº†ä¸€ä¸ªä¾èµ–å…³ç³»å›¾ï¼Œæ˜¾ç¤ºäº†æ¯ä¸ªåº”ç”¨ç¨‹åºé€šè¿‡çš„è·Ÿè¸ªè¯·æ±‚æ•°ã€‚å¦‚æœè¦è§£å†³å»¶è¿Ÿé—®é¢˜æˆ–é”™è¯¯ï¼Œå¯ä»¥æ ¹æ®åº”ç”¨ç¨‹åºï¼Œè·Ÿè¸ªé•¿åº¦ï¼Œæ³¨é‡Šæˆ–æ—¶é—´æˆ³å¯¹æ‰€æœ‰è·Ÿè¸ªè¿›è¡Œç­›é€‰æˆ–æ’åºã€‚é€‰æ‹©è·Ÿè¸ªåï¼Œæ‚¨å¯ä»¥çœ‹åˆ°æ¯ä¸ªè·¨åº¦æ‰€éœ€çš„æ€»è·Ÿè¸ªæ—¶é—´ç™¾åˆ†æ¯”ï¼Œä»è€Œå¯ä»¥è¯†åˆ«æœ‰é—®é¢˜çš„åº”ç”¨ç¨‹åºã€‚</p>
<p>é€šè¿‡dockerå®‰è£…ï¼šdocker run -d -p 9411:9411 openzipkin/zipkin</p>
<p>é€šè¿‡jaråŒ…å®‰è£…ï¼šjava -jar zipkin-server-*exec.jar</p>
<p>jaråŒ…ä¸‹è½½åœ°å€ï¼šhttps://search.maven.org/remote_content?g=io.zipkin&amp;a=zipkin-server&amp;v=LATEST&amp;c=exec</p>
<p>è¯¾å‰èµ„æ–™æœ‰å·²ä¸‹è½½çš„jaråŒ…</p>
<p>åœ¨æµè§ˆå™¨ç«¯è®¿é—®ï¼šhttp://localhost:9411</p>
<h2 id="32-æ”¹é€ consumerproviderå·¥ç¨‹">3.2. æ”¹é€ consumer/providerå·¥ç¨‹</h2>
<p>å¯¹consumerå’Œproviderå·¥ç¨‹åˆ†åˆ«åšå¦‚ä¸‹æ“ä½œï¼š</p>
<ol>
<li>å¼•å…¥sleuthçš„ä¾èµ–</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;groupId&gt;</span>org.springframework.cloud<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;artifactId&gt;</span>spring-cloud-starter-zipkin<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>zipkinçš„å¯åŠ¨å™¨åŒ…å«äº†sleuthçš„ä¾èµ–ã€‚</p>
<ol start="2">
<li>é…ç½®zipkinçš„ç›¸å…³ä¿¡æ¯</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#008080">spring</span><span style="color:#000;font-weight:bold">:</span>  
</span></span><span style="display:flex;"><span>  <span style="color:#008080">zipkin</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">base-url</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">http://192.168.188.138:9411</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">discovery-client-enabled</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">sender</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">web</span>
</span></span></code></pre></div><ol start="3">
<li>é‡å¯consumer/provideræœåŠ¡åï¼Œè®¿é—®æ¶ˆè´¹è€…ï¼šhttp://localhost:18080/hiã€‚æŸ¥çœ‹zipkinå®¢æˆ·ç«¯å¦‚ä¸‹
<img src="/posts/project/20220528224436/zipkin_client.gif"
    
    
    
    loading="lazy"
    
    
>
è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥åœ¨zipkinçš„uiæ§åˆ¶ç•Œé¢çœ‹çœ‹æ•ˆæœï¼Œå¯ä»¥å‘ç°ï¼ŒæœåŠ¡ä¹‹é—´çš„è°ƒç”¨å…³ç³»ï¼ŒæœåŠ¡åç§°å·²ç»æ¸…æ™°å±•ç°å‡ºæ¥äº†ï¼ŒåŒæ—¶åŒ…æ‹¬æœåŠ¡ä¹‹é—´çš„è°ƒç”¨æ—¶å¸¸ç­‰è¯¦ç»†ä¿¡æ¯ä»¥åŠæ›´ç»†çš„ä¿¡æ¯éƒ½å¯ä»¥é€šè¿‡æ§åˆ¶å°çœ‹åˆ°ã€‚
<img src="/posts/project/20220528224436/image-20220528230745389.png"
    
    
    
    loading="lazy"
    
    
></li>
</ol>
<p>è¿˜å¯ä»¥æŸ¥çœ‹è°ƒç”¨å…³ç³»å›¾ï¼š
<img src="/posts/project/20220528224436/image-20220528230751668.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="33-åŸºæœ¬æ¦‚å¿µ">3.3. åŸºæœ¬æ¦‚å¿µ</h2>
<p>Spanï¼šåŸºæœ¬å·¥ä½œå•å…ƒã€‚å‘é€ä¸€ä¸ªè¿œç¨‹è¯·æ±‚å°±ä¼šäº§ç”Ÿä¸€ä¸ªspanï¼Œspané€šè¿‡ä¸€ä¸ª64ä½IDå”¯ä¸€æ ‡è¯†ï¼Œtraceä»¥å¦ä¸€ä¸ª64ä½IDè¡¨ç¤ºï¼Œspanè¿˜æœ‰å…¶ä»–æ•°æ®ä¿¡æ¯ï¼Œæ¯”å¦‚æ‘˜è¦ã€æ—¶é—´æˆ³äº‹ä»¶ã€å…³é”®å€¼æ³¨é‡Š(tags)ã€spançš„IDã€ä»¥åŠè¿›åº¦ID(é€šå¸¸æ˜¯IPåœ°å€)ã€‚spanåœ¨ä¸æ–­çš„å¯åŠ¨å’Œåœæ­¢ï¼ŒåŒæ—¶è®°å½•äº†æ—¶é—´ä¿¡æ¯ï¼Œå½“ä½ åˆ›å»ºäº†ä¸€ä¸ªspanï¼Œä½ å¿…é¡»åœ¨æœªæ¥çš„æŸä¸ªæ—¶åˆ»åœæ­¢å®ƒã€‚</p>
<p>Traceï¼šä¸€ç³»åˆ—spansç»„æˆçš„ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ã€‚ä¾‹å¦‚ï¼šå‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œéœ€è¦è°ƒç”¨å¤šä¸ªå¾®æœåŠ¡ï¼Œæ¯è°ƒç”¨ä¸€ä¸ªå¾®æœåŠ¡éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªspanï¼Œè¿™äº›spanç»„æˆä¸€ä¸ªtrace</p>
<p>Annotationï¼šç”¨æ¥åŠæ—¶è®°å½•ä¸€ä¸ªäº‹ä»¶çš„å­˜åœ¨ï¼Œä¸€äº›æ ¸å¿ƒannotationsç”¨æ¥å®šä¹‰ä¸€ä¸ªè¯·æ±‚çš„å¼€å§‹å’Œç»“æŸ</p>
<ul>
<li>cs - Client Sent -å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œè¿™ä¸ªannotionæè¿°äº†è¿™ä¸ªspançš„å¼€å§‹</li>
<li>sr - Server Received -æœåŠ¡ç«¯è·å¾—è¯·æ±‚å¹¶å‡†å¤‡å¼€å§‹å¤„ç†å®ƒï¼Œå¦‚æœå°†å…¶srå‡å»csæ—¶é—´æˆ³ä¾¿å¯å¾—åˆ°ç½‘ç»œå»¶è¿Ÿ</li>
<li>ss - Server Sent -æ³¨è§£è¡¨æ˜è¯·æ±‚å¤„ç†çš„å®Œæˆ(å½“è¯·æ±‚è¿”å›å®¢æˆ·ç«¯)ï¼Œå¦‚æœsså‡å»sræ—¶é—´æˆ³ä¾¿å¯å¾—åˆ°æœåŠ¡ç«¯éœ€è¦çš„å¤„ç†è¯·æ±‚æ—¶é—´</li>
<li>cr - Client Received -è¡¨æ˜spançš„ç»“æŸï¼Œå®¢æˆ·ç«¯æˆåŠŸæ¥æ”¶åˆ°æœåŠ¡ç«¯çš„å›å¤ï¼Œå¦‚æœcrå‡å»csæ—¶é—´æˆ³ä¾¿å¯å¾—åˆ°å®¢æˆ·ç«¯ä»æœåŠ¡ç«¯è·å–å›å¤çš„æ‰€æœ‰æ‰€éœ€æ—¶é—´</li>
</ul>
<p>ä¾‹å¦‚ä¸€ä¸ªè¯·æ±‚å¦‚ä¸‹ï¼š
<img src="/posts/project/20220528224436/image-20220528230800348.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ä½¿ç”¨zipkinè·Ÿè¸ªæ•´ä¸ªè¯·æ±‚è¿‡ç¨‹å¦‚ä¸‹ï¼š
<img src="/posts/project/20220528224436/12889335-49075b7a31bf4b4a.webp"
    
    
    
    loading="lazy"
    
    
>
ä¸Šå›¾è¡¨ç¤ºä¸€è¯·æ±‚é“¾è·¯ï¼Œä¸€æ¡é“¾è·¯é€šè¿‡<code>Trace Id</code>å”¯ä¸€æ ‡è¯†ï¼Œ<code>Span</code>æ ‡è¯†å‘èµ·çš„è¯·æ±‚ä¿¡æ¯ï¼Œå„<code>span</code>é€šè¿‡<code>parent id</code> å…³è”èµ·æ¥ï¼Œå¦‚å›¾
<img src="/posts/project/20220528224436/image-20220528230817435.png"
    
    
    
    loading="lazy"
    
    
></p>

    </div>

    

    


    <div class="container-prevnext">
    <div><a href="https://lovemjh.github.io/posts/project/20220528222829/">â† tk-SpringCloudAlibaba</a></div>
    <div><a href="https://lovemjh.github.io/posts/project/20220528231163/">tk-é¢˜åº“é¡¹ç›®åŸºæœ¬æ¡†æ¶æ­å»º  â†’</a></div>
</div>
</div>

        </div>
        <div id="footer"><div class="container-footer">
    
    <a href="//beian.miit.gov.cn" target="_blank">
        
        è±«ICPå¤‡2022002918å·
        
    </a>
    <a id="s" href="/secrets">&nbsp;</a>
</div></div>
    </body>
</html>
