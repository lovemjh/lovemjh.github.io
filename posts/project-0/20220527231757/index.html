<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="Thymeleaf实现搜索页面渲染及商品静态页 - https://lovemjh.vercel.app/posts/project-0/20220527231757/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>Thymeleaf实现搜索页面渲染及商品静态页</title>
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    <link rel="stylesheet" href="https://lovemjh.vercel.app/style.min.824365c118b34524ce845ac2a294220354719cca11af5b27a81b04c173bbba57.css">
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate cool">
        <div id="header"><div class="container-header">
    <div id="vars" class="container-vars" style="display: none;">
	{
		"hasFoldAllCodeBlocks": false,
		"svgColor": "#6c757d",
		"en": false,
		"dark": false
	}
</div>
    <h1 class="title">
        
            Thymeleaf实现搜索页面渲染及商品静态页
            
        
    </h1>

    <div class="container-breadcrumb-nav">
    
    <div class="breadcrumb-nav-bar">
        <div><a href="/"><svg t="1656411084410" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2954" width="16" height="16"><path d="M947.5 390.6l-377-290c-34.5-26.5-82.6-26.5-117.1 0l-377 290c-14 10.8-16.6 30.9-5.9 44.9 10.8 14 30.9 16.6 44.9 5.9l28.5-21.9V768c0 88.2 71.8 160 160 160h80c35.3 0 64-28.7 64-64V640c0-17.6 14.4-32 32-32h64c17.6 0 32 14.4 32 32v224c0 35.3 28.7 64 64 64h80c88.2 0 160-71.8 160-160V419.4l28.5 21.9c5.8 4.5 12.7 6.6 19.5 6.6 9.6 0 19.1-4.3 25.4-12.5 10.8-13.9 8.2-34-5.8-44.8zM816 768c0 52.9-43.1 96-96 96h-80V640c0-52.9-43.1-96-96-96h-64c-52.9 0-96 43.1-96 96v224h-80c-52.9 0-96-43.1-96-96V370.2l284.5-218.8c11.5-8.8 27.5-8.8 39 0L816 370.2V768z" fill=#6c757d p-id="2955"></path></svg></a></div>
        <div><a href="/nav"><svg t="1656411531924" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5827" width="16" height="16"><path d="M849.59197473 125.23018519L139.22930586 391.72854662a23.35052669 23.35052669 0 0 0-14.95414244 21.65490745c-0.12257519 9.70384955 5.61801843 18.46795771 14.40255493 22.04306141l318.42928099 129.25528056 119.51057092 320.39047893c3.06437293 8.23295069 10.35758221 13.89182751 18.7335381 14.87242563l2.7170774 0.14300521a22.79893918 22.79893918 0 0 0 21.20546682-15.36272638l259.51158924-729.54564933a23.8612558 23.8612558 0 0 0-5.31158128-24.55584682 22.3290685 22.3290685 0 0 0-23.9021142-5.43415649zM793.65694081 211.64552314l-196.63064161 552.75171747-91.91077952-246.37564122-253.62799211-102.96295445 542.16941324-203.4131218z" p-id="5828" fill=#6c757d></path></svg></a></div>
        <div><a href="/search"><svg t="1656411627509" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1730" width="14" height="14"><path d="M469.333333 85.333333c211.968 0 384 172.032 384 384s-172.032 384-384 384-384-172.032-384-384 172.032-384 384-384z m0 682.666667c164.992 0 298.666667-133.674667 298.666667-298.666667 0-165.034667-133.674667-298.666667-298.666667-298.666666-165.034667 0-298.666667 133.632-298.666666 298.666666 0 164.992 133.632 298.666667 298.666666 298.666667z m362.026667 3.029333l120.704 120.661334-60.373333 60.373333-120.661334-120.704 60.330667-60.330667z" p-id="1731" fill=#6c757d></path></svg></a></div>
        <div><a href="/posts"><svg t="1656411724198" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5655" width="12" height="12"><path d="M811.705761 1024H212.294239c-93.1199 0-174.823046-87.570975-174.823046-187.387854V162.322018C37.471193 69.776145 112.604921 0 212.294239 0H596.190595l7.015883 5.93161c111.74388 95.479788 185.857116 170.741078 279.614824 266.093304 29.65805 30.040735 61.165743 62.122454 96.436499 97.393211l7.271006 7.334787v459.859234c-0.063781 99.816879-81.703145 187.387854-174.823046 187.387854zM212.294239 49.94033c-72.391155 0-124.882716 47.261538-124.882716 112.381688v674.290128c0 71.94469 59.507443 137.383743 124.882716 137.383743h599.411522c65.311492 0 124.882716-65.439053 124.882716-137.383743V397.417876c-32.528184-32.464404-61.73977-62.250016-89.356836-90.377328-90.951355-92.418312-163.278729-165.957521-269.601245-257.163999H212.294239z" fill=#6c757d p-id="5656"></path><path d="M936.588477 449.526752h-212.326129c-99.753099 0-187.324073-81.703145-187.324073-174.823046V49.94033a25.002055 25.002055 0 0 1 49.94033 0v224.763376c0 65.311492 65.502834 124.882716 137.383743 124.882716h212.326129a25.002055 25.002055 0 1 1 0 49.94033z" fill=#6c757d p-id="5657"></path></svg></a></div>
        <div><a href="/archive"><svg t="1656411795742" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7334" width="12" height="12"><path d="M884.224 522.24H504.32V141.824c0-16.896-13.824-30.72-30.72-30.72-120.32 0-233.472 47.616-317.952 134.144S26.112 445.952 29.184 566.784c2.56 114.688 49.152 222.72 131.072 304.128 81.92 81.408 189.952 128 304.64 130.56h10.24c117.76 0 227.84-45.568 312.32-128.512 86.528-85.504 133.632-199.68 132.608-321.024-0.512-2.048-1.536-29.696-35.84-29.696z m-140.288 307.712c-74.752 73.728-173.056 112.64-277.504 110.592-205.824-4.608-370.688-169.472-375.296-374.784-3.072-104.448 35.84-202.752 108.544-277.504 65.536-67.072 151.552-107.52 243.712-114.688v378.88c0 16.896 13.824 30.72 30.72 30.72 129.024 0 311.296 0 382.976 0.512-6.144 93.184-46.08 179.712-113.152 246.272z" fill=#6c757d p-id="7335"></path><path d="M603.136 11.264c-8.192-0.512-15.872 3.072-22.016 8.704-5.632 5.632-9.216 13.824-9.216 22.016v378.88c0 16.896 13.824 30.72 30.72 30.72h378.88c16.896 0 30.72-13.824 30.72-30.72 0-223.744-183.808-407.552-409.088-409.6z m30.208 378.88V74.24c167.424 16.384 301.056 150.016 315.904 315.904h-315.904z" fill=#6c757d p-id="7336"></path></svg></a></div>
        <div id="light-dark" style="cursor: pointer;"><a><svg t="1656411842215" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5086" width="12" height="12"><path d="M1007.492874 384.513055c-8.795694-34.58307-21.189627-67.666874-36.682043-99.05151-2.698679-5.397358-10.894667-3.498287-10.894666 2.598728v0.299853c0 32.484098-6.896624 63.868734-19.890263 92.554691-10.694764 23.488501-25.487523 45.077933-43.978471 64.068635-41.779547 42.679107-99.05151 66.967217-158.722299 67.26707-61.869712 0.299853-119.941284-24.188159-162.920244-68.966238-40.280281-41.979449-62.56937-98.251902-62.269516-156.323473 0.399804-59.270984 23.588452-114.94373 65.567901-156.823229 19.59041-19.59041 42.179351-35.082826 66.667364-46.077443C672.956643 71.166451 704.041426 64.469729 736.125719 64.469729h1.299364c6.097015 0 8.096037-8.096037 2.598728-10.794715C708.739126 37.982696 675.655322 25.488812 641.172203 16.493216 599.492607 5.598549 555.714038-0.098662 510.536154 0.001289 222.37722 0.700947-7.41029 237.38508 0.185992 525.444064c7.096526 271.667008 225.889418 490.559851 497.456474 497.856279 287.559228 7.796183 524.14341-220.891864 525.842579-508.551044 0.299853-44.977981-5.297407-88.656599-15.992171-130.236244z m-83.15929 301.552378c-22.588942 53.27392-54.873137 101.250434-95.953027 142.330323-41.179841 41.179841-89.056403 73.464036-142.330324 95.953027-55.172991 23.288599-113.744317 35.182777-174.314666 35.182777s-119.141675-11.794226-174.314666-35.182777c-53.27392-22.588942-101.250434-54.873137-142.330323-95.953027-41.179841-41.179841-73.464036-89.056403-95.953027-142.330323C75.749001 630.892442 63.954774 572.221164 63.954774 511.750767s11.794226-119.141675 35.182777-174.314666c22.588942-53.27392 54.873137-101.250434 95.953027-142.330323 41.179841-41.179841 89.056403-73.464036 142.330323-95.953027C392.593892 75.7642 451.26517 63.969974 511.735567 63.969974c13.99315 0 27.886348 0.599706 41.679596 1.89907C489.246577 118.643209 448.266638 198.704016 448.266638 288.360126c0 159.022152 128.836929 287.859081 287.859081 287.859081 89.156354 0 168.817357-40.580134 221.691473-104.149015 1.099462 13.09359 1.699168 26.387082 1.699168 39.680575 0 60.470397-11.794226 119.141675-35.182776 174.314666z" p-id="5087" fill=#6c757d></path></svg></a></div>
        
    </div>

    
</div>

            <div id="toc">📜</div>
        
    
    
</div>
</div>
        <div id="content">












<div class="container-main 
     container-page 
">

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7409" width="12" height="12"><path d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z" p-id="7410" fill="#adb5bd"></path></svg>
            2022-05-27&nbsp;
        </span>
        <span>
            
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="23838" width="11" height="11"><path d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z" p-id="23839" fill="#adb5bd"></path></svg>
            2022-05-27&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="33866" width="12" height="12"><path d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z" fill="#adb5bd" p-id="33867"></path><path d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z" fill="#adb5bd" p-id="33868"></path></svg>
            15928 字</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="32892" width="12" height="12"><path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z" p-id="32893" fill="#adb5bd"></path><path d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z" p-id="32894" fill="#adb5bd"></path></svg>
            32 分钟</span><div class="container-ctgtag">
	<div class="taxonomy">
		
		<div class="ctg">
			
			
			<a href="/categories/"></a>
			
		</div>
		<div class="tag">
			
			 - 
			
			<a href="/tags/"></a>
			
		</div>
	</div>
</div>
    </div>
    
    <div class="toc">
        
        <div class="page-operation">
            <div><a href="#"><img src="/imgs/icons/arrow-up-circle.svg" alt=""></a></div>
            <div><a href="https://lovemjh.vercel.app/posts/tool/_20220527215246/"><img src="/imgs/icons/arrow-left-circle.svg" alt=""></a></div>
            <div><a href="https://lovemjh.vercel.app/posts/project-0/20220527220542/"><img src="/imgs/icons/arrow-right-circle.svg" alt=""></a></div>
        </div>
        
        <nav id="TableOfContents">
  <ul>
    <li><a href="#学习目标">学习目标</a></li>
    <li><a href="#一-thymeleaf入门">一 Thymeleaf入门</a>
      <ul>
        <li><a href="#1-thymeleaf介绍">1 Thymeleaf介绍</a></li>
        <li><a href="#2-springboot整合thymeleaf">2 Springboot整合thymeleaf</a></li>
        <li><a href="#3-thymeleaf基本语法">3 Thymeleaf基本语法</a>
          <ul>
            <li><a href="#1thaction">(1)th:action</a></li>
            <li><a href="#2theach">(2)th:each</a></li>
            <li><a href="#3map输出">(3)Map输出</a></li>
            <li><a href="#4数组输出">(4)数组输出</a></li>
            <li><a href="#5date输出">(5)Date输出</a></li>
            <li><a href="#6thif条件">(6)th:if条件</a></li>
            <li><a href="#7使用javascript">(7)使用javascript</a></li>
            <li><a href="#8字符拼接-使用">(8)字符拼接 使用||</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#二-搜索页面渲染了解">二 搜索页面渲染（了解）</a>
      <ul>
        <li><a href="#1-搜索分析">1 搜索分析</a></li>
        <li><a href="#2-搜索实现">2 搜索实现</a>
          <ul>
            <li><a href="#21-搜索工程搭建">2.1 搜索工程搭建</a></li>
            <li><a href="#22-搜索数据填充">2.2 搜索数据填充</a></li>
            <li><a href="#23-关键字搜索">2.3 关键字搜索</a></li>
            <li><a href="#24-搜索条件回显">2.4 搜索条件回显</a></li>
            <li><a href="#25-条件搜索实现">2.5 条件搜索实现</a></li>
            <li><a href="#26-移除搜索条件">2.6 移除搜索条件</a></li>
            <li><a href="#27-选中搜索条件隐藏搜索面板项">2.7 选中搜索条件隐藏搜索面板项</a></li>
            <li><a href="#heading"></a></li>
            <li><a href="#28-排序作业">2.8 排序(作业)</a></li>
            <li><a href="#29-分页">2.9 分页</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#三-东易买商品详情页">三 东易买商品详情页</a>
      <ul>
        <li><a href="#1-为什么要使用网页静态化技术">1 为什么要使用网页静态化技术</a></li>
        <li><a href="#2-需求分析">2 需求分析</a></li>
        <li><a href="#3-商品静态化微服务创建">3 商品静态化微服务创建</a>
          <ul>
            <li><a href="#31-搭建项目">3.1 搭建项目</a></li>
            <li><a href="#32-生成静态页">3.2 生成静态页</a>
              <ul>
                <li><a href="#321-需求分析">3.2.1 需求分析</a></li>
                <li><a href="#322-feign创建">3.2.2 Feign创建</a></li>
                <li><a href="#323-静态页生成代码">3.2.3 静态页生成代码</a></li>
                <li><a href="#324-模板填充">3.2.4 模板填充</a></li>
                <li><a href="#325-启动测试">3.2.5 启动测试</a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#四-canal监听生成静态页">四 canal监听生成静态页</a>
      <ul>
        <li><a href="#1-需求分析">1 需求分析</a></li>
        <li><a href="#2-feign创建">2 Feign创建</a></li>
        <li><a href="#3-canal监听数据变化">3 canal监听数据变化</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>

    <div class='content  content '>
        <h1 align = "center">第八章</h1>
<h1 align = "center">Thymeleaf实现搜索页面渲染及商品静态页</h1>
<h3 align="center">优就业.JAVA教研室</h3>
<h1 id="学习目标">学习目标</h1>
<p>目标1：搜索页面渲染</p>
<p>目标2：Thymeleaf的介绍</p>
<p>目标3：Thymeleaf的入门</p>
<p>目标4：Thymeleaf的语法及标签</p>
<p>目标5：搜索页面渲染</p>
<p>目标6：商品详情页静态化工程搭建</p>
<p>目标7：商品详情页静态化功能实现</p>
<p>目标8：用户修改商品信息，同步更新创建商品详情页</p>
<h1 id="一-thymeleaf入门">一 Thymeleaf入门</h1>
<h2 id="1-thymeleaf介绍">1 Thymeleaf介绍</h2>
<p>thymeleaf是一个XML/XHTML/HTML5模板引擎，可用于Web与非Web环境中的应用开发。它是一个开源的Java库，基于Apache License 2.0许可，由Daniel Fernández创建，该作者还是Java加密库Jasypt的作者。</p>
<p>Thymeleaf提供了一个用于整合Spring MVC的可选模块，在应用开发中，你可以使用Thymeleaf来完全代替JSP或其他模板引擎，如Velocity、FreeMarker等。Thymeleaf的主要目标在于提供一种可被浏览器正确显示的、格式良好的模板创建方式，因此也可以用作静态建模。你可以使用它创建经过验证的XML与HTML模板。相对于编写逻辑或代码，开发者只需将标签属性添加到模板中即可。接下来，这些标签属性就会在DOM（文档对象模型）上执行预先制定好的逻辑。</p>
<p>它的特点便是：开箱即用，Thymeleaf允许您处理六种模板，每种模板称为模板模式：</p>
<ul>
<li>XML</li>
<li>有效的XML</li>
<li>XHTML</li>
<li>有效的XHTML</li>
<li>HTML5</li>
<li>旧版HTML5</li>
</ul>
<p>所有这些模式都指的是格式良好的XML文件，但<code>*Legacy HTML5*</code>模式除外，它允许您处理HTML5文件，其中包含独立（非关闭）标记，没有值的标记属性或不在引号之间写入的标记属性。为了在这种特定模式下处理文件，Thymeleaf将首先执行转换，将您的文件转换为格式良好的XML文件，这些文件仍然是完全有效的HTML5（实际上是创建HTML5代码的推荐方法）<a class="link" href="/posts/project-0/https://www.thymeleaf.org/doc/tutorials/2.1/usingthymeleaf.html#fn1"  target="_blank" rel="noopener"
    >1</a>。</p>
<p>另请注意，验证仅适用于XML和XHTML模板。</p>
<p>然而，这些并不是Thymeleaf可以处理的唯一模板类型，并且用户始终能够通过指定在此模式下<em>解析</em>模板的方法和<em>编写</em>结果的方式来定义他/她自己的模式。这样，任何可以建模为DOM树（无论是否为XML）的东西都可以被Thymeleaf有效地作为模板处理。</p>
<h2 id="2-springboot整合thymeleaf">2 Springboot整合thymeleaf</h2>
<p>使用springboot 来集成使用Thymeleaf可以大大减少单纯使用thymleaf的代码量，所以我们接下来使用springboot集成使用thymeleaf.</p>
<p>实现的步骤为：</p>
<ul>
<li>创建一个sprinboot项目</li>
<li>添加thymeleaf的起步依赖</li>
<li>添加spring web的起步依赖</li>
<li>编写html 使用thymleaf的语法获取变量对应后台传递的值</li>
<li>编写controller 设置变量的值到model中</li>
</ul>
<p>(1)创建工程</p>
<p>创建一个独立的工程springboot-thymeleaf,该工程为案例工程，不需要放到dongyimai-parent工程中。</p>
<p><strong>pom.xml依赖</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;project</span> <span style="color:#008080">xmlns=</span><span style="color:#d14">&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#008080">xmlns:xsi=</span><span style="color:#d14">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#008080">xsi:schemaLocation=</span><span style="color:#d14">&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;modelVersion&gt;</span>4.0.0<span style="color:#000080">&lt;/modelVersion&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;groupId&gt;</span>com.offcn<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;artifactId&gt;</span>springboot-thymeleaf<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;version&gt;</span>1.0-SNAPSHOT<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;parent&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>spring-boot-starter-parent<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>2.3.9.RELEASE<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/parent&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependencies&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&lt;!--web起步依赖--&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;artifactId&gt;</span>spring-boot-starter-web<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&lt;!--thymeleaf配置--&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;artifactId&gt;</span>spring-boot-starter-thymeleaf<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependencies&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/project&gt;</span>
</span></span></code></pre></div><p>(2)创建html</p>
<p>在resources中创建templates目录，在templates目录创建 demo1.html,代码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#000080">html</span> <span style="color:#008080">xmlns:th</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;http://www.thymeleaf.org&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#000080">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">title</span>&gt;Thymeleaf的入门&lt;/<span style="color:#000080">title</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">meta</span> <span style="color:#008080">http-equiv</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;Content-Type&#34;</span> <span style="color:#008080">content</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;text/html; charset=UTF-8&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">head</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#000080">body</span>&gt;
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--输出hello数据--&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#000080">p</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${hello}&#34;</span>&gt;&lt;/<span style="color:#000080">p</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">html</span>&gt;
</span></span></code></pre></div><p>解释：</p>
<p><code>&lt;html xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;</code>:这句声明使用thymeleaf标签</p>
<p><code>&lt;p th:text=&quot;${hello}&quot;&gt;&lt;/p&gt;</code>:这句使用 th:text=&quot;${变量名}&quot; 表示 使用thymeleaf获取文本数据，类似于EL表达式。</p>
<p>(3)修改application.yml配置</p>
<p>创建application.yml,并设置thymeleaf的缓存设置，设置为false。默认加缓存的，用于测试。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">spring</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">thymeleaf</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">cache</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span><span style="color:#bbb">
</span></span></span></code></pre></div><p>在这里，其实还有一些默认配置，比如视图前缀：classpath:/templates/,视图后缀：.html</p>
<p><code>org.springframework.boot.autoconfigure.thymeleaf.ThymeleafProperties</code>部分源码如下：
<img src="/posts/project-0/20220527231757/image-20220527231931353.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>(4)控制层</p>
<p>创建controller用于测试后台 设置数据到model中。</p>
<p>创建com.offcn.controller.TestController，代码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Controller</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RequestMapping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/test&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">TestController</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * 访问/test/hello  跳转到demo1页面
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param model
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@RequestMapping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/hello&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> String <span style="color:#900;font-weight:bold">hello</span><span style="color:#000;font-weight:bold">(</span>Model model<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        model<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addAttribute</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;hello&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;hello welcome&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">&#34;demo1&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>(5)测试</p>
<p>创建启动类<code>com.offcn.ThymeleafApplication</code>，代码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@SpringBootApplication</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">ThymeleafApplication</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        SpringApplication<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">run</span><span style="color:#000;font-weight:bold">(</span>ThymeleafApplication<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span>args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>启动系统，并在浏览器访问</p>
<pre tabindex="0"><code>http://localhost:8080/test/hello
</code></pre><p><img src="/posts/project-0/20220527231757/image-20220527231940177.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="3-thymeleaf基本语法">3 Thymeleaf基本语法</h2>
<h3 id="1thaction">(1)th:action</h3>
<p>定义后台控制器路径，类似<code>&lt;form&gt;</code>标签的action属性。</p>
<p>例如：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#000080">form</span> <span style="color:#008080">id</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;login-form&#34;</span> <span style="color:#008080">th:action</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{/test/hello}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">button</span>&gt;提交&lt;/<span style="color:#000080">button</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">form</span>&gt;
</span></span></code></pre></div><p>表示提交的请求地址为<code>/test/hello</code></p>
<h3 id="2theach">(2)th:each</h3>
<p>对象遍历，功能类似jstl中的<code>&lt;c:forEach&gt;</code>标签。</p>
<p>创建com.offcn.model.User,代码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">User</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> Integer id<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> String name<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> String address<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//无参和全参构造器以及..get..set
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>Controller添加数据</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * 访问/test/hello  跳转到demo1页面
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * @param model
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RequestMapping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/hello&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> String <span style="color:#900;font-weight:bold">hello</span><span style="color:#000;font-weight:bold">(</span>Model model<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>    model<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addAttribute</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;hello&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;hello welcome&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//集合数据
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    List<span style="color:#000;font-weight:bold">&lt;</span>User<span style="color:#000;font-weight:bold">&gt;</span> users <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> ArrayList<span style="color:#000;font-weight:bold">&lt;</span>User<span style="color:#000;font-weight:bold">&gt;();</span>
</span></span><span style="display:flex;"><span>    users<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> User<span style="color:#000;font-weight:bold">(</span>1<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;张三&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;深圳&#34;</span><span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>    users<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> User<span style="color:#000;font-weight:bold">(</span>2<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;李四&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;北京&#34;</span><span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>    users<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> User<span style="color:#000;font-weight:bold">(</span>3<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;王五&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;武汉&#34;</span><span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>    model<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addAttribute</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;users&#34;</span><span style="color:#000;font-weight:bold">,</span>users<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">&#34;demo1&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>页面输出</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#000080">table</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">tr</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">td</span>&gt;下标&lt;/<span style="color:#000080">td</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">td</span>&gt;编号&lt;/<span style="color:#000080">td</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">td</span>&gt;姓名&lt;/<span style="color:#000080">td</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">td</span>&gt;住址&lt;/<span style="color:#000080">td</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">tr</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">tr</span> <span style="color:#008080">th:each</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;user,userStat:${users}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">td</span>&gt;
</span></span><span style="display:flex;"><span>            下标:&lt;<span style="color:#000080">span</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${userStat.index}&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;,
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#000080">td</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">td</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${user.id}&#34;</span>&gt;&lt;/<span style="color:#000080">td</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">td</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${user.name}&#34;</span>&gt;&lt;/<span style="color:#000080">td</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">td</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${user.address}&#34;</span>&gt;&lt;/<span style="color:#000080">td</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">tr</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">table</span>&gt;
</span></span></code></pre></div><p>测试效果
<img src="/posts/project-0/20220527231757/image-20220527231951362.png"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="3map输出">(3)Map输出</h3>
<p>后台添加Map</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">//Map定义
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span>Object<span style="color:#000;font-weight:bold">&gt;</span> dataMap <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> HashMap<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span>Object<span style="color:#000;font-weight:bold">&gt;();</span>
</span></span><span style="display:flex;"><span>dataMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;No&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;123&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>dataMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;address&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;深圳&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addAttribute</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;dataMap&#34;</span><span style="color:#000;font-weight:bold">,</span>dataMap<span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><p>页面输出</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#000080">div</span> <span style="color:#008080">th:each</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;map,mapStat:${dataMap}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">div</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${map}&#34;</span>&gt;&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>    key:&lt;<span style="color:#000080">span</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${mapStat.current.key}&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;&lt;<span style="color:#000080">br</span>/&gt;
</span></span><span style="display:flex;"><span>    value:&lt;<span style="color:#000080">span</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${mapStat.current.value}&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;&lt;<span style="color:#000080">br</span>/&gt;
</span></span><span style="display:flex;"><span>    ==============================================
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">div</span>&gt;
</span></span></code></pre></div><p>测试效果
<img src="/posts/project-0/20220527231757/image-20220527231959198.png"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="4数组输出">(4)数组输出</h3>
<p>后台添加数组</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">//存储一个数组
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>String<span style="color:#000;font-weight:bold">[]</span> names <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#d14">&#34;张三&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;李四&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;王五&#34;</span><span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>model<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addAttribute</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;names&#34;</span><span style="color:#000;font-weight:bold">,</span>names<span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><p>页面输出</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#000080">div</span> <span style="color:#008080">th:each</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;nm,nmStat:${names}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">span</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${nmStat.count}&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;&lt;<span style="color:#000080">span</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${nm}&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>    ==============================================
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">div</span>&gt;
</span></span></code></pre></div><p>测试效果
<img src="/posts/project-0/20220527231757/image-20220527232005560.png"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="5date输出">(5)Date输出</h3>
<p>后台添加日期</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">//日期
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>model<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addAttribute</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;now&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000;font-weight:bold">new</span> Date<span style="color:#000;font-weight:bold">());</span>
</span></span></code></pre></div><p>页面输出</p>
<pre tabindex="0"><code class="language-php+HTML" data-lang="php+HTML">&lt;div&gt;
    &lt;h1&gt;Date输出 th:text&lt;/h1&gt;
    &lt;span th:text=&#34;${#dates.format(now,&#39;yyyy-MM-dd hh:ss:mm&#39;)}&#34;&gt;&lt;/span&gt;
&lt;/div&gt;
</code></pre><p>测试效果
<img src="/posts/project-0/20220527231757/image-20220527232012182.png"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="6thif条件">(6)th:if条件</h3>
<p>后台添加年龄</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">//if条件
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>model<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addAttribute</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;age&#34;</span><span style="color:#000;font-weight:bold">,</span>22<span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><p>页面输出</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>     &lt;<span style="color:#000080">h1</span>&gt;条件判断 th:if&lt;/<span style="color:#000080">h1</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">span</span> <span style="color:#008080">th:if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${(age&gt;=18)}&#34;</span>&gt;终于长大了！&lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">div</span>&gt;
</span></span></code></pre></div><p>测试效果
<img src="/posts/project-0/20220527231757/image-20220527232019197.png"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="7使用javascript">(7)使用javascript</h3>
<p><img src="/posts/project-0/20220527231757/image-20220527232024623.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>java代码为:
<img src="/posts/project-0/20220527231757/image-20220527232029596.png"
    
    
    
    loading="lazy"
    
    
></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#000080">button</span> <span style="color:#008080">onclick</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;abc()&#34;</span>&gt;aaaaaaa&lt;/<span style="color:#000080">button</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#000080">script</span> <span style="color:#008080">th:inline</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;javascript&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">var</span> hhh<span style="color:#000;font-weight:bold">=</span>[[${hello}]];
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">function</span> abc(){
</span></span><span style="display:flex;"><span>        alert(hhh);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">html</span>&gt;
</span></span></code></pre></div><p>运行结果：（注意script放置在body外面）</p>
<p><img src="/posts/project-0/20220527231757/image-20220527232036664.png"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="8字符拼接-使用">(8)字符拼接 使用||</h3>
<p>后台代码:
<img src="/posts/project-0/20220527231757/image-20220527232042777.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>模板:
<img src="/posts/project-0/20220527231757/image-20220527232049016.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>查看生成的页面demo1.html的源码，可以看到如下</p>
<p><img src="/posts/project-0/20220527231757/image-20220527232055293.png"
    
    
    
    loading="lazy"
    
    
></p>
<h1 id="二-搜索页面渲染了解">二 搜索页面渲染（了解）</h1>
<h2 id="1-搜索分析">1 搜索分析</h2>
<p><img src="/posts/project-0/20220527231757/image-20220527232101303.png"
    
    
    
    loading="lazy"
    
    
></p>
<p><img src="/posts/project-0/20220527231757/image-20220527232106209.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>搜索页面要显示的内容主要分为3块。</p>
<p>1)搜索的数据结果</p>
<p>2)筛选出的数据搜索条件</p>
<p>3)用户已经勾选的数据条件</p>
<h2 id="2-搜索实现">2 搜索实现</h2>
<p><img src="/posts/project-0/20220527231757/image-20220527232114255.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>搜索的业务流程如上图，用户每次搜索的时候，先经过搜索业务工程，搜索业务工程调用搜索微服务工程，这里搜索业务工程单独挪出来的原因是它这里涉及到了模板渲染以及其他综合业务处理，以后很有可能会有移动端的搜索和PC端的搜索，后端渲染如果直接在搜索微服务中进行，会对微服务造成一定的侵入，不推荐这么做，推荐微服务独立，只提供服务，如果有其他页面渲染操作，可以搭建一个独立的消费工程调用微服务达到目的。</p>
<h3 id="21-搜索工程搭建">2.1 搜索工程搭建</h3>
<p>(1)工程创建</p>
<p>在dongyimai-web工程中创建dongyimai-search-web工程,</p>
<p><img src="/posts/project-0/20220527231757/image-20220527232120176.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>并在dongyimai-web的pom.xml中引入如下依赖：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;dependencies&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>spring-boot-starter-thymeleaf<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>spring-boot-starter-web<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>org.springframework.cloud<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>spring-cloud-starter-netflix-eureka-client<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--feign--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>org.springframework.cloud<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>spring-cloud-starter-openfeign<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/dependencies&gt;</span>
</span></span></code></pre></div><p>(2)静态资源导入</p>
<p>将资源中的<code>页面/前端页面/search.html</code>拷贝到工程的<code>resources/templates</code>目录下，js、css等拷贝到<code>static</code>目录下，如下图：
<img src="/posts/project-0/20220527231757/image-20220527232127204.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>(3)Feign创建</p>
<p>dongyimai-search-service-api，添加<code>com.offcn.search.feign.SearchSkuFeign</code>，</p>
<p><img src="/posts/project-0/20220527231757/image-20220527232132589.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>实现调用搜索，代码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@FeignClient</span><span style="color:#000;font-weight:bold">(</span>name<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;search&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RequestMapping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/search&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">interface</span> <span style="color:#458;font-weight:bold">SearchSkuFeign</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * 搜索
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param searchMap
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@GetMapping</span>
</span></span><span style="display:flex;"><span>    Map <span style="color:#900;font-weight:bold">search</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3c5d5d;font-weight:bold">@RequestBody</span><span style="color:#000;font-weight:bold">(</span>required <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">)</span> Map searchMap<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>由于以后做搜索都是基于GET请求，所以我们需要将之前的搜索改成GET请求操作，修改<code>dongyimai-search-service</code>微服务的<code>com.offcn.search.controller.SkuController</code>里面的<code>search</code>方法，代码如下：</p>
<p><img src="/posts/project-0/20220527231757/image-20220527232359336.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>(4)dongyimai-search-web的pom.xml依赖dongyimai-search-service-api</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>        <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;groupId&gt;</span>com.offcn<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;artifactId&gt;</span>dongyimai-search-service-api<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;version&gt;</span>1.0<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;exclusions&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000080">&lt;exclusion&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000080">&lt;groupId&gt;</span>com.alibaba<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000080">&lt;artifactId&gt;</span>druid-spring-boot-starter<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000080">&lt;/exclusion&gt;</span>
</span></span><span style="display:flex;"><span>           <span style="color:#000080">&lt;/exclusions&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>(5)搜索调用</p>
<p>在dongyimai-search-web中创建com.offcn.search.controller.SkuController,实现调用搜索，代码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Controller</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RequestMapping</span><span style="color:#000;font-weight:bold">(</span>value <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;/search&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">SkuController</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> SearchSkuFeign searchSkuFeign<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * 搜索
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param searchMap
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@GetMapping</span><span style="color:#000;font-weight:bold">(</span>value <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;/list&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> String <span style="color:#900;font-weight:bold">search</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3c5d5d;font-weight:bold">@RequestParam</span><span style="color:#000;font-weight:bold">(</span>required <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">)</span> Map searchMap<span style="color:#000;font-weight:bold">,</span> Model model<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//dongyimai-search-service微服务
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        Map resultMap <span style="color:#000;font-weight:bold">=</span> searchSkuFeign<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">search</span><span style="color:#000;font-weight:bold">(</span>searchMap<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        model<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addAttribute</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;result&#34;</span><span style="color:#000;font-weight:bold">,</span>resultMap<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">&#34;search&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>(6)启动类创建</p>
<p>修改dongyimai-search-web,添加启动类com.offcn.search.SearchWebApplication，代码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@SpringBootApplication</span><span style="color:#000;font-weight:bold">(</span>exclude<span style="color:#000;font-weight:bold">={</span>DataSourceAutoConfiguration<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@EnableDiscoveryClient</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@EnableFeignClients</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">SearchWebApplication</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        SpringApplication<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">run</span><span style="color:#000;font-weight:bold">(</span>SearchWebApplication<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span>args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>(7)application.yml配置文件</p>
<pre tabindex="0"><code class="language-properties" data-lang="properties">server:
  port: 9101
eureka:
  client:
    service-url:
      defaultZone: http://127.0.0.1:8761/eureka
  instance:
    prefer-ip-address: true
feign:
  hystrix:
    enabled: true
spring:
  thymeleaf:
    cache: false
  application:
    name: search-web
  main:
    allow-bean-definition-overriding: true  
</code></pre><p>(8)项目完整结构
<img src="/posts/project-0/20220527231757/image-20220527232412682.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>在search.html的头部引入thymeleaf标签</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;html</span> <span style="color:#008080">xmlns:th=</span><span style="color:#d14">&#34;http://www.thymeleaf.org&#34;</span><span style="color:#000080">&gt;</span>
</span></span></code></pre></div><p>将样式修改为：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#000080">link</span> <span style="color:#008080">rel</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;stylesheet&#34;</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;text/css&#34;</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;css/webbase.css&#34;</span> <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{/css/webbase.css}&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#000080">link</span> <span style="color:#008080">rel</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;stylesheet&#34;</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;text/css&#34;</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;css/pages-list.css&#34;</span> <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{/css/pages-list.css}&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#000080">link</span> <span style="color:#008080">rel</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;stylesheet&#34;</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;text/css&#34;</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;css/widget-cartPanelView.css&#34;</span>
</span></span><span style="display:flex;"><span>			  <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{/css/widget-cartPanelView.css}&#34;</span>/&gt;
</span></span></code></pre></div><p>测试：<code>http://localhost:9101/search</code>,效果如下：
<img src="/posts/project-0/20220527231757/image-20220527232419302.png"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="22-搜索数据填充">2.2 搜索数据填充</h3>
<p>后端搜索到数据后，前端页面进行数据显示，显示的数据分为3部分</p>
<pre tabindex="0"><code class="language-properties" data-lang="properties">1)搜索的数据结果
2)筛选出的数据搜索条件
3)用户已经勾选的数据条件
</code></pre><h3 id="23-关键字搜索">2.3 关键字搜索</h3>
<p>用户每次输入关键字的时候，直接根据关键字搜索，关键字搜索的数据会存储到<code>result.rows</code>中，页面每次根据result获取rows，然后循环输出即可,同时页面的搜索框每次需要回显搜索的关键词。</p>
<p>实现思路</p>
<pre tabindex="0"><code class="language-properties" data-lang="properties">1.前端表单提交搜索的关键词
2.后端根据关键词进行搜索
3.将搜索条件存储到Model中
4.页面循环迭代输出数据
5.搜索表单回显搜索的关键词
</code></pre><p>(1)后台搜索实现</p>
<p>修改SkuController的search方法，代码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * 搜索
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * @param searchMap
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@GetMapping</span><span style="color:#000;font-weight:bold">(</span>value <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;/list&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> String <span style="color:#900;font-weight:bold">search</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3c5d5d;font-weight:bold">@RequestParam</span><span style="color:#000;font-weight:bold">(</span>required <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">)</span> Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span>String<span style="color:#000;font-weight:bold">&gt;</span> searchMap<span style="color:#000;font-weight:bold">,</span> Model model<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//调用dongyimai-search-service微服务
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span>Object<span style="color:#000;font-weight:bold">&gt;</span> resultMap <span style="color:#000;font-weight:bold">=</span> searchSkuFeign<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">search</span><span style="color:#000;font-weight:bold">(</span>searchMap<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//搜索数据结果
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    model<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addAttribute</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;result&#34;</span><span style="color:#000;font-weight:bold">,</span>resultMap<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//搜索条件
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    model<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addAttribute</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;searchMap&#34;</span><span style="color:#000;font-weight:bold">,</span>searchMap<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">&#34;search&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>(2)页面搜索实现</p>
<p>修改search.html
<img src="/posts/project-0/20220527231757/image-20220527232426786.png"
    
    
    
    loading="lazy"
    
    
></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#000080">form</span> <span style="color:#008080">action</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;/search/list&#34;</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;sui-form form-inline&#34;</span>&gt;
</span></span><span style="display:flex;"><span>   <span style="color:#998;font-style:italic">&lt;!--searchAutoComplete--&gt;</span>
</span></span><span style="display:flex;"><span>   &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;input-append&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">input</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;text&#34;</span> <span style="color:#008080">id</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;autocomplete&#34;</span> <span style="color:#008080">name</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;keywords&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#008080">th:value</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${#maps.containsKey(searchMap,&#39;keywords&#39;)}?${searchMap.keywords}:&#39;&#39;&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;input-error input-xxlarge&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">button</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;sui-btn btn-xlarge btn-danger&#34;</span> <span style="color:#008080">type</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;submit&#34;</span>&gt;搜索&lt;/<span style="color:#000080">button</span>&gt;
</span></span><span style="display:flex;"><span>   &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">form</span>&gt;
</span></span></code></pre></div><p>注意：搜索按钮为submit提交。</p>
<p>(3)页面结果输出</p>
<p>修改search.html，代码如下：
<img src="/posts/project-0/20220527231757/image-20220527232434952.png"
    
    
    
    loading="lazy"
    
    
></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#000080">ul</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;yui3-g&#34;</span>&gt;
</span></span><span style="display:flex;"><span>   &lt;<span style="color:#000080">li</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;yui3-u-1-5&#34;</span> <span style="color:#008080">th:each</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;sku,skuStat:${result.rows}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;list-wrap&#34;</span>&gt;
</span></span><span style="display:flex;"><span>         &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;p-img&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">a</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;item.html&#34;</span> <span style="color:#008080">target</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;_blank&#34;</span>&gt;&lt;<span style="color:#000080">img</span> <span style="color:#008080">th:src</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${sku.image}&#34;</span> /&gt;&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>         &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>         &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;price&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">strong</span>&gt;
</span></span><span style="display:flex;"><span>                  &lt;<span style="color:#000080">em</span>&gt;¥&lt;/<span style="color:#000080">em</span>&gt;
</span></span><span style="display:flex;"><span>                  &lt;<span style="color:#000080">i</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${sku.price}&#34;</span>&gt;&lt;/<span style="color:#000080">i</span>&gt;
</span></span><span style="display:flex;"><span>               &lt;/<span style="color:#000080">strong</span>&gt;
</span></span><span style="display:flex;"><span>         &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>         &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;attr&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">em</span> <span style="color:#008080">th:utext</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${#strings.abbreviate(sku.title,45)}&#34;</span>&gt;&lt;/<span style="color:#000080">em</span>&gt;
</span></span><span style="display:flex;"><span>         &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>         &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;cu&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">em</span>&gt;&lt;/<span style="color:#000080">em</span>&gt;
</span></span><span style="display:flex;"><span>         &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>         &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;commit&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">i</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;command&#34;</span>&gt;已有2000人评价&lt;/<span style="color:#000080">i</span>&gt;
</span></span><span style="display:flex;"><span>         &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>         &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;operate&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">a</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;success-cart.html&#34;</span> <span style="color:#008080">target</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;_blank&#34;</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;sui-btn btn-bordered btn-danger&#34;</span>&gt;加入购物车&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">a</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;javascript:void(0);&#34;</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;sui-btn btn-bordered&#34;</span>&gt;对比&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">a</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;javascript:void(0);&#34;</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;sui-btn btn-bordered&#34;</span>&gt;关注&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>         &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>   &lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">ul</span>&gt;
</span></span></code></pre></div><p>(4)测试，在地址栏输入：http://localhost:9101/search/list/</p>
<p>搜索<code>华为</code>关键字,效果如下：
<img src="/posts/project-0/20220527231757/image-20220527232443319.png"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="24-搜索条件回显">2.4 搜索条件回显</h3>
<p><img src="/posts/project-0/20220527231757/image-20220527232448536.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>搜索条件除了关键字外，还有分类、品牌、以及规格，这些在我们前面已经将数据存入到了Map中，我们可以直接从Map中将数据取出，然后在页面输出即可。</p>
<p>分类：<code>result.categoryList</code></p>
<p>品牌：<code>result.brandList</code></p>
<p>规格：<code>result.specList</code></p>
<p>修改search.html的条件显示部分<img src="/posts/project-0/20220527231757/image-20220527232456274.png"
    
    
    
    loading="lazy"
    
    
></p>
<p><img src="/posts/project-0/20220527231757/image-20220527232501990.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>上图代码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span> 			<span style="color:#998;font-style:italic">&lt;!--selector--&gt;</span>
</span></span><span style="display:flex;"><span>			&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;clearfix selector&#34;</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;type-wrap&#34;</span> <span style="color:#008080">th:if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${#maps.containsKey(result,&#39;categoryList&#39;)&amp;&amp;!#maps.containsKey(searchMap,&#39;category&#39;)}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl key&#34;</span>&gt;商品分类&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl value&#34;</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;<span style="color:#000080">span</span> <span style="color:#008080">th:each</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;category,categoryStat:${result.categoryList}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${category}&#34;</span>&gt;&lt;/<span style="color:#000080">a</span>&gt;<span style="color:#800080">&amp;nbsp;</span>  <span style="color:#800080">&amp;nbsp;</span>
</span></span><span style="display:flex;"><span>						&lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>					&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl ext&#34;</span>&gt;&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;type-wrap logo&#34;</span> <span style="color:#008080">th:if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${#maps.containsKey(result,&#39;brandList&#39;)&amp;&amp;!#maps.containsKey(searchMap,&#39;brand&#39;)}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl key brand&#34;</span>&gt;品牌&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;value logos&#34;</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;<span style="color:#000080">ul</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;logo-list&#34;</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span> <span style="color:#008080">th:each</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;brand,brandStat:${result.brandList}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${brand}&#34;</span>&gt;&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>						&lt;/<span style="color:#000080">ul</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;ext&#34;</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;<span style="color:#000080">a</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;javascript:void(0);&#34;</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;sui-btn&#34;</span>&gt;多选&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;<span style="color:#000080">a</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;javascript:void(0);&#34;</span>&gt;更多&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;type-wrap&#34;</span> <span style="color:#008080">th:each</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;spec,specStat:${result.specMap}&#34;</span> <span style="color:#008080">th:unless</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${#maps.containsKey(searchMap,&#39;spec_&#39;+spec.key)}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl key&#34;</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${spec.key}&#34;</span>&gt;&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl value&#34;</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;<span style="color:#000080">ul</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;type-list&#34;</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span> <span style="color:#008080">th:each</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;op,opStat:${spec.value}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${op}&#34;</span>&gt;&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>						&lt;/<span style="color:#000080">ul</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl ext&#34;</span>&gt;&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>				&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;type-wrap&#34;</span> <span style="color:#008080">th:unless</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${#maps.containsKey(searchMap,&#39;price&#39;)}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl key&#34;</span>&gt;价格&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl value&#34;</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;<span style="color:#000080">ul</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;type-list&#34;</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;0-500元&#34;</span>&gt;&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;500-1000元&#34;</span>&gt;&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;1000-1500元&#34;</span>&gt;&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;1500-2000元&#34;</span>&gt;&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;2000-3000元&#34;</span>&gt; &lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;3000元以上&#34;</span>&gt;&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;/<span style="color:#000080">ul</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl ext&#34;</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;type-wrap&#34;</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl key&#34;</span>&gt;更多筛选项&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl value&#34;</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;<span style="color:#000080">ul</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;type-list&#34;</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span>&gt;特点&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span>&gt;系统&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span>&gt;手机内存 &lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span>&gt;单卡双卡&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span>&gt;其他&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;/<span style="color:#000080">ul</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl ext&#34;</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>			&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>			<span style="color:#998;font-style:italic">&lt;!--details--&gt;</span>
</span></span></code></pre></div><p>解释：</p>
<pre tabindex="0"><code class="language-properties" data-lang="properties">th:unless:条件不满足时，才显示
${#maps.containsKey(result,&#39;brandList&#39;)}:map中包含某个key
</code></pre><p>测试：访问：http://localhost:9101/search/list 输入 关键字 黑色</p>
<p><img src="/posts/project-0/20220527231757/image-20220527232513672.png"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="25-条件搜索实现">2.5 条件搜索实现</h3>
<p><img src="/posts/project-0/20220527231757/image-20220527232522080.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>用户每次点击搜索的时候，其实在上次搜索的基础之上加上了新的搜索条件，也就是在上一次请求的URL后面追加了新的搜索条件，我们可以在后台每次拼接组装出上次搜索的URL，然后每次将URL存入到Model中，页面每次点击不同条件的时候，从Model中取出上次请求的URL，然后再加上新点击的条件参数实现跳转即可。</p>
<p>(1)后台记录搜索URL</p>
<p>修改SkuController，添加组装URL的方法，并将组装好的URL存储起来,代码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * 搜索
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param searchMap
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@GetMapping</span><span style="color:#000;font-weight:bold">(</span>value <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;/list&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> String <span style="color:#900;font-weight:bold">search</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3c5d5d;font-weight:bold">@RequestParam</span><span style="color:#000;font-weight:bold">(</span>required <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">)</span> Map searchMap<span style="color:#000;font-weight:bold">,</span> Model model<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//1.调用搜索微服务的 feign  根据搜索的条件参数 查询 数据
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//调用dongyimai-search-service微服务
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        Map resultMap <span style="color:#000;font-weight:bold">=</span> searchSkuFeign<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">search</span><span style="color:#000;font-weight:bold">(</span>searchMap<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//2.将数据设置到model中     (模板文件中 根据th:标签数据展示)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        model<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addAttribute</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;result&#34;</span><span style="color:#000;font-weight:bold">,</span>resultMap<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//3.设置搜索的条件 回显
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        model<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addAttribute</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;searchMap&#34;</span><span style="color:#000;font-weight:bold">,</span>searchMap<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//4.记住之前的URL
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//拼接url
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        String url <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setUrl</span><span style="color:#000;font-weight:bold">(</span>searchMap<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        model<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addAttribute</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;url&#34;</span><span style="color:#000;font-weight:bold">,</span>url<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">&#34;search&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> <span style="color:#000;font-weight:bold">private</span> String <span style="color:#900;font-weight:bold">setUrl</span><span style="color:#000;font-weight:bold">(</span>Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> String<span style="color:#000;font-weight:bold">&gt;</span> searchMap<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        String url <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;/search/list&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>searchMap<span style="color:#000;font-weight:bold">!=</span><span style="color:#000;font-weight:bold">null</span> <span style="color:#000;font-weight:bold">&amp;&amp;</span> searchMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">size</span><span style="color:#000;font-weight:bold">()&gt;</span>0<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>            url<span style="color:#000;font-weight:bold">+=</span><span style="color:#d14">&#34;?&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>Map<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Entry</span><span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> String<span style="color:#000;font-weight:bold">&gt;</span> stringStringEntry <span style="color:#000;font-weight:bold">:</span> searchMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">entrySet</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                String key <span style="color:#000;font-weight:bold">=</span> stringStringEntry<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getKey</span><span style="color:#000;font-weight:bold">();</span><span style="color:#998;font-style:italic">// keywords / brand  / category
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                String value <span style="color:#000;font-weight:bold">=</span> stringStringEntry<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getValue</span><span style="color:#000;font-weight:bold">();</span><span style="color:#998;font-style:italic">//华为  / 华为  / 笔记本
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>key<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">equals</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;pageNum&#34;</span><span style="color:#000;font-weight:bold">)){</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">continue</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>                url<span style="color:#000;font-weight:bold">+=</span>key<span style="color:#000;font-weight:bold">+</span><span style="color:#d14">&#34;=&#34;</span><span style="color:#000;font-weight:bold">+</span>value<span style="color:#000;font-weight:bold">+</span><span style="color:#d14">&#34;&amp;&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//去掉多余的&amp;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>url<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">lastIndexOf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;&amp;&#34;</span><span style="color:#000;font-weight:bold">)!=-</span>1<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>                url <span style="color:#000;font-weight:bold">=</span>  url<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">substring</span><span style="color:#000;font-weight:bold">(</span>0<span style="color:#000;font-weight:bold">,</span>url<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">lastIndexOf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;&amp;&#34;</span><span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> url<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>(2)页面搜索对接
<img src="/posts/project-0/20220527231757/image-20220527232530986.png"
    
    
    
    loading="lazy"
    
    
></p>
<p><img src="/posts/project-0/20220527231757/image-20220527232538480.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>完整代码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--selector--&gt;</span>
</span></span><span style="display:flex;"><span>			&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;clearfix selector&#34;</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;type-wrap&#34;</span> <span style="color:#008080">th:if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${#maps.containsKey(result,&#39;categoryList&#39;)}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl key&#34;</span>&gt;商品分类&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl value&#34;</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;<span style="color:#000080">span</span> <span style="color:#008080">th:each</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;category,categoryStat:${result.categoryList}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${url}(category=${category})}&#34;</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${category}&#34;</span>&gt;&lt;/<span style="color:#000080">a</span>&gt;<span style="color:#800080">&amp;nbsp;</span>  <span style="color:#800080">&amp;nbsp;</span>
</span></span><span style="display:flex;"><span>						&lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>					&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl ext&#34;</span>&gt;&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;type-wrap logo&#34;</span> <span style="color:#008080">th:if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${#maps.containsKey(result,&#39;brandList&#39;)}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl key brand&#34;</span>&gt;品牌&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;value logos&#34;</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;<span style="color:#000080">ul</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;logo-list&#34;</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span> <span style="color:#008080">th:each</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;brand,brandStat:${result.brandList}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${url}(brand=${brand})}&#34;</span>  <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${brand}&#34;</span>&gt;&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>						&lt;/<span style="color:#000080">ul</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;ext&#34;</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;<span style="color:#000080">a</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;javascript:void(0);&#34;</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;sui-btn&#34;</span>&gt;多选&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;<span style="color:#000080">a</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;javascript:void(0);&#34;</span>&gt;更多&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;type-wrap&#34;</span> <span style="color:#008080">th:each</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;spec,specStat:${result.specMap}&#34;</span> <span style="color:#008080">th:unless</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${#maps.containsKey(searchMap,&#39;spec_&#39;+spec.key)}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl key&#34;</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${spec.key}&#34;</span>&gt;&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl value&#34;</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;<span style="color:#000080">ul</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;type-list&#34;</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span> <span style="color:#008080">th:each</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;op,opStat:${spec.value}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${url}(&#39;spec_&#39;+${spec.key}=${op})}&#34;</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${op}&#34;</span>&gt;&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>						&lt;/<span style="color:#000080">ul</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl ext&#34;</span>&gt;&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>				&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;type-wrap&#34;</span> <span style="color:#008080">th:unless</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${#maps.containsKey(searchMap,&#39;price&#39;)}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl key&#34;</span>&gt;价格&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl value&#34;</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;<span style="color:#000080">ul</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;type-list&#34;</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${url}(price=&#39;0-500&#39;)}&#34;</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;0-500元&#34;</span>&gt;&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${url}(price=&#39;500-1000&#39;)}&#34;</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;500-1000元&#34;</span>&gt;&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${url}(price=&#39;1000-1500&#39;)}&#34;</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;1000-1500元&#34;</span>&gt;&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${url}(price=&#39;1500-2000&#39;)}&#34;</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;1500-2000元&#34;</span>&gt;&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${url}(price=&#39;2000-3000&#39;)}&#34;</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;2000-3000元&#34;</span>&gt; &lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${url}(price=&#39;3000-*&#39;)}&#34;</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;3000元以上&#34;</span>&gt;&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;/<span style="color:#000080">ul</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl ext&#34;</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;/<span style="color:#000080">div</span>&gt;
</span></span></code></pre></div><p>th:href 这里是超链接的语法，例如：<code>th:href=&quot;@{${url}(price='500-1000')}&quot;</code>表示请求地址是取<code>url</code>参数的值，同时向后台传递参数price的值为500-100。</p>
<p>如下是查询的时候，后台使用打印输出语句输出的结果
<img src="/posts/project-0/20220527231757/image-20220527232548932.png"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="26-移除搜索条件">2.6 移除搜索条件</h3>
<p><img src="/posts/project-0/20220527231757/image-20220527232553986.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>如上图，用户点击条件搜索后，要将选中的条件显示出来，并提供移除条件的<code>x</code>按钮,显示条件我们可以从searchMap中获取，移除其实就是将之前的请求地址中的指定条件删除即可。</p>
<p>(1)条件显示</p>
<p>修改search.html，代码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--bread--&gt;</span>
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;bread&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">ul</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl sui-breadcrumb&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>                    &lt;<span style="color:#000080">a</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;#&#34;</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${result.total}&#34;</span>&gt;全部结果&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#000080">ul</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">ul</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;tags-choose&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#000080">li</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;tag&#34;</span> <span style="color:#008080">th:if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${#maps.containsKey(searchMap,&#39;category&#39;)}&#34;</span>&gt;商品分类:&lt;<span style="color:#000080">i</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${searchMap.category}&#34;</span>&gt;&lt;/<span style="color:#000080">i</span>&gt;&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#000080">li</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;tag&#34;</span> <span style="color:#008080">th:if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${#maps.containsKey(searchMap,&#39;brand&#39;)}&#34;</span>&gt;品牌:&lt;<span style="color:#000080">i</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${searchMap.brand}&#34;</span>&gt;&lt;/<span style="color:#000080">i</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#000080">li</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;tag&#34;</span> <span style="color:#008080">th:if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${#maps.containsKey(searchMap,&#39;price&#39;)}&#34;</span>&gt;价格:&lt;<span style="color:#000080">i</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${searchMap.price}&#34;</span>&gt;&lt;/<span style="color:#000080">i</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#000080">li</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;tag&#34;</span> <span style="color:#008080">th:each</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;spec,specStat:${searchMap}&#34;</span> <span style="color:#008080">th:if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${#strings.startsWith(spec.key,&#39;spec_&#39;)}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                    &lt;<span style="color:#000080">i</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${#strings.substring(spec.key,5)}&#34;</span>&gt;手机屏幕尺寸&lt;/<span style="color:#000080">i</span>&gt;
</span></span><span style="display:flex;"><span>                    :
</span></span><span style="display:flex;"><span>                    &lt;<span style="color:#000080">i</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${spec.value}&#34;</span>&gt;5.5寸&lt;/<span style="color:#000080">i</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#000080">ul</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;clearfix&#34;</span>&gt;&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#000080">div</span>&gt;
</span></span></code></pre></div><p>解释：</p>
<pre tabindex="0"><code class="language-properties" data-lang="properties">${#strings.startsWith(spec.key,&#39;spec_&#39;)}:表示以spec_开始的key
${#strings.replace(spec.key,&#39;spec_&#39;,&#39;&#39;)}:表示将spec.key中的spec_替换成空
</code></pre><p>(2)移除搜索条件</p>
<p>修改search.html，移除分类、品牌、价格、规格搜索条件，代码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--bread--&gt;</span>
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;bread&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">ul</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl sui-breadcrumb&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>                    &lt;<span style="color:#000080">a</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;#&#34;</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${result.total}&#34;</span>&gt;全部结果&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#000080">ul</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">ul</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;tags-choose&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#000080">li</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;tag&#34;</span> <span style="color:#008080">th:if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${#maps.containsKey(searchMap,&#39;category&#39;)}&#34;</span>&gt;商品分类:&lt;<span style="color:#000080">i</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${searchMap.category}&#34;</span>&gt;&lt;/<span style="color:#000080">i</span>&gt;&lt;<span style="color:#000080">a</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;sui-icon icon-tb-close&#34;</span>
</span></span><span style="display:flex;"><span>                                                               <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${#strings.replace(url,&#39;category=&#39;+searchMap.category,&#39;&#39;)}}&#34;</span>&gt;&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#000080">li</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;tag&#34;</span> <span style="color:#008080">th:if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${#maps.containsKey(searchMap,&#39;brand&#39;)}&#34;</span>&gt;品牌:&lt;<span style="color:#000080">i</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${searchMap.brand}&#34;</span>&gt;&lt;/<span style="color:#000080">i</span>&gt;&lt;<span style="color:#000080">a</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;sui-icon icon-tb-close&#34;</span>
</span></span><span style="display:flex;"><span>                                                            <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${#strings.replace(url,&#39;brand=&#39;+searchMap.brand,&#39;&#39;)}}&#34;</span>&gt;&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#000080">li</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;tag&#34;</span> <span style="color:#008080">th:if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${#maps.containsKey(searchMap,&#39;price&#39;)}&#34;</span>&gt;价格:&lt;<span style="color:#000080">i</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${searchMap.price}&#34;</span>&gt;&lt;/<span style="color:#000080">i</span>&gt;&lt;<span style="color:#000080">a</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;sui-icon icon-tb-close&#34;</span>
</span></span><span style="display:flex;"><span>                                                            <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${#strings.replace(url,&#39;price=&#39;+searchMap.price,&#39;&#39;)}}&#34;</span>&gt;&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#000080">li</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;tag&#34;</span> <span style="color:#008080">th:each</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;spec,specStat:${searchMap}&#34;</span> <span style="color:#008080">th:if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${#strings.startsWith(spec.key,&#39;spec_&#39;)}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                    &lt;<span style="color:#000080">i</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${#strings.substring(spec.key,5)}&#34;</span>&gt;手机屏幕尺寸&lt;/<span style="color:#000080">i</span>&gt;
</span></span><span style="display:flex;"><span>                    :
</span></span><span style="display:flex;"><span>                    &lt;<span style="color:#000080">i</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${spec.value}&#34;</span>&gt;5.5寸&lt;/<span style="color:#000080">i</span>&gt;
</span></span><span style="display:flex;"><span>                    &lt;<span style="color:#000080">a</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;sui-icon icon-tb-close&#34;</span>
</span></span><span style="display:flex;"><span>                       <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${#strings.replace(url,spec.key+&#39;=&#39;+spec.value,&#39;&#39;)}}&#34;</span>&gt;&lt;/<span style="color:#000080">a</span>&gt;&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#000080">ul</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;clearfix&#34;</span>&gt;&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#000080">div</span>&gt;
</span></span></code></pre></div><h3 id="27-选中搜索条件隐藏搜索面板项">2.7 选中搜索条件隐藏搜索面板项</h3>
<p>当有选中的搜索条件的时候，对应的搜索面板项就隐藏掉，避免出现用户重复选择的情况
<img src="/posts/project-0/20220527231757/image-20220527232604235.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>实现代码，在没个搜索项上增加控制条件，当存在搜索条件的时候，就隐藏搜索面板项</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;type-wrap&#34;</span> <span style="color:#008080">th:if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${#maps.containsKey(result,&#39;categoryList&#39;)} and !${#maps.containsKey(searchMap,&#39;category&#39;)}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl key&#34;</span>&gt;商品分类&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl value&#34;</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;<span style="color:#000080">span</span> <span style="color:#008080">th:each</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;category,categoryStat:${result.categoryList}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>						 &lt;<span style="color:#000080">a</span> <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${url}(category=${category})}&#34;</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${category}&#34;</span>&gt;手机&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl ext&#34;</span>&gt;&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;type-wrap logo&#34;</span> <span style="color:#008080">th:if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${#maps.containsKey(result,&#39;brandList&#39;)} and !${#maps.containsKey(searchMap,&#39;brand&#39;)}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl key brand&#34;</span>&gt;品牌&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;value logos&#34;</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;<span style="color:#000080">ul</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;logo-list&#34;</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span> <span style="color:#008080">th:each</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;brand:${result.brandList}&#34;</span>&gt;&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${url}(brand=${brand})}&#34;</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${brand}&#34;</span>&gt;&lt;/<span style="color:#000080">li</span>&gt;							
</span></span><span style="display:flex;"><span>						&lt;/<span style="color:#000080">ul</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;ext&#34;</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;<span style="color:#000080">a</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;javascript:void(0);&#34;</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;sui-btn&#34;</span>&gt;多选&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;<span style="color:#000080">a</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;javascript:void(0);&#34;</span>&gt;更多&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;type-wrap&#34;</span> <span style="color:#008080">th:each</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;spec:${result.specMap}&#34;</span> <span style="color:#008080">th:unless</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${#maps.containsKey(searchMap,&#39;spec_&#39;+spec.key)}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl key&#34;</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${spec.key}&#34;</span>&gt;网络制式&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl value&#34;</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;<span style="color:#000080">ul</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;type-list&#34;</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span> <span style="color:#008080">th:each</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;op:${spec.value}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${op}&#34;</span> <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${url}(&#39;spec_&#39;+${spec.key}=${op})}&#34;</span>&gt;GSM（移动/联通2G）&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;							
</span></span><span style="display:flex;"><span>						&lt;/<span style="color:#000080">ul</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl ext&#34;</span>&gt;&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;/<span style="color:#000080">div</span>&gt;		
</span></span><span style="display:flex;"><span>				
</span></span><span style="display:flex;"><span>				&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;type-wrap&#34;</span> <span style="color:#008080">th:unless</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${#maps.containsKey(searchMap,&#39;price&#39;)}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl key&#34;</span>&gt;价格&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl value&#34;</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;<span style="color:#000080">ul</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;type-list&#34;</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${url}(price=&#39;0-500&#39;)}&#34;</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;0-500元&#34;</span>&gt;0-500元&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${url}(price=&#39;500-1000&#39;)}&#34;</span>&gt;500-1000元&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${url}(price=&#39;1000-1500&#39;)}&#34;</span>&gt;1000-1500元&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${url}(price=&#39;1500-2000&#39;)}&#34;</span>&gt;1500-2000元&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${url}(price=&#39;2000-3000&#39;)}&#34;</span>&gt;2000-3000元 &lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>								&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${url}(price=&#39;3000-*&#39;)}&#34;</span>&gt;3000元以上&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>							&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>						&lt;/<span style="color:#000080">ul</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl ext&#34;</span>&gt;
</span></span><span style="display:flex;"><span>					&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;/<span style="color:#000080">div</span>&gt;
</span></span></code></pre></div><h3 id="heading"></h3>
<h3 id="28-排序作业">2.8 排序(作业)</h3>
<p><img src="/posts/project-0/20220527231757/image-20220527232617035.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>上图代码是排序代码，需要2个属性，<code>sortRule</code>:排序规则，ASC或者DESC，<code>sortField</code>:排序的域，前端每次只需要将这2个域的值传入到后台即可实现排序。</p>
<p>(1)后台组装排序URL</p>
<p>每次排序的时候恢复第1页查询，所以url地址我们需要重新拼接,每次切换排序的时候，不需要之前的排序信息，修改SkuController,代码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">private</span> String <span style="color:#900;font-weight:bold">url</span><span style="color:#000;font-weight:bold">(</span>Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> String<span style="color:#000;font-weight:bold">&gt;</span> searchMap<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#998;font-style:italic">// { spec_网络:&#34;移动4G&#34;,&#34;keywords&#34;:&#34;华为&#34;}
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    String url <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;/search/list&#34;</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#998;font-style:italic">// a/b?id=1&amp;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>searchMap <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        url <span style="color:#000;font-weight:bold">+=</span> <span style="color:#d14">&#34;?&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>Map<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Entry</span><span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> String<span style="color:#000;font-weight:bold">&gt;</span> stringStringEntry <span style="color:#000;font-weight:bold">:</span> searchMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">entrySet</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//如果是排序 则 跳过 拼接排序的地址 因为有数据
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>stringStringEntry<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getKey</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">equals</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;sortField&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">||</span> stringStringEntry<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getKey</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">equals</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;sortRule&#34;</span><span style="color:#000;font-weight:bold">)){</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">continue</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>            url <span style="color:#000;font-weight:bold">+=</span> stringStringEntry<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getKey</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34;=&#34;</span> <span style="color:#000;font-weight:bold">+</span> stringStringEntry<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getValue</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34;&amp;&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>url<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">lastIndexOf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;&amp;&#34;</span><span style="color:#000;font-weight:bold">)!=-</span>1<span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            url <span style="color:#000;font-weight:bold">=</span> url<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">substring</span><span style="color:#000;font-weight:bold">(</span>0<span style="color:#000;font-weight:bold">,</span> url<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">lastIndexOf</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;&amp;&#34;</span><span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> url<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>(2)前端排序实现</p>
<p>修改search.html，实现排序，代码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>         &lt;<span style="color:#000080">a</span> <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${url}(sortField=price,sortRule=ASC)}&#34;</span>&gt;价格↑&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>		&lt;<span style="color:#000080">a</span> <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${url}(sortField=price,sortRule=DESC)}&#34;</span>&gt;价格↓&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">li</span>&gt;
</span></span></code></pre></div><p>这一块我们实现了价格排序，同学们课后去实现以下销量和新品排序。</p>
<h3 id="29-分页">2.9 分页</h3>
<p>真实的分页应该像京东那样，如下图：
<img src="/posts/project-0/20220527231757/image-20220527232625302.png"
    
    
    
    loading="lazy"
    
    
></p>
<p><img src="/posts/project-0/20220527231757/image-20220527232630762.png"
    
    
    
    loading="lazy"
    
    
></p>
<p><img src="/posts/project-0/20220527231757/image-20220527232636463.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>(1)分页工具类定义</p>
<p>在dongyimai-common工程中添加Page分页对象，代码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Page</span><span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#000;font-weight:bold">implements</span> Serializable <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> List<span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;</span> list<span style="color:#000;font-weight:bold">;</span> <span style="color:#998;font-style:italic">// 每页查询出来的数据存放的集合
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">int</span> pageSize <span style="color:#000;font-weight:bold">=</span> 10<span style="color:#000;font-weight:bold">;</span> <span style="color:#998;font-style:italic">// 每页显示的记录数
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">int</span> pageNo<span style="color:#000;font-weight:bold">;</span> <span style="color:#998;font-style:italic">// 当前页，通过用户传入
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">//	private int totalPageNo; // 总页数，通过计算得到
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">long</span> totalRecord<span style="color:#000;font-weight:bold">;</span> <span style="color:#998;font-style:italic">// 总记录数，通过查询数据库得到
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">int</span> firstPage<span style="color:#000;font-weight:bold">;</span>    <span style="color:#998;font-style:italic">//分页页码集合起始记录
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">int</span> lastPage<span style="color:#000;font-weight:bold">;</span>      <span style="color:#998;font-style:italic">//分页页码集合结束记录
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">int</span> maxPage<span style="color:#000;font-weight:bold">;</span>  <span style="color:#998;font-style:italic">//分页最大页码
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">boolean</span> firstDot <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">boolean</span> lastDot <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#900;font-weight:bold">Page</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#900;font-weight:bold">Page</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">long</span> totalRecord<span style="color:#000;font-weight:bold">,</span><span style="color:#458;font-weight:bold">int</span> pageNo<span style="color:#000;font-weight:bold">,</span><span style="color:#458;font-weight:bold">int</span> pageSize<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">pageSize</span> <span style="color:#000;font-weight:bold">=</span> pageSize<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">totalRecord</span> <span style="color:#000;font-weight:bold">=</span> totalRecord<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">pageNo</span> <span style="color:#000;font-weight:bold">=</span> pageNo<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">firstPage</span> <span style="color:#000;font-weight:bold">=</span> 1<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">lastPage</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getTotalPageNo</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">maxPage</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getTotalPageNo</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        setPageLabel<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> List<span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">getList</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> list<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setList</span><span style="color:#000;font-weight:bold">(</span>List<span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;</span> list<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">list</span> <span style="color:#000;font-weight:bold">=</span> list<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">long</span> <span style="color:#900;font-weight:bold">getPageNo</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>pageNo <span style="color:#000;font-weight:bold">&lt;</span> 1<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">// 如果当前页码小于1，直接返回1
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">return</span> 1<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>pageNo <span style="color:#000;font-weight:bold">&gt;</span> getTotalPageNo<span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">// 如果当前页码大于总页数，返回总页数
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">return</span> getTotalPageNo<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> pageNo<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setPageNo</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> pageNo<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">pageNo</span> <span style="color:#000;font-weight:bold">=</span> pageNo<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// 总页数是由总记录数和每页显示的条数计算得到
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">long</span> <span style="color:#900;font-weight:bold">getTotalPageNo</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>totalRecord <span style="color:#000;font-weight:bold">%</span> pageSize <span style="color:#000;font-weight:bold">==</span> 0<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> totalRecord <span style="color:#000;font-weight:bold">/</span> pageSize<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> totalRecord <span style="color:#000;font-weight:bold">/</span> pageSize <span style="color:#000;font-weight:bold">+</span> 1<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setPageLabel</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>maxPage<span style="color:#000;font-weight:bold">&gt;</span>5<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>pageNo<span style="color:#000;font-weight:bold">&lt;=</span>3<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>                lastPage <span style="color:#000;font-weight:bold">=</span> 5<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                firstDot <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>pageNo<span style="color:#000;font-weight:bold">&gt;=</span>maxPage<span style="color:#000;font-weight:bold">-</span>2<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>                firstPage <span style="color:#000;font-weight:bold">=</span> maxPage<span style="color:#000;font-weight:bold">-</span>4<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                lastDot <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">else</span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                firstPage <span style="color:#000;font-weight:bold">=</span> pageNo<span style="color:#000;font-weight:bold">-</span>2<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                lastPage <span style="color:#000;font-weight:bold">=</span> pageNo<span style="color:#000;font-weight:bold">+</span>2<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">else</span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            firstDot <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            lastDot <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">getFirstPage</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">firstPage</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">getLastPage</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">lastPage</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// public void setTotalPageNo(int totalPageNo) {
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// this.totalPageNo = totalPageNo;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">// }
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">long</span> <span style="color:#900;font-weight:bold">getTotalRecord</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> totalRecord<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setTotalRecord</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> totalRecord<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">totalRecord</span> <span style="color:#000;font-weight:bold">=</span> totalRecord<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">getPageSize</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> pageSize<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// 判断是否有上一页
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">boolean</span> <span style="color:#900;font-weight:bold">hasPrev</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> getPageNo<span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">&gt;</span> 1<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// 获取上一页
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">long</span> <span style="color:#900;font-weight:bold">getPrev</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> hasPrev<span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">?</span> getPageNo<span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">-</span> 1 <span style="color:#000;font-weight:bold">:</span> 1<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// 判断是否有下一页
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">boolean</span> <span style="color:#900;font-weight:bold">hasNext</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> getPageNo<span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">&lt;</span> getTotalPageNo<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// 获取下一页
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">long</span> <span style="color:#900;font-weight:bold">getNext</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> hasNext<span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">?</span> getPageNo<span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">+</span> 1 <span style="color:#000;font-weight:bold">:</span> getTotalPageNo<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">boolean</span> <span style="color:#900;font-weight:bold">isFirstDot</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">firstDot</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">boolean</span> <span style="color:#900;font-weight:bold">isLastDot</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">lastDot</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>(2)分页实现</p>
<p>由于这里需要获取分页信息，我们可以在<code>dongyimai-search-service</code>服务中修改搜索方法实现获取分页数据，修改<code>com.offcn.search.service.impl.SkuServiceImpl</code>的search方法，在return之前添加如下方法获取份额与数据：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">//分页数据保存
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//设置当前页码
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>resultMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;pageNum&#34;</span><span style="color:#000;font-weight:bold">,</span> pageNum<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>resultMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;pageSize&#34;</span><span style="color:#000;font-weight:bold">,</span> 30<span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><p>修改SkuController,实现分页信息封装，代码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">//5.创建一个分页的对象  可以获取当前页 和总个记录数和显示的页码(以当前页为中心的5个页码)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        Page<span style="color:#000;font-weight:bold">&lt;</span>SkuInfo<span style="color:#000;font-weight:bold">&gt;</span> infoPage <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Page<span style="color:#000;font-weight:bold">&lt;</span>SkuInfo<span style="color:#000;font-weight:bold">&gt;(</span>
</span></span><span style="display:flex;"><span>                Long<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">valueOf</span><span style="color:#000;font-weight:bold">(</span>resultMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;total&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">toString</span><span style="color:#000;font-weight:bold">()),</span>
</span></span><span style="display:flex;"><span>                Integer<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">valueOf</span><span style="color:#000;font-weight:bold">(</span>resultMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;pageNum&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">toString</span><span style="color:#000;font-weight:bold">()),</span>
</span></span><span style="display:flex;"><span>                Integer<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">valueOf</span><span style="color:#000;font-weight:bold">(</span>resultMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;pageSize&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">toString</span><span style="color:#000;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>       model<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addAttribute</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;page&#34;</span><span style="color:#000;font-weight:bold">,</span>infoPage<span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><p>(3)页面分页实现</p>
<p>修改search.html，实现分页查询，代码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fr page&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;sui-pagination pagination-large&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                    &lt;<span style="color:#000080">ul</span>&gt;
</span></span><span style="display:flex;"><span>                        &lt;<span style="color:#000080">li</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;prev&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                            &lt;<span style="color:#000080">a</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;#&#34;</span> <span style="color:#008080">th:if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${page.pageNo&gt;1}&#34;</span> <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${url}(pageNum=${page.prev})}&#34;</span>&gt;«上一页&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>                        &lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>                        &lt;<span style="color:#000080">li</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;dotted&#34;</span>&gt;&lt;<span style="color:#000080">span</span> <span style="color:#008080">th:if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${page.firstDot}&#34;</span>&gt;...&lt;/<span style="color:#000080">span</span>&gt;&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>                        &lt;<span style="color:#000080">li</span> <span style="color:#008080">th:class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${page.pageNo}==${i}?&#39;active&#39;:&#39;&#39;&#34;</span> <span style="color:#008080">th:each</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;i:${#numbers.sequence(page.firstPage,page.lastPage)}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                            &lt;<span style="color:#000080">a</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;#&#34;</span> <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${url}(pageNum=${i})}&#34;</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${i}&#34;</span>&gt;1&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>                        &lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>                        &lt;<span style="color:#000080">li</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;dotted&#34;</span>&gt;&lt;<span style="color:#000080">span</span> <span style="color:#008080">th:if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${page.lastDot}&#34;</span>&gt;...&lt;/<span style="color:#000080">span</span>&gt;&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>                        &lt;<span style="color:#000080">li</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;next&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                            &lt;<span style="color:#000080">a</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;#&#34;</span> <span style="color:#008080">th:if</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${page.pageNo&lt;page.next}&#34;</span> <span style="color:#008080">th:href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;@{${url}(pageNum=${page.next})}&#34;</span>&gt;下一页»&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>                        &lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>                    &lt;/<span style="color:#000080">ul</span>&gt;
</span></span><span style="display:flex;"><span>                    &lt;<span style="color:#000080">div</span>&gt;&lt;<span style="color:#000080">span</span>&gt;共&lt;<span style="color:#000080">i</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${page.totalPageNo}&#34;</span>&gt;&lt;/<span style="color:#000080">i</span>&gt;页<span style="color:#800080">&amp;nbsp;</span>&lt;/<span style="color:#000080">span</span>&gt;&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">div</span>&gt;
</span></span></code></pre></div><p>注意：每次如果搜条件发生变化都要从第1页查询，而点击下一页的时候，分页数据在页面给出，不需要在后台拼接的url中给出，所以在拼接url的时候，需要过滤掉分页参数，修改<code>dongyimai-search-web</code>的控制层<code>com.offcn.search.controller.SkuController</code>的url拼接方法，代码如下：
<img src="/posts/project-0/20220527231757/image-20220527232718606.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>测试效果：</p>
<p><img src="/posts/project-0/20220527231757/image-20220527232724838.png"
    
    
    
    loading="lazy"
    
    
></p>
<h1 id="三-东易买商品详情页">三 东易买商品详情页</h1>
<h2 id="1-为什么要使用网页静态化技术">1 为什么要使用网页静态化技术</h2>
<p>网页静态化解决方案在实际开发中运用比较多，例如新闻网站，门户网站中的新闻频道或者是文章类的频道。
<img src="/posts/project-0/20220527231757/clip_image002.gif"
    
    
    
    loading="lazy"
    
    
>
对于电商网站的商品详细页来说，至少几百万个商品，每个商品又有大量的信息，这样的情况同样也适用于使用网页静态化来解决。</p>
<p>网页静态化技术和缓存技术的共同点都是为了减轻数据库的访问压力，但是具体的应用场景不同，缓存比较适合小规模的数据，而网页静态化比较适合大规模且相对变化不太频繁的数据。另外网页静态化还有利于SEO。</p>
<p>另外我们如果将网页以纯静态化的形式展现，就可以使用Nginx这样的高性能的web服务器来部署，Nginx可以承载5万的并发，而Tomcat只有几百。</p>
<p>今天我们就研究网页静态化技术</p>
<h2 id="2-需求分析">2 需求分析</h2>
<p>当系统审核完成商品，需要将商品详情页进行展示，那么采用静态页面生成的方式生成，并部署到高性能的web服务器中进行访问是比较合适的。所以，开发流程如下图所示：
<img src="/posts/project-0/20220527231757/image-20220527232747219.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>执行步骤解释：</p>
<ul>
<li>系统管理员（商家运维人员）修改或者审核商品的时候，会触发canal监控数据</li>
<li>canal微服务获取修改数据后，调用静态页微服务的方法进行生成静态页</li>
<li>静态页微服务只负责使用thymeleaf的模板技术生成静态页</li>
</ul>
<h2 id="3-商品静态化微服务创建">3 商品静态化微服务创建</h2>
<h3 id="31-搭建项目">3.1 搭建项目</h3>
<p>（1）在dongyimai-web下创建一个名称为dongyimai-item-web的模块,该微服务只用于生成商品静态页，如图：
<img src="/posts/project-0/20220527231757/image-20220527232754292.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>（2）dongyimai-item-web中添加起步依赖，如下</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;project</span> <span style="color:#008080">xmlns=</span><span style="color:#d14">&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#008080">xmlns:xsi=</span><span style="color:#d14">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#008080">xsi:schemaLocation=</span><span style="color:#d14">&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;parent&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>dongyimai-web<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>com.offcn<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>1.0<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/parent&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;modelVersion&gt;</span>4.0.0<span style="color:#000080">&lt;/modelVersion&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;artifactId&gt;</span>dongyimai-item-web<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       <span style="color:#000080">&lt;dependencies&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;groupId&gt;</span>com.offcn<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;artifactId&gt;</span>dongyimai-sellergoods-serivce-api<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;version&gt;</span>1.0<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;exclusions&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000080">&lt;exclusion&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000080">&lt;groupId&gt;</span>com.alibaba<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000080">&lt;artifactId&gt;</span>druid-spring-boot-starter<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000080">&lt;/exclusion&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;/exclusions&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;artifactId&gt;</span>spring-boot-starter-thymeleaf<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependencies&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/project&gt;</span>
</span></span></code></pre></div><p>（3）修改application.yml的配置</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">server</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">port</span>:<span style="color:#bbb"> </span><span style="color:#099">9102</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">eureka</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">client</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">service-url</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">defaultZone</span>:<span style="color:#bbb"> </span>http://127.0.0.1:8761/eureka<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">instance</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">prefer-ip-address</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">spring</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">thymeleaf</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">cache</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">application</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>item-web<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">main</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">allow-bean-definition-overriding</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">feign</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">hystrix</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">enabled</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">client</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">config</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">default</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#000080">connectTimeout</span>:<span style="color:#bbb"> </span><span style="color:#099">10000</span><span style="color:#bbb"> </span><span style="color:#998;font-style:italic">#连接超时配置</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#000080">readTimeout</span>:<span style="color:#bbb"> </span><span style="color:#099">60000</span><span style="color:#bbb"> </span><span style="color:#998;font-style:italic">#执行超时配置</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">#设定Hystrix熔断超时时间 ，理论上熔断时间应该大于总连接超时时间</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">hystrix</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">command</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">default</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">execution</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#000080">isolation</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">thread</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#000080">timeoutInMilliseconds</span>:<span style="color:#bbb"> </span><span style="color:#099">6000</span><span style="color:#bbb">         
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic"># 生成静态页的位置</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">pagepath</span>:<span style="color:#bbb"> </span>C:\\items<span style="color:#bbb">
</span></span></span></code></pre></div><p>（4）创建系统启动类</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@SpringBootApplication</span><span style="color:#000;font-weight:bold">(</span>exclude <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>DataSourceAutoConfiguration<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@EnableEurekaClient</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@EnableFeignClients</span><span style="color:#000;font-weight:bold">(</span>basePackages <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;com.offcn.sellergoods.feign&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">ItemApplication</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        SpringApplication<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">run</span><span style="color:#000;font-weight:bold">(</span>ItemApplication<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span>args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="32-生成静态页">3.2 生成静态页</h3>
<h4 id="321-需求分析">3.2.1 需求分析</h4>
<p>页面发送请求，传递要生成的静态页的的商品的SpuID.后台controller 接收请求，调用thyemleaf的原生API生成商品静态页。
<img src="/posts/project-0/20220527231757/image-20220527232804532.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>上图是要生成的商品详情页，从图片上可以看出需要查询SPU的3个分类作为面包屑显示，同时还需要查询SKU和SPU信息。</p>
<h4 id="322-feign创建">3.2.2 Feign创建</h4>
<p>稍后需要查询SPU和SKU以及Category，所以我们需要先创建Feign。</p>
<p>修改dongyimai-sellergoods-service-api,添加ItemCatFeign，并在ItemCatFeign中添加根据ID查询分类数据，代码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@FeignClient</span><span style="color:#000;font-weight:bold">(</span>name<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;sellergoods&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RequestMapping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/itemCat&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">interface</span> <span style="color:#458;font-weight:bold">ItemCatFeign</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * 获取分类的对象信息
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param id
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@GetMapping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/{id}&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> Result<span style="color:#000;font-weight:bold">&lt;</span>ItemCat<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">findById</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3c5d5d;font-weight:bold">@PathVariable</span><span style="color:#000;font-weight:bold">(</span>name <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;id&#34;</span><span style="color:#000;font-weight:bold">)</span> Integer id<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>在dongyimai-sellergoods-service-api,添加GoodsFeign,并添加根据SpuID查询Spu信息，代码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@FeignClient</span><span style="color:#000;font-weight:bold">(</span>name<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;sellergoods&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RequestMapping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/goods&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">interface</span> <span style="color:#458;font-weight:bold">GoodsFeign</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * 根据ID查询Spu数据
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param id
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@GetMapping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/{id}&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    Result<span style="color:#000;font-weight:bold">&lt;</span>GoodsEntity<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">findById</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3c5d5d;font-weight:bold">@PathVariable</span> Long id<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p><img src="/posts/project-0/20220527231757/image-20220527232813006.png"
    
    
    
    loading="lazy"
    
    
></p>
<h4 id="323-静态页生成代码">3.2.3 静态页生成代码</h4>
<p>(1) 创建service</p>
<p>在项目dongyimai-item-web中创建接口 com.offcn.item.service.PageService</p>
<p>接口：PageService</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">interface</span> <span style="color:#458;font-weight:bold">PageService</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * 根据商品的ID 生成静态页
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param spuId
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">createPageHtml</span><span style="color:#000;font-weight:bold">(</span>Long spuId<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>在项目dongyimai-item-web中创建实现类 com.offcn.item.service.impl.PageServiceImpl实现类，代码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Service</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">PageServiceImpl</span> <span style="color:#000;font-weight:bold">implements</span> PageService <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> GoodsFeign goodsFeign<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> ItemCatFeign itemCatFeign<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> TemplateEngine templateEngine<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//生成静态文件路径
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#3c5d5d;font-weight:bold">@Value</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;${pagepath}&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> String pagepath<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * 构建数据模型
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param spuId
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span>Object<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">buildDataModel</span><span style="color:#000;font-weight:bold">(</span>Long spuId<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//构建数据模型
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">&gt;</span> dataMap <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> HashMap<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//获取SPU 和SKU列表
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        Result<span style="color:#000;font-weight:bold">&lt;</span>GoodsEntity<span style="color:#000;font-weight:bold">&gt;</span> result <span style="color:#000;font-weight:bold">=</span> goodsFeign<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findById</span><span style="color:#000;font-weight:bold">(</span>spuId<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        GoodsEntity goodsEntity <span style="color:#000;font-weight:bold">=</span> result<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getData</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//1.加载SPU数据
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        Goods goods <span style="color:#000;font-weight:bold">=</span> goodsEntity<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getGoods</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//2.加载商品扩展数据
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        GoodsDesc goodsDesc <span style="color:#000;font-weight:bold">=</span> goodsEntity<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getGoodsDesc</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//3.加载SKU数据
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        List<span style="color:#000;font-weight:bold">&lt;</span>Item<span style="color:#000;font-weight:bold">&gt;</span> itemList <span style="color:#000;font-weight:bold">=</span> goodsEntity<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getItemList</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        dataMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;goods&#34;</span><span style="color:#000;font-weight:bold">,</span> goods<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        dataMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;goodsDesc&#34;</span><span style="color:#000;font-weight:bold">,</span> goodsDesc<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        dataMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;specificationList&#34;</span><span style="color:#000;font-weight:bold">,</span> JSON<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">parseArray</span><span style="color:#000;font-weight:bold">(</span>goodsDesc<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getSpecificationItems</span><span style="color:#000;font-weight:bold">(),</span>Map<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>        dataMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;imageList&#34;</span><span style="color:#000;font-weight:bold">,</span>JSON<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">parseArray</span><span style="color:#000;font-weight:bold">(</span>goodsDesc<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getItemImages</span><span style="color:#000;font-weight:bold">(),</span>Map<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>        dataMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;itemList&#34;</span><span style="color:#000;font-weight:bold">,</span>itemList<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//4.加载分类数据
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        dataMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;category1&#34;</span><span style="color:#000;font-weight:bold">,</span>itemCatFeign<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findById</span><span style="color:#000;font-weight:bold">(</span>goods<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getCategory1Id</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">intValue</span><span style="color:#000;font-weight:bold">()).</span><span style="color:#008080">getData</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>        dataMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;category2&#34;</span><span style="color:#000;font-weight:bold">,</span>itemCatFeign<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findById</span><span style="color:#000;font-weight:bold">(</span>goods<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getCategory2Id</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">intValue</span><span style="color:#000;font-weight:bold">()).</span><span style="color:#008080">getData</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>        dataMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;category3&#34;</span><span style="color:#000;font-weight:bold">,</span>itemCatFeign<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findById</span><span style="color:#000;font-weight:bold">(</span>goods<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getCategory3Id</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">intValue</span><span style="color:#000;font-weight:bold">()).</span><span style="color:#008080">getData</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> dataMap<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * 生成静态页
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param spuId
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">createPageHtml</span><span style="color:#000;font-weight:bold">(</span>Long spuId<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// 1.上下文
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        Context context <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Context<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">&gt;</span> dataModel <span style="color:#000;font-weight:bold">=</span> buildDataModel<span style="color:#000;font-weight:bold">(</span>spuId<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        context<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setVariables</span><span style="color:#000;font-weight:bold">(</span>dataModel<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// 2.准备文件
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        File dir <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> File<span style="color:#000;font-weight:bold">(</span>pagepath<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(!</span>dir<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">exists</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            dir<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mkdirs</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        File dest <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> File<span style="color:#000;font-weight:bold">(</span>dir<span style="color:#000;font-weight:bold">,</span> spuId <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34;.html&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// 3.生成页面
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">(</span>PrintWriter writer <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> PrintWriter<span style="color:#000;font-weight:bold">(</span>dest<span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;UTF-8&#34;</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            templateEngine<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">process</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;item&#34;</span><span style="color:#000;font-weight:bold">,</span> context<span style="color:#000;font-weight:bold">,</span> writer<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>Exception e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>(2)创建Controller</p>
<p>在dongyimai-item-web中创建com.offcn.item.controller.PageController用于接收请求，测试生成静态页</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RestController</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RequestMapping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/page&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">PageController</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> PageService pageService<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * 生成静态页面
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param id
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@RequestMapping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/createHtml/{id}&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> Result <span style="color:#900;font-weight:bold">createHtml</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3c5d5d;font-weight:bold">@PathVariable</span><span style="color:#000;font-weight:bold">(</span>name<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;id&#34;</span><span style="color:#000;font-weight:bold">)</span> Long id<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        pageService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createPageHtml</span><span style="color:#000;font-weight:bold">(</span>id<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">new</span> Result<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span> StatusCode<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">OK</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;ok&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>（3）拷贝模板文件   资料/网站前台/item.html</p>
<h4 id="324-模板填充">3.2.4 模板填充</h4>
<p>首先将模板 将资料/网站前台/item.html 拷贝到 resources/templates/下</p>
<p>添加thymeleaf的头</p>
<p>修改thymeleaf命名头</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#000080">html</span> <span style="color:#008080">xmlns:th</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;http://www.thymeleaf.org&#34;</span>&gt;
</span></span></code></pre></div><p>(1)面包屑数据的实现</p>
<p><img src="/posts/project-0/20220527231757/image-20220527232842264.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>修改item.html，填充三个分类数据作为面包屑，代码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;crumb-wrap&#34;</span>&gt;
</span></span><span style="display:flex;"><span>		&lt;<span style="color:#000080">ul</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;sui-breadcrumb&#34;</span>&gt;
</span></span><span style="display:flex;"><span>			&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;<span style="color:#000080">a</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;#&#34;</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${category1.name}&#34;</span>&gt;&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>			&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>			&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;<span style="color:#000080">a</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;#&#34;</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${category2.name}&#34;</span>&gt;&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>			&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>			&lt;<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>				&lt;<span style="color:#000080">a</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;#&#34;</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${category3.name}&#34;</span>&gt;&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>			&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>		&lt;/<span style="color:#000080">ul</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">div</span>&gt;
</span></span></code></pre></div><p>(2)商品图片</p>
<p><img src="/posts/project-0/20220527231757/image-20220527232857567.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>修改item.html，将商品图片信息输出，在真实工作中需要做空判断，代码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl preview-wrap&#34;</span>&gt;
</span></span><span style="display:flex;"><span>       <span style="color:#998;font-style:italic">&lt;!--放大镜效果--&gt;</span>
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;zoom&#34;</span>&gt;
</span></span><span style="display:flex;"><span>         <span style="color:#998;font-style:italic">&lt;!--默认第一个预览--&gt;</span>
</span></span><span style="display:flex;"><span>         &lt;<span style="color:#000080">div</span> <span style="color:#008080">id</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;preview&#34;</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;spec-preview&#34;</span>&gt;
</span></span><span style="display:flex;"><span>              &lt;<span style="color:#000080">span</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;jqzoom&#34;</span>&gt;&lt;<span style="color:#000080">img</span> <span style="color:#008080">th:jqimg</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${imageList[0].url}&#34;</span> <span style="color:#008080">th:src</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${imageList[0].url}&#34;</span> <span style="color:#008080">width</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;400px&#34;</span>/&gt;&lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>         &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>         <span style="color:#998;font-style:italic">&lt;!--下方的缩略图--&gt;</span>
</span></span><span style="display:flex;"><span>         &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;spec-scroll&#34;</span>&gt;
</span></span><span style="display:flex;"><span>              &lt;<span style="color:#000080">a</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;prev&#34;</span>&gt;<span style="color:#800080">&amp;lt;</span>&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>              <span style="color:#998;font-style:italic">&lt;!--左右按钮--&gt;</span>
</span></span><span style="display:flex;"><span>              &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;items&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                  &lt;<span style="color:#000080">ul</span>&gt;
</span></span><span style="display:flex;"><span>                     &lt;<span style="color:#000080">li</span> <span style="color:#008080">th:each</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;img:${imageList}&#34;</span>&gt;&lt;<span style="color:#000080">img</span> <span style="color:#008080">th:src</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${img.url}&#34;</span> <span style="color:#008080">th:bimg</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${img.url}&#34;</span> <span style="color:#008080">onmousemove</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;preview(this)&#34;</span>/&gt;&lt;/<span style="color:#000080">li</span>&gt;
</span></span><span style="display:flex;"><span>                  &lt;/<span style="color:#000080">ul</span>&gt;
</span></span><span style="display:flex;"><span>              &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>              &lt;<span style="color:#000080">a</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;next&#34;</span>&gt;<span style="color:#800080">&amp;gt;</span>&lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>         &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>      &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">div</span>&gt;
</span></span></code></pre></div><p>(3)规格输出</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#000080">div</span> <span style="color:#008080">id</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;specification&#34;</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;summary-wrap clearfix&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      <span style="color:#998;font-style:italic">&lt;!--循环MAP--&gt;</span>
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">dl</span> <span style="color:#008080">th:each</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;spec,specStat:${specificationList}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>         &lt;<span style="color:#000080">dt</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl title&#34;</span>&gt;
</span></span><span style="display:flex;"><span>           &lt;<span style="color:#000080">i</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${spec.attributeName}&#34;</span>&gt;&lt;/<span style="color:#000080">i</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#000080">dt</span>&gt;
</span></span><span style="display:flex;"><span>         &lt;<span style="color:#000080">dd</span> <span style="color:#008080">th:each</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;arrValue:${spec.attributeValue}&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">a</span> <span style="color:#008080">href</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;javascript:;&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">i</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${arrValue}&#34;</span>&gt;&lt;/<span style="color:#000080">i</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">span</span> <span style="color:#008080">title</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;点击取消选择&#34;</span>&gt;<span style="color:#800080">&amp;nbsp;</span>&lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#000080">a</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#000080">dd</span>&gt;
</span></span><span style="display:flex;"><span>       &lt;/<span style="color:#000080">dl</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> &lt;/<span style="color:#000080">div</span>&gt;
</span></span></code></pre></div><p>(4)默认SKU显示</p>
<p>静态页生成后，需要显示默认的Sku，我们这里默认显示第1个Sku即可，这里可以结合着Vue一起实现。可以先定义一个集合，再定义一个spec和sku，用来存储当前选中的Sku信息和Sku的规格，代码如下：</p>
<p>需要在页面引入vue.js</p>
<pre tabindex="0"><code>&lt;script src=&#34;js/vue.js&#34;&gt;&lt;/script&gt;
</code></pre><p>设置绑定vue节点</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--页面顶部 结束--&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;py-container&#34;</span> <span style="color:#008080">id</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;itemArray&#34;</span>&gt;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#000080">script</span> <span style="color:#008080">th:inline</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;javascript&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">var</span> item <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Vue({
</span></span><span style="display:flex;"><span>        el<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;#itemArray&#39;</span>,
</span></span><span style="display:flex;"><span>        data<span style="color:#000;font-weight:bold">:</span> {
</span></span><span style="display:flex;"><span>            skuList<span style="color:#000;font-weight:bold">:</span> [[${itemList}]],
</span></span><span style="display:flex;"><span>            sku<span style="color:#000;font-weight:bold">:</span> {},
</span></span><span style="display:flex;"><span>            spec<span style="color:#000;font-weight:bold">:</span> {}
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        created<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">function</span> () {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">this</span>.sku <span style="color:#000;font-weight:bold">=</span> JSON.parse(JSON.stringify(<span style="color:#000;font-weight:bold">this</span>.skuList[<span style="color:#099">0</span>]));
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">this</span>.spec <span style="color:#000;font-weight:bold">=</span> JSON.parse(<span style="color:#000;font-weight:bold">this</span>.skuList[<span style="color:#099">0</span>].spec);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>     })
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">script</span>&gt;   
</span></span></code></pre></div><p>页面显示默认的Sku信息</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span> &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;sku-name&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                    &lt;<span style="color:#000080">h4</span>&gt;{{sku.title}}&lt;/<span style="color:#000080">h4</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;news&#34;</span>&gt;&lt;<span style="color:#000080">span</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${goods.caption}&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;summary&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                    &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;summary-wrap&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                        &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl title&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                            &lt;<span style="color:#000080">i</span>&gt;价　　格&lt;/<span style="color:#000080">i</span>&gt;
</span></span><span style="display:flex;"><span>                        &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>                        &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl price&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                            &lt;<span style="color:#000080">i</span>&gt;¥&lt;/<span style="color:#000080">i</span>&gt;
</span></span><span style="display:flex;"><span>                            &lt;<span style="color:#000080">em</span>&gt;{{sku.price}}&lt;/<span style="color:#000080">em</span>&gt;
</span></span><span style="display:flex;"><span>                            &lt;<span style="color:#000080">span</span>&gt;降价通知&lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>                        &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>                        &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fr remark&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                            &lt;<span style="color:#000080">i</span>&gt;累计评价&lt;/<span style="color:#000080">i</span>&gt;&lt;<span style="color:#000080">em</span>&gt;612188&lt;/<span style="color:#000080">em</span>&gt;
</span></span><span style="display:flex;"><span>                        &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>                    &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>                    ………………
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">div</span>&gt;                    
</span></span></code></pre></div><p>(5)默认SKU显示</p>
<p><img src="/posts/project-0/20220527231757/image-20220527232910834.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>静态页生成后，需要显示默认的Sku，我们这里默认显示第1个Sku即可，这里可以结合着Vue一起实现。可以先定义一个集合，再定义一个spec和sku，用来存储当前选中的Sku信息和Sku的规格，代码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#000080">script</span> <span style="color:#008080">th:inline</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;javascript&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">var</span> item <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Vue({
</span></span><span style="display:flex;"><span>        el<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;#itemArray&#39;</span>,
</span></span><span style="display:flex;"><span>        data<span style="color:#000;font-weight:bold">:</span> {
</span></span><span style="display:flex;"><span>            skuList<span style="color:#000;font-weight:bold">:</span> [[${itemList}]],
</span></span><span style="display:flex;"><span>            sku<span style="color:#000;font-weight:bold">:</span> {},
</span></span><span style="display:flex;"><span>            spec<span style="color:#000;font-weight:bold">:</span> {}
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        created<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">function</span> () {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">this</span>.sku <span style="color:#000;font-weight:bold">=</span> JSON.parse(JSON.stringify(<span style="color:#000;font-weight:bold">this</span>.skuList[<span style="color:#099">0</span>]));
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//注意这里是直接把json字符串转换为对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">this</span>.spec <span style="color:#000;font-weight:bold">=</span> JSON.parse(<span style="color:#000;font-weight:bold">this</span>.skuList[<span style="color:#099">0</span>].spec);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>     })
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">script</span>&gt;   
</span></span></code></pre></div><p>注意：th:inline=&ldquo;javascript&quot;这是Thymeleaf中的内联写法，支持在javascript访问model中的数据，所以有[[${xxx.xxx}]]这样写法(Javascript中访问thymeleaf变量值)的时候一定要记得在script中写上th:inline=&ldquo;javascript&quot;这样才成功访问。</p>
<p>位置如下：</p>
<p><img src="/posts/project-0/20220527231757/image-20220527232923692.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>页面显示默认的Sku信息</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>  &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fr itemInfo-wrap&#34;</span> <span style="color:#008080">id</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;itemArray&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;sku-name&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">h4</span>&gt;{{sku.title}}&lt;/<span style="color:#000080">h4</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;news&#34;</span>&gt;&lt;<span style="color:#000080">span</span> <span style="color:#008080">th:text</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;${goods.caption}&#34;</span>&gt;&lt;/<span style="color:#000080">span</span>&gt;&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;summary&#34;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;summary-wrap&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl title&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#000080">i</span>&gt;价　　格&lt;/<span style="color:#000080">i</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fl price&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#000080">i</span>&gt;¥&lt;/<span style="color:#000080">i</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#000080">em</span>&gt;{{sku.price}}&lt;/<span style="color:#000080">em</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#000080">span</span>&gt;降价通知&lt;/<span style="color:#000080">span</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="color:#000080">div</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;fr remark&#34;</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#000080">i</span>&gt;累计评价&lt;/<span style="color:#000080">i</span>&gt;&lt;<span style="color:#000080">em</span>&gt;612188&lt;/<span style="color:#000080">em</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span>        .......
</span></span><span style="display:flex;"><span>   &lt;/<span style="color:#000080">div</span>&gt;        
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">div</span>&gt;
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--product-detail--&gt;</span> 
</span></span></code></pre></div><p>(6)记录选中的Sku</p>
<p>在当前Spu的所有Sku中spec值是唯一的，我们可以根据spec来判断用户选中的是哪个Sku，我们可以在Vue中添加代码来实现，代码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span> methods<span style="color:#000;font-weight:bold">:</span> {
</span></span><span style="display:flex;"><span>            selectSpecification<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">function</span> (specName, specValue) {
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">//选中的spec信息，且触发视图更新
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">this</span>.$set(<span style="color:#000;font-weight:bold">this</span>.spec, specName, specValue);
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">//循环匹配
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">for</span> (<span style="color:#000;font-weight:bold">var</span> i <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>; i <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#000;font-weight:bold">this</span>.skuList.length; i<span style="color:#000;font-weight:bold">++</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#998;font-style:italic">//匹配规格是否相同，如果相同，则表明选中的是该SKU
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    <span style="color:#000;font-weight:bold">if</span> (<span style="color:#000;font-weight:bold">this</span>.matchObject(JSON.parse(<span style="color:#000;font-weight:bold">this</span>.skuList[i].spec), <span style="color:#000;font-weight:bold">this</span>.spec)) {
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">this</span>.sku <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.skuList[i];
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">//如果上面执行完毕，没有找到SKU，则提示下架操作
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">this</span>.sku <span style="color:#000;font-weight:bold">=</span> {<span style="color:#d14">&#39;id&#39;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">0</span>,<span style="color:#d14">&#39;title&#39;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#d14">&#39;提示：该商品已经下架&#39;</span>,<span style="color:#d14">&#39;price&#39;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">0</span>};
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            matchObject<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">function</span> (map1, map2) {
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">for</span> (<span style="color:#000;font-weight:bold">var</span> k <span style="color:#000;font-weight:bold">in</span> map1) {
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">if</span> (map1[k] <span style="color:#000;font-weight:bold">!=</span> map2[k]) {
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">for</span> (<span style="color:#000;font-weight:bold">var</span> k <span style="color:#000;font-weight:bold">in</span> map2) {
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">if</span> (map2[k] <span style="color:#000;font-weight:bold">!=</span> map1[k]) {
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>添加规格点击事件
<img src="/posts/project-0/20220527231757/image-20220527232933184.png"
    
    
    
    loading="lazy"
    
    
></p>
<pre tabindex="0"><code>&lt;a href=&#34;javascript:;&#34; th:@click=&#34;|selectSpecification(&#39;${spec.attributeName}&#39;,&#39;${arrValue}&#39;)|&#34; th:v-bind:class=&#34;|{selected:sel(&#39;${spec.attributeName}&#39;,&#39;${arrValue}&#39;)}|&#34;&gt;[[${arrValue}]]&lt;span title=&#34;点击取消选择&#34;&gt;&amp;nbsp;&lt;/span&gt;
&lt;/a&gt;
</code></pre><p>(6)样式切换</p>
<p>点击不同规格后，实现样式选中，我们可以根据每个规格判断该规格是否在当前选中的Sku规格中，如果在，则返回true添加selected样式，否则返回false不添加selected样式。</p>
<p>Vue添加代码：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span> sel<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">function</span> (name, value) {
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">if</span> (<span style="color:#000;font-weight:bold">this</span>.spec <span style="color:#000;font-weight:bold">==</span> <span style="color:#000;font-weight:bold">undefined</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">if</span> (<span style="color:#000;font-weight:bold">this</span>.spec[name] <span style="color:#000;font-weight:bold">==</span> value) {
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>                } <span style="color:#000;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>      }
</span></span></code></pre></div><p>页面添加样式绑定，代码如下：
<img src="/posts/project-0/20220527231757/image-20220527232943161.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>完整的vue代码如下:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#000080">script</span> <span style="color:#008080">th:inline</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;javascript&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">var</span> item <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Vue({
</span></span><span style="display:flex;"><span>        el<span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#39;#itemArray&#39;</span>,
</span></span><span style="display:flex;"><span>        data<span style="color:#000;font-weight:bold">:</span> {
</span></span><span style="display:flex;"><span>            skuList<span style="color:#000;font-weight:bold">:</span> [[${itemList}]],
</span></span><span style="display:flex;"><span>            sku<span style="color:#000;font-weight:bold">:</span> {},
</span></span><span style="display:flex;"><span>            spec<span style="color:#000;font-weight:bold">:</span> {}
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        created<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">function</span> () {
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">this</span>.sku <span style="color:#000;font-weight:bold">=</span> JSON.parse(JSON.stringify(<span style="color:#000;font-weight:bold">this</span>.skuList[<span style="color:#099">0</span>]));
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">this</span>.spec <span style="color:#000;font-weight:bold">=</span> JSON.parse(<span style="color:#000;font-weight:bold">this</span>.skuList[<span style="color:#099">0</span>].spec);
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        methods<span style="color:#000;font-weight:bold">:</span> {
</span></span><span style="display:flex;"><span>            sel<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">function</span> (name, value) {
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">if</span> (<span style="color:#000;font-weight:bold">this</span>.spec <span style="color:#000;font-weight:bold">==</span> <span style="color:#000;font-weight:bold">undefined</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">if</span> (<span style="color:#000;font-weight:bold">this</span>.spec[name] <span style="color:#000;font-weight:bold">==</span> value) {
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>                } <span style="color:#000;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            selectSpecification<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">function</span> (specName, specValue) {
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">//选中的spec信息
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">this</span>.$set(<span style="color:#000;font-weight:bold">this</span>.spec, specName, specValue);
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">//循环匹配
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">for</span> (<span style="color:#000;font-weight:bold">var</span> i <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">0</span>; i <span style="color:#000;font-weight:bold">&lt;</span> <span style="color:#000;font-weight:bold">this</span>.skuList.length; i<span style="color:#000;font-weight:bold">++</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#998;font-style:italic">//匹配规格是否相同，如果相同，则表明选中的是该SKU
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                    <span style="color:#000;font-weight:bold">if</span> (<span style="color:#000;font-weight:bold">this</span>.matchObject(JSON.parse(<span style="color:#000;font-weight:bold">this</span>.skuList[i].spec), <span style="color:#000;font-weight:bold">this</span>.spec)) {
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">this</span>.sku <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span>.skuList[i];
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">return</span>;
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">//如果上面执行完毕，没有找到SKU，则提示下架操作
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">this</span>.sku <span style="color:#000;font-weight:bold">=</span> {<span style="color:#d14">&#39;id&#39;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">0</span>,<span style="color:#d14">&#39;title&#39;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#d14">&#39;提示：该商品已经下架&#39;</span>,<span style="color:#d14">&#39;price&#39;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#099">0</span>};
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            matchObject<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">function</span> (map1, map2) {
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">for</span> (<span style="color:#000;font-weight:bold">var</span> k <span style="color:#000;font-weight:bold">in</span> map1) {
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">if</span> (map1[k] <span style="color:#000;font-weight:bold">!=</span> map2[k]) {
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">for</span> (<span style="color:#000;font-weight:bold">var</span> k <span style="color:#000;font-weight:bold">in</span> map2) {
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">if</span> (map2[k] <span style="color:#000;font-weight:bold">!=</span> map1[k]) {
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#000080">script</span>&gt;
</span></span></code></pre></div><h4 id="325-启动测试">3.2.5 启动测试</h4>
<p>启动eureka服务端 dongyimai-eureka</p>
<p>启动商品微服务 dongyimai-sellergoods-service</p>
<p>启动静态化微服务 dongyimai-item-web</p>
<p>将静态资源导入到C:\items目录下中，如下图：
<img src="/posts/project-0/20220527231757/image-20220527232951292.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>这样生成静态页面到给地址的时候就可以有正确的样式等信息了。</p>
<p>开始生成静态页面:</p>
<p>访问生成静态页地址 <code>http://localhost:9102/page/createHtml/149187842867985</code>
<img src="/posts/project-0/20220527231757/image-20220527233000101.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>注意: 此处一定要使用一个<font color="red">有效的数据信息</font>才可以实现效果。如果数据库中的商品的数据信息不完整将不能正常生成页面数据。</p>
<p>静态页生成后在生成目录中访问页面，效果如下：
<img src="/posts/project-0/20220527231757/image-20220527233006885.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>这样后续我们将这些生成的静态网页部署到Nginx下，就可以直接访问了。</p>
<h1 id="四-canal监听生成静态页">四 canal监听生成静态页</h1>
<p><img src="/posts/project-0/20220527231757/image-20220527233014291.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>监听到数据的变化,直接调用feign 生成静态页即可.</p>
<p>目前，已经完成使用静态页微服务，接收传递的商品spuId 通过Fegin调用商品微服务获取商品数据，以及商品分类数据， 实现商品详情页的生成。</p>
<p>接下需要实现就是使用canal 动态监控数据库中商品数据的变化，比如： 商品审核通过了，canal监听到商品数据发生变化，就会调用 静态页微服务并传递spuId， 接下来静态页微服务就生成静态页。</p>
<h2 id="1-需求分析">1 需求分析</h2>
<p>当商品微服务审核商品之后，应当发送消息，这里采用了Canal监控数据变化，数据变化后，调用feign实现生成静态页</p>
<h2 id="2-feign创建">2 Feign创建</h2>
<p>在dongyimai-service-api中创建dongyimai-item-web-api，该工程中主要创建dongyimai-item-web的对外依赖抽取信息。</p>
<p>(1)Feign创建</p>
<p>在dongyimai-item-web-api中创建com.offcn.item.feign.PageFeign,代码如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@FeignClient</span><span style="color:#000;font-weight:bold">(</span>name<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;item-web&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RequestMapping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/page&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">interface</span> <span style="color:#458;font-weight:bold">PageFeign</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * 根据SpuID生成静态页
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param id
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@RequestMapping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/createHtml/{id}&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    Result <span style="color:#900;font-weight:bold">createHtml</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3c5d5d;font-weight:bold">@PathVariable</span><span style="color:#000;font-weight:bold">(</span>name<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;id&#34;</span><span style="color:#000;font-weight:bold">)</span> Long id<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>(2)pom.xml依赖</p>
<p>修改dongyimai-canal-service工程的pom.xml，引入如下依赖：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--静态页API 服务--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;groupId&gt;</span>com.offcn<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;artifactId&gt;</span>dongyimai-item-web-api<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;version&gt;</span>1.0<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;exclusions&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&lt;exclusion&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000080">&lt;groupId&gt;</span>com.alibaba<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000080">&lt;artifactId&gt;</span>druid-spring-boot-starter<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#000080">&lt;/exclusion&gt;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#000080">&lt;/exclusions&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>(3)修改dongyiami-canal-service工程中的启动类
<img src="/posts/project-0/20220527231757/image-20220527233024713.png"
    
    
    
    loading="lazy"
    
    
></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@SpringBootApplication</span><span style="color:#000;font-weight:bold">(</span>exclude<span style="color:#000;font-weight:bold">={</span>DataSourceAutoConfiguration<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@EnableEurekaClient</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@EnableCanalClient</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@EnableFeignClients</span><span style="color:#000;font-weight:bold">(</span>basePackages <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#d14">&#34;com.offcn.content.feign&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;com.offcn.item.feign&#34;</span><span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">CanalApplication</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        SpringApplication<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">run</span><span style="color:#000;font-weight:bold">(</span>CanalApplication<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span>args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="3-canal监听数据变化">3 canal监听数据变化</h2>
<p>监听类中,监听商品数据库的tb_goods的数据变化,当数据变化的时候生成静态页或者删除静态页</p>
<p>在原来的监听类中添加如下代码即可,</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">private</span> PageFeign pageFeign<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@ListenPoint</span><span style="color:#000;font-weight:bold">(</span>destination <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;example&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        schema <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;dongyimaidb&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>        table <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#d14">&#34;tb_goods&#34;</span><span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>        eventType <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>CanalEntry<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">EventType</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">UPDATE</span><span style="color:#000;font-weight:bold">,</span> CanalEntry<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">EventType</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">INSERT</span><span style="color:#000;font-weight:bold">,</span> CanalEntry<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">EventType</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">DELETE</span><span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">onEventCustomSpu</span><span style="color:#000;font-weight:bold">(</span>CanalEntry<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">EventType</span> eventType<span style="color:#000;font-weight:bold">,</span> CanalEntry<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">RowData</span> rowData<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//判断操作类型
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>eventType <span style="color:#000;font-weight:bold">==</span> CanalEntry<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">EventType</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">DELETE</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        String goodsId <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        List<span style="color:#000;font-weight:bold">&lt;</span>CanalEntry<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Column</span><span style="color:#000;font-weight:bold">&gt;</span> beforeColumnsList <span style="color:#000;font-weight:bold">=</span> rowData<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getBeforeColumnsList</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>CanalEntry<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Column</span> column <span style="color:#000;font-weight:bold">:</span> beforeColumnsList<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>column<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getName</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">equals</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;id&#34;</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                goodsId <span style="color:#000;font-weight:bold">=</span> column<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getValue</span><span style="color:#000;font-weight:bold">();</span><span style="color:#998;font-style:italic">//goodsId
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//todo 删除静态页
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">else</span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//新增 或者 更新
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        List<span style="color:#000;font-weight:bold">&lt;</span>CanalEntry<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Column</span><span style="color:#000;font-weight:bold">&gt;</span> afterColumnsList <span style="color:#000;font-weight:bold">=</span> rowData<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getAfterColumnsList</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        String goodsId <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>CanalEntry<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Column</span> column <span style="color:#000;font-weight:bold">:</span> afterColumnsList<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>column<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getName</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">equals</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;id&#34;</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                goodsId <span style="color:#000;font-weight:bold">=</span> column<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getValue</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//更新 生成静态页
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        pageFeign<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createHtml</span><span style="color:#000;font-weight:bold">(</span>Long<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">valueOf</span><span style="color:#000;font-weight:bold">(</span>goodsId<span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>4.具体演示可以新增一个商品数据，然后后在监听的时候打印一个数据语句便于观察效果。</p>
<p>新增之后，可以看到 dongyimai-canal-service,打印如下输出语句
<img src="/posts/project-0/20220527231757/image-20220527233036229.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>查看静态页面目录发现生成了静态页面。</p>

    </div>

    

    


    <div class="container-prevnext">
    <div><a href="https://lovemjh.vercel.app/posts/tool/_20220527215246/">← Docker快速入门</a></div>
    <div><a href="https://lovemjh.vercel.app/posts/project-0/20220527220542/">东易买后端微服务框架搭建  →</a></div>
</div>
</div>

        </div>
        <div id="footer"><div class="container-footer">
    
    <a href="//beian.miit.gov.cn" target="_blank">
        
        豫ICP备2022002918号
        
    </a>
    <a id="s" href="/secrets">&nbsp;</a>
</div></div>
    </body>
</html>
