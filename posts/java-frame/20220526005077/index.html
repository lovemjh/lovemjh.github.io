<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="Spring-2 - https://lovemjh.vercel.app/posts/java-frame/20220526005077/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>Spring-2</title>
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    <link rel="stylesheet" href="https://lovemjh.vercel.app/style.min.824365c118b34524ce845ac2a294220354719cca11af5b27a81b04c173bbba57.css">
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate cool">
        <div id="header"><div class="container-header">
    <div id="vars" class="container-vars" style="display: none;">
	{
		"hasFoldAllCodeBlocks": false,
		"svgColor": "#6c757d",
		"en": false,
		"dark": false
	}
</div>
    <h1 class="title">
        
            Spring-2
            
        
    </h1>

    <div class="container-breadcrumb-nav">
    
    <div class="breadcrumb-nav-bar">
        <div><a href="/"><svg t="1656411084410" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2954" width="16" height="16"><path d="M947.5 390.6l-377-290c-34.5-26.5-82.6-26.5-117.1 0l-377 290c-14 10.8-16.6 30.9-5.9 44.9 10.8 14 30.9 16.6 44.9 5.9l28.5-21.9V768c0 88.2 71.8 160 160 160h80c35.3 0 64-28.7 64-64V640c0-17.6 14.4-32 32-32h64c17.6 0 32 14.4 32 32v224c0 35.3 28.7 64 64 64h80c88.2 0 160-71.8 160-160V419.4l28.5 21.9c5.8 4.5 12.7 6.6 19.5 6.6 9.6 0 19.1-4.3 25.4-12.5 10.8-13.9 8.2-34-5.8-44.8zM816 768c0 52.9-43.1 96-96 96h-80V640c0-52.9-43.1-96-96-96h-64c-52.9 0-96 43.1-96 96v224h-80c-52.9 0-96-43.1-96-96V370.2l284.5-218.8c11.5-8.8 27.5-8.8 39 0L816 370.2V768z" fill=#6c757d p-id="2955"></path></svg></a></div>
        <div><a href="/nav"><svg t="1656411531924" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5827" width="16" height="16"><path d="M849.59197473 125.23018519L139.22930586 391.72854662a23.35052669 23.35052669 0 0 0-14.95414244 21.65490745c-0.12257519 9.70384955 5.61801843 18.46795771 14.40255493 22.04306141l318.42928099 129.25528056 119.51057092 320.39047893c3.06437293 8.23295069 10.35758221 13.89182751 18.7335381 14.87242563l2.7170774 0.14300521a22.79893918 22.79893918 0 0 0 21.20546682-15.36272638l259.51158924-729.54564933a23.8612558 23.8612558 0 0 0-5.31158128-24.55584682 22.3290685 22.3290685 0 0 0-23.9021142-5.43415649zM793.65694081 211.64552314l-196.63064161 552.75171747-91.91077952-246.37564122-253.62799211-102.96295445 542.16941324-203.4131218z" p-id="5828" fill=#6c757d></path></svg></a></div>
        <div><a href="/search"><svg t="1656411627509" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1730" width="14" height="14"><path d="M469.333333 85.333333c211.968 0 384 172.032 384 384s-172.032 384-384 384-384-172.032-384-384 172.032-384 384-384z m0 682.666667c164.992 0 298.666667-133.674667 298.666667-298.666667 0-165.034667-133.674667-298.666667-298.666667-298.666666-165.034667 0-298.666667 133.632-298.666666 298.666666 0 164.992 133.632 298.666667 298.666666 298.666667z m362.026667 3.029333l120.704 120.661334-60.373333 60.373333-120.661334-120.704 60.330667-60.330667z" p-id="1731" fill=#6c757d></path></svg></a></div>
        <div><a href="/posts"><svg t="1656411724198" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5655" width="12" height="12"><path d="M811.705761 1024H212.294239c-93.1199 0-174.823046-87.570975-174.823046-187.387854V162.322018C37.471193 69.776145 112.604921 0 212.294239 0H596.190595l7.015883 5.93161c111.74388 95.479788 185.857116 170.741078 279.614824 266.093304 29.65805 30.040735 61.165743 62.122454 96.436499 97.393211l7.271006 7.334787v459.859234c-0.063781 99.816879-81.703145 187.387854-174.823046 187.387854zM212.294239 49.94033c-72.391155 0-124.882716 47.261538-124.882716 112.381688v674.290128c0 71.94469 59.507443 137.383743 124.882716 137.383743h599.411522c65.311492 0 124.882716-65.439053 124.882716-137.383743V397.417876c-32.528184-32.464404-61.73977-62.250016-89.356836-90.377328-90.951355-92.418312-163.278729-165.957521-269.601245-257.163999H212.294239z" fill=#6c757d p-id="5656"></path><path d="M936.588477 449.526752h-212.326129c-99.753099 0-187.324073-81.703145-187.324073-174.823046V49.94033a25.002055 25.002055 0 0 1 49.94033 0v224.763376c0 65.311492 65.502834 124.882716 137.383743 124.882716h212.326129a25.002055 25.002055 0 1 1 0 49.94033z" fill=#6c757d p-id="5657"></path></svg></a></div>
        <div><a href="/archive"><svg t="1656411795742" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7334" width="12" height="12"><path d="M884.224 522.24H504.32V141.824c0-16.896-13.824-30.72-30.72-30.72-120.32 0-233.472 47.616-317.952 134.144S26.112 445.952 29.184 566.784c2.56 114.688 49.152 222.72 131.072 304.128 81.92 81.408 189.952 128 304.64 130.56h10.24c117.76 0 227.84-45.568 312.32-128.512 86.528-85.504 133.632-199.68 132.608-321.024-0.512-2.048-1.536-29.696-35.84-29.696z m-140.288 307.712c-74.752 73.728-173.056 112.64-277.504 110.592-205.824-4.608-370.688-169.472-375.296-374.784-3.072-104.448 35.84-202.752 108.544-277.504 65.536-67.072 151.552-107.52 243.712-114.688v378.88c0 16.896 13.824 30.72 30.72 30.72 129.024 0 311.296 0 382.976 0.512-6.144 93.184-46.08 179.712-113.152 246.272z" fill=#6c757d p-id="7335"></path><path d="M603.136 11.264c-8.192-0.512-15.872 3.072-22.016 8.704-5.632 5.632-9.216 13.824-9.216 22.016v378.88c0 16.896 13.824 30.72 30.72 30.72h378.88c16.896 0 30.72-13.824 30.72-30.72 0-223.744-183.808-407.552-409.088-409.6z m30.208 378.88V74.24c167.424 16.384 301.056 150.016 315.904 315.904h-315.904z" fill=#6c757d p-id="7336"></path></svg></a></div>
        <div id="light-dark" style="cursor: pointer;"><a><svg t="1656411842215" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5086" width="12" height="12"><path d="M1007.492874 384.513055c-8.795694-34.58307-21.189627-67.666874-36.682043-99.05151-2.698679-5.397358-10.894667-3.498287-10.894666 2.598728v0.299853c0 32.484098-6.896624 63.868734-19.890263 92.554691-10.694764 23.488501-25.487523 45.077933-43.978471 64.068635-41.779547 42.679107-99.05151 66.967217-158.722299 67.26707-61.869712 0.299853-119.941284-24.188159-162.920244-68.966238-40.280281-41.979449-62.56937-98.251902-62.269516-156.323473 0.399804-59.270984 23.588452-114.94373 65.567901-156.823229 19.59041-19.59041 42.179351-35.082826 66.667364-46.077443C672.956643 71.166451 704.041426 64.469729 736.125719 64.469729h1.299364c6.097015 0 8.096037-8.096037 2.598728-10.794715C708.739126 37.982696 675.655322 25.488812 641.172203 16.493216 599.492607 5.598549 555.714038-0.098662 510.536154 0.001289 222.37722 0.700947-7.41029 237.38508 0.185992 525.444064c7.096526 271.667008 225.889418 490.559851 497.456474 497.856279 287.559228 7.796183 524.14341-220.891864 525.842579-508.551044 0.299853-44.977981-5.297407-88.656599-15.992171-130.236244z m-83.15929 301.552378c-22.588942 53.27392-54.873137 101.250434-95.953027 142.330323-41.179841 41.179841-89.056403 73.464036-142.330324 95.953027-55.172991 23.288599-113.744317 35.182777-174.314666 35.182777s-119.141675-11.794226-174.314666-35.182777c-53.27392-22.588942-101.250434-54.873137-142.330323-95.953027-41.179841-41.179841-73.464036-89.056403-95.953027-142.330323C75.749001 630.892442 63.954774 572.221164 63.954774 511.750767s11.794226-119.141675 35.182777-174.314666c22.588942-53.27392 54.873137-101.250434 95.953027-142.330323 41.179841-41.179841 89.056403-73.464036 142.330323-95.953027C392.593892 75.7642 451.26517 63.969974 511.735567 63.969974c13.99315 0 27.886348 0.599706 41.679596 1.89907C489.246577 118.643209 448.266638 198.704016 448.266638 288.360126c0 159.022152 128.836929 287.859081 287.859081 287.859081 89.156354 0 168.817357-40.580134 221.691473-104.149015 1.099462 13.09359 1.699168 26.387082 1.699168 39.680575 0 60.470397-11.794226 119.141675-35.182776 174.314666z" p-id="5087" fill=#6c757d></path></svg></a></div>
        
    </div>

    
</div>

            <div id="toc">ğŸ“œ</div>
        
    
    
</div>
</div>
        <div id="content">












<div class="container-main 
     container-page 
">

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7409" width="12" height="12"><path d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z" p-id="7410" fill="#adb5bd"></path></svg>
            2022-05-25&nbsp;
        </span>
        <span>
            
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="23838" width="11" height="11"><path d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z" p-id="23839" fill="#adb5bd"></path></svg>
            2022-05-25&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="33866" width="12" height="12"><path d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z" fill="#adb5bd" p-id="33867"></path><path d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z" fill="#adb5bd" p-id="33868"></path></svg>
            11177 å­—</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="32892" width="12" height="12"><path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z" p-id="32893" fill="#adb5bd"></path><path d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z" p-id="32894" fill="#adb5bd"></path></svg>
            23 åˆ†é’Ÿ</span><div class="container-ctgtag">
	<div class="taxonomy">
		
		<div class="ctg">
			
			
			<a href="/categories/"></a>
			
		</div>
		<div class="tag">
			
			 - 
			
			<a href="/tags/"></a>
			
		</div>
	</div>
</div>
    </div>
    
    <div class="toc">
        
        <div class="page-operation">
            <div><a href="#"><img src="/imgs/icons/arrow-up-circle.svg" alt=""></a></div>
            <div><a href="https://lovemjh.vercel.app/posts/java-frame/20220526003427/"><img src="/imgs/icons/arrow-left-circle.svg" alt=""></a></div>
            <div><a href="https://lovemjh.vercel.app/posts/java-web/20220430214937/"><img src="/imgs/icons/arrow-right-circle.svg" alt=""></a></div>
        </div>
        
        <nav id="TableOfContents">
  <ul>
    <li><a href="#0å®ç°è½¬è´¦ä¸šåŠ¡">0ã€å®ç°è½¬è´¦ä¸šåŠ¡</a>
      <ul>
        <li><a href="#ä¸€-å®ç°è½¬è´¦ä¸šåŠ¡">ä¸€ï¼š å®ç°è½¬è´¦ä¸šåŠ¡</a>
          <ul>
            <li><a href="#1-åº•å±‚æ•°æ®åº“è¡¨-account">1 åº•å±‚æ•°æ®åº“è¡¨ï¼š Account</a></li>
            <li><a href="#2-å®ç°ç±»-account">2 å®ç°ç±»ï¼š Account</a></li>
            <li><a href="#3-accountdao-å±‚æ¥å£--accountdaoimpl">3 AccountDao å±‚æ¥å£ &amp; AccountDaoImpl</a></li>
            <li><a href="#4-accountserviceå±‚æ¥å£--accountserviceimpl">4 AccountServiceå±‚æ¥å£ &amp; AccountServiceImpl</a></li>
            <li><a href="#5-applicationcontextxml-ç®¡ç†å¯¹è±¡">5: applicationContext.xml ç®¡ç†å¯¹è±¡</a></li>
            <li><a href="#6-è½¬è´¦æµ‹è¯•">6 è½¬è´¦æµ‹è¯•</a></li>
          </ul>
        </li>
        <li><a href="#äºŒäº‹åŠ¡ç›¸å…³å†…å®¹å¤ä¹ ">äºŒã€äº‹åŠ¡ç›¸å…³å†…å®¹å¤ä¹ </a></li>
        <li><a href="#ä¸‰äº‹åŠ¡æ§åˆ¶-threadlocal">ä¸‰ã€äº‹åŠ¡æ§åˆ¶-ThreadLocal</a>
          <ul>
            <li><a href="#1å®šä¹‰äº†ä¸€ä¸ªè¿æ¥çš„å·¥å…·ç±»">1.å®šä¹‰äº†ä¸€ä¸ªè¿æ¥çš„å·¥å…·ç±»</a></li>
            <li><a href="#2æ”¹é€ äº†accountdaoimpl">2ã€æ”¹é€ äº†AccountDaoImpl</a></li>
            <li><a href="#3å®šä¹‰äº†äº‹åŠ¡ç®¡ç†çš„å·¥å…·ç±»">3ã€å®šä¹‰äº†äº‹åŠ¡ç®¡ç†çš„å·¥å…·ç±»</a></li>
            <li><a href="#4æ”¹é€ accountserviceimpl">4ã€æ”¹é€ AccountServiceImpl</a></li>
            <li><a href="#5é…ç½®æ–‡ä»¶æ”¹é€ ">5ã€é…ç½®æ–‡ä»¶æ”¹é€ </a></li>
            <li><a href="#6æµ‹è¯•è½¬è´¦-è€ƒè™‘äº‹åŠ¡">6ã€æµ‹è¯•è½¬è´¦-è€ƒè™‘äº‹åŠ¡</a></li>
          </ul>
        </li>
        <li><a href="#å››-äº‹åŠ¡æ§åˆ¶-åŠ¨æ€ä»£ç†">å››ã€ äº‹åŠ¡æ§åˆ¶-åŠ¨æ€ä»£ç†</a>
          <ul>
            <li><a href="#1åŠ¨æ€ä»£ç†æ¨¡å¼23">1ã€åŠ¨æ€ä»£ç†æ¨¡å¼ã€23ã€‘</a></li>
            <li><a href="#2åŠ¨æ€ä»£ç†çš„å…¥é—¨æ¡ˆä¾‹">2ã€åŠ¨æ€ä»£ç†çš„å…¥é—¨æ¡ˆä¾‹</a></li>
            <li><a href="#3-ä½¿ç”¨åŠ¨æ€ä»£ç†æ§åˆ¶äº‹åŠ¡">3 ä½¿ç”¨åŠ¨æ€ä»£ç†æ§åˆ¶äº‹åŠ¡</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#ä¸€-springaopæœºåˆ¶è¯¦è§£">ä¸€ã€ SpringAOPæœºåˆ¶è¯¦è§£</a>
      <ul>
        <li><a href="#ä¸€aop-æ¦‚è¿°">ï¼ˆä¸€ï¼‰AOP æ¦‚è¿°</a>
          <ul>
            <li><a href="#1-ä»€ä¹ˆæ˜¯-aop">1 ä»€ä¹ˆæ˜¯ AOP</a></li>
            <li><a href="#2-aopç¼–ç¨‹æ€æƒ³">2 AOPç¼–ç¨‹æ€æƒ³</a></li>
            <li><a href="#3-springä¸­çš„å¸¸ç”¨æœ¯è¯­">3 Springä¸­çš„å¸¸ç”¨æœ¯è¯­</a></li>
            <li><a href="#4-aop-çš„ä½œç”¨åŠä¼˜åŠ¿">4 AOP çš„ä½œç”¨åŠä¼˜åŠ¿</a></li>
          </ul>
        </li>
        <li><a href="#äºŒspringåŸºäºxmlçš„aopé…ç½®">ï¼ˆäºŒï¼‰SpringåŸºäºXMLçš„AOPé…ç½®</a>
          <ul>
            <li><a href="#1-ç¯å¢ƒæ­å»º">1 ç¯å¢ƒæ­å»º</a>
              <ul>
                <li><a href="#11-æ„å»ºmavenå·¥ç¨‹æ·»åŠ ä¾èµ–">1.1 æ„å»ºmavenå·¥ç¨‹æ·»åŠ ä¾èµ–</a></li>
                <li><a href="#12-æ²¿ç”¨è½¬è´¦ä¸šåŠ¡çš„ä»£ç ">1.2 æ²¿ç”¨è½¬è´¦ä¸šåŠ¡çš„ä»£ç </a></li>
                <li><a href="#13-åˆ›å»º-spring-çš„é…ç½®æ–‡ä»¶å¹¶å¯¼å…¥çº¦æŸ">1.3 åˆ›å»º Spring çš„é…ç½®æ–‡ä»¶å¹¶å¯¼å…¥çº¦æŸ</a></li>
                <li><a href="#14-é…ç½®-spring-çš„-ioc">1.4 é…ç½® Spring çš„ IOC</a></li>
                <li><a href="#15-æŠ½å–å…¬å…±ä»£ç åˆ¶ä½œæˆé€šçŸ¥å¢å¼ºä»£ç ">1.5 æŠ½å–å…¬å…±ä»£ç åˆ¶ä½œæˆé€šçŸ¥(å¢å¼ºä»£ç )</a></li>
              </ul>
            </li>
            <li><a href="#2-aop-é…ç½®æ­¥éª¤">2 AOP é…ç½®æ­¥éª¤</a>
              <ul>
                <li><a href="#21-æŠŠé€šçŸ¥ç±»ç”¨-bean-æ ‡ç­¾é…ç½®èµ·æ¥">2.1 æŠŠé€šçŸ¥ç±»ç”¨ bean æ ‡ç­¾é…ç½®èµ·æ¥</a></li>
                <li><a href="#22-ä½¿ç”¨-aopconfig-å£°æ˜-aop-é…ç½®">2.2 ä½¿ç”¨ aop:config å£°æ˜ AOP é…ç½®</a></li>
                <li><a href="#23-ä½¿ç”¨-aopaspect-é…ç½®åˆ‡é¢">2.3 ä½¿ç”¨ aop:aspect é…ç½®åˆ‡é¢</a></li>
                <li><a href="#24-ä½¿ç”¨-aoppointcut-é…ç½®åˆ‡å…¥ç‚¹è¡¨è¾¾å¼">2.4 ä½¿ç”¨ aop:pointcut é…ç½®åˆ‡å…¥ç‚¹è¡¨è¾¾å¼</a></li>
                <li><a href="#25--ä½¿ç”¨-aopxxx-é…ç½®å¯¹åº”çš„é€šçŸ¥ç±»å‹">2.5  ä½¿ç”¨ aop:xxx é…ç½®å¯¹åº”çš„é€šçŸ¥ç±»å‹</a></li>
              </ul>
            </li>
            <li><a href="#3-åˆ‡å…¥ç‚¹è¡¨è¾¾å¼è¯´æ˜">3 åˆ‡å…¥ç‚¹è¡¨è¾¾å¼è¯´æ˜</a>
              <ul>
                <li><a href="#31-åˆ‡ç‚¹è¡¨è¾¾å¼çš„è¯­æ³•">3.1 åˆ‡ç‚¹è¡¨è¾¾å¼çš„è¯­æ³•</a></li>
              </ul>
            </li>
            <li><a href="#4-ç¯ç»•é€šçŸ¥é…ç½®äº‹åŠ¡ç®¡ç†">4 ç¯ç»•é€šçŸ¥é…ç½®äº‹åŠ¡ç®¡ç†</a></li>
          </ul>
        </li>
        <li><a href="#ä¸‰springåŸºäºæ³¨è§£çš„aopé…ç½®">ï¼ˆä¸‰ï¼‰SpringåŸºäºæ³¨è§£çš„AOPé…ç½®</a>
          <ul>
            <li><a href="#1-ç¯å¢ƒæ­å»º-1">1 ç¯å¢ƒæ­å»º</a>
              <ul>
                <li><a href="#11-æ„å»ºmavenå·¥ç¨‹æ·»åŠ aopæ³¨è§£çš„ç›¸å…³ä¾èµ–">1.1 æ„å»ºmavenå·¥ç¨‹æ·»åŠ AOPæ³¨è§£çš„ç›¸å…³ä¾èµ–</a></li>
                <li><a href="#12-æ²¿ç”¨ä¸Šä¸€ç« èŠ‚èµ„æº">1.2 æ²¿ç”¨ä¸Šä¸€ç« èŠ‚èµ„æº</a></li>
                <li><a href="#13-åœ¨é…ç½®æ–‡ä»¶ä¸­å¯¼å…¥-context-çš„åç§°ç©ºé—´ä¸”é…ç½®">1.3 åœ¨é…ç½®æ–‡ä»¶ä¸­å¯¼å…¥ context çš„åç§°ç©ºé—´ä¸”é…ç½®</a></li>
                <li><a href="#14-èµ„æºä½¿ç”¨æ³¨è§£é…ç½®">1.4 èµ„æºä½¿ç”¨æ³¨è§£é…ç½®</a></li>
                <li><a href="#15-åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®š-spring-è¦æ‰«æçš„åŒ…">1.5 åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®š spring è¦æ‰«æçš„åŒ…</a></li>
              </ul>
            </li>
            <li><a href="#2-é…ç½®æ­¥éª¤">2 é…ç½®æ­¥éª¤</a>
              <ul>
                <li><a href="#11--é€šçŸ¥ç±»ä½¿ç”¨æ³¨è§£é…ç½®">1.1  é€šçŸ¥ç±»ä½¿ç”¨æ³¨è§£é…ç½®</a></li>
                <li><a href="#12-åœ¨é€šçŸ¥ç±»ä¸Šä½¿ç”¨aspect-æ³¨è§£å£°æ˜ä¸ºåˆ‡é¢">1.2 åœ¨é€šçŸ¥ç±»ä¸Šä½¿ç”¨@Aspect æ³¨è§£å£°æ˜ä¸ºåˆ‡é¢</a></li>
                <li><a href="#13-åœ¨å¢å¼ºçš„æ–¹æ³•ä¸Šä½¿ç”¨æ³¨è§£é…ç½®é€šçŸ¥">1.3 åœ¨å¢å¼ºçš„æ–¹æ³•ä¸Šä½¿ç”¨æ³¨è§£é…ç½®é€šçŸ¥</a></li>
                <li><a href="#14-åœ¨-spring-é…ç½®æ–‡ä»¶ä¸­å¼€å¯-spring-å¯¹æ³¨è§£-aop-çš„æ”¯æŒ">1.4 åœ¨ spring é…ç½®æ–‡ä»¶ä¸­å¼€å¯ spring å¯¹æ³¨è§£ AOP çš„æ”¯æŒ</a></li>
                <li><a href="#15-ç¯ç»•é€šçŸ¥æ³¨è§£é…ç½®">1.5 ç¯ç»•é€šçŸ¥æ³¨è§£é…ç½®</a></li>
                <li><a href="#16-åˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ³¨è§£">1.6 åˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ³¨è§£</a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#äºŒ-springäº‹åŠ¡è¯¦è§£">äºŒã€ Springäº‹åŠ¡è¯¦è§£</a>
      <ul>
        <li><a href="#ä¸€springä¸­äº‹åŠ¡çš„apiè¯¦è§£">ï¼ˆä¸€ï¼‰Springä¸­äº‹åŠ¡çš„APIè¯¦è§£</a>
          <ul>
            <li><a href="#1-platformtransactionmanagerä½œç”¨æŒæ¡">1 PlatformTransactionManagerä½œç”¨ã€æŒæ¡ã€‘</a></li>
            <li><a href="#2-transactiondefinitionä½œç”¨">2 TransactionDefinitionä½œç”¨</a>
              <ul>
                <li><a href="#21-äº‹åŠ¡éš”ç¦»çº§åˆ«">2.1 äº‹åŠ¡éš”ç¦»çº§åˆ«</a></li>
                <li><a href="#22-äº‹åŠ¡ä¼ æ’­è¡Œä¸º">2.2 äº‹åŠ¡ä¼ æ’­è¡Œä¸º</a></li>
                <li><a href="#23-äº‹åŠ¡è¶…æ—¶æ—¶é—´">2.3 äº‹åŠ¡è¶…æ—¶æ—¶é—´</a></li>
                <li><a href="#24-æ˜¯å¦æ˜¯åªè¯»äº‹åŠ¡">2.4 æ˜¯å¦æ˜¯åªè¯»äº‹åŠ¡</a></li>
              </ul>
            </li>
            <li><a href="#3-transactionstatusä½œç”¨">3 TransactionStatusä½œç”¨</a></li>
            <li><a href="#4-ä¸Šè¿°ä¸‰ä¸ªå¯¹è±¡å…³ç³»">4 ä¸Šè¿°ä¸‰ä¸ªå¯¹è±¡å…³ç³»</a></li>
          </ul>
        </li>
        <li><a href="#äºŒspringåŸºäºxmlçš„äº‹åŠ¡é…ç½®">ï¼ˆäºŒï¼‰SpringåŸºäºXMLçš„äº‹åŠ¡é…ç½®</a>
          <ul>
            <li><a href="#1-ç¯å¢ƒæ­å»º-2">1 ç¯å¢ƒæ­å»º</a>
              <ul>
                <li><a href="#11-æ„å»ºmavenå·¥ç¨‹æ·»åŠ ç›¸å…³æŠ€æœ¯ä¾èµ–">1.1 æ„å»ºmavenå·¥ç¨‹ï¼Œæ·»åŠ ç›¸å…³æŠ€æœ¯ä¾èµ–</a></li>
                <li><a href="#12-åˆ›å»ºspring-çš„é…ç½®æ–‡ä»¶å¹¶å¯¼å…¥çº¦æŸ">1.2 åˆ›å»ºSpring çš„é…ç½®æ–‡ä»¶å¹¶å¯¼å…¥çº¦æŸ</a></li>
                <li><a href="#13-æ²¿ç”¨è½¬è´¦ä¸šåŠ¡çš„ä»£ç ">1.3 æ²¿ç”¨è½¬è´¦ä¸šåŠ¡çš„ä»£ç </a></li>
              </ul>
            </li>
            <li><a href="#2-äº‹åŠ¡ç®¡ç†é…ç½®æ­¥éª¤">2 äº‹åŠ¡ç®¡ç†é…ç½®æ­¥éª¤</a>
              <ul>
                <li><a href="#21-é…ç½®äº‹åŠ¡ç®¡ç†å™¨">2.1 é…ç½®äº‹åŠ¡ç®¡ç†å™¨</a></li>
                <li><a href="#22-é…ç½®äº‹åŠ¡çš„é€šçŸ¥å¼•ç”¨äº‹åŠ¡ç®¡ç†å™¨">2.2 é…ç½®äº‹åŠ¡çš„é€šçŸ¥å¼•ç”¨äº‹åŠ¡ç®¡ç†å™¨</a></li>
                <li><a href="#23-é…ç½®äº‹åŠ¡çš„å±æ€§">2.3 é…ç½®äº‹åŠ¡çš„å±æ€§</a></li>
                <li><a href="#24-é…ç½®-aop-åˆ‡å…¥ç‚¹è¡¨è¾¾å¼">2.4 é…ç½® AOP åˆ‡å…¥ç‚¹è¡¨è¾¾å¼</a></li>
                <li><a href="#25-é…ç½®åˆ‡å…¥ç‚¹è¡¨è¾¾å¼å’Œäº‹åŠ¡é€šçŸ¥çš„å¯¹åº”å…³ç³»">2.5 é…ç½®åˆ‡å…¥ç‚¹è¡¨è¾¾å¼å’Œäº‹åŠ¡é€šçŸ¥çš„å¯¹åº”å…³ç³»</a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#ä¸‰-springäº‹åŠ¡è¯¦è§£-æ³¨è§£">ä¸‰ã€ Springäº‹åŠ¡è¯¦è§£-æ³¨è§£</a>
      <ul>
        <li><a href="#ä¸€-springåŸºäºæ³¨è§£çš„äº‹åŠ¡é…ç½®">ï¼ˆä¸€ï¼‰ SpringåŸºäºæ³¨è§£çš„äº‹åŠ¡é…ç½®</a>
          <ul>
            <li><a href="#1-ç¯å¢ƒæ­å»º-3">1 ç¯å¢ƒæ­å»º</a>
              <ul>
                <li><a href="#11--æ„å»ºmavenå·¥ç¨‹æ·»åŠ ç›¸å…³æŠ€æœ¯ä¾èµ–">1.1  æ„å»ºmavenå·¥ç¨‹ï¼Œæ·»åŠ ç›¸å…³æŠ€æœ¯ä¾èµ–</a></li>
                <li><a href="#12-åˆ›å»º-spring-çš„é…ç½®æ–‡ä»¶å¹¶å¯¼å…¥çº¦æŸ">1.2 åˆ›å»º Spring çš„é…ç½®æ–‡ä»¶å¹¶å¯¼å…¥çº¦æŸ</a></li>
                <li><a href="#13-æ²¿ç”¨è½¬è´¦ä¸šåŠ¡çš„ä»£ç daoå®ç°ç±»å’Œserviceå®ç°ç±»é‡‡ç”¨æ³¨è§£çš„å½¢å¼æ·»åŠ åˆ°å®¹å™¨ä¸­ç®¡ç†">1.3 æ²¿ç”¨è½¬è´¦ä¸šåŠ¡çš„ä»£ç ï¼šdaoå®ç°ç±»å’Œserviceå®ç°ç±»é‡‡ç”¨æ³¨è§£çš„å½¢å¼ï¼Œæ·»åŠ åˆ°å®¹å™¨ä¸­ç®¡ç†</a></li>
              </ul>
            </li>
            <li><a href="#2-äº‹åŠ¡ç®¡ç†é…ç½®æ­¥éª¤é‡ç‚¹">2 äº‹åŠ¡ç®¡ç†é…ç½®æ­¥éª¤(é‡ç‚¹)</a>
              <ul>
                <li><a href="#21-é…ç½®äº‹åŠ¡ç®¡ç†å™¨å¹¶æ³¨å…¥æ•°æ®æº">2.1 é…ç½®äº‹åŠ¡ç®¡ç†å™¨å¹¶æ³¨å…¥æ•°æ®æº</a></li>
                <li><a href="#22-åœ¨ä¸šåŠ¡å±‚ä½¿ç”¨transactional-æ³¨è§£">2.2 åœ¨ä¸šåŠ¡å±‚ä½¿ç”¨@Transactional æ³¨è§£</a></li>
                <li><a href="#23-åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯-spring-å¯¹æ³¨è§£äº‹åŠ¡çš„æ”¯æŒ">2.3 åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯ Spring å¯¹æ³¨è§£äº‹åŠ¡çš„æ”¯æŒ</a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#å››-springæ•´åˆmybatiså®ç°ç”¨æˆ·çš„crud">å››ã€ Springæ•´åˆMybatiså®ç°ç”¨æˆ·çš„CRUD</a>
      <ul>
        <li><a href="#ä¸€æ•´åˆæ€è·¯åˆ†æ">ï¼ˆä¸€ï¼‰æ•´åˆæ€è·¯åˆ†æ</a></li>
        <li><a href="#äºŒæ„å»ºmavenå·¥ç¨‹æ·»åŠ æŠ€æœ¯ä¾èµ–">ï¼ˆäºŒï¼‰æ„å»ºmavenå·¥ç¨‹ï¼Œæ·»åŠ æŠ€æœ¯ä¾èµ–</a></li>
        <li><a href="#ä¸‰æ„å»ºæ•°æ®åº“è¡¨å¹¶åˆ›å»ºå®ä½“user">ï¼ˆä¸‰ï¼‰æ„å»ºæ•°æ®åº“è¡¨å¹¶åˆ›å»ºå®ä½“User</a></li>
        <li><a href="#å››ç¼–å†™daoå±‚çš„æ¥å£usermapper">ï¼ˆå››ï¼‰ç¼–å†™daoå±‚çš„æ¥å£UserMapper</a></li>
        <li><a href="#äº”æ„å»ºmapperæ¥å£å¯¹åº”çš„sqlé…ç½®æ–‡ä»¶">ï¼ˆäº”ï¼‰æ„å»ºmapperæ¥å£å¯¹åº”çš„sqlé…ç½®æ–‡ä»¶</a></li>
        <li><a href="#å…­æ„å»ºæœåŠ¡å±‚æ¥å£userservice">ï¼ˆå…­ï¼‰æ„å»ºæœåŠ¡å±‚æ¥å£UserService</a></li>
        <li><a href="#ä¸ƒæ„å»ºæœåŠ¡å±‚å®ç°ç±»userserviceimpl">ï¼ˆä¸ƒï¼‰æ„å»ºæœåŠ¡å±‚å®ç°ç±»UserServiceImpl</a></li>
        <li><a href="#å…«æ„å»ºspringæ¡†æ¶çš„é…ç½®æ–‡ä»¶applicationcontextxmlé…ç½®iocç®¡ç†çš„å¯¹è±¡é‡ç‚¹">ï¼ˆå…«ï¼‰æ„å»ºSpringæ¡†æ¶çš„é…ç½®æ–‡ä»¶applicationContext.xml,é…ç½®IOCç®¡ç†çš„å¯¹è±¡ã€é‡ç‚¹ã€‘</a></li>
        <li><a href="#ä¹æµ‹è¯•ä»£ç ">ï¼ˆä¹ï¼‰æµ‹è¯•ä»£ç </a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>

    <div class='content  content '>
        <p>å¤ä¹ å›é¡¾ï¼š</p>
<pre tabindex="0"><code>DIï¼š ä¾èµ–æ³¨å…¥
ä¾èµ–æ³¨å…¥çš„æ–¹å¼ï¼š 
æ„é€ å™¨æ³¨å…¥ï¼š 
setteræ³¨å…¥u:
Påç§°ç©ºé—´æ³¨å…¥ï¼š
SpELè¡¨è¾¾å¼æ³¨å…¥ï¼š

IOCçš„æ³¨è§£ç‰ˆæœ¬ï¼š 
@Component  æ‰€å±çš„ç±»æ²¡æœ‰æ˜ç¡®çš„å±‚çº§åˆ’åˆ†ï¼Œ æ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨è¯¥æ³¨è§£ã€‚
@Repository daoå±‚
@Service serviceå±‚ï¼š
@Controller webå±‚ï¼š

DIçš„ç›¸å…³æ³¨è§£ï¼š 
@Value(&#34;&#34;) èƒ½å¤Ÿè·å¾—é…ç½®æ–‡ä»¶å½“ä¸­çš„å†…å®¹ï¼š 
@Autowire æ ¹æ®ç±»å‹è‡ªåŠ¨è£…é…ã€‚  å¦‚æœå®¹å™¨å½“ä¸­æœ‰å¤šä¸ªå¯¹è±¡ï¼Œ æ­¤æ—¶å°±ä¼šæ ¹æ®åç§°è¿›è¡Œè£…é…ã€‚ 
@Qualifier æ ¹æ®å¯¹è±¡çš„åç§°è¿›è¡Œè£…é…ã€‚ 
@Resource javaæä¾›çš„ï¼Œ @Autowire+@Qualifier 

JdbcTemplateæ¨¡æ¿å¯¹è±¡ï¼š 
query() | queryForObject()
update()

springæ•´åˆJunitï¼š 
ï¼ˆ1ï¼‰å¼•å…¥ä¾èµ–åŒ…ï¼š 
ï¼ˆ2ï¼‰å¼•å…¥æ³¨è§£ï¼š
</code></pre><h1 id="0å®ç°è½¬è´¦ä¸šåŠ¡">0ã€å®ç°è½¬è´¦ä¸šåŠ¡</h1>
<h2 id="ä¸€-å®ç°è½¬è´¦ä¸šåŠ¡">ä¸€ï¼š å®ç°è½¬è´¦ä¸šåŠ¡</h2>
<h3 id="1-åº•å±‚æ•°æ®åº“è¡¨-account">1 åº•å±‚æ•°æ®åº“è¡¨ï¼š Account</h3>
<h3 id="2-å®ç°ç±»-account">2 å®ç°ç±»ï¼š Account</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Account</span> <span style="color:#000;font-weight:bold">implements</span> Serializable <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> Integer id<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> String name<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> Double money<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    getter å’Œ setter <span style="color:#000;font-weight:bold">...</span> 
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="3-accountdao-å±‚æ¥å£--accountdaoimpl">3 AccountDao å±‚æ¥å£ &amp; AccountDaoImpl</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">package</span> <span style="color:#555">com.offcn.dao</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.offcn.pojo.Account</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">interface</span> <span style="color:#458;font-weight:bold">AccountDao</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#998;font-style:italic">// data access object
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     *  æ ¹æ®idè¿›è¡Œå”¯ä¸€æ€§æŸ¥è¯¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param id
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>     <span style="color:#000;font-weight:bold">public</span> Account <span style="color:#900;font-weight:bold">findById</span><span style="color:#000;font-weight:bold">(</span>Integer id<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * æ›´æ–°è´¦æˆ·çš„æ–¹æ³•ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param account
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">update</span><span style="color:#000;font-weight:bold">(</span>Account account<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">package</span> <span style="color:#555">com.offcn.dao.impl</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.offcn.dao.AccountDao</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.offcn.pojo.Account</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.apache.commons.dbutils.QueryRunner</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.apache.commons.dbutils.handlers.BeanHandler</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.sql.SQLException</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">AccountDaoImpl</span> <span style="color:#000;font-weight:bold">implements</span> AccountDao <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//private JdbcTemplate jdbcTemplate;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> QueryRunner queryRunner <span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> QueryRunner <span style="color:#900;font-weight:bold">getQueryRunner</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> queryRunner<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setQueryRunner</span><span style="color:#000;font-weight:bold">(</span>QueryRunner queryRunner<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">queryRunner</span> <span style="color:#000;font-weight:bold">=</span> queryRunner<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> Account <span style="color:#900;font-weight:bold">findById</span><span style="color:#000;font-weight:bold">(</span>Integer id<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            String sql <span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;select * from account where id=?&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            Account account <span style="color:#000;font-weight:bold">=</span> queryRunner<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">query</span><span style="color:#000;font-weight:bold">(</span>sql<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">new</span> BeanHandler<span style="color:#000;font-weight:bold">&lt;</span>Account<span style="color:#000;font-weight:bold">&gt;(</span>Account<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">),</span> id<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> account<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>SQLException throwables<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            throwables<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">update</span><span style="color:#000;font-weight:bold">(</span>Account account<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            String sql <span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;update account set money=? where id=?&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            queryRunner<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">update</span><span style="color:#000;font-weight:bold">(</span>sql<span style="color:#000;font-weight:bold">,</span>account<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMoney</span><span style="color:#000;font-weight:bold">(),</span>account<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getId</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>SQLException throwables<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            throwables<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="4-accountserviceå±‚æ¥å£--accountserviceimpl">4 AccountServiceå±‚æ¥å£ &amp; AccountServiceImpl</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">package</span> <span style="color:#555">com.offcn.service</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">interface</span> <span style="color:#458;font-weight:bold">AccountService</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * å®šä¹‰è½¬è´¦æ–¹æ³•ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param sourceId æ¥æºè´¦æˆ·
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param targetId ç›®æ ‡è´¦æˆ·
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param money    è½¬è´¦é‡‘é¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">transfer</span><span style="color:#000;font-weight:bold">(</span>Integer sourceId<span style="color:#000;font-weight:bold">,</span> Integer targetId<span style="color:#000;font-weight:bold">,</span> Double money<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">package</span> <span style="color:#555">com.offcn.service.impl</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.offcn.dao.AccountDao</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.offcn.pojo.Account</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.offcn.service.AccountService</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">AccountServiceImpl</span> <span style="color:#000;font-weight:bold">implements</span> AccountService <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> AccountDao accountDao<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">transfer</span><span style="color:#000;font-weight:bold">(</span>Integer sourceId<span style="color:#000;font-weight:bold">,</span> Integer targetId<span style="color:#000;font-weight:bold">,</span> Double money<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//1: æŸ¥è¯¢æ¥æºè´¦æˆ·,æŸ¥è¯¢ç›®æ ‡è´¦æˆ·
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        Account sAcc <span style="color:#000;font-weight:bold">=</span> accountDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findById</span><span style="color:#000;font-weight:bold">(</span>sourceId<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        Account tAcc <span style="color:#000;font-weight:bold">=</span> accountDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findById</span><span style="color:#000;font-weight:bold">(</span>targetId<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//2: å†…å­˜å½“ä¸­ä¿®æ”¹é‡‘é¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        sAcc<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setMoney</span><span style="color:#000;font-weight:bold">(</span>sAcc<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMoney</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">-</span> money<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        tAcc<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setMoney</span><span style="color:#000;font-weight:bold">(</span>tAcc<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMoney</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">+</span> money<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//3: æ›´æ–°åˆ°æ•°æ®åº“å½“ä¸­ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        accountDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">update</span><span style="color:#000;font-weight:bold">(</span>sAcc<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        accountDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">update</span><span style="color:#000;font-weight:bold">(</span>tAcc<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> AccountDao <span style="color:#900;font-weight:bold">getAccountDao</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> accountDao<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setAccountDao</span><span style="color:#000;font-weight:bold">(</span>AccountDao accountDao<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">accountDao</span> <span style="color:#000;font-weight:bold">=</span> accountDao<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="5-applicationcontextxml-ç®¡ç†å¯¹è±¡">5: applicationContext.xml ç®¡ç†å¯¹è±¡</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;beans</span> <span style="color:#008080">xmlns=</span><span style="color:#d14">&#34;http://www.springframework.org/schema/beans&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008080">xmlns:xsi=</span><span style="color:#d14">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008080">xsi:schemaLocation=</span><span style="color:#d14">&#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--dataSource--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;dataSource&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;com.alibaba.druid.pool.DruidDataSource&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;driverClassName&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;com.mysql.jdbc.Driver&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;url&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;jdbc:mysql://localhost:3306/test&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;username&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;root&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;password&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;root&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--æ„å»ºQueryRunner å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">       QueryRunner qr = new QueryRunner(DataSource dataSource);
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;bean</span> <span style="color:#008080">id =</span><span style="color:#d14">&#34;queryRunner&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;org.apache.commons.dbutils.QueryRunner&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;constructor-arg</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;ds&#34;</span> <span style="color:#008080">ref=</span><span style="color:#d14">&#34;dataSource&#34;</span><span style="color:#000080">&gt;&lt;/constructor-arg&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--accountDao--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;accountDao&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;com.offcn.dao.impl.AccountDaoImpl&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;queryRunner&#34;</span> <span style="color:#008080">ref=</span><span style="color:#d14">&#34;queryRunner&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>                  
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--accountService--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;accountService&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;com.offcn.service.impl.AccountServiceImpl&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;accountDao&#34;</span> <span style="color:#008080">ref=</span><span style="color:#d14">&#34;accountDao&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/beans&gt;</span>
</span></span></code></pre></div><h3 id="6-è½¬è´¦æµ‹è¯•">6 è½¬è´¦æµ‹è¯•</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">package</span> <span style="color:#555">com.offcn</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.offcn.service.AccountService</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.junit.Test</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.junit.runner.RunWith</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.beans.factory.annotation.Autowired</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.test.context.ContextConfiguration</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.test.context.junit4.SpringJUnit4ClassRunner</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RunWith</span><span style="color:#000;font-weight:bold">(</span>SpringJUnit4ClassRunner<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@ContextConfiguration</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;classpath:applicationContext.xml&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">TestTransfer</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> AccountService accountService<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">test1</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        accountService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">transfer</span><span style="color:#000;font-weight:bold">(</span>1001<span style="color:#000;font-weight:bold">,</span>1002<span style="color:#000;font-weight:bold">,</span>100D<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="äºŒäº‹åŠ¡ç›¸å…³å†…å®¹å¤ä¹ ">äºŒã€äº‹åŠ¡ç›¸å…³å†…å®¹å¤ä¹ </h2>
<p>1ã€äº‹åŠ¡çš„å®šä¹‰</p>
<p>2ã€äº‹åŠ¡çš„ç‰¹æ€§</p>
<p>3ã€äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</p>
<p>4ã€ä¸åŒäº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œäº§ç”Ÿä¸åŒçš„é”™è¯¯æ•°æ®ã€‚</p>
<p>5ã€äº‹åŠ¡ç›¸å…³çš„ä»£ç ï¼š Connection ~</p>
<h2 id="ä¸‰äº‹åŠ¡æ§åˆ¶-threadlocal">ä¸‰ã€äº‹åŠ¡æ§åˆ¶-ThreadLocal</h2>
<h3 id="1å®šä¹‰äº†ä¸€ä¸ªè¿æ¥çš„å·¥å…·ç±»">1.å®šä¹‰äº†ä¸€ä¸ªè¿æ¥çš„å·¥å…·ç±»</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * ç®¡ç†è¿æ¥çš„å·¥å…·ç±»ï¼š  
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">ConnectionUtil</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> DataSource dataSource<span style="color:#000;font-weight:bold">;</span><span style="color:#998;font-style:italic">//å‡†å¤‡è¿æ¥å¯¹è±¡ï¼š 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * ThreadLocal: map
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * map.put(çº¿ç¨‹å¯¹è±¡ï¼Œvalue);
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * map.get(çº¿ç¨‹å¯¹è±¡);
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> ThreadLocal<span style="color:#000;font-weight:bold">&lt;</span>Connection<span style="color:#000;font-weight:bold">&gt;</span> threadLocal <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> ThreadLocal<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> Connection <span style="color:#900;font-weight:bold">getConnection</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        Connection connection <span style="color:#000;font-weight:bold">=</span> threadLocal<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>connection <span style="color:#000;font-weight:bold">==</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                connection <span style="color:#000;font-weight:bold">=</span> dataSource<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getConnection</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">//ç»‘å®šåœ¨ThreadLocalå½“ä¸­ï¼š 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                threadLocal<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">set</span><span style="color:#000;font-weight:bold">(</span>connection<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">return</span> connection<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>SQLException throwables<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                throwables<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span>  connection<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>     
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="2æ”¹é€ äº†accountdaoimpl">2ã€æ”¹é€ äº†AccountDaoImpl</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">package</span> <span style="color:#555">com.offcn.dao.impl</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.offcn.dao.AccountDao</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.offcn.pojo.Account</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.offcn.utils.ConnectionUtil</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.apache.commons.dbutils.QueryRunner</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.apache.commons.dbutils.handlers.BeanHandler</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.sql.SQLException</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">AccountDaoImpl</span> <span style="color:#000;font-weight:bold">implements</span> AccountDao <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//private JdbcTemplate jdbcTemplate;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> QueryRunner queryRunner <span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> ConnectionUtil connectionUtil<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> ConnectionUtil <span style="color:#900;font-weight:bold">getConnectionUtil</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> connectionUtil<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setConnectionUtil</span><span style="color:#000;font-weight:bold">(</span>ConnectionUtil connectionUtil<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">connectionUtil</span> <span style="color:#000;font-weight:bold">=</span> connectionUtil<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> QueryRunner <span style="color:#900;font-weight:bold">getQueryRunner</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> queryRunner<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setQueryRunner</span><span style="color:#000;font-weight:bold">(</span>QueryRunner queryRunner<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">queryRunner</span> <span style="color:#000;font-weight:bold">=</span> queryRunner<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> Account <span style="color:#900;font-weight:bold">findById</span><span style="color:#000;font-weight:bold">(</span>Integer id<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            String sql <span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;select * from account where id=?&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            Account account <span style="color:#000;font-weight:bold">=</span> queryRunner<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">query</span><span style="color:#000;font-weight:bold">(</span>connectionUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getConnection</span><span style="color:#000;font-weight:bold">(),</span>sql<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">new</span> BeanHandler<span style="color:#000;font-weight:bold">&lt;</span>Account<span style="color:#000;font-weight:bold">&gt;(</span>Account<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">),</span> id<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> account<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>SQLException throwables<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            throwables<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">update</span><span style="color:#000;font-weight:bold">(</span>Account account<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            String sql <span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;update account set money=? where id=?&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            queryRunner<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">update</span><span style="color:#000;font-weight:bold">(</span>connectionUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getConnection</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">,</span>sql<span style="color:#000;font-weight:bold">,</span>account<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMoney</span><span style="color:#000;font-weight:bold">(),</span>account<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getId</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>SQLException throwables<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            throwables<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="3å®šä¹‰äº†äº‹åŠ¡ç®¡ç†çš„å·¥å…·ç±»">3ã€å®šä¹‰äº†äº‹åŠ¡ç®¡ç†çš„å·¥å…·ç±»</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">package</span> <span style="color:#555">com.offcn.utils</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.sql.Connection</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.sql.SQLException</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * å®šä¹‰å’Œäº‹åŠ¡ç›¸å…³çš„ä»£ç ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * äº‹åŠ¡çš„å¼€å¯ æäº¤  å›æ»š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> *
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">TransactionManager</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> ConnectionUtil connectionUtil<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//å¼€å¯äº‹åŠ¡ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">public</span>  <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">beginTransaction</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            Connection connection <span style="color:#000;font-weight:bold">=</span> connectionUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getConnection</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            connection<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setAutoCommit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>SQLException throwables<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            throwables<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//äº‹åŠ¡æäº¤
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">public</span>  <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">commit</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            Connection connection <span style="color:#000;font-weight:bold">=</span> connectionUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getConnection</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            connection<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">commit</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>SQLException throwables<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            throwables<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//äº‹åŠ¡æäº¤
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">public</span>  <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">rollback</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            Connection connection <span style="color:#000;font-weight:bold">=</span> connectionUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getConnection</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            connection<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">rollback</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>SQLException throwables<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            throwables<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//å®šä¹‰é‡Šæ”¾èµ„æºï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">release</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            Connection connection <span style="color:#000;font-weight:bold">=</span> connectionUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getConnection</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            connection<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">close</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>SQLException throwables<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            throwables<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="4æ”¹é€ accountserviceimpl">4ã€æ”¹é€ AccountServiceImpl</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">package</span> <span style="color:#555">com.offcn.service.impl</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.offcn.dao.AccountDao</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.offcn.pojo.Account</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.offcn.service.AccountService</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.offcn.utils.TransactionManager</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">AccountServiceImpl</span> <span style="color:#000;font-weight:bold">implements</span> AccountService <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> AccountDao accountDao<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> TransactionManager transactionManager<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">transfer</span><span style="color:#000;font-weight:bold">(</span>Integer sourceId<span style="color:#000;font-weight:bold">,</span> Integer targetId<span style="color:#000;font-weight:bold">,</span> Double money<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//å¼€å¯äº‹åŠ¡ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            transactionManager<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">beginTransaction</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//1: æŸ¥è¯¢æ¥æºè´¦æˆ·,æŸ¥è¯¢ç›®æ ‡è´¦æˆ·
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            Account sAcc <span style="color:#000;font-weight:bold">=</span> accountDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findById</span><span style="color:#000;font-weight:bold">(</span>sourceId<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            Account tAcc <span style="color:#000;font-weight:bold">=</span> accountDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findById</span><span style="color:#000;font-weight:bold">(</span>targetId<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//2: å†…å­˜å½“ä¸­ä¿®æ”¹é‡‘é¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            sAcc<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setMoney</span><span style="color:#000;font-weight:bold">(</span>sAcc<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMoney</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">-</span> money<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            tAcc<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setMoney</span><span style="color:#000;font-weight:bold">(</span>tAcc<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMoney</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">+</span> money<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//3: æ›´æ–°åˆ°æ•°æ®åº“å½“ä¸­ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            accountDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">update</span><span style="color:#000;font-weight:bold">(</span>sAcc<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#458;font-weight:bold">int</span> i<span style="color:#000;font-weight:bold">=</span> 1<span style="color:#000;font-weight:bold">/</span>0<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            accountDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">update</span><span style="color:#000;font-weight:bold">(</span>tAcc<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//äº‹åŠ¡çš„æäº¤ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            transactionManager<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">commit</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>Exception e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            transactionManager<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">rollback</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">finally</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//èµ„æºé‡Šæ”¾ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            transactionManager<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">release</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> AccountDao <span style="color:#900;font-weight:bold">getAccountDao</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> accountDao<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setAccountDao</span><span style="color:#000;font-weight:bold">(</span>AccountDao accountDao<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">accountDao</span> <span style="color:#000;font-weight:bold">=</span> accountDao<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="5é…ç½®æ–‡ä»¶æ”¹é€ ">5ã€é…ç½®æ–‡ä»¶æ”¹é€ </h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;beans</span> <span style="color:#008080">xmlns=</span><span style="color:#d14">&#34;http://www.springframework.org/schema/beans&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008080">xmlns:xsi=</span><span style="color:#d14">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008080">xsi:schemaLocation=</span><span style="color:#d14">&#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--dataSource--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;dataSource&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;com.alibaba.druid.pool.DruidDataSource&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;driverClassName&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;com.mysql.jdbc.Driver&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;url&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;jdbc:mysql://localhost:3306/test&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;username&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;root&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;password&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;root&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--æ„å»ºQueryRunner å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">       QueryRunner qr = new QueryRunner(DataSource dataSource);
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;bean</span> <span style="color:#008080">id =</span><span style="color:#d14">&#34;queryRunner&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;org.apache.commons.dbutils.QueryRunner&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&lt;!--ä¸ºäº†ä¿è¯åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä½¿ç”¨åŒä¸€ä¸ªè¿æ¥ï¼Œä¸èƒ½åœ¨æ„å»ºqrçš„æ—¶å€™ï¼Œæ‰§è¡ŒæŒ‡å®šDataSource--&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#998;font-style:italic">&lt;!--  &lt;constructor-arg name=&#34;ds&#34; ref=&#34;dataSource&#34;&gt;&lt;/constructor-arg&gt;--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--connectionUtil--&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;connectionUtil&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;com.offcn.utils.ConnectionUtil&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;dataSource&#34;</span> <span style="color:#008080">ref=</span><span style="color:#d14">&#34;dataSource&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--transactionManager--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;transactionManager&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;com.offcn.utils.TransactionManager&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;connectionUtil&#34;</span> <span style="color:#008080">ref=</span><span style="color:#d14">&#34;connectionUtil&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--accountDao--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;accountDao&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;com.offcn.dao.impl.AccountDaoImpl&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;queryRunner&#34;</span> <span style="color:#008080">ref=</span><span style="color:#d14">&#34;queryRunner&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;connectionUtil&#34;</span> <span style="color:#008080">ref=</span><span style="color:#d14">&#34;connectionUtil&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--accountService--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;accountService&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;com.offcn.service.impl.AccountServiceImpl&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;accountDao&#34;</span> <span style="color:#008080">ref=</span><span style="color:#d14">&#34;accountDao&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;transactionManager&#34;</span> <span style="color:#008080">ref=</span><span style="color:#d14">&#34;transactionManager&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/beans&gt;</span>
</span></span></code></pre></div><h3 id="6æµ‹è¯•è½¬è´¦-è€ƒè™‘äº‹åŠ¡">6ã€æµ‹è¯•è½¬è´¦-è€ƒè™‘äº‹åŠ¡</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">package</span> <span style="color:#555">com.offcn</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.offcn.service.AccountService</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.junit.Test</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.junit.runner.RunWith</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.beans.factory.annotation.Autowired</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.test.context.ContextConfiguration</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.test.context.junit4.SpringJUnit4ClassRunner</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RunWith</span><span style="color:#000;font-weight:bold">(</span>SpringJUnit4ClassRunner<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@ContextConfiguration</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;classpath:applicationContext.xml&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">TestTransfer</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> AccountService accountService<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">test1</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        accountService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">transfer</span><span style="color:#000;font-weight:bold">(</span>1001<span style="color:#000;font-weight:bold">,</span>1002<span style="color:#000;font-weight:bold">,</span>100D<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="å››-äº‹åŠ¡æ§åˆ¶-åŠ¨æ€ä»£ç†">å››ã€ äº‹åŠ¡æ§åˆ¶-åŠ¨æ€ä»£ç†</h2>
<h3 id="1åŠ¨æ€ä»£ç†æ¨¡å¼23">1ã€åŠ¨æ€ä»£ç†æ¨¡å¼ã€23ã€‘</h3>
<p>ä½   ã€ ä¸­ä»‹ ã€‘  ä¹°æˆ¿ ä¹°æˆ¿~</p>
<p>ä»£ç†çš„è§’è‰²ï¼š</p>
<p>â€‹    ä»£ç†ç±»ï¼š ä»£ç†å¯¹è±¡ã€ä¸­ä»‹ã€‘</p>
<p>â€‹    è¢«ä»£ç†ç±»ï¼š è¢«ä»£ç†å¯¹è±¡ã€ä¹°æˆ¿äººã€‘</p>
<p>â€‹    ç›®æ ‡æ–¹æ³•ï¼š æ ¸å¿ƒä¸šåŠ¡</p>
<p>ä½œç”¨ï¼š å¯¹æŸä¸ªç±»çš„æŸä¸ªæ–¹æ³•è¿›è¡ŒåŠŸèƒ½å¢å¼ºã€‚</p>
<p>åŠ¨æ€ä»£ç†åˆ†ç±»ï¼š</p>
<p>â€‹    ï¼ˆ1ï¼‰åŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†ï¼ˆJDKçš„åŠ¨æ€ä»£ç†ï¼‰ï¼š  è¢«ä»£ç†çš„ç±»å¿…é¡»å®ç°æ¥å£ã€‚ é‡è¦ã€JDKæä¾›çš„ã€‘</p>
<p>â€‹    ï¼ˆ2ï¼‰CGLIBä»£ç†ï¼š åœ°æ–¹æä¾›çš„ä»£ç†,éœ€è¦å¼•å…¥ç¬¬ä¸‰æ–¹åŒ…ã€‚</p>
<h3 id="2åŠ¨æ€ä»£ç†çš„å…¥é—¨æ¡ˆä¾‹">2ã€åŠ¨æ€ä»£ç†çš„å…¥é—¨æ¡ˆä¾‹</h3>
<p>éœ€æ±‚ï¼š  å…¬å¸part ï¼Œ person å®Œæˆæ™šä¼šï¼Œ sing dance</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">package</span> <span style="color:#555">com.offcn.proxy</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">interface</span> <span style="color:#458;font-weight:bold">CompanyParty</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">sing</span><span style="color:#000;font-weight:bold">(</span>Double money<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">dance</span><span style="color:#000;font-weight:bold">(</span>Double money<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>åˆ›å»ºæ¥å£çš„å®ç°ç±»å¯¹è±¡ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">package</span> <span style="color:#555">com.offcn.proxy</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Person</span> <span style="color:#000;font-weight:bold">implements</span> CompanyParty <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">sing</span><span style="color:#000;font-weight:bold">(</span>Double money<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;ç»™ä½ &#34;</span><span style="color:#000;font-weight:bold">+</span>money<span style="color:#000;font-weight:bold">+</span><span style="color:#d14">&#34;sing&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">dance</span><span style="color:#000;font-weight:bold">(</span>Double money<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;ç»™ä½ &#34;</span><span style="color:#000;font-weight:bold">+</span>money<span style="color:#000;font-weight:bold">+</span><span style="color:#d14">&#34;dance&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>ä½¿ç”¨JDKçš„åŠ¨æ€ä»£ç†ï¼Œè·å¾—personç±»çš„ä»£ç†ç±»å¯¹è±¡ï¼Œå®Œæˆä¸šåŠ¡æ–¹æ³•</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">package</span> <span style="color:#555">com.offcn</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.offcn.proxy.CompanyParty</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.offcn.proxy.Person</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.junit.Test</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.lang.reflect.InvocationHandler</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.lang.reflect.Method</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.lang.reflect.Proxy</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">TestProxy</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">test1</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//è¢«ä»£ç†ï¼šperson
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        Person person <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Person<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//person.dance(1001D);
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//person.sing(1008D) ;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">         *  JDKçš„åŠ¨æ€ä»£ç†
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">         *  Proxy: åå°„åŒ…å½“ä¸­æä¾›çš„ç±»ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">         *  newProxyInstance(p1,p2,p3)ï¼š è·å¾—ä»£ç†ç±»çš„æ–¹æ³•ï¼šè¿”å›å€¼æ˜¯Objectç±»å‹ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">         *     p1: ClassLoader ç±»çš„åŠ è½½å™¨ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">         *        ç›®æ ‡å¯¹è±¡(è¢«ä»£ç†å¯¹è±¡)çš„ç±»åŠ è½½å™¨ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">         *
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">         *     p2: è·å¾—äº†æ¥å£å½“ä¸­æ‰€æœ‰çš„æ–¹æ³•ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">         *       ç›®çš„ï¼š ä»£ç†ç±»å’Œè¢«ä»£ç†ç±»å¯¹è±¡æœ‰ç€ç›¸åŒçš„è¡Œä¸ºï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">         *
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">         *     p3: InvocationHandler å®šä¹‰ä»£ç†å¯¹è±¡å’Œè¢«ä»£ç†å¯¹è±¡ä¹‹é—´çš„ä»£ç†ç­–ç•¥ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">         *
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">         *
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">         */</span>
</span></span><span style="display:flex;"><span>        CompanyParty proxy <span style="color:#000;font-weight:bold">=(</span>CompanyParty<span style="color:#000;font-weight:bold">)</span> Proxy<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">newProxyInstance</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>                person<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getClass</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">getClassLoader</span><span style="color:#000;font-weight:bold">(),</span>
</span></span><span style="display:flex;"><span>                person<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getClass</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">getInterfaces</span><span style="color:#000;font-weight:bold">(),</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">new</span> InvocationHandler<span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">                     *
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">                     * @param proxy  ä¸€èˆ¬æƒ…å†µä¸é€‚ç”¨ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">                     * @param method  å°è£…äº†æ‰§è¡Œçš„ç›®æ ‡æ–¹æ³•ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">                     * @param args    å°è£…äº†æ‰§è¡Œç›®æ ‡æ–¹æ³•çš„å‚æ•°ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">                     * @return object  æ‰§è¡Œäº†ç›®æ ‡æ–¹æ³•ï¼Œç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">                     * @throws Throwable æ‰§è¡Œç›®æ ‡æ–¹æ³•ï¼Œé‡åˆ°å¼‚å¸¸ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">                     *
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">                     */</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">public</span> Object <span style="color:#900;font-weight:bold">invoke</span><span style="color:#000;font-weight:bold">(</span>Object proxy<span style="color:#000;font-weight:bold">,</span> Method method<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                        String name <span style="color:#000;font-weight:bold">=</span> method<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getName</span><span style="color:#000;font-weight:bold">();</span><span style="color:#998;font-style:italic">//è·å¾—æ‰§è¡Œæ–¹æ³•çš„åç§°ã€‚ï¼›
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                        Double money <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>Double<span style="color:#000;font-weight:bold">)</span> args<span style="color:#000;font-weight:bold">[</span>0<span style="color:#000;font-weight:bold">];</span><span style="color:#998;font-style:italic">//è·å¾—ç›®æ ‡æ–¹æ³•çš„å‚æ•°ä¿¡æ¯ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                        Object obj<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;sing&#34;</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">equals</span><span style="color:#000;font-weight:bold">(</span>name<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">&amp;&amp;</span> money <span style="color:#000;font-weight:bold">&gt;=</span>1000<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>                            <span style="color:#998;font-style:italic">//çœŸæ­£æ‰§è¡Œç›®æ ‡æ–¹æ³•ï¼š  p1:ç›®æ ‡å¯¹è±¡ p2: ç›®æ ‡æ–¹æ³•éœ€è¦çš„å‚æ•°ä¿¡æ¯ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                             obj <span style="color:#000;font-weight:bold">=</span> method<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">invoke</span><span style="color:#000;font-weight:bold">(</span>person<span style="color:#000;font-weight:bold">,</span> args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;dance&#34;</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">equals</span><span style="color:#000;font-weight:bold">(</span>name<span style="color:#000;font-weight:bold">)&amp;&amp;</span> money<span style="color:#000;font-weight:bold">&gt;=</span>2000<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>                             obj <span style="color:#000;font-weight:bold">=</span> method<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">invoke</span><span style="color:#000;font-weight:bold">(</span>person<span style="color:#000;font-weight:bold">,</span> args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                        <span style="color:#000;font-weight:bold">return</span> obj<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        proxy<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sing</span><span style="color:#000;font-weight:bold">(</span>1005D<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        proxy<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">dance</span><span style="color:#000;font-weight:bold">(</span>2005D<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="3-ä½¿ç”¨åŠ¨æ€ä»£ç†æ§åˆ¶äº‹åŠ¡">3 ä½¿ç”¨åŠ¨æ€ä»£ç†æ§åˆ¶äº‹åŠ¡</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>åˆ›å»ºäº†å·¥å‚ç±»<span style="color:#a61717;background-color:#e3d2d2">ï¼Œ</span> ç”Ÿæˆä»£ç†ç±»å¯¹è±¡<span style="color:#a61717;background-color:#e3d2d2">ï¼š</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">package</span> <span style="color:#555">com.offcn.factory</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.offcn.service.AccountService</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.offcn.utils.TransactionManager</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.lang.reflect.InvocationHandler</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.lang.reflect.Method</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.lang.reflect.Proxy</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * å·¥å‚å¯¹è±¡ç”¨æ¥ç”Ÿæˆä»£ç†ç±»å¯¹è±¡ï¼›
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">BeanFactory</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//ç›®æ ‡å¯¹è±¡ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">public</span> AccountService accountService<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> TransactionManager transactionManager<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> AccountService <span style="color:#900;font-weight:bold">getProxy</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>       <span style="color:#000;font-weight:bold">return</span>  <span style="color:#000;font-weight:bold">(</span>AccountService<span style="color:#000;font-weight:bold">)</span>Proxy<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">newProxyInstance</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>               accountService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getClass</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">getClassLoader</span><span style="color:#000;font-weight:bold">(),</span>
</span></span><span style="display:flex;"><span>               accountService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getClass</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">getInterfaces</span><span style="color:#000;font-weight:bold">(),</span>
</span></span><span style="display:flex;"><span>               <span style="color:#000;font-weight:bold">new</span> InvocationHandler<span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#998;font-style:italic">//è¾¾æˆå…·ä½“çš„ä»£ç†ç­–ç•¥
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                   <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>                   <span style="color:#000;font-weight:bold">public</span> Object <span style="color:#900;font-weight:bold">invoke</span><span style="color:#000;font-weight:bold">(</span>Object proxy<span style="color:#000;font-weight:bold">,</span> Method method<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                       Object invoke<span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                       <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                           <span style="color:#998;font-style:italic">//å¼€å¯äº‹åŠ¡ï¼š 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                           transactionManager<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">beginTransaction</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>                           invoke <span style="color:#000;font-weight:bold">=</span> method<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">invoke</span><span style="color:#000;font-weight:bold">(</span>accountService<span style="color:#000;font-weight:bold">,</span> args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>                           <span style="color:#998;font-style:italic">//æäº¤äº‹åŠ¡ï¼š 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                           transactionManager<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">commit</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>                           <span style="color:#000;font-weight:bold">return</span> invoke<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                       <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>Exception e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                           e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>                           <span style="color:#998;font-style:italic">//æ‰§è¡Œä¸šåŠ¡æ–¹æ³•ï¼Œ é‡åˆ°äº†å¼‚å¸¸ä¿¡æ¯ï¼š 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                           transactionManager<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">rollback</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>                       <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">finally</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                           transactionManager<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">release</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>                       <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>                       <span style="color:#000;font-weight:bold">return</span> invoke<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                   <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>               <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>       <span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> AccountService <span style="color:#900;font-weight:bold">getAccountService</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> accountService<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setAccountService</span><span style="color:#000;font-weight:bold">(</span>AccountService accountService<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">accountService</span> <span style="color:#000;font-weight:bold">=</span> accountService<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> TransactionManager <span style="color:#900;font-weight:bold">getTransactionManager</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> transactionManager<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setTransactionManager</span><span style="color:#000;font-weight:bold">(</span>TransactionManager transactionManager<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">transactionManager</span> <span style="color:#000;font-weight:bold">=</span> transactionManager<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>ä¸šåŠ¡å±‚æ”¹é€ ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">transfer</span><span style="color:#000;font-weight:bold">(</span>Integer sourceId<span style="color:#000;font-weight:bold">,</span> Integer targetId<span style="color:#000;font-weight:bold">,</span> Double money<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//1: æŸ¥è¯¢æ¥æºè´¦æˆ·,æŸ¥è¯¢ç›®æ ‡è´¦æˆ·
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            Account sAcc <span style="color:#000;font-weight:bold">=</span> accountDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findById</span><span style="color:#000;font-weight:bold">(</span>sourceId<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            Account tAcc <span style="color:#000;font-weight:bold">=</span> accountDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findById</span><span style="color:#000;font-weight:bold">(</span>targetId<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//2: å†…å­˜å½“ä¸­ä¿®æ”¹é‡‘é¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            sAcc<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setMoney</span><span style="color:#000;font-weight:bold">(</span>sAcc<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMoney</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">-</span> money<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            tAcc<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setMoney</span><span style="color:#000;font-weight:bold">(</span>tAcc<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMoney</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">+</span> money<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//3: æ›´æ–°åˆ°æ•°æ®åº“å½“ä¸­ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            accountDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">update</span><span style="color:#000;font-weight:bold">(</span>sAcc<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#458;font-weight:bold">int</span> i<span style="color:#000;font-weight:bold">=</span> 1<span style="color:#000;font-weight:bold">/</span>0<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            accountDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">update</span><span style="color:#000;font-weight:bold">(</span>tAcc<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>BeanFactoryé…ç½®åœ¨applicationContext.xmlå½“ä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">&lt;!--BeanFactory: 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">       é…ç½®äº†ä¸€ä¸ªå®ä¾‹å·¥å‚ï¼š factory-bean æŒ‡å®šçš„å·¥å‚çš„å®ä¾‹å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">                        factory-methodï¼šå·¥å‚æ–¹æ³•ï¼Œæ–¹æ³•çš„è¿”å›å€¼å­˜åœ¨IOCå®¹å™¨å½“ä¸­
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;factory&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;com.offcn.factory.BeanFactory&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;transactionManager&#34;</span> <span style="color:#008080">ref=</span><span style="color:#d14">&#34;transactionManager&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;accountService&#34;</span> <span style="color:#008080">ref=</span><span style="color:#d14">&#34;accountService&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;bean</span> <span style="color:#008080">factory-bean=</span><span style="color:#d14">&#34;factory&#34;</span> <span style="color:#008080">factory-method=</span><span style="color:#d14">&#34;getProxy&#34;</span><span style="color:#000080">&gt;&lt;/bean&gt;</span>
</span></span></code></pre></div><p>æµ‹è¯•ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">package</span> <span style="color:#555">com.offcn</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.offcn.service.AccountService</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.junit.Test</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.junit.runner.RunWith</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.beans.factory.annotation.Autowired</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.beans.factory.annotation.Qualifier</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.test.context.ContextConfiguration</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.test.context.junit4.SpringJUnit4ClassRunner</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RunWith</span><span style="color:#000;font-weight:bold">(</span>SpringJUnit4ClassRunner<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@ContextConfiguration</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;classpath:applicationContext.xml&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">TestTransfer</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Qualifier</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;proxy&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#998;font-style:italic">//è·å¾—å¯¹è±¡æ˜¯ä»£ç†å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">private</span> AccountService proxy<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">test1</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//accountService.transfer(1001,1002,100D);
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        proxy<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">transfer</span><span style="color:#000;font-weight:bold">(</span>1001<span style="color:#000;font-weight:bold">,</span>1002<span style="color:#000;font-weight:bold">,</span>100D<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h1 id="ä¸€-springaopæœºåˆ¶è¯¦è§£">ä¸€ã€ SpringAOPæœºåˆ¶è¯¦è§£</h1>
<h2 id="ä¸€aop-æ¦‚è¿°">ï¼ˆä¸€ï¼‰AOP æ¦‚è¿°</h2>
<h3 id="1-ä»€ä¹ˆæ˜¯-aop">1 ä»€ä¹ˆæ˜¯ AOP</h3>
<pre tabindex="0"><code>è¯æœ¯ï¼š
AOP ä¸º Aspect Oriented Programming çš„ç¼©å†™ï¼Œæ„æ€ä¸ºé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œæ˜¯é€šè¿‡é¢„ç¼–è¯‘æ–¹å¼å’Œè¿è¡ŒæœŸåŠ¨æ€ä»£ç†å®ç°ç¨‹åºåŠŸèƒ½çš„ç»Ÿä¸€ç»´æŠ¤çš„ä¸€ç§æŠ€æœ¯ã€‚

aop:é¢å‘åˆ‡é¢ç¼–ç¨‹
åº•å±‚ï¼š åŠ¨æ€ä»£ç† 
      åå°„ï¼š javaè¯­è¨€ï¼Œ æ˜¯ä¸€ä¸ªé™æ€è¯­è¨€ï¼Œ ä½†æ˜¯å¯ä»¥é€šè¿‡åå°„æŠ€æœ¯ï¼Œ ä½“ç°å‡ºæ¥åŠ¨æ€æ€§ã€‚ 
</code></pre><h3 id="2-aopç¼–ç¨‹æ€æƒ³">2 AOPç¼–ç¨‹æ€æƒ³</h3>
<pre tabindex="0"><code>è¯æœ¯ï¼š
AOP é¢å‘åˆ‡é¢ç¼–ç¨‹æ˜¯ä¸€ç§ç¼–ç¨‹æ€æƒ³ï¼Œæ˜¯ OOPï¼ˆé¢å‘å¯¹è±¡ï¼‰ çš„å»¶ç»­ï¼Œæ˜¯è½¯ä»¶å¼€å‘ä¸­çš„ä¸€ä¸ªçƒ­ç‚¹ï¼Œä¹Ÿæ˜¯Springæ¡†æ¶ä¸­çš„ä¸€ä¸ªé‡è¦å†…å®¹ï¼Œæ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€ç§è¡ç”ŸèŒƒå‹ã€‚åˆ©ç”¨AOPå¯ä»¥å¯¹ä¸šåŠ¡é€»è¾‘çš„å„ä¸ªéƒ¨åˆ†è¿›è¡Œéš”ç¦»ï¼Œä»è€Œä½¿å¾—ä¸šåŠ¡é€»è¾‘å„éƒ¨åˆ†ä¹‹é—´çš„è€¦åˆåº¦é™ä½ï¼Œæé«˜ç¨‹åºçš„å¯é‡ç”¨æ€§ï¼ŒåŒæ—¶æé«˜äº†å¼€å‘çš„æ•ˆç‡ã€‚

åº”ç”¨åœºæ™¯ï¼š aop äº‹åŠ¡æ§åˆ¶ï¼Œ æƒé™æ ¡éªŒï¼Œ æ—¥å¿—è®°å½•ï¼Œ æ€§èƒ½ç»Ÿè®¡
</code></pre><h3 id="3-springä¸­çš„å¸¸ç”¨æœ¯è¯­">3 Springä¸­çš„å¸¸ç”¨æœ¯è¯­</h3>
<pre tabindex="0"><code>è¯æœ¯ï¼š
Joinpointï¼ˆè¿æ¥ç‚¹ï¼‰ï¼šæ‰€è°“è¿æ¥ç‚¹æ˜¯æŒ‡é‚£äº›è¢«æ‹¦æˆªåˆ°çš„ç‚¹ã€‚åœ¨springä¸­,è¿™äº›ç‚¹æŒ‡çš„æ˜¯æ–¹æ³•ï¼Œå› ä¸ºspringåªæ”¯æŒæ–¹æ³•ç±»å‹çš„è¿æ¥ç‚¹ã€‚ 
æ‰€æœ‰æœ‰æœºä¼šè¢«å¢å¼ºçš„æ–¹æ³•å°±å°±ä¼¼ä¹é“¾æ¥ç‚¹ã€‚

Pointcutï¼ˆåˆ‡ç‚¹ï¼‰ï¼šçœŸæ­£è¢«å¢å¼ºçš„æ–¹æ³•ï¼Œ å°±æ˜¯åˆ‡ç‚¹ã€‚  æ¡ˆä¾‹ï¼š transfer æ–¹æ³•ã€‚

Adviceï¼ˆé€šçŸ¥/ å¢å¼ºï¼‰ï¼šæ‰€è°“é€šçŸ¥æ˜¯æŒ‡æ‹¦æˆªåˆ° Joinpoint ä¹‹åæ‰€è¦åšçš„äº‹æƒ…å°±æ˜¯é€šçŸ¥ã€‚
åœ¨transferæ–¹æ³•ä¸Šï¼Œ è¿›è¡Œäº†äº‹åŠ¡ä»£ç çš„å¢å¼ºã€‚ äº‹åŠ¡ä»£ç å°±æ˜¯é€šçŸ¥~ 
é€šçŸ¥çš„ç±»å‹ï¼šå‰ç½®é€šçŸ¥,æ­£å¸¸è¿”å›é€šçŸ¥,å¼‚å¸¸è¿”å›é€šçŸ¥,æœ€ç»ˆé€šçŸ¥,ç¯ç»•é€šçŸ¥ã€‚ã€é¢è¯•é—®é¢˜ã€‘

Targetï¼ˆç›®æ ‡å¯¹è±¡ï¼‰ï¼šä»£ç†çš„ç›®æ ‡å¯¹è±¡ [è¢«ä»£ç†å¯¹è±¡]
Proxy ï¼ˆä»£ç†ï¼‰ï¼šä¸€ä¸ªç±»è¢« AOP ç»‡å…¥å¢å¼ºåï¼Œå°±äº§ç”Ÿä¸€ä¸ªç»“æœä»£ç†ç±»ï¼Œä»£ç†ç±»äº§ç”Ÿä»£ç†å¯¹è±¡
Weavingï¼ˆç»‡å…¥ï¼‰ï¼šæ˜¯æŒ‡æŠŠå¢å¼ºåº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡æ¥åˆ›å»ºæ–°çš„ä»£ç†å¯¹è±¡çš„è¿‡ç¨‹
Aspectï¼ˆåˆ‡é¢ï¼‰ï¼šæ˜¯åˆ‡å…¥ç‚¹å’Œé€šçŸ¥ï¼ˆå¼•ä»‹ï¼‰çš„ç»“åˆ  
              åˆ‡é¢æè¿°äº†ï¼š å…·ä½“çš„é€šçŸ¥åº”ç”¨åœ¨å…·ä½“çš„å“ªä¸ªåˆ‡ç‚¹ä¸Šã€‚
</code></pre><h3 id="4-aop-çš„ä½œç”¨åŠä¼˜åŠ¿">4 AOP çš„ä½œç”¨åŠä¼˜åŠ¿</h3>
<pre tabindex="0"><code>è¯æœ¯ï¼š
ä½œç”¨ï¼šåœ¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œåœ¨ä¸ä¿®æ”¹æºç çš„æƒ…å†µä¸‹å¯¹æ–¹æ³•è¿›è¡ŒåŠŸèƒ½å¢å¼º
ä¼˜åŠ¿ï¼šå‡å°‘é‡å¤ä»£ç ï¼Œæé«˜å¼€å‘æ•ˆç‡ï¼Œå¹¶ä¸”ä¾¿äºç»´æŠ¤
</code></pre><h2 id="äºŒspringåŸºäºxmlçš„aopé…ç½®">ï¼ˆäºŒï¼‰SpringåŸºäºXMLçš„AOPé…ç½®</h2>
<pre tabindex="0"><code>è®²è§£æ€è·¯ï¼š 
 1ã€æ­å»ºmavenå·¥ç¨‹ï¼Œæ²¿ç”¨ä¸Šä¸€ç« èŠ‚è½¬è´¦çš„ä¸šåŠ¡åœºæ™¯
 2ã€å‡†å¤‡å¥½é€šçŸ¥ç±»TransactionManager
 3ã€è®²è§£åŸºäºXMLå½¢å¼çš„AOPé…ç½®ï¼Œè¯¦ç»†ä»‹ç»æ¯ä¸ªæ ‡ç­¾ï¼Œæ¯ä¸ªæ ‡ç­¾å½“ä¸­å±æ€§çš„ä½œç”¨
 4ã€æµ‹è¯•ä½¿ç”¨AOPè¿›è¡Œäº‹åŠ¡é…ç½®
 5ã€å¸¸ç”¨é€šçŸ¥ç±»å‹çš„æ€»ç»“
 6ã€è¯¦è§£åˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„è¯­æ³•ï¼Œå¸¸ç”¨æ¡ˆä¾‹çš„åˆ—ä¸¾
</code></pre><h3 id="1-ç¯å¢ƒæ­å»º">1 ç¯å¢ƒæ­å»º</h3>
<h4 id="11-æ„å»ºmavenå·¥ç¨‹æ·»åŠ ä¾èµ–">1.1 æ„å»ºmavenå·¥ç¨‹æ·»åŠ ä¾èµ–</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;properties&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;spring.version&gt;</span>5.2.5.RELEASE<span style="color:#000080">&lt;/spring.version&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/properties&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;dependencies&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>org.springframework<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>spring-context<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>${spring.version}<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>org.aspectj<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>aspectjweaver<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>1.8.7<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/dependencies&gt;</span>
</span></span></code></pre></div><h4 id="12-æ²¿ç”¨è½¬è´¦ä¸šåŠ¡çš„ä»£ç ">1.2 æ²¿ç”¨è½¬è´¦ä¸šåŠ¡çš„ä»£ç </h4>
<p>æ­å»ºäº†è½¬è´¦ç¯å¢ƒ~</p>
<h4 id="13-åˆ›å»º-spring-çš„é…ç½®æ–‡ä»¶å¹¶å¯¼å…¥çº¦æŸ">1.3 åˆ›å»º Spring çš„é…ç½®æ–‡ä»¶å¹¶å¯¼å…¥çº¦æŸ</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;beans</span> <span style="color:#008080">xmlns=</span><span style="color:#d14">&#34;http://www.springframework.org/schema/beans&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008080">xmlns:xsi=</span><span style="color:#d14">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008080">xmlns:aop=</span><span style="color:#d14">&#34;http://www.springframework.org/schema/aop&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008080">xsi:schemaLocation=</span><span style="color:#d14">&#34;http://www.springframework.org/schema/beans
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/beans/spring-beans.xsd
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/aop
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/aop/spring-aop.xsd&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/beans&gt;</span>
</span></span></code></pre></div><h4 id="14-é…ç½®-spring-çš„-ioc">1.4 é…ç½® Spring çš„ IOC</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- é…ç½®æ•°æ®æº --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;dataSource&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;com.mchange.v2.c3p0.ComboPooledDataSource&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--è¿æ¥æ•°æ®åº“çš„å¿…å¤‡ä¿¡æ¯--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;driverClass&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;com.mysql.jdbc.Driver&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;jdbcUrl&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;jdbc:mysql://localhost:3306/test&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;user&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;root&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;password&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;root&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- é…ç½®Connectionçš„å·¥å…·ç±» ConnectionUtils --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;connectionUtils&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;com.offcn.utils.ConnectionUtils&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!-- æ³¨å…¥æ•°æ®æº--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;dataSource&#34;</span> <span style="color:#008080">ref=</span><span style="color:#d14">&#34;dataSource&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--é…ç½®queryRunner--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;queryRunner&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;org.apache.commons.dbutils.QueryRunner&#34;</span><span style="color:#000080">&gt;&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--é…ç½®accountDao--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;accountDao&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;com.offcn.dao.impl.AccountDaoImpl&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;queryRunner&#34;</span> <span style="color:#008080">ref=</span><span style="color:#d14">&#34;queryRunner&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;connectionUtils&#34;</span> <span style="color:#008080">ref=</span><span style="color:#d14">&#34;connectionUtils&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--é…ç½®accountService--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;accountService&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;com.offcn.service.impl.AccountServiceImpl&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;accountDao&#34;</span> <span style="color:#008080">ref=</span><span style="color:#d14">&#34;accountDao&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/bean&gt;</span>
</span></span></code></pre></div><h4 id="15-æŠ½å–å…¬å…±ä»£ç åˆ¶ä½œæˆé€šçŸ¥å¢å¼ºä»£ç ">1.5 æŠ½å–å…¬å…±ä»£ç åˆ¶ä½œæˆé€šçŸ¥(å¢å¼ºä»£ç )</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * å’Œäº‹åŠ¡ç®¡ç†ç›¸å…³çš„å·¥å…·ç±»ï¼Œå®ƒåŒ…å«äº†ï¼Œå¼€å¯äº‹åŠ¡ï¼Œæäº¤äº‹åŠ¡ï¼Œå›æ»šäº‹åŠ¡å’Œé‡Šæ”¾è¿æ¥
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">TransactionManager</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> ConnectionUtils connectionUtils<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setConnectionUtils</span><span style="color:#000;font-weight:bold">(</span>ConnectionUtils connectionUtils<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">connectionUtils</span> <span style="color:#000;font-weight:bold">=</span> connectionUtils<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * å¼€å¯äº‹åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span>  <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">beginTransaction</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            connectionUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getThreadConnection</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">setAutoCommit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>Exception e<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * æäº¤äº‹åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span>  <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">commit</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            connectionUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getThreadConnection</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">commit</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>Exception e<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * å›æ»šäº‹åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span>  <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">rollback</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            connectionUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getThreadConnection</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">rollback</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>Exception e<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * é‡Šæ”¾è¿æ¥
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span>  <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">release</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            connectionUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">removeConnection</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            connectionUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getThreadConnection</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">close</span><span style="color:#000;font-weight:bold">();</span><span style="color:#998;font-style:italic">//è¿˜å›è¿æ¥æ± ä¸­
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>Exception e<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="2-aop-é…ç½®æ­¥éª¤">2 AOP é…ç½®æ­¥éª¤</h3>
<h4 id="21-æŠŠé€šçŸ¥ç±»ç”¨-bean-æ ‡ç­¾é…ç½®èµ·æ¥">2.1 æŠŠé€šçŸ¥ç±»ç”¨ bean æ ‡ç­¾é…ç½®èµ·æ¥</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--é…ç½®é€šçŸ¥ï¼štxManager--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;txManager&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;com.offcn.utils.TransactionManager&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;connectionUtils&#34;</span> <span style="color:#008080">ref=</span><span style="color:#d14">&#34;connectionUtils&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/bean&gt;</span>
</span></span></code></pre></div><h4 id="22-ä½¿ç”¨-aopconfig-å£°æ˜-aop-é…ç½®">2.2 ä½¿ç”¨ aop:config å£°æ˜ AOP é…ç½®</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>aop:config: 
</span></span><span style="display:flex;"><span>   ä½œç”¨ï¼š å¼€å§‹å£°æ˜aopé…ç½®
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;aop:config&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#998;font-style:italic">&lt;!-- é…ç½®çš„ä»£ç éƒ½å†™åœ¨æ­¤å¤„ --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/aop:config&gt;</span>
</span></span></code></pre></div><h4 id="23-ä½¿ç”¨-aopaspect-é…ç½®åˆ‡é¢">2.3 ä½¿ç”¨ aop:aspect é…ç½®åˆ‡é¢</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>aopï¼šaspect
</span></span><span style="display:flex;"><span>   ä½œç”¨ï¼š ç”¨äºé…ç½®åˆ‡é¢
</span></span><span style="display:flex;"><span>   å±æ€§ï¼š 
</span></span><span style="display:flex;"><span>         id ï¼šç»™åˆ‡é¢æä¾›ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ã€‚
</span></span><span style="display:flex;"><span>         refï¼šå¼•ç”¨é…ç½®å¥½çš„é€šçŸ¥ç±» bean çš„ idã€‚
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;aop:aspect</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;tdAdvice&#34;</span> <span style="color:#008080">ref=</span><span style="color:#d14">&#34;txManager&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#998;font-style:italic">&lt;!--é…ç½®é€šçŸ¥çš„ç±»å‹è¦å†™åœ¨æ­¤å¤„--&gt;</span>  
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/aop:aspect&gt;</span>
</span></span></code></pre></div><h4 id="24-ä½¿ç”¨-aoppointcut-é…ç½®åˆ‡å…¥ç‚¹è¡¨è¾¾å¼">2.4 ä½¿ç”¨ aop:pointcut é…ç½®åˆ‡å…¥ç‚¹è¡¨è¾¾å¼</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>aop:pointcut
</span></span><span style="display:flex;"><span>   ä½œç”¨ï¼š ç”¨äºé…ç½®åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ã€‚å°±æ˜¯æŒ‡å®šå¯¹å“ªäº›ç±»çš„å“ªäº›æ–¹æ³•è¿›è¡Œå¢å¼ºã€‚
</span></span><span style="display:flex;"><span>   å±æ€§ï¼š expressionï¼šç”¨äºå®šä¹‰åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ã€‚
</span></span><span style="display:flex;"><span>         idï¼šç”¨äºç»™åˆ‡å…¥ç‚¹è¡¨è¾¾å¼æä¾›ä¸€ä¸ªå”¯ä¸€æ ‡è¯†
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;aop:pointcut</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;point1&#34;</span>
</span></span><span style="display:flex;"><span>               <span style="color:#008080">expression=</span><span style="color:#d14">&#34;execution( public void  com.offcn.service.impl.AccountServiceImpl.transfer(java.lang.String,java.lang.String,java.lang.Double))&#34;</span><span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span>        
</span></span></code></pre></div><h4 id="25--ä½¿ç”¨-aopxxx-é…ç½®å¯¹åº”çš„é€šçŸ¥ç±»å‹">2.5  ä½¿ç”¨ aop:xxx é…ç½®å¯¹åº”çš„é€šçŸ¥ç±»å‹</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>aopï¼šbefore
</span></span><span style="display:flex;"><span>    ä½œç”¨ï¼šç”¨äºé…ç½®å‰ç½®é€šçŸ¥ã€‚æŒ‡å®šå¢å¼ºçš„æ–¹æ³•åœ¨åˆ‡å…¥ç‚¹æ–¹æ³•ä¹‹å‰æ‰§è¡Œ
</span></span><span style="display:flex;"><span>    å±æ€§ï¼š
</span></span><span style="display:flex;"><span>         method:ç”¨äºæŒ‡å®šé€šçŸ¥ç±»ä¸­çš„å¢å¼ºæ–¹æ³•åç§°
</span></span><span style="display:flex;"><span>		 ponitcut-refï¼šç”¨äºæŒ‡å®šåˆ‡å…¥ç‚¹çš„è¡¨è¾¾å¼çš„å¼•ç”¨
</span></span><span style="display:flex;"><span>		 poinitcutï¼šç”¨äºæŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼
</span></span><span style="display:flex;"><span>    æ‰§è¡Œæ—¶é—´ç‚¹ï¼š
</span></span><span style="display:flex;"><span>         åˆ‡å…¥ç‚¹æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œ   
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;aop:before</span> <span style="color:#008080">method=</span><span style="color:#d14">&#34;beginTransaction&#34;</span> <span style="color:#008080">pointcut-ref=</span><span style="color:#d14">&#34;point1&#34;</span><span style="color:#000080">&gt;&lt;/aop:before&gt;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>aop:after-returning
</span></span><span style="display:flex;"><span>	ä½œç”¨ï¼š 
</span></span><span style="display:flex;"><span>    	ç”¨äºé…ç½®åç½®é€šçŸ¥
</span></span><span style="display:flex;"><span>	å±æ€§ï¼š
</span></span><span style="display:flex;"><span>   		methodï¼šæŒ‡å®šé€šçŸ¥ä¸­æ–¹æ³•çš„åç§°ã€‚
</span></span><span style="display:flex;"><span>  		pointctï¼šå®šä¹‰åˆ‡å…¥ç‚¹è¡¨è¾¾å¼
</span></span><span style="display:flex;"><span>   		pointcut-refï¼šæŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„å¼•ç”¨
</span></span><span style="display:flex;"><span>   	æ‰§è¡Œæ—¶é—´ç‚¹ï¼š
</span></span><span style="display:flex;"><span>   	    åˆ‡å…¥ç‚¹æ–¹æ³•æ­£å¸¸æ‰§è¡Œä¹‹åã€‚å®ƒå’Œå¼‚å¸¸é€šçŸ¥åªèƒ½æœ‰ä¸€ä¸ªæ‰§è¡Œ
</span></span><span style="display:flex;"><span>   	    
</span></span><span style="display:flex;"><span> <span style="color:#000080">&lt;aop:after-returning</span> <span style="color:#008080">method=</span><span style="color:#d14">&#34;commit&#34;</span> <span style="color:#008080">pointcut-ref=</span><span style="color:#d14">&#34;point1&#34;</span><span style="color:#000080">/&gt;</span> 	    
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>aop:after-throwing
</span></span><span style="display:flex;"><span>	ä½œç”¨ï¼š
</span></span><span style="display:flex;"><span>		ç”¨äºé…ç½®å¼‚å¸¸é€šçŸ¥
</span></span><span style="display:flex;"><span>	å±æ€§ï¼š
</span></span><span style="display:flex;"><span>		methodï¼šæŒ‡å®šé€šçŸ¥ä¸­æ–¹æ³•çš„åç§°ã€‚
</span></span><span style="display:flex;"><span>		pointctï¼šå®šä¹‰åˆ‡å…¥ç‚¹è¡¨è¾¾å¼
</span></span><span style="display:flex;"><span>		pointcut-refï¼šæŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„å¼•ç”¨
</span></span><span style="display:flex;"><span>	æ‰§è¡Œæ—¶é—´ç‚¹ï¼š
</span></span><span style="display:flex;"><span>		åˆ‡å…¥ç‚¹æ–¹æ³•æ‰§è¡Œäº§ç”Ÿå¼‚å¸¸åæ‰§è¡Œã€‚å®ƒå’Œåç½®é€šçŸ¥åªèƒ½æ‰§è¡Œä¸€ä¸ª
</span></span><span style="display:flex;"><span> <span style="color:#000080">&lt;aop:after-throwing</span> <span style="color:#008080">method=</span><span style="color:#d14">&#34;rollback&#34;</span> <span style="color:#008080">pointcut-ref=</span><span style="color:#d14">&#34;point1&#34;</span><span style="color:#000080">/&gt;</span>	
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>aop:after
</span></span><span style="display:flex;"><span>	ä½œç”¨ï¼š
</span></span><span style="display:flex;"><span>		ç”¨äºé…ç½®æœ€ç»ˆé€šçŸ¥
</span></span><span style="display:flex;"><span>	å±æ€§ï¼š
</span></span><span style="display:flex;"><span>        methodï¼šæŒ‡å®šé€šçŸ¥ä¸­æ–¹æ³•çš„åç§°ã€‚
</span></span><span style="display:flex;"><span>        pointctï¼šå®šä¹‰åˆ‡å…¥ç‚¹è¡¨è¾¾å¼
</span></span><span style="display:flex;"><span>        pointcut-refï¼šæŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„å¼•ç”¨
</span></span><span style="display:flex;"><span>	æ‰§è¡Œæ—¶é—´ç‚¹ï¼š
</span></span><span style="display:flex;"><span>		æ— è®ºåˆ‡å…¥ç‚¹æ–¹æ³•æ‰§è¡Œæ—¶æ˜¯å¦æœ‰å¼‚å¸¸ï¼Œå®ƒéƒ½ä¼šåœ¨å…¶åé¢æ‰§è¡Œã€‚
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span> <span style="color:#000080">&lt;aop:after</span> <span style="color:#008080">method=</span><span style="color:#d14">&#34;release&#34;</span> <span style="color:#008080">pointcut-ref=</span><span style="color:#d14">&#34;point1&#34;</span><span style="color:#000080">/&gt;</span>
</span></span></code></pre></div><h3 id="3-åˆ‡å…¥ç‚¹è¡¨è¾¾å¼è¯´æ˜">3 åˆ‡å…¥ç‚¹è¡¨è¾¾å¼è¯´æ˜</h3>
<h4 id="31-åˆ‡ç‚¹è¡¨è¾¾å¼çš„è¯­æ³•">3.1 åˆ‡ç‚¹è¡¨è¾¾å¼çš„è¯­æ³•</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>execution<span style="color:#000;font-weight:bold">([</span>ä¿®é¥°ç¬¦<span style="color:#000;font-weight:bold">]</span> è¿”å›å€¼ç±»å‹ åŒ…å<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ç±»å</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">æ–¹æ³•å</span><span style="color:#000;font-weight:bold">(</span>å‚æ•°<span style="color:#000;font-weight:bold">))</span>
</span></span></code></pre></div><ul>
<li>è®¿é—®ä¿®é¥°ç¬¦å¯ä»¥çœç•¥</li>
<li>è¿”å›å€¼ç±»å‹ã€åŒ…åã€ç±»åã€æ–¹æ³•åå¯ä»¥ä½¿ç”¨æ˜Ÿå·*  ä»£è¡¨ä»»æ„</li>
<li>åŒ…åä¸ç±»åä¹‹é—´ä¸€ä¸ªç‚¹ . ä»£è¡¨å½“å‰åŒ…ä¸‹çš„ç±»ï¼Œä¸¤ä¸ªç‚¹ .. è¡¨ç¤ºå½“å‰åŒ…åŠå…¶å­åŒ…ä¸‹çš„ç±»</li>
<li>å‚æ•°åˆ—è¡¨å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªç‚¹ .. è¡¨ç¤ºä»»æ„ä¸ªæ•°ï¼Œä»»æ„ç±»å‹çš„å‚æ•°åˆ—è¡¨</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<p>å…¨åŒ¹é…æ–¹å¼</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> 
</span></span><span style="display:flex;"><span>com<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ujiuye</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">service</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">impl</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">AccountServiceImpl</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">saveAccount</span><span style="color:#000;font-weight:bold">(</span>com<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ujiuye</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">domain</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Account</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>è®¿é—®ä¿®é¥°ç¬¦å¯ä»¥çœç•¥</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#458;font-weight:bold">void</span> com<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ujiuye</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">service</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">impl</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">AccountServiceImpl</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">saveAccount</span><span style="color:#000;font-weight:bold">(</span>com<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ujiuye</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">domain</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Account</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>è¿”å›å€¼å¯ä»¥ä½¿ç”¨*å·ï¼Œè¡¨ç¤ºä»»æ„è¿”å›å€¼</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">*</span> com<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ujiuye</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">service</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">impl</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">AccountServiceImpl</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">saveAccount</span><span style="color:#000;font-weight:bold">(</span>com<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ujiuye</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">domain</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Account</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>åŒ…åå¯ä»¥ä½¿ç”¨ * å·ï¼Œè¡¨ç¤ºä»»æ„åŒ…ï¼Œä½†æ˜¯æœ‰å‡ çº§åŒ…ï¼Œéœ€è¦å†™å‡ ä¸ª *</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">*</span> <span style="color:#000;font-weight:bold">*.*.*.*.</span><span style="color:#008080">AccountServiceImpl</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">saveAccount</span><span style="color:#000;font-weight:bold">(</span>com<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ujiuye</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">domain</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Account</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>ä½¿ç”¨..æ¥è¡¨ç¤ºå½“å‰åŒ…ï¼ŒåŠå…¶å­åŒ…</p>
<pre tabindex="0"><code>* com..AccountServiceImpl.saveAccount(com.ujiuye.domain.Account)
</code></pre><p>ç±»åå¯ä»¥ä½¿ç”¨*å·ï¼Œè¡¨ç¤ºä»»æ„ç±»</p>
<pre tabindex="0"><code>* com..*.saveAccount(com.ujiuye.domain.Account)
</code></pre><p>æ–¹æ³•åå¯ä»¥ä½¿ç”¨*å·ï¼Œè¡¨ç¤ºä»»æ„æ–¹æ³•</p>
<pre tabindex="0"><code>* com..*.*( com.ujiuye.domain.Account)
</code></pre><p>å‚æ•°åˆ—è¡¨å¯ä»¥ä½¿ç”¨*ï¼Œè¡¨ç¤ºå‚æ•°å¯ä»¥æ˜¯ä»»æ„æ•°æ®ç±»å‹ï¼Œä½†æ˜¯å¿…é¡»æœ‰å‚æ•°</p>
<pre tabindex="0"><code>* com..*.*(*)
</code></pre><p>å‚æ•°åˆ—è¡¨å¯ä»¥ä½¿ç”¨..è¡¨ç¤ºæœ‰æ— å‚æ•°å‡å¯ï¼Œæœ‰å‚æ•°å¯ä»¥æ˜¯ä»»æ„ç±»å‹</p>
<pre tabindex="0"><code>* com..*.*(..)
</code></pre><p>å…¨é€šé…æ–¹å¼ï¼š</p>
<pre tabindex="0"><code>* *..*.*(..)
</code></pre><p>æ³¨æ„ï¼š é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯å¯¹ä¸šåŠ¡å±‚çš„æ–¹æ³•è¿›è¡Œå¢å¼ºï¼Œæ‰€ä»¥åˆ‡å…¥ç‚¹è¡¨è¾¾å¼éƒ½æ˜¯åˆ‡åˆ°ä¸šåŠ¡å±‚å®ç°ç±»ã€‚</p>
<pre tabindex="0"><code>execution(* com.ujiuye.service.impl.*.*(..))
</code></pre><h3 id="4-ç¯ç»•é€šçŸ¥é…ç½®äº‹åŠ¡ç®¡ç†">4 ç¯ç»•é€šçŸ¥é…ç½®äº‹åŠ¡ç®¡ç†</h3>
<p>åœ¨TransactionManagerç±»å½“ä¸­æ·»åŠ æ–¹æ³•</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * ç¯ç»•é€šçŸ¥:
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * spring æ¡†æ¶ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ¥å£ï¼šProceedingJoinPointï¼Œå®ƒå¯ä»¥ä½œä¸ºç¯ç»•é€šçŸ¥çš„æ–¹æ³•å‚æ•°ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * åœ¨ç¯ç»•é€šçŸ¥æ‰§è¡Œæ—¶ï¼Œspring æ¡†æ¶ä¼šä¸ºæˆ‘ä»¬æä¾›è¯¥æ¥å£çš„å®ç°ç±»å¯¹è±¡ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨å°±è¡Œã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param pjp
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> Object <span style="color:#900;font-weight:bold">transactionAround</span><span style="color:#000;font-weight:bold">(</span>ProceedingJoinPoint pjp<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//å®šä¹‰è¿”å›å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Object returnValue <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//è·å–æ–¹æ³•æ‰§è¡Œæ‰€éœ€çš„å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        Object<span style="color:#000;font-weight:bold">[]</span> args <span style="color:#000;font-weight:bold">=</span> pjp<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getArgs</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//å‰ç½®é€šçŸ¥ï¼šå¼€å¯äº‹åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        beginTransaction<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//æ‰§è¡Œæ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        returnValue <span style="color:#000;font-weight:bold">=</span> pjp<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">proceed</span><span style="color:#000;font-weight:bold">(</span>args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//åç½®é€šçŸ¥ï¼šæäº¤äº‹åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        commit<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">catch</span><span style="color:#000;font-weight:bold">(</span>Throwable e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//å¼‚å¸¸é€šçŸ¥ï¼šå›æ»šäº‹åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        rollback<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">finally</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//æœ€ç»ˆé€šçŸ¥ï¼šé‡Šæ”¾èµ„æº
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        release<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> returnValue<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span> aop:aroundï¼š
</span></span><span style="display:flex;"><span>	ä½œç”¨ï¼š
</span></span><span style="display:flex;"><span>		ç”¨äºé…ç½®ç¯ç»•é€šçŸ¥
</span></span><span style="display:flex;"><span>	å±æ€§ï¼š
</span></span><span style="display:flex;"><span>        methodï¼šæŒ‡å®šé€šçŸ¥ä¸­æ–¹æ³•çš„åç§°ã€‚
</span></span><span style="display:flex;"><span>        pointctï¼šå®šä¹‰åˆ‡å…¥ç‚¹è¡¨è¾¾å¼
</span></span><span style="display:flex;"><span>        pointcut-refï¼šæŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„å¼•ç”¨
</span></span><span style="display:flex;"><span>	è¯´æ˜ï¼š
</span></span><span style="display:flex;"><span>        å®ƒæ˜¯ spring æ¡†æ¶ä¸ºæˆ‘ä»¬æä¾›çš„ä¸€ç§å¯ä»¥åœ¨ä»£ç ä¸­æ‰‹åŠ¨æ§åˆ¶å¢å¼ºä»£ç ä»€ä¹ˆæ—¶å€™æ‰§è¡Œçš„æ–¹å¼ã€‚
</span></span><span style="display:flex;"><span>        æ³¨æ„ï¼šé€šå¸¸æƒ…å†µä¸‹ï¼Œç¯ç»•é€šçŸ¥éƒ½æ˜¯ç‹¬ç«‹ä½¿ç”¨çš„
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;aop:config&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;aop:aspect</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;tdAdvice&#34;</span> <span style="color:#008080">ref=</span><span style="color:#d14">&#34;txManager&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;aop:pointcut</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;point1&#34;</span> <span style="color:#008080">expression=</span><span style="color:#d14">&#34;execution(* com.offcn.service.impl.*.*(..))&#34;</span><span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">&lt;!-- é…ç½®ç¯ç»•é€šçŸ¥ --&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;aop:around</span> <span style="color:#008080">method=</span><span style="color:#d14">&#34;transactionAround&#34;</span> <span style="color:#008080">pointcut-ref=</span><span style="color:#d14">&#34;point1&#34;</span><span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;/aop:aspect&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/aop:config&gt;</span>
</span></span></code></pre></div><h2 id="ä¸‰springåŸºäºæ³¨è§£çš„aopé…ç½®">ï¼ˆä¸‰ï¼‰SpringåŸºäºæ³¨è§£çš„AOPé…ç½®</h2>
<pre tabindex="0"><code>è¯æœ¯ï¼š 
 AOPæ³¨è§£æ–¹å¼å’ŒXMLæ–¹å¼å®Œæˆçš„åŠŸèƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯é‡‡ç”¨äº†ä¸¤ç§å¼€å‘æ–¹å¼è€Œå·²ã€‚å°†åŸæœ‰çš„XMLæ–¹å¼ä½¿ç”¨æ³¨è§£é€ä¸€æ›¿ä»£ã€‚
</code></pre><h3 id="1-ç¯å¢ƒæ­å»º-1">1 ç¯å¢ƒæ­å»º</h3>
<h4 id="11-æ„å»ºmavenå·¥ç¨‹æ·»åŠ aopæ³¨è§£çš„ç›¸å…³ä¾èµ–">1.1 æ„å»ºmavenå·¥ç¨‹æ·»åŠ AOPæ³¨è§£çš„ç›¸å…³ä¾èµ–</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;properties&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;spring.version&gt;</span>5.2.5.RELEASE<span style="color:#000080">&lt;/spring.version&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/properties&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;dependencies&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>org.springframework<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>spring-context<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>${spring.version}<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>org.aspectj<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>aspectjweaver<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>1.8.7<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/dependencies&gt;</span>
</span></span></code></pre></div><h4 id="12-æ²¿ç”¨ä¸Šä¸€ç« èŠ‚èµ„æº">1.2 æ²¿ç”¨ä¸Šä¸€ç« èŠ‚èµ„æº</h4>
<p>copy Account AccountDao AccountDaoImpl AccountService AccountServiceImpl</p>
<h4 id="13-åœ¨é…ç½®æ–‡ä»¶ä¸­å¯¼å…¥-context-çš„åç§°ç©ºé—´ä¸”é…ç½®">1.3 åœ¨é…ç½®æ–‡ä»¶ä¸­å¯¼å…¥ context çš„åç§°ç©ºé—´ä¸”é…ç½®</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;beans</span> <span style="color:#008080">xmlns=</span><span style="color:#d14">&#34;http://www.springframework.org/schema/beans&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008080">xmlns:aop=</span><span style="color:#d14">&#34;http://www.springframework.org/schema/aop&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008080">xmlns:context=</span><span style="color:#d14">&#34;http://www.springframework.org/schema/context&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008080">xmlns:xsi=</span><span style="color:#d14">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008080">xsi:schemaLocation=</span><span style="color:#d14">&#34;http://www.springframework.org/schema/beans
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/beans/spring-beans.xsd
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/aop
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/aop/spring-aop.xsd
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/context
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/context/spring-context.xsd&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/beans&gt;</span>
</span></span></code></pre></div><h4 id="14-èµ„æºä½¿ç”¨æ³¨è§£é…ç½®">1.4 èµ„æºä½¿ç”¨æ³¨è§£é…ç½®</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- é…ç½®æ•°æ®æº --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;dataSource&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;com.mchange.v2.c3p0.ComboPooledDataSource&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--è¿æ¥æ•°æ®åº“çš„å¿…å¤‡ä¿¡æ¯--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;driverClass&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;com.mysql.jdbc.Driver&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;jdbcUrl&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;jdbc:mysql://localhost:3306/test&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;user&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;root&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;password&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;root&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--é…ç½®queryRunner--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;queryRunner&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;org.apache.commons.dbutils.QueryRunner&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/bean&gt;</span>
</span></span></code></pre></div><h4 id="15-åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®š-spring-è¦æ‰«æçš„åŒ…">1.5 åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®š spring è¦æ‰«æçš„åŒ…</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span> <span style="color:#998;font-style:italic">&lt;!-- å‘ŠçŸ¥ springï¼Œåœ¨åˆ›å»ºå®¹å™¨æ—¶è¦æ‰«æçš„åŒ… --&gt;</span>
</span></span><span style="display:flex;"><span> <span style="color:#000080">&lt;context:component-scan</span> <span style="color:#008080">base-package=</span><span style="color:#d14">&#34;com.offcn&#34;</span><span style="color:#000080">&gt;&lt;/context:component-scan&gt;</span>
</span></span></code></pre></div><h3 id="2-é…ç½®æ­¥éª¤">2 é…ç½®æ­¥éª¤</h3>
<h4 id="11--é€šçŸ¥ç±»ä½¿ç”¨æ³¨è§£é…ç½®">1.1  é€šçŸ¥ç±»ä½¿ç”¨æ³¨è§£é…ç½®</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * å’Œäº‹åŠ¡ç®¡ç†ç›¸å…³çš„å·¥å…·ç±»ï¼Œå®ƒåŒ…å«äº†ï¼Œå¼€å¯äº‹åŠ¡ï¼Œæäº¤äº‹åŠ¡ï¼Œå›æ»šäº‹åŠ¡å’Œé‡Šæ”¾è¿æ¥
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Component</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;txManager&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">TransactionManager</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> ConnectionUtils connectionUtils<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="12-åœ¨é€šçŸ¥ç±»ä¸Šä½¿ç”¨aspect-æ³¨è§£å£°æ˜ä¸ºåˆ‡é¢">1.2 åœ¨é€šçŸ¥ç±»ä¸Šä½¿ç”¨@Aspect æ³¨è§£å£°æ˜ä¸ºåˆ‡é¢</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * å’Œäº‹åŠ¡ç®¡ç†ç›¸å…³çš„å·¥å…·ç±»ï¼Œå®ƒåŒ…å«äº†ï¼Œå¼€å¯äº‹åŠ¡ï¼Œæäº¤äº‹åŠ¡ï¼Œå›æ»šäº‹åŠ¡å’Œé‡Šæ”¾è¿æ¥
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Component</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;txManager&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Aspect</span> <span style="color:#998;font-style:italic">//è¡¨æ˜å½“å‰ç±»æ˜¯ä¸€ä¸ªåˆ‡é¢ç±»
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">TransactionManager</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> ConnectionUtils connectionUtils<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="13-åœ¨å¢å¼ºçš„æ–¹æ³•ä¸Šä½¿ç”¨æ³¨è§£é…ç½®é€šçŸ¥">1.3 åœ¨å¢å¼ºçš„æ–¹æ³•ä¸Šä½¿ç”¨æ³¨è§£é…ç½®é€šçŸ¥</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Before</span>
</span></span><span style="display:flex;"><span>	ä½œç”¨<span style="color:#a61717;background-color:#e3d2d2">ï¼š</span>
</span></span><span style="display:flex;"><span>		æŠŠå½“å‰æ–¹æ³•çœ‹æˆæ˜¯å‰ç½®é€šçŸ¥
</span></span><span style="display:flex;"><span>	å±æ€§<span style="color:#a61717;background-color:#e3d2d2">ï¼š</span>
</span></span><span style="display:flex;"><span>		value<span style="color:#a61717;background-color:#e3d2d2">ï¼š</span>ç”¨äºæŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼<span style="color:#a61717;background-color:#e3d2d2">ï¼Œ</span>è¿˜å¯ä»¥æŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„å¼•ç”¨<span style="color:#a61717;background-color:#e3d2d2">ã€‚</span>
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//å¼€å¯äº‹åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#3c5d5d;font-weight:bold">@Before</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;execution(* com.offcn.service.impl.*.*(..)))&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span>  <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">beginTransaction</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;before..........................&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        connectionUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getThreadConnection</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">setAutoCommit</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>Exception e<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> <span style="color:#3c5d5d;font-weight:bold">@AfterReturning</span>
</span></span><span style="display:flex;"><span>	ä½œç”¨<span style="color:#a61717;background-color:#e3d2d2">ï¼š</span> 
</span></span><span style="display:flex;"><span>		æŠŠå½“å‰æ–¹æ³•çœ‹æˆæ˜¯åç½®é€šçŸ¥<span style="color:#a61717;background-color:#e3d2d2">ã€‚</span>
</span></span><span style="display:flex;"><span>	å±æ€§<span style="color:#a61717;background-color:#e3d2d2">ï¼š</span> 
</span></span><span style="display:flex;"><span>		value<span style="color:#a61717;background-color:#e3d2d2">ï¼š</span>ç”¨äºæŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼<span style="color:#a61717;background-color:#e3d2d2">ï¼Œ</span>è¿˜å¯ä»¥æŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„å¼•ç”¨
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">// æäº¤äº‹åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#3c5d5d;font-weight:bold">@AfterReturning</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;execution(* com.offcn.service.impl.*.*(..)))&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span>  <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">commit</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        connectionUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getThreadConnection</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">commit</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>Exception e<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@AfterThrowing</span>
</span></span><span style="display:flex;"><span>	ä½œç”¨<span style="color:#a61717;background-color:#e3d2d2">ï¼š</span> 
</span></span><span style="display:flex;"><span>		æŠŠå½“å‰æ–¹æ³•çœ‹æˆæ˜¯å¼‚å¸¸é€šçŸ¥<span style="color:#a61717;background-color:#e3d2d2">ã€‚</span>
</span></span><span style="display:flex;"><span>	å±æ€§<span style="color:#a61717;background-color:#e3d2d2">ï¼š</span> 
</span></span><span style="display:flex;"><span>		value<span style="color:#a61717;background-color:#e3d2d2">ï¼š</span>ç”¨äºæŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼<span style="color:#a61717;background-color:#e3d2d2">ï¼Œ</span>è¿˜å¯ä»¥æŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„å¼•ç”¨
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//å›æ»šäº‹åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#3c5d5d;font-weight:bold">@AfterThrowing</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;execution(* com.offcn.service.impl.*.*(..)))&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span>  <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">rollback</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        connectionUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getThreadConnection</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">rollback</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>Exception e<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@After</span>
</span></span><span style="display:flex;"><span>	ä½œç”¨<span style="color:#a61717;background-color:#e3d2d2">ï¼š</span> 
</span></span><span style="display:flex;"><span>		æŠŠå½“å‰æ–¹æ³•çœ‹æˆæ˜¯æœ€ç»ˆé€šçŸ¥<span style="color:#a61717;background-color:#e3d2d2">ã€‚</span>
</span></span><span style="display:flex;"><span>	å±æ€§<span style="color:#a61717;background-color:#e3d2d2">ï¼š</span> 
</span></span><span style="display:flex;"><span>		value<span style="color:#a61717;background-color:#e3d2d2">ï¼š</span>ç”¨äºæŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼<span style="color:#a61717;background-color:#e3d2d2">ï¼Œ</span>è¿˜å¯ä»¥æŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„å¼•ç”¨
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//é‡Šæ”¾è¿æ¥
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#3c5d5d;font-weight:bold">@After</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;execution(* com.offcn.service.impl.*.*(..)))&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span>  <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">release</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        connectionUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">removeConnection</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        connectionUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getThreadConnection</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">close</span><span style="color:#000;font-weight:bold">();</span><span style="color:#998;font-style:italic">//è¿˜å›è¿æ¥æ± ä¸­
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>Exception e<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="14-åœ¨-spring-é…ç½®æ–‡ä»¶ä¸­å¼€å¯-spring-å¯¹æ³¨è§£-aop-çš„æ”¯æŒ">1.4 åœ¨ spring é…ç½®æ–‡ä»¶ä¸­å¼€å¯ spring å¯¹æ³¨è§£ AOP çš„æ”¯æŒ</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- å¼€å¯ spring å¯¹æ³¨è§£ AOP çš„æ”¯æŒ --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;aop:aspectj-autoproxy/&gt;</span>
</span></span></code></pre></div><h4 id="15-ç¯ç»•é€šçŸ¥æ³¨è§£é…ç½®">1.5 ç¯ç»•é€šçŸ¥æ³¨è§£é…ç½®</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Around</span>
</span></span><span style="display:flex;"><span>	ä½œç”¨<span style="color:#a61717;background-color:#e3d2d2">ï¼š</span> 
</span></span><span style="display:flex;"><span>		æŠŠå½“å‰æ–¹æ³•çœ‹æˆæ˜¯ç¯ç»•é€šçŸ¥<span style="color:#a61717;background-color:#e3d2d2">ã€‚</span>
</span></span><span style="display:flex;"><span>	å±æ€§<span style="color:#a61717;background-color:#e3d2d2">ï¼š</span> 
</span></span><span style="display:flex;"><span>		value<span style="color:#a61717;background-color:#e3d2d2">ï¼š</span>ç”¨äºæŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼<span style="color:#a61717;background-color:#e3d2d2">ï¼Œ</span>è¿˜å¯ä»¥æŒ‡å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„å¼•ç”¨<span style="color:#a61717;background-color:#e3d2d2">ã€‚</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">// ç¯ç»•é€šçŸ¥:
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#3c5d5d;font-weight:bold">@Around</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;execution(* com.offcn.service.impl.*.*(..)))&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> Object <span style="color:#900;font-weight:bold">transactionAround</span><span style="color:#000;font-weight:bold">(</span>ProceedingJoinPoint pjp<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//å®šä¹‰è¿”å›å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Object returnValue <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//è·å–æ–¹æ³•æ‰§è¡Œæ‰€éœ€çš„å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        Object<span style="color:#000;font-weight:bold">[]</span> args <span style="color:#000;font-weight:bold">=</span> pjp<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getArgs</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//å‰ç½®é€šçŸ¥ï¼šå¼€å¯äº‹åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        beginTransaction<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//æ‰§è¡Œæ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        returnValue <span style="color:#000;font-weight:bold">=</span> pjp<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">proceed</span><span style="color:#000;font-weight:bold">(</span>args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//åç½®é€šçŸ¥ï¼šæäº¤äº‹åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        commit<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">catch</span><span style="color:#000;font-weight:bold">(</span>Throwable e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//å¼‚å¸¸é€šçŸ¥ï¼šå›æ»šäº‹åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        rollback<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">finally</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//æœ€ç»ˆé€šçŸ¥ï¼šé‡Šæ”¾èµ„æº
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        release<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> returnValue<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="16-åˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ³¨è§£">1.6 åˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ³¨è§£</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Pointcut</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;execution(* com.offcn.service.impl.*.*(..))&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">point1</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">// ç¯ç»•é€šçŸ¥:
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#3c5d5d;font-weight:bold">@Around</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;point1()&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#998;font-style:italic">///æ³¨æ„ï¼šåƒä¸‡åˆ«å¿˜äº†å†™æ‹¬å·
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">public</span> Object <span style="color:#900;font-weight:bold">transactionAround</span><span style="color:#000;font-weight:bold">(</span>ProceedingJoinPoint pjp<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//å®šä¹‰è¿”å›å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Object returnValue <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//è·å–æ–¹æ³•æ‰§è¡Œæ‰€éœ€çš„å‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        Object<span style="color:#000;font-weight:bold">[]</span> args <span style="color:#000;font-weight:bold">=</span> pjp<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getArgs</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//å‰ç½®é€šçŸ¥ï¼šå¼€å¯äº‹åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        beginTransaction<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//æ‰§è¡Œæ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        returnValue <span style="color:#000;font-weight:bold">=</span> pjp<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">proceed</span><span style="color:#000;font-weight:bold">(</span>args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//åç½®é€šçŸ¥ï¼šæäº¤äº‹åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        commit<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">catch</span><span style="color:#000;font-weight:bold">(</span>Throwable e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//å¼‚å¸¸é€šçŸ¥ï¼šå›æ»šäº‹åŠ¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        rollback<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">finally</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//æœ€ç»ˆé€šçŸ¥ï¼šé‡Šæ”¾èµ„æº
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        release<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> returnValue<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>ä½œä¸šï¼š aop æ§åˆ¶äº‹åŠ¡ï¼Œ çº¯æ³¨è§£å¼€å‘~</p>
<h1 id="äºŒ-springäº‹åŠ¡è¯¦è§£">äºŒã€ Springäº‹åŠ¡è¯¦è§£</h1>
<pre tabindex="0"><code>è®²è§£æ€è·¯ï¼š 
 1ã€ä»‹ç»Springå½“ä¸­è¿›è¡Œäº‹åŠ¡æ§åˆ¶çš„å¸¸ç”¨å¯¹è±¡ä»¥åŠä½œç”¨
 2ã€äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼Œä¸åŒéš”ç¦»çº§åˆ«äº§ç”Ÿçš„é”™è¯¯æ•°æ®
 3ã€æ‰©å±•äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼Œäº‹åŠ¡ä¼ æ’­è¡Œä¸ºçš„å¯¹åº”å‡ ç§æƒ…å†µï¼Œé¢è¯•é—®é¢˜
 4ã€å®ŒæˆåŸºäºXMLå½¢å¼äº‹åŠ¡é…ç½®
</code></pre><h2 id="ä¸€springä¸­äº‹åŠ¡çš„apiè¯¦è§£">ï¼ˆä¸€ï¼‰Springä¸­äº‹åŠ¡çš„APIè¯¦è§£</h2>
<h3 id="1-platformtransactionmanagerä½œç”¨æŒæ¡">1 PlatformTransactionManagerä½œç”¨ã€æŒæ¡ã€‘</h3>
<p>PlatformTransactionManager æ¥å£æ˜¯ Spring çš„äº‹åŠ¡ç®¡ç†å™¨ï¼Œå®ƒé‡Œé¢æä¾›äº†æˆ‘ä»¬å¸¸ç”¨çš„æ“ä½œäº‹åŠ¡çš„æ–¹æ³•ã€‚</p>
<p><img src="/posts/Java-frame/20220526005077/image-20220526005607843.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>æ³¨æ„ï¼š</p>
<p>PlatformTransactionManager æ˜¯æ¥å£ç±»å‹ï¼Œä¸åŒçš„ Dao å±‚æŠ€æœ¯åˆ™æœ‰ä¸åŒçš„å®ç°ç±»ï¼Œä¾‹å¦‚ï¼šDao å±‚æŠ€æœ¯æ˜¯jdbc æˆ– mybatis æ—¶ï¼ŒJdbcTemplate å¯¹è±¡ï¼šorg.springframework.jdbc.datasource.DataSourceTransactionManager</p>
<p>Dao å±‚æŠ€æœ¯æ˜¯hibernateæ—¶ï¼šorg.springframework.orm.hibernate5.HibernateTransactionManager</p>
<h3 id="2-transactiondefinitionä½œç”¨">2 TransactionDefinitionä½œç”¨</h3>
<p>TransactionDefinition æ˜¯äº‹åŠ¡çš„å®šä¹‰ä¿¡æ¯å¯¹è±¡ï¼Œé‡Œé¢æœ‰å¦‚ä¸‹æ–¹æ³•</p>
<p><img src="/posts/Java-frame/20220526005077/image-20220526005627306.png"
    
    
    
    loading="lazy"
    
    
></p>
<h4 id="21-äº‹åŠ¡éš”ç¦»çº§åˆ«">2.1 äº‹åŠ¡éš”ç¦»çº§åˆ«</h4>
<p>è®¾ç½®éš”ç¦»çº§åˆ«ï¼Œå¯ä»¥è§£å†³äº‹åŠ¡å¹¶å‘äº§ç”Ÿçš„é—®é¢˜ï¼Œå¦‚è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œè™šè¯»ã€‚</p>
<table>
<thead>
<tr>
<th>äº‹åŠ¡éš”ç¦»çº§åˆ«</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>ISOLATION_DEFAULT</td>
<td>é»˜è®¤çº§åˆ«ï¼Œå½’å±ä¸‹åˆ—æŸä¸€ç§</td>
</tr>
<tr>
<td>ISOLATION_READ_UNCOMMITTED</td>
<td>æœªæäº¤è¯»ï¼Œå¯ä»¥è¯»å–æœªæäº¤æ•°æ®</td>
</tr>
<tr>
<td>ISOLATION_READ_COMMITTED</td>
<td>å·²æäº¤è¯»ï¼Œåªèƒ½è¯»å–å·²æäº¤æ•°æ®ï¼Œè§£å†³è„è¯»é—®é¢˜ï¼ˆOracleé»˜è®¤çº§åˆ«ï¼‰</td>
</tr>
<tr>
<td>ISOLATION_REPEATABLE_READ</td>
<td>å¯é‡å¤è¯»ï¼Œè§£å†³ä¸å¯é‡å¤åº¦é—®é¢˜ï¼ˆMySQLé»˜è®¤çº§åˆ«ï¼‰</td>
</tr>
<tr>
<td>ISOLATION_SERIALIZABLE</td>
<td>ä¸²è¡ŒåŒ–ï¼ŒèŠ‚çº¦å¹»è¯»ï¼ˆè™šè¯»ï¼‰é—®é¢˜</td>
</tr>
</tbody>
</table>
<h4 id="22-äº‹åŠ¡ä¼ æ’­è¡Œä¸º">2.2 äº‹åŠ¡ä¼ æ’­è¡Œä¸º</h4>
<table>
<thead>
<tr>
<th>äº‹åŠ¡ä¼ æ’­è¡Œä¸º</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>REQUIRED</strong></td>
<td><strong>å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±æ–°å»ºä¸€ä¸ªäº‹åŠ¡ï¼Œå¦‚æœå·²ç»å­˜åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼ŒåŠ å…¥åˆ°è¿™ä¸ªäº‹åŠ¡ä¸­ã€‚ä¸€èˆ¬çš„é€‰æ‹©ï¼ˆé»˜è®¤å€¼ï¼‰</strong></td>
</tr>
<tr>
<td><strong>SUPPORTS</strong></td>
<td>æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼ˆæ²¡æœ‰äº‹åŠ¡ï¼‰</td>
</tr>
<tr>
<td>MANDATORY</td>
<td>ä½¿ç”¨å½“å‰çš„äº‹åŠ¡ï¼Œå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±æŠ›å‡ºå¼‚å¸¸</td>
</tr>
<tr>
<td>REQUERS_NEW</td>
<td>æ–°å»ºäº‹åŠ¡ï¼Œå¦‚æœå½“å‰åœ¨äº‹åŠ¡ä¸­ï¼ŒæŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚</td>
</tr>
<tr>
<td>NOT_SUPPORTED</td>
<td>ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œæ“ä½œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·</td>
</tr>
<tr>
<td>NEVER</td>
<td>ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼ŒæŠ›å‡ºå¼‚å¸¸</td>
</tr>
<tr>
<td>NESTED</td>
<td>å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œã€‚å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æ‰§è¡Œ REQUIRED ç±»ä¼¼çš„æ“ä½œ</td>
</tr>
</tbody>
</table>
<h4 id="23-äº‹åŠ¡è¶…æ—¶æ—¶é—´">2.3 äº‹åŠ¡è¶…æ—¶æ—¶é—´</h4>
<p>é»˜è®¤å€¼æ˜¯-1ï¼Œæ²¡æœ‰è¶…æ—¶é™åˆ¶ã€‚å¦‚æœæœ‰ï¼Œä»¥ç§’ä¸ºå•ä½è¿›è¡Œè®¾ç½®ã€‚</p>
<h4 id="24-æ˜¯å¦æ˜¯åªè¯»äº‹åŠ¡">2.4 æ˜¯å¦æ˜¯åªè¯»äº‹åŠ¡</h4>
<p>å»ºè®®æŸ¥è¯¢æ—¶è®¾ç½®ä¸ºåªè¯»ã€‚</p>
<h3 id="3-transactionstatusä½œç”¨">3 TransactionStatusä½œç”¨</h3>
<p>TransactionStatus æ¥å£æä¾›çš„æ˜¯äº‹åŠ¡å…·ä½“çš„è¿è¡ŒçŠ¶æ€ï¼Œæ–¹æ³•ä»‹ç»å¦‚ä¸‹ã€‚</p>
<p><img src="/posts/Java-frame/20220526005077/image-20220526005647243.png"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="4-ä¸Šè¿°ä¸‰ä¸ªå¯¹è±¡å…³ç³»">4 ä¸Šè¿°ä¸‰ä¸ªå¯¹è±¡å…³ç³»</h3>
<p>PlatformTransactionManager æ ¹æ®TransactionDefinition å®šä¹‰çš„äº‹åŠ¡å±æ€§ï¼Œè¿›è¡Œäº‹åŠ¡çš„ç®¡ç†ï¼Œ åœ¨äº‹åŠ¡ç®¡ç†çš„è¿‡ç¨‹å½“ä¸­äº§ç”Ÿçš„çŠ¶æ€ä¿¡æ¯ä¿å­˜åœ¨TransactionStatusã€‚</p>
<h2 id="äºŒspringåŸºäºxmlçš„äº‹åŠ¡é…ç½®">ï¼ˆäºŒï¼‰SpringåŸºäºXMLçš„äº‹åŠ¡é…ç½®</h2>
<pre tabindex="0"><code>è®²è§£æ€è·¯ï¼š 
 1ã€å‡†å¤‡è½¬è´¦çš„ä¸šåŠ¡åœºæ™¯ï¼Œæ¼”ç¤ºæ²¡æœ‰äº‹åŠ¡æ§åˆ¶æ—¶ï¼Œæ•°æ®ä¸€è‡´æ€§å—æŸ
 2ã€åœ¨XMLé…ç½®æ–‡ä»¶å½“ä¸­ï¼Œä½¿ç”¨Springæä¾›çš„å£°æ˜å¼äº‹åŠ¡è¿›è¡Œæ§åˆ¶ï¼Œè¯¦è§£äº‹åŠ¡æ§åˆ¶çš„æ¯ä¸ªæ­¥éª¤ï¼Œæ¯ä¸ªæ­¥éª¤å½“ä¸­æ¶‰åŠçš„æ¯ä¸ªæ ‡ç­¾ï¼Œè®²è§£çš„è¿‡ç¨‹å½“ä¸­å¤ä¹ å·©å›ºAOPå½“ä¸­çš„ç›¸å…³æ¦‚å¿µï¼ŒåŠ æ·±å­¦å‘˜å¯¹æ¦‚å¿µçš„ç†è§£
 3ã€æµ‹è¯•åŸºäºXMLå£°æ˜å¼äº‹åŠ¡æ˜¯å¦ç”Ÿæ•ˆ
</code></pre><h3 id="1-ç¯å¢ƒæ­å»º-2">1 ç¯å¢ƒæ­å»º</h3>
<h4 id="11-æ„å»ºmavenå·¥ç¨‹æ·»åŠ ç›¸å…³æŠ€æœ¯ä¾èµ–">1.1 æ„å»ºmavenå·¥ç¨‹ï¼Œæ·»åŠ ç›¸å…³æŠ€æœ¯ä¾èµ–</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;properties&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;spring.version&gt;</span>5.2.5.RELEASE<span style="color:#000080">&lt;/spring.version&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/properties&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;dependencies&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--å¯¼å…¥junitå•å…ƒæµ‹è¯•--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>junit<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>junit<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>4.12<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;scope&gt;</span>test<span style="color:#000080">&lt;/scope&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--å¯¼å…¥springçš„contextåæ ‡--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>org.springframework<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>spring-context<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>${spring.version}<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>org.springframework<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>spring-test<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>${spring.version}<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--å¯¼å…¥Jdbcæ¨¡å—ä¾èµ–--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>org.springframework<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>spring-jdbc<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>${spring.version}<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--å¯¼å…¥Mysql é©±åŠ¨--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>mysql<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>mysql-connector-java<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>5.1.47<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--å¯¼å…¥C3P0è¿æ¥æ± --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>com.mchange<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>c3p0<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>0.9.5.2<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--aop--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>org.aspectj<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>aspectjweaver<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>1.8.7<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/dependencies&gt;</span>
</span></span></code></pre></div><h4 id="12-åˆ›å»ºspring-çš„é…ç½®æ–‡ä»¶å¹¶å¯¼å…¥çº¦æŸ">1.2 åˆ›å»ºSpring çš„é…ç½®æ–‡ä»¶å¹¶å¯¼å…¥çº¦æŸ</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;beans</span> <span style="color:#008080">xmlns=</span><span style="color:#d14">&#34;http://www.springframework.org/schema/beans&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008080">xmlns:xsi=</span><span style="color:#d14">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008080">xmlns:context=</span><span style="color:#d14">&#34;http://www.springframework.org/schema/context&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008080">xmlns:aop=</span><span style="color:#d14">&#34;http://www.springframework.org/schema/aop&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008080">xmlns:tx=</span><span style="color:#d14">&#34;http://www.springframework.org/schema/tx&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008080">xsi:schemaLocation=</span><span style="color:#d14">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/context
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/context/spring-context.xsd
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/aop
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/aop/spring-aop.xsd
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/tx
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/tx/spring-tx.xsd
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/beans
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/beans/spring-beans.xsd&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>     <span style="color:#998;font-style:italic">&lt;!-- å‘ŠçŸ¥ Springï¼Œåœ¨åˆ›å»ºå®¹å™¨æ—¶è¦æ‰«æçš„åŒ… --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;context:component-scan</span> <span style="color:#008080">base-package=</span><span style="color:#d14">&#34;com.offcn&#34;</span><span style="color:#000080">&gt;&lt;/context:component-scan&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!-- é…ç½®æ•°æ®æº --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;dataSource&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;com.mchange.v2.c3p0.ComboPooledDataSource&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&lt;!--è¿æ¥æ•°æ®åº“çš„å¿…å¤‡ä¿¡æ¯--&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;driverClass&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;com.mysql.jdbc.Driver&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;jdbcUrl&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;jdbc:mysql://localhost:3306/test&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;user&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;root&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;password&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;root&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--JdbcTemplate--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;jdbcTemplate&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;org.springframework.jdbc.core.JdbcTemplate&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;dataSource&#34;</span> <span style="color:#008080">ref=</span><span style="color:#d14">&#34;dataSource&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/beans&gt;</span>
</span></span></code></pre></div><h4 id="13-æ²¿ç”¨è½¬è´¦ä¸šåŠ¡çš„ä»£ç ">1.3 æ²¿ç”¨è½¬è´¦ä¸šåŠ¡çš„ä»£ç </h4>
<p>copy Account AccountDao AccountDaoImpl AccontService AccountServiceImpl ä»£ç ï¼š</p>
<p>æ³¨æ„ï¼š AccountDaoImpl å…·ä½“ä½¿ç”¨ä½¿ç”¨Springæä¾›çš„JdbcTemplateæ¨¡æ¿å¯¹è±¡å®ç°</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Repository</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;accountDao&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">AccountDaoImpl</span> <span style="color:#000;font-weight:bold">implements</span> AccountDao <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> JdbcTemplate jdbcTemplate<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> Account <span style="color:#900;font-weight:bold">findByName</span><span style="color:#000;font-weight:bold">(</span>String name<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        String sql <span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;select * from account where name =? &#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        Account account <span style="color:#000;font-weight:bold">=</span>  <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">jdbcTemplate</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">queryForObject</span><span style="color:#000;font-weight:bold">(</span>sql<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">new</span> BeanPropertyRowMapper<span style="color:#000;font-weight:bold">&lt;&gt;(</span>Account<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">),</span> name<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span>  account<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">update</span><span style="color:#000;font-weight:bold">(</span>Account account<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        String sql <span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;update account set money =? where name =? &#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">jdbcTemplate</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">update</span><span style="color:#000;font-weight:bold">(</span>sql<span style="color:#000;font-weight:bold">,</span> account<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMoney</span><span style="color:#000;font-weight:bold">(),</span> account<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getName</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="2-äº‹åŠ¡ç®¡ç†é…ç½®æ­¥éª¤">2 äº‹åŠ¡ç®¡ç†é…ç½®æ­¥éª¤</h3>
<h4 id="21-é…ç½®äº‹åŠ¡ç®¡ç†å™¨">2.1 é…ç½®äº‹åŠ¡ç®¡ç†å™¨</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--å¹³å°äº‹åŠ¡ç®¡ç†å™¨--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;transactionManager&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;org.springframework.jdbc.datasource.DataSourceTransactionManager&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;dataSource&#34;</span> <span style="color:#008080">ref=</span><span style="color:#d14">&#34;dataSource&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/bean&gt;</span>
</span></span></code></pre></div><h4 id="22-é…ç½®äº‹åŠ¡çš„é€šçŸ¥å¼•ç”¨äº‹åŠ¡ç®¡ç†å™¨">2.2 é…ç½®äº‹åŠ¡çš„é€šçŸ¥å¼•ç”¨äº‹åŠ¡ç®¡ç†å™¨</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--äº‹åŠ¡çš„é…ç½®--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;tx:advice</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;txAdvice&#34;</span> <span style="color:#008080">transaction-manager=</span><span style="color:#d14">&#34;transactionManager&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/tx:advice&gt;</span>
</span></span></code></pre></div><h4 id="23-é…ç½®äº‹åŠ¡çš„å±æ€§">2.3 é…ç½®äº‹åŠ¡çš„å±æ€§</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    æŒ‡å®šæ–¹æ³•åç§°ï¼šæ˜¯ä¸šåŠ¡æ ¸å¿ƒæ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     read-onlyï¼šæ˜¯å¦æ˜¯åªè¯»äº‹åŠ¡ã€‚é»˜è®¤ falseï¼Œä¸åªè¯»ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     isolationï¼šæŒ‡å®šäº‹åŠ¡çš„éš”ç¦»çº§åˆ«ã€‚é»˜è®¤å€¼æ˜¯ä½¿ç”¨æ•°æ®åº“çš„é»˜è®¤éš”ç¦»çº§åˆ«ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     propagationï¼šæŒ‡å®šäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     timeoutï¼šæŒ‡å®šè¶…æ—¶æ—¶é—´ã€‚é»˜è®¤å€¼ä¸ºï¼š-1ã€‚æ°¸ä¸è¶…æ—¶ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     rollback-forï¼šç”¨äºæŒ‡å®šä¸€ä¸ªå¼‚å¸¸ï¼Œå½“æ‰§è¡Œäº§ç”Ÿè¯¥å¼‚å¸¸æ—¶ï¼Œäº‹åŠ¡å›æ»šã€‚äº§ç”Ÿå…¶ä»–å¼‚å¸¸ï¼Œäº‹åŠ¡ä¸å›æ»šã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     æ²¡æœ‰é»˜è®¤å€¼ï¼Œä»»ä½•å¼‚å¸¸éƒ½å›æ»šã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     no-rollback-forï¼šç”¨äºæŒ‡å®šä¸€ä¸ªå¼‚å¸¸ï¼Œå½“äº§ç”Ÿè¯¥å¼‚å¸¸æ—¶ï¼Œäº‹åŠ¡ä¸å›æ»šï¼Œäº§ç”Ÿå…¶ä»–å¼‚å¸¸æ—¶ï¼Œäº‹åŠ¡å›æ»šã€‚æ²¡æœ‰é»˜è®¤å€¼ï¼Œä»»ä½•å¼‚å¸¸éƒ½å›æ»šã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;tx:attributes&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;tx:method</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;*&#34;</span><span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/tx:attributes&gt;</span>
</span></span></code></pre></div><h4 id="24-é…ç½®-aop-åˆ‡å…¥ç‚¹è¡¨è¾¾å¼">2.4 é…ç½® AOP åˆ‡å…¥ç‚¹è¡¨è¾¾å¼</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--äº‹åŠ¡çš„aopå¢å¼º--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;aop:config&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;aop:pointcut</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;myPointcut&#34;</span> <span style="color:#008080">expression=</span><span style="color:#d14">&#34;execution(* com.offcn.service.impl.*.*(..))&#34;</span><span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/aop:config&gt;</span>
</span></span></code></pre></div><h4 id="25-é…ç½®åˆ‡å…¥ç‚¹è¡¨è¾¾å¼å’Œäº‹åŠ¡é€šçŸ¥çš„å¯¹åº”å…³ç³»">2.5 é…ç½®åˆ‡å…¥ç‚¹è¡¨è¾¾å¼å’Œäº‹åŠ¡é€šçŸ¥çš„å¯¹åº”å…³ç³»</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--åœ¨aopï¼šconfigæ ‡ç­¾å†…éƒ¨ï¼šå»ºç«‹äº‹åŠ¡çš„é€šçŸ¥å’Œåˆ‡å…¥ç‚¹è¡¨è¾¾å¼çš„å…³ç³»--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;aop:advisor</span> <span style="color:#008080">advice-ref=</span><span style="color:#d14">&#34;txAdvice&#34;</span> <span style="color:#008080">pointcut-ref=</span><span style="color:#d14">&#34;myPointcut&#34;</span><span style="color:#000080">&gt;&lt;/aop:advisor&gt;</span>
</span></span></code></pre></div><h1 id="ä¸‰-springäº‹åŠ¡è¯¦è§£-æ³¨è§£">ä¸‰ã€ Springäº‹åŠ¡è¯¦è§£-æ³¨è§£</h1>
<h2 id="ä¸€-springåŸºäºæ³¨è§£çš„äº‹åŠ¡é…ç½®">ï¼ˆä¸€ï¼‰ SpringåŸºäºæ³¨è§£çš„äº‹åŠ¡é…ç½®</h2>
<h3 id="1-ç¯å¢ƒæ­å»º-3">1 ç¯å¢ƒæ­å»º</h3>
<h4 id="11--æ„å»ºmavenå·¥ç¨‹æ·»åŠ ç›¸å…³æŠ€æœ¯ä¾èµ–">1.1  æ„å»ºmavenå·¥ç¨‹ï¼Œæ·»åŠ ç›¸å…³æŠ€æœ¯ä¾èµ–</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;properties&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;spring.version&gt;</span>5.2.5.RELEASE<span style="color:#000080">&lt;/spring.version&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/properties&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;dependencies&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--å¯¼å…¥junitå•å…ƒæµ‹è¯•--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>junit<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>junit<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>4.12<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;scope&gt;</span>test<span style="color:#000080">&lt;/scope&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--å¯¼å…¥springçš„contextåæ ‡--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>org.springframework<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>spring-context<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>${spring.version}<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>org.springframework<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>spring-test<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>${spring.version}<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--å¯¼å…¥Jdbcæ¨¡å—ä¾èµ–--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>org.springframework<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>spring-jdbc<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>${spring.version}<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--å¯¼å…¥Mysql é©±åŠ¨--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>mysql<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>mysql-connector-java<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>5.1.47<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--å¯¼å…¥C3P0è¿æ¥æ± --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>com.mchange<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>c3p0<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>0.9.5.2<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--aop--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>org.aspectj<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>aspectjweaver<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>1.8.7<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span></code></pre></div><h4 id="12-åˆ›å»º-spring-çš„é…ç½®æ–‡ä»¶å¹¶å¯¼å…¥çº¦æŸ">1.2 åˆ›å»º Spring çš„é…ç½®æ–‡ä»¶å¹¶å¯¼å…¥çº¦æŸ</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;beans</span> <span style="color:#008080">xmlns=</span><span style="color:#d14">&#34;http://www.springframework.org/schema/beans&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008080">xmlns:xsi=</span><span style="color:#d14">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008080">xmlns:context=</span><span style="color:#d14">&#34;http://www.springframework.org/schema/context&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008080">xmlns:aop=</span><span style="color:#d14">&#34;http://www.springframework.org/schema/aop&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008080">xmlns:tx=</span><span style="color:#d14">&#34;http://www.springframework.org/schema/tx&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008080">xsi:schemaLocation=</span><span style="color:#d14">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/context
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/context/spring-context.xsd
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/aop
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/aop/spring-aop.xsd
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/tx
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/tx/spring-tx.xsd
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/beans
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/beans/spring-beans.xsd&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!-- å‘ŠçŸ¥ springï¼Œåœ¨åˆ›å»ºå®¹å™¨æ—¶è¦æ‰«æçš„åŒ… --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;context:component-scan</span> <span style="color:#008080">base-package=</span><span style="color:#d14">&#34;com.offcn&#34;</span><span style="color:#000080">&gt;&lt;/context:component-scan&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!-- é…ç½®æ•°æ®æº --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;dataSource&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;com.mchange.v2.c3p0.ComboPooledDataSource&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&lt;!--è¿æ¥æ•°æ®åº“çš„å¿…å¤‡ä¿¡æ¯--&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;driverClass&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;com.mysql.jdbc.Driver&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;jdbcUrl&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;jdbc:mysql://localhost:3306/test&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;user&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;root&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;password&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;root&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--JdbcTemplate--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;jdbcTemplate&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;org.springframework.jdbc.core.JdbcTemplate&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;dataSource&#34;</span> <span style="color:#008080">ref=</span><span style="color:#d14">&#34;dataSource&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/beans&gt;</span>
</span></span></code></pre></div><h4 id="13-æ²¿ç”¨è½¬è´¦ä¸šåŠ¡çš„ä»£ç daoå®ç°ç±»å’Œserviceå®ç°ç±»é‡‡ç”¨æ³¨è§£çš„å½¢å¼æ·»åŠ åˆ°å®¹å™¨ä¸­ç®¡ç†">1.3 æ²¿ç”¨è½¬è´¦ä¸šåŠ¡çš„ä»£ç ï¼šdaoå®ç°ç±»å’Œserviceå®ç°ç±»é‡‡ç”¨æ³¨è§£çš„å½¢å¼ï¼Œæ·»åŠ åˆ°å®¹å™¨ä¸­ç®¡ç†</h4>
<p>copy Account AccountDao AccountImpl  AccountService AccountServiceImpl åˆ°å·¥ç¨‹å½“ä¸­å¤ç”¨</p>
<h3 id="2-äº‹åŠ¡ç®¡ç†é…ç½®æ­¥éª¤é‡ç‚¹">2 äº‹åŠ¡ç®¡ç†é…ç½®æ­¥éª¤(é‡ç‚¹)</h3>
<h4 id="21-é…ç½®äº‹åŠ¡ç®¡ç†å™¨å¹¶æ³¨å…¥æ•°æ®æº">2.1 é…ç½®äº‹åŠ¡ç®¡ç†å™¨å¹¶æ³¨å…¥æ•°æ®æº</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- é…ç½®äº‹åŠ¡ç®¡ç†å™¨ --&gt;</span> 
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;transactionManager&#34;</span><span style="color:#008080">class=</span><span style="color:#d14">&#34;org.springframework.jdbc.datasource.DataSourceTransactionManager&#34;</span><span style="color:#000080">&gt;</span> 
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;dataSource&#34;</span> <span style="color:#008080">ref=</span><span style="color:#d14">&#34;dataSource&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/bean&gt;</span>
</span></span></code></pre></div><h4 id="22-åœ¨ä¸šåŠ¡å±‚ä½¿ç”¨transactional-æ³¨è§£">2.2 åœ¨ä¸šåŠ¡å±‚ä½¿ç”¨@Transactional æ³¨è§£</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> è¯¥æ³¨è§£çš„å±æ€§å’Œ xml ä¸­çš„å±æ€§å«ä¹‰ä¸€è‡´ã€‚è¯¥æ³¨è§£å¯ä»¥å‡ºç°åœ¨æ¥å£ä¸Šï¼Œç±»ä¸Šå’Œæ–¹æ³•ä¸Šã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> å‡ºç°æ¥å£ä¸Šï¼Œè¡¨ç¤ºè¯¥æ¥å£çš„æ‰€æœ‰å®ç°ç±»éƒ½æœ‰äº‹åŠ¡æ”¯æŒã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> å‡ºç°åœ¨ç±»ä¸Šï¼Œè¡¨ç¤ºç±»ä¸­æ‰€æœ‰æ–¹æ³•æœ‰äº‹åŠ¡æ”¯æŒ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> å‡ºç°åœ¨æ–¹æ³•ä¸Šï¼Œè¡¨ç¤ºæ–¹æ³•æœ‰äº‹åŠ¡æ”¯æŒã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> ä»¥ä¸Šä¸‰ä¸ªä½ç½®çš„ä¼˜å…ˆçº§ï¼šæ–¹æ³•&gt;ç±»&gt;æ¥å£ 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Service</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;accountService&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Transactional</span><span style="color:#000;font-weight:bold">(</span>readOnly <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span>propagation <span style="color:#000;font-weight:bold">=</span> Propagation<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">SUPPORTS</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">AccountServiceImpl</span> <span style="color:#000;font-weight:bold">implements</span> AccountService <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//ä¾èµ–daoå±‚
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> AccountDao accountDao <span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Transactional</span><span style="color:#000;font-weight:bold">(</span>readOnly <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">,</span>propagation <span style="color:#000;font-weight:bold">=</span> Propagation<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">REQUIRED</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">transfer</span><span style="color:#000;font-weight:bold">(</span>String sourceAccountName<span style="color:#000;font-weight:bold">,</span> String targetAccountName<span style="color:#000;font-weight:bold">,</span> Double money<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            Account sAccount <span style="color:#000;font-weight:bold">=</span> accountDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findByName</span><span style="color:#000;font-weight:bold">(</span>sourceAccountName<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            Account tAccount <span style="color:#000;font-weight:bold">=</span> accountDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findByName</span><span style="color:#000;font-weight:bold">(</span>targetAccountName<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//æ¥æºè´¦æˆ·å‡é’±ï¼Œç›®æ ‡è´¦æˆ·åŠ é’±
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            sAccount<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setMoney</span><span style="color:#000;font-weight:bold">(</span>sAccount<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMoney</span><span style="color:#000;font-weight:bold">()-</span>money<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            tAccount<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setMoney</span><span style="color:#000;font-weight:bold">(</span>tAccount<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMoney</span><span style="color:#000;font-weight:bold">()+</span>money<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//æŒä¹…åŒ–åˆ°æ•°æ®åº“
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            accountDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">update</span><span style="color:#000;font-weight:bold">(</span>sAccount<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//æ¨¡æ‹Ÿå¼‚å¸¸å‘ç”Ÿ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#998;font-style:italic">//int i=1/0;
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            accountDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">update</span><span style="color:#000;font-weight:bold">(</span>tAccount<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="23-åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯-spring-å¯¹æ³¨è§£äº‹åŠ¡çš„æ”¯æŒ">2.3 åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯ Spring å¯¹æ³¨è§£äº‹åŠ¡çš„æ”¯æŒ</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- å¼€å¯ spring å¯¹æ³¨è§£äº‹åŠ¡çš„æ”¯æŒ --&gt;</span> 
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;tx:annotation-driven</span> <span style="color:#008080">transaction-manager=</span><span style="color:#d14">&#34;transactionManager&#34;</span><span style="color:#000080">/&gt;</span>
</span></span></code></pre></div><p>ä½œä¸šï¼š å…¨æ³¨è§£å¼€å‘~</p>
<h1 id="å››-springæ•´åˆmybatiså®ç°ç”¨æˆ·çš„crud">å››ã€ Springæ•´åˆMybatiså®ç°ç”¨æˆ·çš„CRUD</h1>
<h2 id="ä¸€æ•´åˆæ€è·¯åˆ†æ">ï¼ˆä¸€ï¼‰æ•´åˆæ€è·¯åˆ†æ</h2>
<p>Mybatisæ¡†æ¶æ˜¯ä¸€ä¸ªæŒä¹…å±‚ORMæ¡†æ¶ï¼Œè€ŒSpringåˆ™æ˜¯ä¸€ä¸ªç»¼åˆæ€§ä¸€ç«™å¼æ¡†æ¶ã€‚æ‰€ä»¥æ•´åˆæ˜¯Mybatiså¾€Springä¸Šæ•´åˆã€‚å°±æ˜¯è®©Springæ¡†æ¶æ¥ç®¡Mybatisçš„ç»„ä»¶ã€‚</p>
<p>Mybatiså•ç‹¬è¿è¡Œæ—¶ï¼Œæ•°æ®æºçš„ç®¡ç†ï¼Œäº‹åŠ¡çš„ç®¡ç†ï¼Œ SqlSessionFactory ä»¥åŠæ¥å£çš„å®ç°ç±»éƒ½æ˜¯Mybatisç®¡ç†çš„ï¼Œæ•´åˆåä»¥ä¸Šç»„ä»¶äº¤ç»™Springç®¡ç†ã€‚</p>
<h2 id="äºŒæ„å»ºmavenå·¥ç¨‹æ·»åŠ æŠ€æœ¯ä¾èµ–">ï¼ˆäºŒï¼‰æ„å»ºmavenå·¥ç¨‹ï¼Œæ·»åŠ æŠ€æœ¯ä¾èµ–</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;properties&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;spring.version&gt;</span>5.2.5.RELEASE<span style="color:#000080">&lt;/spring.version&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/properties&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;dependencies&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--å¯¼å…¥junitå•å…ƒæµ‹è¯•--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>junit<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>junit<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>4.12<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;scope&gt;</span>test<span style="color:#000080">&lt;/scope&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--å¯¼å…¥springçš„contextåæ ‡--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>org.springframework<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>spring-context<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>${spring.version}<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>org.springframework<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>spring-test<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>${spring.version}<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--å¯¼å…¥Jdbcæ¨¡å—ä¾èµ–--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>org.springframework<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>spring-jdbc<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>${spring.version}<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--å¯¼å…¥Mysql é©±åŠ¨--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>mysql<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>mysql-connector-java<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>5.1.47<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--å¯¼å…¥C3P0è¿æ¥æ± --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>com.mchange<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>c3p0<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>0.9.5.2<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--aop--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>org.aspectj<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>aspectjweaver<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>1.8.7<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--mybatis-Springé€‚é…åŒ… --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>org.mybatis<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>mybatis-spring<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>2.0.0<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!-- mybatis ormæ¡†æ¶ --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>org.mybatis<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>mybatis<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>3.4.6<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/dependencies&gt;</span>
</span></span></code></pre></div><h2 id="ä¸‰æ„å»ºæ•°æ®åº“è¡¨å¹¶åˆ›å»ºå®ä½“user">ï¼ˆä¸‰ï¼‰æ„å»ºæ•°æ®åº“è¡¨å¹¶åˆ›å»ºå®ä½“User</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">create</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">User</span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>id<span style="color:#bbb"> </span><span style="color:#0086b3">int</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">primary</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">key</span><span style="color:#bbb"> </span>auto_increment,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>name<span style="color:#bbb"> </span><span style="color:#0086b3">varchar</span>(<span style="color:#099">32</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">not</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>address<span style="color:#bbb"> </span><span style="color:#0086b3">varchar</span>(<span style="color:#099">32</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">not</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>birthday<span style="color:#bbb"> </span><span style="color:#0086b3">date</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>);<span style="color:#bbb">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">User</span> <span style="color:#000;font-weight:bold">implements</span> Serializable <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> Integer id<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> String name<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> String address<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> Date birthday<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> Integer <span style="color:#900;font-weight:bold">getId</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> id<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setId</span><span style="color:#000;font-weight:bold">(</span>Integer id<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">id</span> <span style="color:#000;font-weight:bold">=</span> id<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> String <span style="color:#900;font-weight:bold">getName</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> name<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setName</span><span style="color:#000;font-weight:bold">(</span>String name<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">name</span> <span style="color:#000;font-weight:bold">=</span> name<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> String <span style="color:#900;font-weight:bold">getAddress</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> address<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setAddress</span><span style="color:#000;font-weight:bold">(</span>String address<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">address</span> <span style="color:#000;font-weight:bold">=</span> address<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> Date <span style="color:#900;font-weight:bold">getBirthday</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> birthday<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setBirthday</span><span style="color:#000;font-weight:bold">(</span>Date birthday<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">birthday</span> <span style="color:#000;font-weight:bold">=</span> birthday<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> String <span style="color:#900;font-weight:bold">toString</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#d14">&#34;User{&#34;</span> <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;id=&#34;</span> <span style="color:#000;font-weight:bold">+</span> id <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;, name=&#39;&#34;</span> <span style="color:#000;font-weight:bold">+</span> name <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#39;\&#39;&#39;</span> <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;, address=&#39;&#34;</span> <span style="color:#000;font-weight:bold">+</span> address <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#39;\&#39;&#39;</span> <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;, birthday=&#34;</span> <span style="color:#000;font-weight:bold">+</span> birthday <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#39;}&#39;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="å››ç¼–å†™daoå±‚çš„æ¥å£usermapper">ï¼ˆå››ï¼‰ç¼–å†™daoå±‚çš„æ¥å£UserMapper</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">interface</span> <span style="color:#458;font-weight:bold">UserMapper</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">insert</span><span style="color:#000;font-weight:bold">(</span>User user<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">update</span><span style="color:#000;font-weight:bold">(</span>User user<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">delete</span><span style="color:#000;font-weight:bold">(</span>Integer id<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    User <span style="color:#900;font-weight:bold">findById</span><span style="color:#000;font-weight:bold">(</span>Integer id<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    List<span style="color:#000;font-weight:bold">&lt;</span>User<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">findAll</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="äº”æ„å»ºmapperæ¥å£å¯¹åº”çš„sqlé…ç½®æ–‡ä»¶">ï¼ˆäº”ï¼‰æ„å»ºmapperæ¥å£å¯¹åº”çš„sqlé…ç½®æ–‡ä»¶</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">&lt;!DOCTYPE mapper
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">        PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">        &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;mapper</span> <span style="color:#008080">namespace=</span><span style="color:#d14">&#34;com.offcn.mapper.UserMapper&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;resultMap</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;BaseResultMap&#34;</span> <span style="color:#008080">type=</span><span style="color:#d14">&#34;com.offcn.pojo.User&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;id</span> <span style="color:#008080">column=</span><span style="color:#d14">&#34;id&#34;</span> <span style="color:#008080">jdbcType=</span><span style="color:#d14">&#34;INTEGER&#34;</span> <span style="color:#008080">property=</span><span style="color:#d14">&#34;id&#34;</span> <span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;result</span> <span style="color:#008080">column=</span><span style="color:#d14">&#34;name&#34;</span> <span style="color:#008080">jdbcType=</span><span style="color:#d14">&#34;VARCHAR&#34;</span> <span style="color:#008080">property=</span><span style="color:#d14">&#34;name&#34;</span> <span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;result</span> <span style="color:#008080">column=</span><span style="color:#d14">&#34;address&#34;</span> <span style="color:#008080">jdbcType=</span><span style="color:#d14">&#34;VARCHAR&#34;</span> <span style="color:#008080">property=</span><span style="color:#d14">&#34;address&#34;</span> <span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;result</span> <span style="color:#008080">column=</span><span style="color:#d14">&#34;birthday&#34;</span> <span style="color:#008080">jdbcType=</span><span style="color:#d14">&#34;DATE&#34;</span> <span style="color:#008080">property=</span><span style="color:#d14">&#34;birthday&#34;</span> <span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/resultMap&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;insert</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;insert&#34;</span> <span style="color:#008080">parameterType=</span><span style="color:#d14">&#34;com.offcn.pojo.User&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>        insert into user (name, birthday, address)
</span></span><span style="display:flex;"><span>        values (#{name}, #{birthday},#{address})
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/insert&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;update</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;update&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>        update user
</span></span><span style="display:flex;"><span>        set
</span></span><span style="display:flex;"><span>        name= #{name},
</span></span><span style="display:flex;"><span>        birthday=#{birthday},
</span></span><span style="display:flex;"><span>        address = #{address}
</span></span><span style="display:flex;"><span>        where id=#{id}
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/update&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;delete</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;delete&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>        delete from user
</span></span><span style="display:flex;"><span>        where id =#{id}
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/delete&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;select</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;findById&#34;</span> <span style="color:#008080">resultMap=</span><span style="color:#d14">&#34;BaseResultMap&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>        select * from user where id=#{id}
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/select&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;select</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;findAll&#34;</span> <span style="color:#008080">resultMap=</span><span style="color:#d14">&#34;BaseResultMap&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>        select * from user
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/select&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/mapper&gt;</span>
</span></span></code></pre></div><h2 id="å…­æ„å»ºæœåŠ¡å±‚æ¥å£userservice">ï¼ˆå…­ï¼‰æ„å»ºæœåŠ¡å±‚æ¥å£UserService</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">interface</span> <span style="color:#458;font-weight:bold">UserService</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">insert</span><span style="color:#000;font-weight:bold">(</span>User user<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">update</span><span style="color:#000;font-weight:bold">(</span>User user<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">delete</span><span style="color:#000;font-weight:bold">(</span>Integer id<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    User <span style="color:#900;font-weight:bold">findById</span><span style="color:#000;font-weight:bold">(</span>Integer id<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    List<span style="color:#000;font-weight:bold">&lt;</span>User<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">findAll</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="ä¸ƒæ„å»ºæœåŠ¡å±‚å®ç°ç±»userserviceimpl">ï¼ˆä¸ƒï¼‰æ„å»ºæœåŠ¡å±‚å®ç°ç±»UserServiceImpl</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Service</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">UserServiceImpl</span> <span style="color:#000;font-weight:bold">implements</span> UserService <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> UserMapper userMapper<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">insert</span><span style="color:#000;font-weight:bold">(</span>User user<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#458;font-weight:bold">int</span> num <span style="color:#000;font-weight:bold">=</span> userMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">insert</span><span style="color:#000;font-weight:bold">(</span>user<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span>  num<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">update</span><span style="color:#000;font-weight:bold">(</span>User user<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#458;font-weight:bold">int</span> num <span style="color:#000;font-weight:bold">=</span> userMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">update</span><span style="color:#000;font-weight:bold">(</span>user<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> num<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">delete</span><span style="color:#000;font-weight:bold">(</span>Integer id<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#458;font-weight:bold">int</span> num <span style="color:#000;font-weight:bold">=</span> userMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">delete</span><span style="color:#000;font-weight:bold">(</span>id<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> num<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> User <span style="color:#900;font-weight:bold">findById</span><span style="color:#000;font-weight:bold">(</span>Integer id<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        User user <span style="color:#000;font-weight:bold">=</span> userMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findById</span><span style="color:#000;font-weight:bold">(</span>id<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> user<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> List<span style="color:#000;font-weight:bold">&lt;</span>User<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">findAll</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        List<span style="color:#000;font-weight:bold">&lt;</span>User<span style="color:#000;font-weight:bold">&gt;</span> userList <span style="color:#000;font-weight:bold">=</span> userMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findAll</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> userList<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="å…«æ„å»ºspringæ¡†æ¶çš„é…ç½®æ–‡ä»¶applicationcontextxmlé…ç½®iocç®¡ç†çš„å¯¹è±¡é‡ç‚¹">ï¼ˆå…«ï¼‰æ„å»ºSpringæ¡†æ¶çš„é…ç½®æ–‡ä»¶applicationContext.xml,é…ç½®IOCç®¡ç†çš„å¯¹è±¡ã€é‡ç‚¹ã€‘</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;beans</span> <span style="color:#008080">xmlns=</span><span style="color:#d14">&#34;http://www.springframework.org/schema/beans&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008080">xmlns:xsi=</span><span style="color:#d14">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008080">xmlns:aop=</span><span style="color:#d14">&#34;http://www.springframework.org/schema/aop&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008080">xmlns:tx=</span><span style="color:#d14">&#34;http://www.springframework.org/schema/tx&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008080">xmlns:context=</span><span style="color:#d14">&#34;http://www.springframework.org/schema/context&#34;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#008080">xsi:schemaLocation=</span><span style="color:#d14">&#34;http://www.springframework.org/schema/beans
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        https://www.springframework.org/schema/beans/spring-beans.xsd
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/tx
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/tx/spring-tx.xsd
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/aop
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/aop/spring-aop.xsd
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/context
</span></span></span><span style="display:flex;"><span><span style="color:#d14">        http://www.springframework.org/schema/context/spring-context.xsd&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--å¼€å¯åŒ…æ‰«æ--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;context:component-scan</span> <span style="color:#008080">base-package=</span><span style="color:#d14">&#34;com.offcn&#34;</span><span style="color:#000080">&gt;</span> <span style="color:#000080">&lt;/context:component-scan&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!-- é…ç½®æ•°æ®æº --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;dataSource&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;com.mchange.v2.c3p0.ComboPooledDataSource&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&lt;!--è¿æ¥æ•°æ®åº“çš„å¿…å¤‡ä¿¡æ¯--&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;driverClass&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;com.mysql.jdbc.Driver&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;jdbcUrl&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;jdbc:mysql://localhost:3306/test&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;user&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;root&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;password&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;root&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--Mybatis æ ¸å¿ƒå¯¹è±¡ï¼š å·¥å‚å¯¹è±¡--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;sqlSessionFactory&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;org.mybatis.spring.SqlSessionFactoryBean&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&lt;!--å·¥å‚åˆ›å»ºå¿…é¡»æ³¨å…¥ä¸€ä¸ªæ•°æ®æº--&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;dataSource&#34;</span> <span style="color:#008080">ref=</span><span style="color:#d14">&#34;dataSource&#34;</span><span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&lt;!--æŒ‡å®šmapperæ–‡ä»¶ä½ç½®--&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;mapperLocations&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;classpath:com/offcn/mapper/*Mapper.xml&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&lt;!--å¼•å…¥Mybatisçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">           å¦‚æœMybaitsçš„æ ¸å¿ƒé…ç½®è¦ä¿ç•™ï¼Œéœ€è¦å†æ­¤å¤„é…ç½®ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">        --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;configLocation&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;classpath:SqlMapConfig.xml&#34;</span><span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&lt;!--åˆ«åé…ç½®--&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;typeAliasesPackage&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;com/offcn/pojo&#34;</span><span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&lt;!--è¿›è¡Œåˆ†é¡µæ’ä»¶çš„é…ç½®--&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;plugins&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000080">&lt;array&gt;</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000080">&lt;bean</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;com.github.pagehelper.PageInterceptor&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>					<span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;properties&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>						<span style="color:#000080">&lt;value&gt;</span>
</span></span><span style="display:flex;"><span>							helperDialect=MySQL
</span></span><span style="display:flex;"><span>							reasonable=true
</span></span><span style="display:flex;"><span>							supportMethodsArguments=true
</span></span><span style="display:flex;"><span>							params=count=countSql
</span></span><span style="display:flex;"><span>							autoRuntimeDialect=true
</span></span><span style="display:flex;"><span>						<span style="color:#000080">&lt;/value&gt;</span>
</span></span><span style="display:flex;"><span>					<span style="color:#000080">&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000080">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000080">&lt;/array&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000080">&lt;/property&gt;</span>   
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--é…ç½®æ¥å£çš„æ‰«æ--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;mapperScannerConfigurer&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;org.mybatis.spring.mapper.MapperScannerConfigurer&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&lt;!--æŒ‡å®šäº†åŒ…ï¼š èƒ½å¤Ÿå°†åŒ…ä¸‹çš„æ¥å£ç”Ÿæˆå®ç°ç±»ï¼š --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;basePackage&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;com.offcn.mapper&#34;</span><span style="color:#000080">&gt;&lt;/property&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">&lt;!--é…ç½®å¹³å°ç®¡ç†å™¨--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;bean</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;transactionManager&#34;</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;org.springframework.jdbc.datasource.DataSourceTransactionManager&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&lt;!--æ³¨å…¥æ•°æ®æº--&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;dataSource&#34;</span> <span style="color:#008080">ref=</span><span style="color:#d14">&#34;dataSource&#34;</span><span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/bean&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;tx:annotation-driven</span> <span style="color:#008080">transaction-manager=</span><span style="color:#d14">&#34;transactionManager&#34;</span><span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/beans&gt;</span>
</span></span></code></pre></div><h2 id="ä¹æµ‹è¯•ä»£ç ">ï¼ˆä¹ï¼‰æµ‹è¯•ä»£ç </h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RunWith</span><span style="color:#000;font-weight:bold">(</span>SpringJUnit4ClassRunner<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@ContextConfiguration</span><span style="color:#000;font-weight:bold">(</span>locations <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;classpath:applicationContext.xml&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">TestAccountTransfer</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> UserService userService<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//save
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testInsert</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        User user <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> User<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        user<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setName</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;admin&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        user<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setAddress</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;china&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        user<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setBirthday</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> Date<span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#458;font-weight:bold">int</span> num <span style="color:#000;font-weight:bold">=</span> userService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">insert</span><span style="color:#000;font-weight:bold">(</span>user<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;num:&#34;</span><span style="color:#000;font-weight:bold">+</span>num<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//update
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testUpdate</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        User user <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> User<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        user<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setName</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;marry&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        user<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setAddress</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;America&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        user<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setBirthday</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> Date<span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>        user<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setId</span><span style="color:#000;font-weight:bold">(</span>1<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#458;font-weight:bold">int</span> num <span style="color:#000;font-weight:bold">=</span> userService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">update</span><span style="color:#000;font-weight:bold">(</span>user<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;num:&#34;</span><span style="color:#000;font-weight:bold">+</span>num<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//delete:
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testDelete</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#458;font-weight:bold">int</span> num <span style="color:#000;font-weight:bold">=</span> userService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">delete</span><span style="color:#000;font-weight:bold">(</span>1<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;num:&#34;</span><span style="color:#000;font-weight:bold">+</span>num<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//findById
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testFindById</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        User user <span style="color:#000;font-weight:bold">=</span> userService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findById</span><span style="color:#000;font-weight:bold">(</span>2<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;user:&#34;</span><span style="color:#000;font-weight:bold">+</span>user<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//findAll
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testFindByAll</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        List<span style="color:#000;font-weight:bold">&lt;</span>User<span style="color:#000;font-weight:bold">&gt;</span> userList <span style="color:#000;font-weight:bold">=</span> userService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findAll</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;userList:&#34;</span><span style="color:#000;font-weight:bold">+</span>userList<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div>
    </div>

    

    


    <div class="container-prevnext">
    <div><a href="https://lovemjh.vercel.app/posts/java-frame/20220526003427/">â† Spring-1</a></div>
    <div><a href="https://lovemjh.vercel.app/posts/java-web/20220430214937/">HTML DOM  â†’</a></div>
</div>
</div>

        </div>
        <div id="footer"><div class="container-footer">
    
    <a href="//beian.miit.gov.cn" target="_blank">
        
        è±«ICPå¤‡2022002918å·
        
    </a>
    <a id="s" href="/secrets">&nbsp;</a>
</div></div>
    </body>
</html>
