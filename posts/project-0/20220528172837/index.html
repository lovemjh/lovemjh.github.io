<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="ç§’æ€1 - https://lovemjh.vercel.app/posts/project-0/20220528172837/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>ç§’æ€1</title>
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    <link rel="stylesheet" href="https://lovemjh.vercel.app/style.min.824365c118b34524ce845ac2a294220354719cca11af5b27a81b04c173bbba57.css">
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate cool">
        <div id="header"><div class="container-header">
    <div id="vars" class="container-vars" style="display: none;">
	{
		"hasFoldAllCodeBlocks": false,
		"svgColor": "#6c757d",
		"en": false,
		"dark": false
	}
</div>
    <h1 class="title">
        
            ç§’æ€1
            
        
    </h1>

    <div class="container-breadcrumb-nav">
    
    <div class="breadcrumb-nav-bar">
        <div><a href="/"><svg t="1656411084410" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2954" width="16" height="16"><path d="M947.5 390.6l-377-290c-34.5-26.5-82.6-26.5-117.1 0l-377 290c-14 10.8-16.6 30.9-5.9 44.9 10.8 14 30.9 16.6 44.9 5.9l28.5-21.9V768c0 88.2 71.8 160 160 160h80c35.3 0 64-28.7 64-64V640c0-17.6 14.4-32 32-32h64c17.6 0 32 14.4 32 32v224c0 35.3 28.7 64 64 64h80c88.2 0 160-71.8 160-160V419.4l28.5 21.9c5.8 4.5 12.7 6.6 19.5 6.6 9.6 0 19.1-4.3 25.4-12.5 10.8-13.9 8.2-34-5.8-44.8zM816 768c0 52.9-43.1 96-96 96h-80V640c0-52.9-43.1-96-96-96h-64c-52.9 0-96 43.1-96 96v224h-80c-52.9 0-96-43.1-96-96V370.2l284.5-218.8c11.5-8.8 27.5-8.8 39 0L816 370.2V768z" fill=#6c757d p-id="2955"></path></svg></a></div>
        <div><a href="/nav"><svg t="1656411531924" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5827" width="16" height="16"><path d="M849.59197473 125.23018519L139.22930586 391.72854662a23.35052669 23.35052669 0 0 0-14.95414244 21.65490745c-0.12257519 9.70384955 5.61801843 18.46795771 14.40255493 22.04306141l318.42928099 129.25528056 119.51057092 320.39047893c3.06437293 8.23295069 10.35758221 13.89182751 18.7335381 14.87242563l2.7170774 0.14300521a22.79893918 22.79893918 0 0 0 21.20546682-15.36272638l259.51158924-729.54564933a23.8612558 23.8612558 0 0 0-5.31158128-24.55584682 22.3290685 22.3290685 0 0 0-23.9021142-5.43415649zM793.65694081 211.64552314l-196.63064161 552.75171747-91.91077952-246.37564122-253.62799211-102.96295445 542.16941324-203.4131218z" p-id="5828" fill=#6c757d></path></svg></a></div>
        <div><a href="/search"><svg t="1656411627509" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1730" width="14" height="14"><path d="M469.333333 85.333333c211.968 0 384 172.032 384 384s-172.032 384-384 384-384-172.032-384-384 172.032-384 384-384z m0 682.666667c164.992 0 298.666667-133.674667 298.666667-298.666667 0-165.034667-133.674667-298.666667-298.666667-298.666666-165.034667 0-298.666667 133.632-298.666666 298.666666 0 164.992 133.632 298.666667 298.666666 298.666667z m362.026667 3.029333l120.704 120.661334-60.373333 60.373333-120.661334-120.704 60.330667-60.330667z" p-id="1731" fill=#6c757d></path></svg></a></div>
        <div><a href="/posts"><svg t="1656411724198" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5655" width="12" height="12"><path d="M811.705761 1024H212.294239c-93.1199 0-174.823046-87.570975-174.823046-187.387854V162.322018C37.471193 69.776145 112.604921 0 212.294239 0H596.190595l7.015883 5.93161c111.74388 95.479788 185.857116 170.741078 279.614824 266.093304 29.65805 30.040735 61.165743 62.122454 96.436499 97.393211l7.271006 7.334787v459.859234c-0.063781 99.816879-81.703145 187.387854-174.823046 187.387854zM212.294239 49.94033c-72.391155 0-124.882716 47.261538-124.882716 112.381688v674.290128c0 71.94469 59.507443 137.383743 124.882716 137.383743h599.411522c65.311492 0 124.882716-65.439053 124.882716-137.383743V397.417876c-32.528184-32.464404-61.73977-62.250016-89.356836-90.377328-90.951355-92.418312-163.278729-165.957521-269.601245-257.163999H212.294239z" fill=#6c757d p-id="5656"></path><path d="M936.588477 449.526752h-212.326129c-99.753099 0-187.324073-81.703145-187.324073-174.823046V49.94033a25.002055 25.002055 0 0 1 49.94033 0v224.763376c0 65.311492 65.502834 124.882716 137.383743 124.882716h212.326129a25.002055 25.002055 0 1 1 0 49.94033z" fill=#6c757d p-id="5657"></path></svg></a></div>
        <div><a href="/archive"><svg t="1656411795742" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7334" width="12" height="12"><path d="M884.224 522.24H504.32V141.824c0-16.896-13.824-30.72-30.72-30.72-120.32 0-233.472 47.616-317.952 134.144S26.112 445.952 29.184 566.784c2.56 114.688 49.152 222.72 131.072 304.128 81.92 81.408 189.952 128 304.64 130.56h10.24c117.76 0 227.84-45.568 312.32-128.512 86.528-85.504 133.632-199.68 132.608-321.024-0.512-2.048-1.536-29.696-35.84-29.696z m-140.288 307.712c-74.752 73.728-173.056 112.64-277.504 110.592-205.824-4.608-370.688-169.472-375.296-374.784-3.072-104.448 35.84-202.752 108.544-277.504 65.536-67.072 151.552-107.52 243.712-114.688v378.88c0 16.896 13.824 30.72 30.72 30.72 129.024 0 311.296 0 382.976 0.512-6.144 93.184-46.08 179.712-113.152 246.272z" fill=#6c757d p-id="7335"></path><path d="M603.136 11.264c-8.192-0.512-15.872 3.072-22.016 8.704-5.632 5.632-9.216 13.824-9.216 22.016v378.88c0 16.896 13.824 30.72 30.72 30.72h378.88c16.896 0 30.72-13.824 30.72-30.72 0-223.744-183.808-407.552-409.088-409.6z m30.208 378.88V74.24c167.424 16.384 301.056 150.016 315.904 315.904h-315.904z" fill=#6c757d p-id="7336"></path></svg></a></div>
        <div id="light-dark" style="cursor: pointer;"><a><svg t="1656411842215" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5086" width="12" height="12"><path d="M1007.492874 384.513055c-8.795694-34.58307-21.189627-67.666874-36.682043-99.05151-2.698679-5.397358-10.894667-3.498287-10.894666 2.598728v0.299853c0 32.484098-6.896624 63.868734-19.890263 92.554691-10.694764 23.488501-25.487523 45.077933-43.978471 64.068635-41.779547 42.679107-99.05151 66.967217-158.722299 67.26707-61.869712 0.299853-119.941284-24.188159-162.920244-68.966238-40.280281-41.979449-62.56937-98.251902-62.269516-156.323473 0.399804-59.270984 23.588452-114.94373 65.567901-156.823229 19.59041-19.59041 42.179351-35.082826 66.667364-46.077443C672.956643 71.166451 704.041426 64.469729 736.125719 64.469729h1.299364c6.097015 0 8.096037-8.096037 2.598728-10.794715C708.739126 37.982696 675.655322 25.488812 641.172203 16.493216 599.492607 5.598549 555.714038-0.098662 510.536154 0.001289 222.37722 0.700947-7.41029 237.38508 0.185992 525.444064c7.096526 271.667008 225.889418 490.559851 497.456474 497.856279 287.559228 7.796183 524.14341-220.891864 525.842579-508.551044 0.299853-44.977981-5.297407-88.656599-15.992171-130.236244z m-83.15929 301.552378c-22.588942 53.27392-54.873137 101.250434-95.953027 142.330323-41.179841 41.179841-89.056403 73.464036-142.330324 95.953027-55.172991 23.288599-113.744317 35.182777-174.314666 35.182777s-119.141675-11.794226-174.314666-35.182777c-53.27392-22.588942-101.250434-54.873137-142.330323-95.953027-41.179841-41.179841-73.464036-89.056403-95.953027-142.330323C75.749001 630.892442 63.954774 572.221164 63.954774 511.750767s11.794226-119.141675 35.182777-174.314666c22.588942-53.27392 54.873137-101.250434 95.953027-142.330323 41.179841-41.179841 89.056403-73.464036 142.330323-95.953027C392.593892 75.7642 451.26517 63.969974 511.735567 63.969974c13.99315 0 27.886348 0.599706 41.679596 1.89907C489.246577 118.643209 448.266638 198.704016 448.266638 288.360126c0 159.022152 128.836929 287.859081 287.859081 287.859081 89.156354 0 168.817357-40.580134 221.691473-104.149015 1.099462 13.09359 1.699168 26.387082 1.699168 39.680575 0 60.470397-11.794226 119.141675-35.182776 174.314666z" p-id="5087" fill=#6c757d></path></svg></a></div>
        
    </div>

    
</div>

            <div id="toc">ğŸ“œ</div>
        
    
    
</div>
</div>
        <div id="content">












<div class="container-main 
     container-page 
">

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7409" width="12" height="12"><path d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z" p-id="7410" fill="#adb5bd"></path></svg>
            2022-05-28&nbsp;
        </span>
        <span>
            
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="23838" width="11" height="11"><path d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z" p-id="23839" fill="#adb5bd"></path></svg>
            2022-05-28&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="33866" width="12" height="12"><path d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z" fill="#adb5bd" p-id="33867"></path><path d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z" fill="#adb5bd" p-id="33868"></path></svg>
            10061 å­—</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="32892" width="12" height="12"><path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z" p-id="32893" fill="#adb5bd"></path><path d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z" p-id="32894" fill="#adb5bd"></path></svg>
            21 åˆ†é’Ÿ</span><div class="container-ctgtag">
	<div class="taxonomy">
		
		<div class="ctg">
			
			
			<a href="/categories/"></a>
			
		</div>
		<div class="tag">
			
			 - 
			
			<a href="/tags/"></a>
			
		</div>
	</div>
</div>
    </div>
    
    <div class="toc">
        
        <div class="page-operation">
            <div><a href="#"><img src="/imgs/icons/arrow-up-circle.svg" alt=""></a></div>
            <div><a href="https://lovemjh.vercel.app/posts/project-0/20220528172145/"><img src="/imgs/icons/arrow-left-circle.svg" alt=""></a></div>
            <div><a href="https://lovemjh.vercel.app/posts/project-0/20220528173393/"><img src="/imgs/icons/arrow-right-circle.svg" alt=""></a></div>
        </div>
        
        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#å­¦ä¹ ç›®æ ‡">å­¦ä¹ ç›®æ ‡</a></li>
        <li><a href="#1-ç§’æ€ä¸šåŠ¡åˆ†æ">1 ç§’æ€ä¸šåŠ¡åˆ†æ</a>
          <ul>
            <li><a href="#11-éœ€æ±‚åˆ†æ">1.1 éœ€æ±‚åˆ†æ</a></li>
            <li><a href="#12-è¡¨ç»“æ„è¯´æ˜">1.2 è¡¨ç»“æ„è¯´æ˜</a></li>
            <li><a href="#13-ç§’æ€éœ€æ±‚åˆ†æ">1.3 ç§’æ€éœ€æ±‚åˆ†æ</a></li>
          </ul>
        </li>
        <li><a href="#2-ç§’æ€å•†å“å‹å…¥ç¼“å­˜">2 ç§’æ€å•†å“å‹å…¥ç¼“å­˜</a>
          <ul>
            <li><a href="#21-ç§’æ€æœåŠ¡å·¥ç¨‹">2.1 ç§’æ€æœåŠ¡å·¥ç¨‹</a></li>
            <li><a href="#22-å®šæ—¶ä»»åŠ¡">2.2 å®šæ—¶ä»»åŠ¡</a>
              <ul>
                <li><a href="#221-å®šæ—¶ä»»åŠ¡æ–¹æ³•é…ç½®">2.2.1 å®šæ—¶ä»»åŠ¡æ–¹æ³•é…ç½®</a></li>
                <li><a href="#222-å®šæ—¶ä»»åŠ¡å¸¸ç”¨æ—¶é—´è¡¨è¾¾å¼">2.2.2 å®šæ—¶ä»»åŠ¡å¸¸ç”¨æ—¶é—´è¡¨è¾¾å¼</a></li>
              </ul>
            </li>
            <li><a href="#23-ç§’æ€å•†å“å‹å…¥ç¼“å­˜å®ç°">2.3 ç§’æ€å•†å“å‹å…¥ç¼“å­˜å®ç°</a>
              <ul>
                <li><a href="#231-æ•°æ®æ£€ç´¢æ¡ä»¶åˆ†æ">2.3.1 æ•°æ®æ£€ç´¢æ¡ä»¶åˆ†æ</a></li>
                <li><a href="#232-æ—¶é—´èœå•åˆ†æ">2.3.2 æ—¶é—´èœå•åˆ†æ</a></li>
                <li><a href="#233-æŸ¥è¯¢ç§’æ€å•†å“å¯¼å…¥reids">2.3.3 æŸ¥è¯¢ç§’æ€å•†å“å¯¼å…¥Reids</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#3-ç§’æ€é¢‘é“é¡µ">3 ç§’æ€é¢‘é“é¡µ</a>
          <ul>
            <li><a href="#31-ç§’æ€æ—¶é—´èœå•">3.1 ç§’æ€æ—¶é—´èœå•</a></li>
            <li><a href="#32-ç§’æ€é¢‘é“é¡µ">3.2 ç§’æ€é¢‘é“é¡µ</a>
              <ul>
                <li><a href="#321-ä¸šåŠ¡å±‚">3.2.1 ä¸šåŠ¡å±‚</a></li>
                <li><a href="#322-æ§åˆ¶å±‚">3.2.2 æ§åˆ¶å±‚</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#4-ç§’æ€è¯¦æƒ…é¡µ">4 ç§’æ€è¯¦æƒ…é¡µ</a>
          <ul>
            <li><a href="#41-ä¸šåŠ¡å±‚">4.1 ä¸šåŠ¡å±‚</a></li>
            <li><a href="#42-æ§åˆ¶å±‚">4.2 æ§åˆ¶å±‚</a></li>
          </ul>
        </li>
        <li><a href="#5-ä¸‹å•å®ç°">5 ä¸‹å•å®ç°</a>
          <ul>
            <li><a href="#51-ä¸šåŠ¡å±‚">5.1 ä¸šåŠ¡å±‚</a></li>
            <li><a href="#52-æ§åˆ¶å±‚">5.2 æ§åˆ¶å±‚</a></li>
            <li><a href="#53æ•´åˆgatewayç½‘å…³é…ç½®èµ„æºæœåŠ¡å™¨">5.3ã€æ•´åˆgatewayç½‘å…³ã€é…ç½®èµ„æºæœåŠ¡å™¨</a>
              <ul>
                <li><a href="#531ä¿®æ”¹é¡¹ç›®dongyimai-seckill-serviceå¼•å…¥ä¾èµ–">5.3.1ã€ä¿®æ”¹é¡¹ç›®dongyimai-seckill-serviceå¼•å…¥ä¾èµ–</a></li>
                <li><a href="#532æ‹·è´å…¬é’¥ä»¥åŠèµ„æºæœåŠ¡å™¨é…ç½®ç±»æ–‡ä»¶">5.3.2ã€æ‹·è´å…¬é’¥ã€ä»¥åŠèµ„æºæœåŠ¡å™¨é…ç½®ç±»æ–‡ä»¶</a></li>
                <li><a href="#533ä¿®æ”¹ç½‘å…³é…ç½®æ–‡ä»¶å¢åŠ ç§’æ€å¾®æœåŠ¡è½¬å‘">5.3.3ã€ä¿®æ”¹ç½‘å…³é…ç½®æ–‡ä»¶ï¼Œå¢åŠ ç§’æ€å¾®æœåŠ¡è½¬å‘</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#6-å¤šçº¿ç¨‹æŠ¢å•">6 å¤šçº¿ç¨‹æŠ¢å•</a>
          <ul>
            <li><a href="#61--å®ç°æ€è·¯åˆ†æ">6.1  å®ç°æ€è·¯åˆ†æ</a></li>
            <li><a href="#62-å¼‚æ­¥å®ç°">6.2 å¼‚æ­¥å®ç°</a></li>
            <li><a href="#63-å¤šçº¿ç¨‹æŠ¢å•">6.3 å¤šçº¿ç¨‹æŠ¢å•</a>
              <ul>
                <li><a href="#631-å¤šçº¿ç¨‹ä¸‹å•">6.3.1 å¤šçº¿ç¨‹ä¸‹å•</a></li>
                <li><a href="#632-æ’é˜Ÿä¸‹å•">6.3.2 æ’é˜Ÿä¸‹å•</a>
                  <ul>
                    <li><a href="#6321-æ’é˜Ÿä¿¡æ¯å°è£…">6.3.2.1 æ’é˜Ÿä¿¡æ¯å°è£…</a></li>
                    <li><a href="#6322-æ’é˜Ÿå®ç°">6.3.2.2 æ’é˜Ÿå®ç°</a></li>
                  </ul>
                </li>
                <li><a href="#633-ä¸‹å•çŠ¶æ€æŸ¥è¯¢">6.3.3 ä¸‹å•çŠ¶æ€æŸ¥è¯¢</a>
                  <ul>
                    <li><a href="#6331-ä¸‹å•æ›´æ–°æŠ¢å•çŠ¶æ€">6.3.3.1 ä¸‹å•æ›´æ–°æŠ¢å•çŠ¶æ€</a></li>
                    <li><a href="#6332-åå°æŸ¥è¯¢æŠ¢å•çŠ¶æ€">6.3.3.2 åå°æŸ¥è¯¢æŠ¢å•çŠ¶æ€</a></li>
                    <li><a href="#6333-æµ‹è¯•">6.3.3.3 æµ‹è¯•</a></li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
    </div>

    <div class='content  content '>
        <h1 align = "center">ç¬¬åäº”ç« </h1>
<h1 align = "center">ç§’æ€1</h1>
<h3 align="center">ä¼˜å°±ä¸š.JAVAæ•™ç ”å®¤</h3>
<h2 id="å­¦ä¹ ç›®æ ‡">å­¦ä¹ ç›®æ ‡</h2>
<ul>
<li>ç§’æ€ä¸šåŠ¡åˆ†æ</li>
<li>ç§’æ€å•†å“å‹å…¥Redisç¼“å­˜</li>
<li>Springå®šæ—¶ä»»åŠ¡äº†è§£-å®šæ—¶å°†ç§’æ€å•†å“å­˜å…¥åˆ°Redisä¸­</li>
<li>ç§’æ€å•†å“é¢‘é“é¡µå®ç°-ç§’æ€å•†å“åˆ—è¡¨é¡µ</li>
<li>ç§’æ€å•†å“è¯¦æƒ…é¡µå®ç°</li>
<li>ä¸‹å•å®ç°(æ™®é€šä¸‹å•)</li>
<li>å¤šçº¿ç¨‹å¼‚æ­¥æŠ¢å•å®ç°-é˜Ÿåˆ—å‰Šå³°</li>
</ul>
<h2 id="1-ç§’æ€ä¸šåŠ¡åˆ†æ">1 ç§’æ€ä¸šåŠ¡åˆ†æ</h2>
<h3 id="11-éœ€æ±‚åˆ†æ">1.1 éœ€æ±‚åˆ†æ</h3>
<p>æ‰€è°“â€œç§’æ€â€ï¼Œå°±æ˜¯ç½‘ç»œå–å®¶å‘å¸ƒä¸€äº›è¶…ä½ä»·æ ¼çš„å•†å“ï¼Œæ‰€æœ‰ä¹°å®¶åœ¨åŒä¸€æ—¶é—´ç½‘ä¸ŠæŠ¢è´­çš„ä¸€ç§é”€å”®æ–¹å¼ã€‚é€šä¿—ä¸€ç‚¹è®²å°±æ˜¯ç½‘ç»œå•†å®¶ä¸ºä¿ƒé”€ç­‰ç›®çš„ç»„ç»‡çš„ç½‘ä¸Šé™æ—¶æŠ¢è´­æ´»åŠ¨ã€‚ç”±äºå•†å“ä»·æ ¼ä½å»‰ï¼Œå¾€å¾€ä¸€ä¸Šæ¶å°±è¢«æŠ¢è´­ä¸€ç©ºï¼Œæœ‰æ—¶åªç”¨ä¸€ç§’é’Ÿã€‚</p>
<p>ç§’æ€å•†å“é€šå¸¸æœ‰ä¸¤ç§é™åˆ¶ï¼šåº“å­˜é™åˆ¶ã€æ—¶é—´é™åˆ¶ã€‚</p>
<p>éœ€æ±‚ï¼š</p>
<pre tabindex="0"><code class="language-properties" data-lang="properties">ï¼ˆ1ï¼‰å½•å…¥ç§’æ€å•†å“æ•°æ®ï¼Œä¸»è¦åŒ…æ‹¬ï¼šå•†å“æ ‡é¢˜ã€åŸä»·ã€ç§’æ€ä»·ã€å•†å“å›¾ç‰‡ã€ä»‹ç»ã€ç§’æ€æ—¶æ®µç­‰ä¿¡æ¯
ï¼ˆ2ï¼‰ç§’æ€é¢‘é“é¦–é¡µåˆ—å‡ºç§’æ€å•†å“ï¼ˆè¿›è¡Œä¸­çš„ï¼‰ç‚¹å‡»ç§’æ€å•†å“å›¾ç‰‡è·³è½¬åˆ°ç§’æ€å•†å“è¯¦ç»†é¡µã€‚
ï¼ˆ3ï¼‰å•†å“è¯¦ç»†é¡µæ˜¾ç¤ºç§’æ€å•†å“ä¿¡æ¯ï¼Œç‚¹å‡»ç«‹å³æŠ¢è´­å®ç°ç§’æ€ä¸‹å•ï¼Œä¸‹å•æ—¶æ‰£å‡åº“å­˜ã€‚å½“åº“å­˜ä¸º0æˆ–ä¸åœ¨æ´»åŠ¨æœŸèŒƒå›´å†…æ—¶æ— æ³•ç§’æ€ã€‚
ï¼ˆ4ï¼‰ç§’æ€ä¸‹å•æˆåŠŸï¼Œç›´æ¥è·³è½¬åˆ°æ”¯ä»˜é¡µé¢ï¼ˆæ‰«ç ï¼‰ï¼Œæ”¯ä»˜æˆåŠŸï¼Œè·³è½¬åˆ°æˆåŠŸé¡µï¼Œå¡«å†™æ”¶è´§åœ°å€ã€ç”µè¯ã€æ”¶ä»¶äººç­‰ä¿¡æ¯ï¼Œå®Œæˆè®¢å•ã€‚
ï¼ˆ5ï¼‰å½“ç”¨æˆ·ç§’æ€ä¸‹å•5åˆ†é’Ÿå†…æœªæ”¯ä»˜ï¼Œå–æ¶ˆé¢„è®¢å•ï¼Œè°ƒç”¨æ”¯ä»˜çš„å…³é—­è®¢å•æ¥å£ï¼Œæ¢å¤åº“å­˜ã€‚
</code></pre><h3 id="12-è¡¨ç»“æ„è¯´æ˜">1.2 è¡¨ç»“æ„è¯´æ˜</h3>
<p><strong>ç§’æ€å•†å“ä¿¡æ¯è¡¨</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">CREATE</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">TABLE</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">`</span>tb_seckill_goods<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">`</span>id<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span><span style="color:#0086b3">bigint</span>(<span style="color:#099">20</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NOT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb"> </span>AUTO_INCREMENT,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">`</span>goods_id<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span><span style="color:#0086b3">bigint</span>(<span style="color:#099">20</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">COMMENT</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;spu ID&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">`</span>item_id<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span><span style="color:#0086b3">bigint</span>(<span style="color:#099">20</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">COMMENT</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;sku ID&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">`</span>title<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span><span style="color:#0086b3">varchar</span>(<span style="color:#099">100</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">COMMENT</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;æ ‡é¢˜&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">`</span>small_pic<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span><span style="color:#0086b3">varchar</span>(<span style="color:#099">150</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">COMMENT</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;å•†å“å›¾ç‰‡&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">`</span>price<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span><span style="color:#0086b3">decimal</span>(<span style="color:#099">10</span>,<span style="color:#099">2</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">COMMENT</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;åŸä»·æ ¼&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">`</span>cost_price<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span><span style="color:#0086b3">decimal</span>(<span style="color:#099">10</span>,<span style="color:#099">2</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">COMMENT</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;ç§’æ€ä»·æ ¼&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">`</span>create_time<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span>datetime<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">COMMENT</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;æ·»åŠ æ—¥æœŸ&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">`</span>check_time<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span>datetime<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">COMMENT</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;å®¡æ ¸æ—¥æœŸ&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">`</span>status<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span><span style="color:#0086b3">char</span>(<span style="color:#099">1</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">COMMENT</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;å®¡æ ¸çŠ¶æ€ï¼Œ0æœªå®¡æ ¸ï¼Œ1å®¡æ ¸é€šè¿‡ï¼Œ2å®¡æ ¸ä¸é€šè¿‡&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">`</span>start_time<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span>datetime<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">COMMENT</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;å¼€å§‹æ—¶é—´&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">`</span>end_time<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span>datetime<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">COMMENT</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;ç»“æŸæ—¶é—´&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">`</span>num<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span><span style="color:#0086b3">int</span>(<span style="color:#099">11</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">COMMENT</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;ç§’æ€å•†å“æ•°&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">`</span>stock_count<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span><span style="color:#0086b3">int</span>(<span style="color:#099">11</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">COMMENT</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;å‰©ä½™åº“å­˜æ•°&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">`</span>introduction<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span><span style="color:#0086b3">varchar</span>(<span style="color:#099">2000</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">COMMENT</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;æè¿°&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">PRIMARY</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">KEY</span><span style="color:#bbb"> </span>(<span style="color:#000;font-weight:bold">`</span>id<span style="color:#000;font-weight:bold">`</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>)<span style="color:#bbb"> </span>ENGINE<span style="color:#000;font-weight:bold">=</span>InnoDB<span style="color:#bbb"> </span>AUTO_INCREMENT<span style="color:#000;font-weight:bold">=</span><span style="color:#099">1</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span>CHARSET<span style="color:#000;font-weight:bold">=</span>utf8;<span style="color:#bbb">
</span></span></span></code></pre></div><p><strong>ç§’æ€è®¢å•è¡¨</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">CREATE</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">TABLE</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">`</span>tb_seckill_order<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">`</span>id<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span><span style="color:#0086b3">bigint</span>(<span style="color:#099">20</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NOT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">COMMENT</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;ä¸»é”®&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">`</span>seckill_id<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span><span style="color:#0086b3">bigint</span>(<span style="color:#099">20</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">COMMENT</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;ç§’æ€å•†å“ID&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">`</span>money<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span><span style="color:#0086b3">decimal</span>(<span style="color:#099">10</span>,<span style="color:#099">2</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">COMMENT</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;æ”¯ä»˜é‡‘é¢&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">`</span>user_id<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span><span style="color:#0086b3">varchar</span>(<span style="color:#099">50</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">COMMENT</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;ç”¨æˆ·&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">`</span>create_time<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span>datetime<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">COMMENT</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;åˆ›å»ºæ—¶é—´&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">`</span>pay_time<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span>datetime<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">COMMENT</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;æ”¯ä»˜æ—¶é—´&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">`</span>status<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span><span style="color:#0086b3">char</span>(<span style="color:#099">1</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">COMMENT</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;çŠ¶æ€ï¼Œ0æœªæ”¯ä»˜ï¼Œ1å·²æ”¯ä»˜&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">`</span>receiver_address<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span><span style="color:#0086b3">varchar</span>(<span style="color:#099">200</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">COMMENT</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;æ”¶è´§äººåœ°å€&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">`</span>receiver_mobile<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span><span style="color:#0086b3">varchar</span>(<span style="color:#099">20</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">COMMENT</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;æ”¶è´§äººç”µè¯&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">`</span>receiver<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span><span style="color:#0086b3">varchar</span>(<span style="color:#099">20</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">COMMENT</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;æ”¶è´§äºº&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">`</span>transaction_id<span style="color:#000;font-weight:bold">`</span><span style="color:#bbb"> </span><span style="color:#0086b3">varchar</span>(<span style="color:#099">30</span>)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">NULL</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">COMMENT</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;äº¤æ˜“æµæ°´&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000;font-weight:bold">PRIMARY</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">KEY</span><span style="color:#bbb"> </span>(<span style="color:#000;font-weight:bold">`</span>id<span style="color:#000;font-weight:bold">`</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>)<span style="color:#bbb"> </span>ENGINE<span style="color:#000;font-weight:bold">=</span>InnoDB<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span>CHARSET<span style="color:#000;font-weight:bold">=</span>utf8;<span style="color:#bbb">
</span></span></span></code></pre></div><h3 id="13-ç§’æ€éœ€æ±‚åˆ†æ">1.3 ç§’æ€éœ€æ±‚åˆ†æ</h3>
<p>ç§’æ€æŠ€æœ¯å®ç°æ ¸å¿ƒæ€æƒ³æ˜¯è¿ç”¨ç¼“å­˜å‡å°‘æ•°æ®åº“ç¬é—´çš„è®¿é—®å‹åŠ›ï¼è¯»å–å•†å“è¯¦ç»†ä¿¡æ¯æ—¶è¿ç”¨ç¼“å­˜ï¼Œå½“ç”¨æˆ·ç‚¹å‡»æŠ¢è´­æ—¶å‡å°‘ç¼“å­˜ä¸­çš„åº“å­˜æ•°é‡ï¼Œå½“åº“å­˜æ•°ä¸º0æ—¶æˆ–æ´»åŠ¨æœŸç»“æŸæ—¶ï¼ŒåŒæ­¥åˆ°æ•°æ®åº“ã€‚ äº§ç”Ÿçš„ç§’æ€é¢„è®¢å•ä¹Ÿä¸ä¼šç«‹åˆ»å†™åˆ°æ•°æ®åº“ä¸­ï¼Œè€Œæ˜¯å…ˆå†™åˆ°ç¼“å­˜ï¼Œå½“ç”¨æˆ·ä»˜æ¬¾æˆåŠŸåå†å†™å…¥æ•°æ®åº“ã€‚</p>
<p>å½“ç„¶ï¼Œä¸Šé¢å®ç°çš„æ€è·¯åªæ˜¯ä¸€ç§æœ€ç®€å•çš„æ–¹å¼ï¼Œå¹¶æœªè€ƒè™‘å…¶ä¸­ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚å¹¶å‘çŠ¶å†µå®¹æ˜“äº§ç”Ÿçš„é—®é¢˜ã€‚æˆ‘ä»¬çœ‹çœ‹ä¸‹é¢è¿™å¼ æ€è·¯æ›´ä¸¥è°¨çš„å›¾ï¼š
<img src="/posts/project-0/20220528172837/image-20220528172937147.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="2-ç§’æ€å•†å“å‹å…¥ç¼“å­˜">2 ç§’æ€å•†å“å‹å…¥ç¼“å­˜</h2>
<p><img src="/posts/project-0/20220528172837/image-20220528172946667.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>æˆ‘ä»¬è¿™é‡Œç§’æ€å•†å“åˆ—è¡¨å’Œç§’æ€å•†å“è¯¦æƒ…éƒ½æ˜¯ä»Redisä¸­å–å‡ºæ¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆè¦å°†ç¬¦åˆå‚ä¸ç§’æ€çš„å•†å“å®šæ—¶æŸ¥è¯¢å‡ºæ¥ï¼Œå¹¶å°†æ•°æ®å­˜å…¥åˆ°Redisç¼“å­˜ä¸­ã€‚</p>
<p>æ•°æ®å­˜å‚¨ç±»å‹æˆ‘ä»¬å¯ä»¥é€‰æ‹©Hashç±»å‹ã€‚</p>
<p>ç§’æ€åˆ†é¡µåˆ—è¡¨è¿™é‡Œå¯ä»¥é€šè¿‡è·å–redisTemplate.boundHashOps(key).values()è·å–ç»“æœæ•°æ®ã€‚</p>
<p>ç§’æ€å•†å“è¯¦æƒ…ï¼Œå¯ä»¥é€šè¿‡redisTemplate.boundHashOps(key).get(key)è·å–è¯¦æƒ…ã€‚</p>
<h3 id="21-ç§’æ€æœåŠ¡å·¥ç¨‹">2.1 ç§’æ€æœåŠ¡å·¥ç¨‹</h3>
<p>æˆ‘ä»¬å°†å•†å“æ•°æ®å‹å…¥åˆ°Reidsç¼“å­˜ï¼Œå¯ä»¥åœ¨ç§’æ€å·¥ç¨‹çš„æœåŠ¡å·¥ç¨‹ä¸­å®Œæˆï¼Œå¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤å®ç°ï¼š</p>
<pre tabindex="0"><code class="language-properties" data-lang="properties">1.æŸ¥è¯¢æ´»åŠ¨æ²¡ç»“æŸçš„æ‰€æœ‰ç§’æ€å•†å“
	1)çŠ¶æ€å¿…é¡»ä¸ºå®¡æ ¸é€šè¿‡ status=1
	2)å•†å“åº“å­˜ä¸ªæ•°&gt;0
	3)æ´»åŠ¨æ²¡æœ‰ç»“æŸ  endTime&gt;=now()
	4)åœ¨Redisä¸­æ²¡æœ‰è¯¥å•†å“çš„ç¼“å­˜
	5)æ‰§è¡ŒæŸ¥è¯¢è·å–å¯¹åº”çš„ç»“æœé›†
2.å°†æ´»åŠ¨æ²¡æœ‰ç»“æŸçš„ç§’æ€å•†å“å…¥åº“
</code></pre><p>æˆ‘ä»¬é¦–å…ˆæ­å»ºä¸€ä¸ªç§’æ€æœåŠ¡å·¥ç¨‹ï¼Œç„¶åæŒ‰ç…§ä¸Šé¢æ­¥éª¤å®ç°ã€‚</p>
<p>æ­å»ºdongyimai-seckill-serviceï¼Œä½œä¸ºç§’æ€å·¥ç¨‹çš„æœåŠ¡æä¾›å·¥ç¨‹ã€‚</p>
<p>(1)pom.xmlä¾èµ–</p>
<p>pom.xml</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;project</span> <span style="color:#008080">xmlns=</span><span style="color:#d14">&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#008080">xmlns:xsi=</span><span style="color:#d14">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#008080">xsi:schemaLocation=</span><span style="color:#d14">&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;parent&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>dongyimai-service<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>com.offcn<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>1.0<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/parent&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;modelVersion&gt;</span>4.0.0<span style="color:#000080">&lt;/modelVersion&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;artifactId&gt;</span>dongyimai-seckill-service<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;properties&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;maven.compiler.source&gt;</span>8<span style="color:#000080">&lt;/maven.compiler.source&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;maven.compiler.target&gt;</span>8<span style="color:#000080">&lt;/maven.compiler.target&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/properties&gt;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependencies&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;groupId&gt;</span>com.offcn<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;artifactId&gt;</span>dongyimai-seckill-service-api<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;version&gt;</span>1.0<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependencies&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/project&gt;</span>
</span></span></code></pre></div><p>(2) application.ymlé…ç½®</p>
<pre tabindex="0"><code class="language-properties" data-lang="properties">server:
  port: 9005
spring:
  application:
    name: seckill
  datasource:
    driver-class-name: com.mysql.jdbc.Driver
    url: jdbc:mysql://192.168.188.1:3306/dongyimaidb?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=UTC
    username: root
    password: root
  rabbitmq:
    host: 192.168.188.128 #mqçš„æœåŠ¡å™¨åœ°å€
    username: guest #è´¦å·
    password: guest #å¯†ç 
  main:
    allow-bean-definition-overriding: true
eureka:
  client:
    service-url:
      defaultZone: http://127.0.0.1:8761/eureka
  instance:
    prefer-ip-address: true
feign:
  hystrix:
    enabled: true
#hystrix é…ç½®
hystrix:
  command:
    default:
      execution:
        timeout:
        #å¦‚æœenabledè®¾ç½®ä¸ºfalseï¼Œåˆ™è¯·æ±‚è¶…æ—¶äº¤ç»™ribbonæ§åˆ¶
          enabled: true
        isolation:
          thread:
            timeoutInMilliseconds: 10000
          strategy: SEMAPHORE
</code></pre><p>(3) å¯¼å…¥ç”Ÿæˆæ–‡ä»¶</p>
<p>å°†ç”Ÿæˆçš„Daoæ–‡ä»¶å’ŒPojoæ–‡ä»¶å¯¼å…¥åˆ°å·¥ç¨‹ä¸­ï¼Œå¦‚ä¸‹å›¾ï¼š
<img src="/posts/project-0/20220528172837/image-20220528173005196.png"
    
    
    
    loading="lazy"
    
    
></p>
<p><img src="/posts/project-0/20220528172837/image-20220528173010133.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>(4) å¯åŠ¨ç±»é…ç½®</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@SpringBootApplication</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@EnableEurekaClient</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@EnableFeignClients</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@MapperScan</span><span style="color:#000;font-weight:bold">(</span>basePackages <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#d14">&#34;com.offcn.seckill.dao&#34;</span><span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@EnableScheduling</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">SeckillApplication</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        SpringApplication<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">run</span><span style="color:#000;font-weight:bold">(</span>SeckillApplication<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span>args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> IdWorker <span style="color:#900;font-weight:bold">idWorker</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">new</span> IdWorker<span style="color:#000;font-weight:bold">(</span>1<span style="color:#000;font-weight:bold">,</span>1<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="22-å®šæ—¶ä»»åŠ¡">2.2 å®šæ—¶ä»»åŠ¡</h3>
<p>ä¸€ä¼šå„¿æˆ‘ä»¬é‡‡ç”¨Springçš„å®šæ—¶ä»»åŠ¡å®šæ—¶å°†ç¬¦åˆå‚ä¸ç§’æ€çš„å•†å“æŸ¥è¯¢å‡ºæ¥å†å­˜å…¥åˆ°Redisç¼“å­˜ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦ä½¿ç”¨åˆ°å®šæ—¶ä»»åŠ¡ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬äº†è§£ä¸‹å®šæ—¶ä»»åŠ¡ç›¸å…³çš„é…ç½®,é…ç½®æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code class="language-properties" data-lang="properties">1)åœ¨å®šæ—¶ä»»åŠ¡ç±»çš„æŒ‡å®šæ–¹æ³•ä¸ŠåŠ ä¸Š@Scheduledå¼€å¯å®šæ—¶ä»»åŠ¡
2)å®šæ—¶ä»»åŠ¡è¡¨è¾¾å¼ï¼šä½¿ç”¨cronå±æ€§æ¥é…ç½®å®šæ—¶ä»»åŠ¡æ‰§è¡Œæ—¶é—´
</code></pre><h4 id="221-å®šæ—¶ä»»åŠ¡æ–¹æ³•é…ç½®">2.2.1 å®šæ—¶ä»»åŠ¡æ–¹æ³•é…ç½®</h4>
<p>åˆ›å»ºcom.offcn.seckill.timer.SeckillGoodsPushTaskç±»ï¼Œå¹¶åœ¨ç±»ä¸­åŠ ä¸Šå®šæ—¶ä»»åŠ¡æ‰§è¡Œæ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">SeckillGoodsPushTask</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/****
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * æ¯30ç§’æ‰§è¡Œä¸€æ¬¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Scheduled</span><span style="color:#000;font-weight:bold">(</span>cron <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;0/30 * * * * *&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">loadGoodsPushRedis</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;task demo&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="222-å®šæ—¶ä»»åŠ¡å¸¸ç”¨æ—¶é—´è¡¨è¾¾å¼">2.2.2 å®šæ—¶ä»»åŠ¡å¸¸ç”¨æ—¶é—´è¡¨è¾¾å¼</h4>
<p>CronTriggeré…ç½®å®Œæ•´æ ¼å¼ä¸ºï¼š [ç§’][åˆ†] [å°æ—¶][æ—¥] [æœˆ][å‘¨] [å¹´]</p>
<table>
<thead>
<tr>
<th>åºå·</th>
<th>è¯´æ˜</th>
<th>æ˜¯å¦å¿…å¡«</th>
<th>å…è®¸å¡«å†™çš„å€¼</th>
<th>å…è®¸çš„é€šé…ç¬¦</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>ç§’</td>
<td>æ˜¯</td>
<td>0-59</td>
<td>, - * /</td>
</tr>
<tr>
<td>2</td>
<td>åˆ†</td>
<td>æ˜¯</td>
<td>0-59</td>
<td>, - * /</td>
</tr>
<tr>
<td>3</td>
<td>å°æ—¶</td>
<td>æ˜¯</td>
<td>0-23</td>
<td>, - * /</td>
</tr>
<tr>
<td>4</td>
<td>æ—¥</td>
<td>æ˜¯</td>
<td>1-31</td>
<td>, - * ? / L W</td>
</tr>
<tr>
<td>5</td>
<td>æœˆ</td>
<td>æ˜¯</td>
<td>1-12æˆ–JAN-DEC</td>
<td>, - * /</td>
</tr>
<tr>
<td>6</td>
<td>å‘¨</td>
<td>æ˜¯</td>
<td>1-7æˆ–SUN-SAT</td>
<td>, - * ? / L W</td>
</tr>
<tr>
<td>7</td>
<td>å¹´</td>
<td>å¦</td>
<td>empty æˆ–1970-2099</td>
<td>, - * /</td>
</tr>
</tbody>
</table>
<p>ä½¿ç”¨è¯´æ˜ï¼š</p>
<pre tabindex="0"><code class="language-properties" data-lang="properties">é€šé…ç¬¦è¯´æ˜:
* è¡¨ç¤ºæ‰€æœ‰å€¼. ä¾‹å¦‚:åœ¨åˆ†çš„å­—æ®µä¸Šè®¾ç½® &#34;*&#34;,è¡¨ç¤ºæ¯ä¸€åˆ†é’Ÿéƒ½ä¼šè§¦å‘ã€‚

? è¡¨ç¤ºä¸æŒ‡å®šå€¼ã€‚ä½¿ç”¨çš„åœºæ™¯ä¸ºä¸éœ€è¦å…³å¿ƒå½“å‰è®¾ç½®è¿™ä¸ªå­—æ®µçš„å€¼ã€‚

ä¾‹å¦‚:è¦åœ¨æ¯æœˆçš„10å·è§¦å‘ä¸€ä¸ªæ“ä½œï¼Œä½†ä¸å…³å¿ƒæ˜¯å‘¨å‡ ï¼Œæ‰€ä»¥éœ€è¦å‘¨ä½ç½®çš„é‚£ä¸ªå­—æ®µè®¾ç½®ä¸º&#34;?&#34; å…·ä½“è®¾ç½®ä¸º 0 0 0 10 * ?

- è¡¨ç¤ºåŒºé—´ã€‚ä¾‹å¦‚ åœ¨å°æ—¶ä¸Šè®¾ç½® &#34;10-12&#34;,è¡¨ç¤º 10,11,12ç‚¹éƒ½ä¼šè§¦å‘ã€‚

, è¡¨ç¤ºæŒ‡å®šå¤šä¸ªå€¼ï¼Œä¾‹å¦‚åœ¨å‘¨å­—æ®µä¸Šè®¾ç½® &#34;MON,WED,FRI&#34; è¡¨ç¤ºå‘¨ä¸€ï¼Œå‘¨ä¸‰å’Œå‘¨äº”è§¦å‘  12,14,19

/ ç”¨äºé€’å¢è§¦å‘ã€‚å¦‚åœ¨ç§’ä¸Šé¢è®¾ç½®&#34;5/15&#34; è¡¨ç¤ºä»5ç§’å¼€å§‹ï¼Œæ¯å¢15ç§’è§¦å‘(5,20,35,50)ã€‚ åœ¨æœˆå­—æ®µä¸Šè®¾ç½®&#39;1/3&#39;æ‰€ç¤ºæ¯æœˆ1å·å¼€å§‹ï¼Œæ¯éš”ä¸‰å¤©è§¦å‘ä¸€æ¬¡ã€‚

L è¡¨ç¤ºæœ€åçš„æ„æ€ã€‚åœ¨æ—¥å­—æ®µè®¾ç½®ä¸Šï¼Œè¡¨ç¤ºå½“æœˆçš„æœ€åä¸€å¤©(ä¾æ®å½“å‰æœˆä»½ï¼Œå¦‚æœæ˜¯äºŒæœˆè¿˜ä¼šä¾æ®æ˜¯å¦æ˜¯æ¶¦å¹´[leap]), åœ¨å‘¨å­—æ®µä¸Šè¡¨ç¤ºæ˜ŸæœŸå…­ï¼Œç›¸å½“äº&#34;7&#34;æˆ–&#34;SAT&#34;ã€‚å¦‚æœåœ¨&#34;L&#34;å‰åŠ ä¸Šæ•°å­—ï¼Œåˆ™è¡¨ç¤ºè¯¥æ•°æ®çš„æœ€åä¸€ä¸ªã€‚ä¾‹å¦‚åœ¨å‘¨å­—æ®µä¸Šè®¾ç½®&#34;6L&#34;è¿™æ ·çš„æ ¼å¼,åˆ™è¡¨ç¤ºâ€œæœ¬æœˆæœ€åä¸€ä¸ªæ˜ŸæœŸäº”&#34;

W è¡¨ç¤ºç¦»æŒ‡å®šæ—¥æœŸçš„æœ€è¿‘é‚£ä¸ªå·¥ä½œæ—¥(å‘¨ä¸€è‡³å‘¨äº”). ä¾‹å¦‚åœ¨æ—¥å­—æ®µä¸Šè®¾ç½®&#34;15W&#34;ï¼Œè¡¨ç¤ºç¦»æ¯æœˆ15å·æœ€è¿‘çš„é‚£ä¸ªå·¥ä½œæ—¥è§¦å‘ã€‚å¦‚æœ15å·æ­£å¥½æ˜¯å‘¨å…­ï¼Œåˆ™æ‰¾æœ€è¿‘çš„å‘¨äº”(14å·)è§¦å‘, å¦‚æœ15å·æ˜¯å‘¨æœªï¼Œåˆ™æ‰¾æœ€è¿‘çš„ä¸‹å‘¨ä¸€(16å·)è§¦å‘.å¦‚æœ15å·æ­£å¥½åœ¨å·¥ä½œæ—¥(å‘¨ä¸€è‡³å‘¨äº”)ï¼Œåˆ™å°±åœ¨è¯¥å¤©è§¦å‘ã€‚å¦‚æœæŒ‡å®šæ ¼å¼ä¸º &#34;1W&#34;,å®ƒåˆ™è¡¨ç¤ºæ¯æœˆ1å·å¾€åæœ€è¿‘çš„å·¥ä½œæ—¥è§¦å‘ã€‚å¦‚æœ1å·æ­£æ˜¯å‘¨å…­ï¼Œåˆ™å°†åœ¨3å·ä¸‹å‘¨ä¸€è§¦å‘ã€‚(æ³¨ï¼Œ&#34;W&#34;å‰åªèƒ½è®¾ç½®å…·ä½“çš„æ•°å­—,ä¸å…è®¸åŒºé—´&#34;-&#34;).

# åºå·(è¡¨ç¤ºæ¯æœˆçš„ç¬¬å‡ ä¸ªå‘¨å‡ )ï¼Œä¾‹å¦‚åœ¨å‘¨å­—æ®µä¸Šè®¾ç½®&#34;6#3&#34;è¡¨ç¤ºåœ¨æ¯æœˆçš„ç¬¬ä¸‰ä¸ªå‘¨å…­.æ³¨æ„å¦‚æœæŒ‡å®š&#34;#5&#34;,æ­£å¥½ç¬¬äº”å‘¨æ²¡æœ‰å‘¨å…­ï¼Œåˆ™ä¸ä¼šè§¦å‘è¯¥é…ç½®(ç”¨åœ¨æ¯äº²èŠ‚å’Œçˆ¶äº²èŠ‚å†åˆé€‚ä¸è¿‡äº†) ï¼›
</code></pre><p>å¸¸ç”¨è¡¨è¾¾å¼</p>
<pre tabindex="0"><code class="language-properties" data-lang="properties">0 0 10,14,16 * * ? æ¯å¤©ä¸Šåˆ10ç‚¹ï¼Œä¸‹åˆ2ç‚¹ï¼Œ4ç‚¹ 
0 0/30 9-17 * * ? æœä¹æ™šäº”å·¥ä½œæ—¶é—´å†…æ¯åŠå°æ—¶ 
0 0 12 ? * WED è¡¨ç¤ºæ¯ä¸ªæ˜ŸæœŸä¸‰ä¸­åˆ12ç‚¹ 
&#34;0 0 12 * * ?&#34; æ¯å¤©ä¸­åˆ12ç‚¹è§¦å‘ 
&#34;0 15 10 ? * *&#34; æ¯å¤©ä¸Šåˆ10:15è§¦å‘ 
&#34;0 15 10 * * ?&#34; æ¯å¤©ä¸Šåˆ10:15è§¦å‘ 
&#34;0 15 10 * * ? *&#34; æ¯å¤©ä¸Šåˆ10:15è§¦å‘ 
&#34;0 15 10 * * ? 2005&#34; 2005å¹´çš„æ¯å¤©ä¸Šåˆ10:15è§¦å‘ 
&#34;0 * 14 * * ?&#34; åœ¨æ¯å¤©ä¸‹åˆ2ç‚¹åˆ°ä¸‹åˆ2:59æœŸé—´çš„æ¯1åˆ†é’Ÿè§¦å‘ 
&#34;0 0/5 14 * * ?&#34; åœ¨æ¯å¤©ä¸‹åˆ2ç‚¹åˆ°ä¸‹åˆ2:55æœŸé—´çš„æ¯5åˆ†é’Ÿè§¦å‘ 
&#34;0 0/5 14,18 * * ?&#34; åœ¨æ¯å¤©ä¸‹åˆ2ç‚¹åˆ°2:55æœŸé—´å’Œä¸‹åˆ6ç‚¹åˆ°6:55æœŸé—´çš„æ¯5åˆ†é’Ÿè§¦å‘ 
&#34;0 0-5 14 * * ?&#34; åœ¨æ¯å¤©ä¸‹åˆ2ç‚¹åˆ°ä¸‹åˆ2:05æœŸé—´çš„æ¯1åˆ†é’Ÿè§¦å‘ 
&#34;0 10,44 14 ? 3 WED&#34; æ¯å¹´ä¸‰æœˆçš„æ˜ŸæœŸä¸‰çš„ä¸‹åˆ2:10å’Œ2:44è§¦å‘ 
&#34;0 15 10 ? * MON-FRI&#34; å‘¨ä¸€è‡³å‘¨äº”çš„ä¸Šåˆ10:15è§¦å‘ 
&#34;0 15 10 15 * ?&#34; æ¯æœˆ15æ—¥ä¸Šåˆ10:15è§¦å‘ 
&#34;0 15 10 L * ?&#34; æ¯æœˆæœ€åä¸€æ—¥çš„ä¸Šåˆ10:15è§¦å‘ 
&#34;0 15 10 ? * 6L&#34; æ¯æœˆçš„æœ€åä¸€ä¸ªæ˜ŸæœŸäº”ä¸Šåˆ10:15è§¦å‘ 
&#34;0 15 10 ? * 6L 2002-2005&#34; 2002å¹´è‡³2005å¹´çš„æ¯æœˆçš„æœ€åä¸€ä¸ªæ˜ŸæœŸäº”ä¸Šåˆ10:15è§¦å‘ 
&#34;0 15 10 ? * 6#3&#34; æ¯æœˆçš„ç¬¬ä¸‰ä¸ªæ˜ŸæœŸäº”ä¸Šåˆ10:15è§¦å‘
</code></pre><h3 id="23-ç§’æ€å•†å“å‹å…¥ç¼“å­˜å®ç°">2.3 ç§’æ€å•†å“å‹å…¥ç¼“å­˜å®ç°</h3>
<h4 id="231-æ•°æ®æ£€ç´¢æ¡ä»¶åˆ†æ">2.3.1 æ•°æ®æ£€ç´¢æ¡ä»¶åˆ†æ</h4>
<p>æŒ‰ç…§2.1ä¸­çš„å‡ ä¸ªæ­¥éª¤å®ç°å°†ç§’æ€å•†å“ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ¥ï¼Œå¹¶å­˜å…¥åˆ°Redisç¼“å­˜</p>
<pre tabindex="0"><code class="language-properties" data-lang="properties">1.æŸ¥è¯¢æ´»åŠ¨æ²¡ç»“æŸçš„æ‰€æœ‰ç§’æ€å•†å“
	1)è®¡ç®—ç§’æ€æ—¶é—´æ®µ
	2)çŠ¶æ€å¿…é¡»ä¸ºå®¡æ ¸é€šè¿‡ status=1
	3)å•†å“åº“å­˜ä¸ªæ•°&gt;0
	4)æ´»åŠ¨æ²¡æœ‰ç»“æŸ  endTime&gt;now()
	5)åœ¨Redisä¸­æ²¡æœ‰è¯¥å•†å“çš„ç¼“å­˜
	6)æ‰§è¡ŒæŸ¥è¯¢è·å–å¯¹åº”çš„ç»“æœé›†
2.å°†æ´»åŠ¨æ²¡æœ‰ç»“æŸçš„ç§’æ€å•†å“å…¥åº“
</code></pre><p>ä¸Šé¢è¿™é‡Œä¼šæ¶‰åŠåˆ°æ—¶é—´æ“ä½œï¼Œæ‰€ä»¥è¿™é‡Œæå‰å‡†å¤‡äº†ä¸€ä¸ªæ—¶é—´å·¥å…·åŒ…DateUtilã€‚</p>
<h4 id="232-æ—¶é—´èœå•åˆ†æ">2.3.2 æ—¶é—´èœå•åˆ†æ</h4>
<p><img src="/posts/project-0/20220528172837/image-20220528173024909.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>æˆ‘ä»¬å°†å•†å“æ•°æ®ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ¥ï¼Œå¹¶å­˜å…¥Redisç¼“å­˜ï¼Œä½†é¡µé¢æ¯æ¬¡æ˜¾ç¤ºçš„æ—¶å€™ï¼Œåªæ˜¾ç¤ºå½“å‰æ­£åœ¨ç§’æ€ä»¥åŠå¾€åå»¶æ—¶2ä¸ªå°æ—¶ã€4ä¸ªå°æ—¶ã€6ä¸ªå°æ—¶ã€8ä¸ªå°æ—¶çš„ç§’æ€å•†å“æ•°æ®ã€‚æˆ‘ä»¬è¦åšçš„ç¬¬ä¸€ä¸ªäº‹æ˜¯è®¡ç®—å‡ºç§’æ€æ—¶é—´èœå•ï¼Œè¿™ä¸ªèœå•æ˜¯ä»åå°è·å–çš„ã€‚</p>
<p>è¿™ä¸ªæ—¶é—´èœå•çš„è®¡ç®—æˆ‘ä»¬æ¥åˆ†æä¸‹ï¼Œå¯ä»¥å…ˆæ±‚å‡ºå½“å‰æ—¶é—´çš„å‡Œæ™¨ï¼Œç„¶åæ¯2ä¸ªå°æ—¶åä½œä¸ºä¸‹ä¸€ä¸ªæŠ¢è´­çš„å¼€å§‹æ—¶é—´ï¼Œè¿™æ ·å¯ä»¥åˆ†å‡º12ä¸ªæŠ¢è´­æ—¶é—´æ®µ,å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code class="language-properties" data-lang="properties">00:00-02:00
02:00-04:00
04:00-06:00
06:00-08:00
08:00-10:00
10:00-12:00
12:00-14:00
14:00-16:00
16:00-18:00
18:00-20:00
20:00-22:00
22:00-00:00
</code></pre><p>è€Œç°å®çš„èœå•åªéœ€è¦è®¡ç®—å‡ºå½“å‰æ—¶é—´åœ¨å“ªä¸ªæ—¶é—´æ®µèŒƒå›´ï¼Œè¯¥æ—¶é—´æ®µèŒƒå›´å°±å±äºæ­£åœ¨ç§’æ€çš„æ—¶é—´æ®µï¼Œè€Œåé¢å³å°†å¼€å§‹çš„ç§’æ€æ—¶é—´æ®µçš„è®¡ç®—ä¹Ÿå°±å‡ºæ¥äº†ï¼Œå¯ä»¥åœ¨å½“å‰æ—¶é—´æ®µåŸºç¡€ä¹‹ä¸Š+2å°æ—¶ã€+4å°æ—¶ã€+6å°æ—¶ã€+8å°æ—¶ã€‚</p>
<p>å…³äºæ—¶é—´èœå•çš„è¿ç®—ï¼Œåœ¨ç»™å‡ºçš„DateUtilåŒ…é‡Œå·²ç»å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">DateUtil</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//ç»™å®šä¸€ä¸ªDateè½¬æ¢æˆæŒ‡å®šæ ¼å¼çš„å­—ç¬¦ä¸²
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> String <span style="color:#900;font-weight:bold">date2StrFull</span><span style="color:#000;font-weight:bold">(</span>Date date<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        SimpleDateFormat dateFormat <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> SimpleDateFormat<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;yyyy-MM-dd HH:mm:ss&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> dateFormat<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">format</span><span style="color:#000;font-weight:bold">(</span>date<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//æŠŠDateè½¬æ¢æˆå¹´æœˆæ—¥æ—¶çš„å­—ç¬¦ä¸²
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> String <span style="color:#900;font-weight:bold">date2Str</span><span style="color:#000;font-weight:bold">(</span>Date date<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        SimpleDateFormat dateFormat <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> SimpleDateFormat<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;yyyyMMddHH&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> dateFormat<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">format</span><span style="color:#000;font-weight:bold">(</span>date<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//è·å–æŒ‡å®šDateçš„ å½“å‰æ—¥æœŸçš„ 00ï¼š00ï¼š00çš„Dateå¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> Date <span style="color:#900;font-weight:bold">toDayStartHour</span><span style="color:#000;font-weight:bold">(</span>Date date<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        Calendar calendar <span style="color:#000;font-weight:bold">=</span> Calendar<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getInstance</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        calendar<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setTime</span><span style="color:#000;font-weight:bold">(</span>date<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//æ‹¨åŠ¨è¡¨ç›˜
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        calendar<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">set</span><span style="color:#000;font-weight:bold">(</span>Calendar<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">HOUR_OF_DAY</span><span style="color:#000;font-weight:bold">,</span> 0<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        calendar<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">set</span><span style="color:#000;font-weight:bold">(</span>Calendar<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">MINUTE</span><span style="color:#000;font-weight:bold">,</span> 0<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        calendar<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">set</span><span style="color:#000;font-weight:bold">(</span>Calendar<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">SECOND</span><span style="color:#000;font-weight:bold">,</span> 0<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        calendar<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">set</span><span style="color:#000;font-weight:bold">(</span>Calendar<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">MILLISECOND</span><span style="color:#000;font-weight:bold">,</span> 0<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        Date start <span style="color:#000;font-weight:bold">=</span> calendar<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getTime</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> start<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * æ—¶é—´é€’å¢Nå°æ—¶
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param hour
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> Date <span style="color:#900;font-weight:bold">addDateHour</span><span style="color:#000;font-weight:bold">(</span>Date date<span style="color:#000;font-weight:bold">,</span><span style="color:#458;font-weight:bold">int</span> hour<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        Calendar calendar <span style="color:#000;font-weight:bold">=</span> Calendar<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getInstance</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        calendar<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setTime</span><span style="color:#000;font-weight:bold">(</span>date<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        calendar<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>Calendar<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">HOUR</span><span style="color:#000;font-weight:bold">,</span> hour<span style="color:#000;font-weight:bold">);</span><span style="color:#998;font-style:italic">// 24å°æ—¶åˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        date <span style="color:#000;font-weight:bold">=</span> calendar<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getTime</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> date<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//è·å–æŒ‡å®šæ•°é‡Nä¸ªæ—¶é—´æ®µ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> List<span style="color:#000;font-weight:bold">&lt;</span>Date<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">getDates</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> hours<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//åˆ›å»ºé›†åˆ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        List<span style="color:#000;font-weight:bold">&lt;</span>Date<span style="color:#000;font-weight:bold">&gt;</span> dates<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">new</span> ArrayList<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//è·å–å½“å‰ç³»ç»Ÿæ—¶é—´ï¼Œçš„å‡Œæ™¨æ—¶é—´å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        Date date <span style="color:#000;font-weight:bold">=</span> toDayStartHour<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> Date<span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//2021-09-08 00:00:00
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//2021-09-08 02:00:00
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//2021-09-08 04:00:00
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> i <span style="color:#000;font-weight:bold">&lt;</span>hours <span style="color:#000;font-weight:bold">;</span> i<span style="color:#000;font-weight:bold">++)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            dates<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>addDateHour<span style="color:#000;font-weight:bold">(</span>date<span style="color:#000;font-weight:bold">,</span>i<span style="color:#000;font-weight:bold">*</span>2<span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> dates<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//è·å–å½“å‰æ—¶é—´ç«¯å’Œå¾€å4ä¸ªçš„æ—¶é—´æ®µ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> List<span style="color:#000;font-weight:bold">&lt;</span>Date<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">getDateMenus</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//è·å–12ä¸ªæ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        List<span style="color:#000;font-weight:bold">&lt;</span>Date<span style="color:#000;font-weight:bold">&gt;</span> dateList <span style="color:#000;font-weight:bold">=</span> getDates<span style="color:#000;font-weight:bold">(</span>12<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//è·å–å½“å‰ç³»ç»Ÿæ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        Date now <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Date<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//éå†12ä¸ªæ—¶é—´æ®µï¼Œå’Œå½“å‰ç³»ç»Ÿæ—¶é—´æ¯”å¯¹ï¼Œçœ‹å½“å‰ç³»ç»Ÿæ—¶é—´å±äºå“ªä¸ªæ—¶é—´æ®µ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>Date date <span style="color:#000;font-weight:bold">:</span> dateList<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>date<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getTime</span><span style="color:#000;font-weight:bold">()&lt;=</span>now<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getTime</span><span style="color:#000;font-weight:bold">()&amp;&amp;</span>now<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getTime</span><span style="color:#000;font-weight:bold">()&lt;</span>addDateHour<span style="color:#000;font-weight:bold">(</span>date<span style="color:#000;font-weight:bold">,</span>2<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">getTime</span><span style="color:#000;font-weight:bold">()){</span>
</span></span><span style="display:flex;"><span>                now<span style="color:#000;font-weight:bold">=</span>date<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//å¤„ç†è¦æ˜¾ç¤ºæ—¶é—´æ®µ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        List<span style="color:#000;font-weight:bold">&lt;</span>Date<span style="color:#000;font-weight:bold">&gt;</span> dateMenus<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">new</span> ArrayList<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> i <span style="color:#000;font-weight:bold">=</span> 0<span style="color:#000;font-weight:bold">;</span> i <span style="color:#000;font-weight:bold">&lt;</span>5 <span style="color:#000;font-weight:bold">;</span> i<span style="color:#000;font-weight:bold">++)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            dateMenus<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>addDateHour<span style="color:#000;font-weight:bold">(</span>now<span style="color:#000;font-weight:bold">,</span>i<span style="color:#000;font-weight:bold">*</span>2<span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> dateMenus<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">/*List&lt;Date&gt; dateList = DateUtil.getDates(12);
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">        for (Date date : dateList) {
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">            System.out.println(DateUtil.date2StrFull(date));
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">        }*/</span>
</span></span><span style="display:flex;"><span>        List<span style="color:#000;font-weight:bold">&lt;</span>Date<span style="color:#000;font-weight:bold">&gt;</span> dateMenus <span style="color:#000;font-weight:bold">=</span> DateUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getDateMenus</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>Date dateMenu <span style="color:#000;font-weight:bold">:</span> dateMenus<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>DateUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">date2StrFull</span><span style="color:#000;font-weight:bold">(</span>dateMenu<span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="233-æŸ¥è¯¢ç§’æ€å•†å“å¯¼å…¥reids">2.3.3 æŸ¥è¯¢ç§’æ€å•†å“å¯¼å…¥Reids</h4>
<p>æˆ‘ä»¬å¯ä»¥å†™ä¸ªå®šæ—¶ä»»åŠ¡ï¼ŒæŸ¥è¯¢ä»å½“å‰æ—¶é—´å¼€å§‹ï¼Œå¾€åå»¶ç»­4ä¸ªæ—¶é—´èœå•é—´éš”ï¼Œä¹Ÿå°±æ˜¯ä¸€å…±åªæŸ¥è¯¢5ä¸ªæ—¶é—´æ®µæŠ¢è´­å•†å“æ•°æ®ï¼Œå¹¶å‹å…¥ç¼“å­˜ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š</p>
<p>ä¿®æ”¹SeckillGoodsPushTaskçš„loadGoodsPushRedisæ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> <span style="color:#998;font-style:italic">/****
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * æ¯30ç§’æ‰§è¡Œä¸€æ¬¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Scheduled</span><span style="color:#000;font-weight:bold">(</span>cron <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;0/30 * * * * ?&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">loadGoodsPushRedis</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//è·å¾—æ—¶é—´æ®µé›†åˆ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        List<span style="color:#000;font-weight:bold">&lt;</span>Date<span style="color:#000;font-weight:bold">&gt;</span> dateMenus <span style="color:#000;font-weight:bold">=</span> DateUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getDateMenus</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//å¾ªç¯æ—¶é—´æ®µé›†åˆ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>Date startTime <span style="color:#000;font-weight:bold">:</span> dateMenus<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//æå–å¼€å§‹æ—¶é—´ï¼Œè½¬æ¢ä¸ºå¹´æœˆæ—¥æ ¼å¼çš„å­—ç¬¦ä¸²
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            String extName <span style="color:#000;font-weight:bold">=</span> DateUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">date2Str</span><span style="color:#000;font-weight:bold">(</span>startTime<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//åˆ›å»ºæŸ¥è¯¢æ¡ä»¶å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            QueryWrapper<span style="color:#000;font-weight:bold">&lt;</span>SeckillGoods<span style="color:#000;font-weight:bold">&gt;</span> queryWrapper <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> QueryWrapper<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//è®¾ç½®æŸ¥è¯¢æ¡ä»¶ 1)å•†å“å¿…é¡»å®¡æ ¸é€šè¿‡  status=1
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            queryWrapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">eq</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;status&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;1&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//2)åº“å­˜å¤§äº0
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            queryWrapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">gt</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;stock_count&#34;</span><span style="color:#000;font-weight:bold">,</span>0<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//3)å¼€å§‹æ—¶é—´&lt;=æ´»åŠ¨å¼€å§‹æ—¶é—´ï¼ˆæ•°æ®åº“ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            queryWrapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ge</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;start_time&#34;</span><span style="color:#000;font-weight:bold">,</span>DateUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">date2StrFull</span><span style="color:#000;font-weight:bold">(</span>startTime<span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//4)æ´»åŠ¨ç»“æŸæ—¶é—´&lt;å¼€å§‹æ—¶é—´+2å°æ—¶
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            queryWrapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">lt</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;end_time&#34;</span><span style="color:#000;font-weight:bold">,</span>DateUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">date2StrFull</span><span style="color:#000;font-weight:bold">(</span>DateUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addDateHour</span><span style="color:#000;font-weight:bold">(</span>startTime<span style="color:#000;font-weight:bold">,</span>2<span style="color:#000;font-weight:bold">)));</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//5)è¯»å–redisä¸­å­˜åœ¨çš„å½“å¤©çš„ç§’æ€å•†å“
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            Set keys <span style="color:#000;font-weight:bold">=</span> redisTemplate<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">boundHashOps</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;SeckillGoods_&#34;</span><span style="color:#000;font-weight:bold">+</span>extName<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">keys</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//åˆ¤æ–­keysä¸ä¸ºç©ºï¼Œå°±è®¾ç½®æ’é™¤æ¡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>keys<span style="color:#000;font-weight:bold">!=</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">&amp;&amp;</span>keys<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">size</span><span style="color:#000;font-weight:bold">()&gt;</span>0<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>                queryWrapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">notIn</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;id&#34;</span><span style="color:#000;font-weight:bold">,</span>keys<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„æ•°æ®åº“
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            List<span style="color:#000;font-weight:bold">&lt;</span>SeckillGoods<span style="color:#000;font-weight:bold">&gt;</span> seckillGoodsList <span style="color:#000;font-weight:bold">=</span> seckillGoodsMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">selectList</span><span style="color:#000;font-weight:bold">(</span>queryWrapper<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//éå†æŸ¥è¯¢åˆ°æ•°æ®é›†åˆ,å­˜å‚¨æ•°æ®åˆ°redis
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>SeckillGoods seckillGoods <span style="color:#000;font-weight:bold">:</span> seckillGoodsList<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>               redisTemplate<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">boundHashOps</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;SeckillGoods_&#34;</span><span style="color:#000;font-weight:bold">+</span>extName<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span>seckillGoods<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getId</span><span style="color:#000;font-weight:bold">(),</span>seckillGoods<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>               <span style="color:#998;font-style:italic">//è®¾ç½®è¶…æ—¶æ—¶é—´2å°æ—¶
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                redisTemplate<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">expireAt</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;SeckillGoods_&#34;</span><span style="color:#000;font-weight:bold">+</span>extName<span style="color:#000;font-weight:bold">,</span>DateUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addDateHour</span><span style="color:#000;font-weight:bold">(</span>startTime<span style="color:#000;font-weight:bold">,</span>2<span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>Redisæ•°æ®å¦‚ä¸‹ï¼š
<img src="/posts/project-0/20220528172837/image-20220528173036091.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="3-ç§’æ€é¢‘é“é¡µ">3 ç§’æ€é¢‘é“é¡µ</h2>
<p><img src="/posts/project-0/20220528172837/image-20220528173043087.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ç§’æ€é¢‘é“é¦–é¡µï¼Œæ˜¾ç¤ºæ­£åœ¨ç§’æ€çš„å’Œæœªå¼€å§‹ç§’æ€çš„å•†å“ï¼ˆå·²ç»å¼€å§‹æˆ–è€…è¿˜æ²¡å¼€å§‹ï¼Œæœªç»“æŸçš„ç§’æ€å•†å“ï¼‰</p>
<h3 id="31-ç§’æ€æ—¶é—´èœå•">3.1 ç§’æ€æ—¶é—´èœå•</h3>
<p><img src="/posts/project-0/20220528172837/image-20220528173057826.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>å¦‚ä¸Šå›¾ï¼Œæ—¶é—´èœå•éœ€è¦æ ¹æ®å½“å‰æ—¶é—´åŠ¨æ€åŠ è½½ï¼Œæ—¶é—´èœå•çš„è®¡ç®—ä¸Šé¢åŠŸèƒ½ä¸­å·²ç»å®ç°ï¼Œåœ¨DateUtilå·¥å…·åŒ…ä¸­ã€‚æˆ‘ä»¬åªéœ€è¦å°†æ—¶é—´èœå•è·å–ï¼Œç„¶åå“åº”åˆ°é¡µé¢ï¼Œé¡µé¢æ ¹æ®å¯¹åº”çš„æ•°æ®æ˜¾ç¤ºå³å¯ã€‚</p>
<p>åˆ›å»ºcom.offcn.seckill.controller.SeckillGoodsControllerï¼Œå¹¶æ·»åŠ èœå•è·å–æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RestController</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RequestMapping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/seckillGoods&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@CrossOrigin</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">SeckillGoodsController</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/*****
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * è·å–æ—¶é—´èœå•
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * URLL:/seckill/goods/menus
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@RequestMapping</span><span style="color:#000;font-weight:bold">(</span>value <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;/menus&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> List<span style="color:#000;font-weight:bold">&lt;</span>Date<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">dateMenus</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> DateUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getDateMenus</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>ä½¿ç”¨Postmanæµ‹è¯•ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p>http://localhost:9005/seckillGoods/menus
<img src="/posts/project-0/20220528172837/image-20220528173104701.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>è®¿é—®æ–¹å‘æ˜¾ç¤ºçš„æ—¶é—´æ®µå’Œå½“å‰æ—¶é—´ç›¸å·®å…«ä¸ªå°æ—¶ï¼Œéœ€è¦è®¾ç½®æ—¶åŒº</p>
<p>ä¿®æ”¹é…ç½®æ–‡ä»¶application.ymlè®¾ç½®jsonè½¬æ¢æ—¶åŒº</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">spring</span>:<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">jackson</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">time-zone</span>:<span style="color:#bbb"> </span>GMT+8<span style="color:#bbb">
</span></span></span></code></pre></div><h3 id="32-ç§’æ€é¢‘é“é¡µ">3.2 ç§’æ€é¢‘é“é¡µ</h3>
<p><img src="/posts/project-0/20220528172837/image-20220528173147199.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ç§’æ€é¢‘é“é¡µæ˜¯æŒ‡å°†å¯¹åº”æ—¶åŒºçš„ç§’æ€å•†å“ä»Reidsç¼“å­˜ä¸­æŸ¥è¯¢å‡ºæ¥ï¼Œå¹¶åˆ°é¡µé¢æ˜¾ç¤ºã€‚å¯¹åº”æ—¶åŒºç§’æ€å•†å“å­˜å‚¨çš„æ—¶å€™ä»¥Hashç±»å‹è¿›è¡Œäº†å­˜å‚¨ï¼Œkey=SeckillGoods_2019010112ï¼Œvalue=æ¯ä¸ªå•†å“è¯¦æƒ…ã€‚</p>
<p>æ¯æ¬¡ç”¨æˆ·åœ¨å‰ç«¯ç‚¹å‡»å¯¹åº”æ—¶é—´èœå•çš„æ—¶å€™ï¼Œå¯ä»¥å°†æ—¶é—´èœå•çš„å¼€å§‹æ—¶é—´ä»¥yyyyMMddHHæ ¼å¼æäº¤åˆ°åå°ï¼Œåå°æ ¹æ®æ—¶é—´æ ¼å¼æŸ¥è¯¢å‡ºå¯¹åº”æ—¶åŒºç§’æ€å•†å“ä¿¡æ¯ã€‚</p>
<h4 id="321-ä¸šåŠ¡å±‚">3.2.1 ä¸šåŠ¡å±‚</h4>
<p>åˆ›å»ºcom.offcn.seckill.service.SeckillGoodsService,æ·»åŠ æ ¹æ®æ—¶åŒºæŸ¥è¯¢ç§’æ€å•†å“çš„æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">interface</span> <span style="color:#458;font-weight:bold">SeckillGoodsService</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * è·å–æŒ‡å®šæ—¶é—´å¯¹åº”çš„ç§’æ€å•†å“åˆ—è¡¨
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param key
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    List<span style="color:#000;font-weight:bold">&lt;</span>SeckillGoods<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">list</span><span style="color:#000;font-weight:bold">(</span>String key<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>åˆ›å»ºcom.offcn.seckill.service.impl.SeckillGoodsServiceImplï¼Œå®ç°æ ¹æ®æ—¶åŒºæŸ¥è¯¢ç§’æ€å•†å“çš„æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Service</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">SeckillGoodsServiceImpl</span> <span style="color:#000;font-weight:bold">implements</span> SeckillGoodsService <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> RedisTemplate redisTemplate<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * Redisä¸­æ ¹æ®Keyè·å–ç§’æ€å•†å“åˆ—è¡¨
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param key
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> List<span style="color:#000;font-weight:bold">&lt;</span>SeckillGoods<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">list</span><span style="color:#000;font-weight:bold">(</span>String key<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> redisTemplate<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">boundHashOps</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;SeckillGoods_&#34;</span><span style="color:#000;font-weight:bold">+</span>key<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">values</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="322-æ§åˆ¶å±‚">3.2.2 æ§åˆ¶å±‚</h4>
<p>ä¿®æ”¹com.offcn.seckill.controller.SeckillGoodsControllerï¼Œå¹¶æ·»åŠ ç§’æ€å•†å“æŸ¥è¯¢æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">private</span> SeckillGoodsService seckillGoodsService<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">/****
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * URL:/seckillGoods/list
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * å¯¹åº”æ—¶é—´æ®µç§’æ€å•†å“é›†åˆæŸ¥è¯¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * è°ƒç”¨ServiceæŸ¥è¯¢æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * @param time:2019050716
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RequestMapping</span><span style="color:#000;font-weight:bold">(</span>value <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;/list&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> List<span style="color:#000;font-weight:bold">&lt;</span>SeckillGoods<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">list</span><span style="color:#000;font-weight:bold">(</span>String time<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//è°ƒç”¨ServiceæŸ¥è¯¢æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">return</span> seckillGoodsService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">list</span><span style="color:#000;font-weight:bold">(</span>time<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>ä½¿ç”¨Postmanæµ‹è¯•ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p>http://localhost:9005/seckillGoods/list?time=2019052414
<img src="/posts/project-0/20220528172837/image-20220528173156655.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="4-ç§’æ€è¯¦æƒ…é¡µ">4 ç§’æ€è¯¦æƒ…é¡µ</h2>
<p>é€šè¿‡ç§’æ€é¢‘é“é¡µç‚¹å‡»è¯·è´­æŒ‰é’®ï¼Œä¼šè·³è½¬åˆ°å•†å“ç§’æ€è¯¦æƒ…é¡µï¼Œç§’æ€è¯¦æƒ…é¡µéœ€è¦æ ¹æ®å•†å“IDæŸ¥è¯¢å•†å“è¯¦æƒ…ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é¢‘é“é¡µç‚¹å‡»ç§’æ€æŠ¢è´­çš„æ—¶å€™å°†IDä¸€èµ·ä¼ åˆ°åå°ï¼Œç„¶åæ ¹æ®IDå»Redisä¸­æŸ¥è¯¢è¯¦æƒ…ä¿¡æ¯ã€‚</p>
<h3 id="41-ä¸šåŠ¡å±‚">4.1 ä¸šåŠ¡å±‚</h3>
<p>ä¿®æ”¹com.offcn.seckill.service.SeckillGoodsServiceï¼Œæ·»åŠ å¦‚ä¸‹æ–¹æ³•å®ç°æŸ¥è¯¢ç§’æ€å•†å“è¯¦æƒ…,ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/****
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * æ ¹æ®IDæŸ¥è¯¢å•†å“è¯¦æƒ…
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * @param time:æ—¶é—´åŒºé—´
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * @param id:å•†å“ID
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span>SeckillGoods <span style="color:#900;font-weight:bold">one</span><span style="color:#000;font-weight:bold">(</span>String time<span style="color:#000;font-weight:bold">,</span>Long id<span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><p>ä¿®æ”¹com.offcn.seckill.service.impl.SeckillGoodsServiceImplï¼Œæ·»åŠ æŸ¥è¯¢ç§’æ€å•†å“è¯¦æƒ…ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/****
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * æ ¹æ®å•†å“IDæŸ¥è¯¢å•†å“è¯¦æƒ…
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * @param time:æ—¶é—´åŒºé—´
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * @param id:å•†å“ID
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> SeckillGoods <span style="color:#900;font-weight:bold">one</span><span style="color:#000;font-weight:bold">(</span>String time<span style="color:#000;font-weight:bold">,</span> Long id<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">(</span>SeckillGoods<span style="color:#000;font-weight:bold">)</span> redisTemplate<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">boundHashOps</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;SeckillGoods_&#34;</span><span style="color:#000;font-weight:bold">+</span>time<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span>id<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="42-æ§åˆ¶å±‚">4.2 æ§åˆ¶å±‚</h3>
<p>ä¿®æ”¹com.offcn.seckill.controller.SeckillGoodsControllerï¼Œæ·»åŠ å¦‚ä¸‹æ–¹æ³•å®ç°æŸ¥è¯¢ç§’æ€å•†å“è¯¦æƒ…ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/****
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * URL:/seckillGoods/one
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * æ ¹æ®IDæŸ¥è¯¢å•†å“è¯¦æƒ…
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * è°ƒç”¨ServiceæŸ¥è¯¢å•†å“è¯¦æƒ…
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * @param time
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * @param id
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RequestMapping</span><span style="color:#000;font-weight:bold">(</span>value <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;/one&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> SeckillGoods <span style="color:#900;font-weight:bold">one</span><span style="color:#000;font-weight:bold">(</span>String time<span style="color:#000;font-weight:bold">,</span>Long id<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//è°ƒç”¨ServiceæŸ¥è¯¢å•†å“è¯¦æƒ…
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">return</span> seckillGoodsService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">one</span><span style="color:#000;font-weight:bold">(</span>time<span style="color:#000;font-weight:bold">,</span>id<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>ä½¿ç”¨Postmanæµ‹è¯•ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p>http://localhost:9005/seckillGoods/one?id=1&amp;time=2019052414
<img src="/posts/project-0/20220528172837/image-20220528173206034.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="5-ä¸‹å•å®ç°">5 ä¸‹å•å®ç°</h2>
<p>ç”¨æˆ·ä¸‹å•ï¼Œä»æ§åˆ¶å±‚-&gt;Serviceå±‚-&gt;Daoå±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæŠŠdaoåˆ›å»ºå¥½ï¼Œå†åˆ›å»ºserviceå±‚ï¼Œå†åˆ›å»ºæ§åˆ¶å±‚ã€‚</p>
<p>ç”¨æˆ·ä¸‹å•ï¼Œä¸ºäº†æå‡ä¸‹å•é€Ÿåº¦ï¼Œæˆ‘ä»¬å°†è®¢å•æ•°æ®å­˜å…¥åˆ°Redisç¼“å­˜ä¸­ï¼Œå¦‚æœç”¨æˆ·æ”¯ä»˜äº†ï¼Œåˆ™å°†Reidsç¼“å­˜ä¸­çš„è®¢å•å­˜å…¥åˆ°MySQLä¸­ï¼Œå¹¶æ¸…ç©ºRedisç¼“å­˜ä¸­çš„è®¢å•ã€‚</p>
<h3 id="51-ä¸šåŠ¡å±‚">5.1 ä¸šåŠ¡å±‚</h3>
<p>åˆ›å»ºcom.offcn.seckill.service.SeckillOrderServiceï¼Œå¹¶åœ¨æ¥å£ä¸­å¢åŠ ä¸‹å•æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">interface</span> <span style="color:#458;font-weight:bold">SeckillOrderService</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * æ·»åŠ ç§’æ€è®¢å•
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param id:ç§’æ€å•†å“ID
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param time:å•†å“ç§’æ€å¼€å§‹æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param username:ç”¨æˆ·ç™»å½•å
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    Boolean <span style="color:#900;font-weight:bold">add</span><span style="color:#000;font-weight:bold">(</span>Long id<span style="color:#000;font-weight:bold">,</span> String time<span style="color:#000;font-weight:bold">,</span> String username<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>åˆ›å»ºcom.offcn.seckill.service.impl.SeckillOrderServiceImplå®ç°ç±»ï¼Œå¹¶åœ¨ç±»ä¸­æ·»åŠ ä¸‹å•å®ç°æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Service</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">SeckillOrderServiceImpl</span> <span style="color:#000;font-weight:bold">implements</span> SeckillOrderService <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> RedisTemplate redisTemplate<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> SeckillGoodsMapper seckillGoodsMapper<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> IdWorker idWorker<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/****
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * æ·»åŠ è®¢å•
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param id
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param time
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param username
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> Boolean <span style="color:#900;font-weight:bold">add</span><span style="color:#000;font-weight:bold">(</span>Long id<span style="color:#000;font-weight:bold">,</span> String time<span style="color:#000;font-weight:bold">,</span> String username<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//è·å–å•†å“æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        SeckillGoods goods <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>SeckillGoods<span style="color:#000;font-weight:bold">)</span> redisTemplate<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">boundHashOps</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;SeckillGoods_&#34;</span> <span style="color:#000;font-weight:bold">+</span> time<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span>id<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//å¦‚æœæ²¡æœ‰åº“å­˜ï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>goods<span style="color:#000;font-weight:bold">==</span><span style="color:#000;font-weight:bold">null</span> <span style="color:#000;font-weight:bold">||</span> goods<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getStockCount</span><span style="color:#000;font-weight:bold">()&lt;=</span>0<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">throw</span> <span style="color:#000;font-weight:bold">new</span> RuntimeException<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;å·²å”®ç½„!&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//å¦‚æœæœ‰åº“å­˜ï¼Œåˆ™åˆ›å»ºç§’æ€å•†å“è®¢å•
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        SeckillOrder seckillOrder <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> SeckillOrder<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        seckillOrder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setId</span><span style="color:#000;font-weight:bold">(</span>idWorker<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">nextId</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>        seckillOrder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setSeckillId</span><span style="color:#000;font-weight:bold">(</span>id<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        seckillOrder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setMoney</span><span style="color:#000;font-weight:bold">(</span>goods<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getCostPrice</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>        seckillOrder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setUserId</span><span style="color:#000;font-weight:bold">(</span>username<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        seckillOrder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setCreateTime</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> Date<span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>        seckillOrder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setStatus</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;0&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//å°†ç§’æ€è®¢å•å­˜å…¥åˆ°Redisä¸­
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        redisTemplate<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">boundHashOps</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;SeckillOrder&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span>username<span style="color:#000;font-weight:bold">,</span>seckillOrder<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//åº“å­˜å‡å°‘
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        goods<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setStockCount</span><span style="color:#000;font-weight:bold">(</span>goods<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getStockCount</span><span style="color:#000;font-weight:bold">()-</span>1<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//åˆ¤æ–­å½“å‰å•†å“æ˜¯å¦è¿˜æœ‰åº“å­˜
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>goods<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getStockCount</span><span style="color:#000;font-weight:bold">()&lt;=</span>0<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//å¹¶ä¸”å°†å•†å“æ•°æ®åŒæ­¥åˆ°MySQLä¸­
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            seckillGoodsMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">updateById</span><span style="color:#000;font-weight:bold">(</span>goods<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//å¦‚æœæ²¡æœ‰åº“å­˜,åˆ™æ¸…ç©ºRedisç¼“å­˜ä¸­è¯¥å•†å“
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            redisTemplate<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">boundHashOps</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;SeckillGoods_&#34;</span> <span style="color:#000;font-weight:bold">+</span> time<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">delete</span><span style="color:#000;font-weight:bold">(</span>id<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">else</span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//å¦‚æœæœ‰åº“å­˜ï¼Œåˆ™ç›´æ•°æ®é‡ç½®åˆ°Reidsä¸­
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            redisTemplate<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">boundHashOps</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;SeckillGoods_&#34;</span> <span style="color:#000;font-weight:bold">+</span> time<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span>id<span style="color:#000;font-weight:bold">,</span>goods<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="52-æ§åˆ¶å±‚">5.2 æ§åˆ¶å±‚</h3>
<p>åˆ›å»ºcom.offcn.seckill.controller.SeckillOrderControllerï¼Œæ·»åŠ ä¸‹å•æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RestController</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@CrossOrigin</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RequestMapping</span><span style="color:#000;font-weight:bold">(</span>value <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;/seckillOrder&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">SeckillOrderController</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> SeckillOrderService seckillOrderService<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/****
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * URL:/seckillOrder/add
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * æ·»åŠ è®¢å•
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * è°ƒç”¨Serviceå¢åŠ è®¢å•
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * åŒ¿åè®¿é—®ï¼šanonymousUser
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param time
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param id
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@RequestMapping</span><span style="color:#000;font-weight:bold">(</span>value <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;/add&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> Result <span style="color:#900;font-weight:bold">add</span><span style="color:#000;font-weight:bold">(</span>String time<span style="color:#000;font-weight:bold">,</span> Long id<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//ç”¨æˆ·ç™»å½•å
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            String username <span style="color:#000;font-weight:bold">=</span> TokenDcode<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getUserInfo</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;user_name&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//è°ƒç”¨Serviceå¢åŠ è®¢å•
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            Boolean bo <span style="color:#000;font-weight:bold">=</span> seckillOrderService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>id<span style="color:#000;font-weight:bold">,</span> time<span style="color:#000;font-weight:bold">,</span> username<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>bo<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">//æŠ¢å•æˆåŠŸ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">new</span> Result<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span>StatusCode<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">OK</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;æŠ¢å•æˆåŠŸï¼&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>Exception e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>             <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">new</span> Result<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span>StatusCode<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ERROR</span><span style="color:#000;font-weight:bold">,</span>e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMessage</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">new</span> Result<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span>StatusCode<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">ERROR</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;æœåŠ¡å™¨ç¹å¿™ï¼Œè¯·ç¨åå†è¯•&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="53æ•´åˆgatewayç½‘å…³é…ç½®èµ„æºæœåŠ¡å™¨">5.3ã€æ•´åˆgatewayç½‘å…³ã€é…ç½®èµ„æºæœåŠ¡å™¨</h3>
<h4 id="531ä¿®æ”¹é¡¹ç›®dongyimai-seckill-serviceå¼•å…¥ä¾èµ–">5.3.1ã€ä¿®æ”¹é¡¹ç›®dongyimai-seckill-serviceå¼•å…¥ä¾èµ–</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#bbb"> </span>&lt;!--oauthä¾èµ–--&gt;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>&lt;dependency&gt;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>&lt;artifactId&gt;spring-cloud-starter-oauth2&lt;/artifactId&gt;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>&lt;/dependency&gt;<span style="color:#bbb">
</span></span></span></code></pre></div><h4 id="532æ‹·è´å…¬é’¥ä»¥åŠèµ„æºæœåŠ¡å™¨é…ç½®ç±»æ–‡ä»¶">5.3.2ã€æ‹·è´å…¬é’¥ã€ä»¥åŠèµ„æºæœåŠ¡å™¨é…ç½®ç±»æ–‡ä»¶</h4>
<p><img src="/posts/project-0/20220528172837/image-20220528173217418.png"
    
    
    
    loading="lazy"
    
    
></p>
<h4 id="533ä¿®æ”¹ç½‘å…³é…ç½®æ–‡ä»¶å¢åŠ ç§’æ€å¾®æœåŠ¡è½¬å‘">5.3.3ã€ä¿®æ”¹ç½‘å…³é…ç½®æ–‡ä»¶ï¼Œå¢åŠ ç§’æ€å¾®æœåŠ¡è½¬å‘</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#bbb">        </span>- <span style="color:#000080">id</span>:<span style="color:#bbb"> </span>dongyimai_seckill_route<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">uri</span>:<span style="color:#bbb"> </span>lb://SECKILL<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">predicates</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- Path=/api/seckillGoods/**,/api/seckillOrder/**<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">filters</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- StripPrefix=1<span style="color:#bbb">
</span></span></span></code></pre></div><p>æµ‹è¯•ç§’æ€ä¸‹å•ï¼š</p>
<p>http://localhost:8001/api/seckillOrder/add?time=2021061820&amp;id=1</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">flag:</span> <span style="color:#a61717;background-color:#e3d2d2">true,</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">code:</span> <span style="color:#a61717;background-color:#e3d2d2">20000,</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">message:</span> <span style="color:#000080">&#34;ç§’æ€æˆåŠŸ&#34;</span>,
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">data:</span> <span style="color:#a61717;background-color:#e3d2d2">null</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>é—®é¢˜åˆ†æ:</p>
<p>ä¸Šè¿°åŠŸèƒ½å®Œæˆäº†ç§’æ€æŠ¢å•æ“ä½œï¼Œä½†æ²¡æœ‰è§£å†³å¹¶å‘ç›¸å…³çš„é—®é¢˜ï¼Œä¾‹å¦‚å¹¶å‘ã€è¶…å–ç°è±¡ï¼Œè¿™å—ç”šè‡³æœ‰å¯èƒ½äº§ç”Ÿé›ªå´©é—®é¢˜ã€‚</p>
<h2 id="6-å¤šçº¿ç¨‹æŠ¢å•">6 å¤šçº¿ç¨‹æŠ¢å•</h2>
<h3 id="61--å®ç°æ€è·¯åˆ†æ">6.1  å®ç°æ€è·¯åˆ†æ</h3>
<p><img src="/posts/project-0/20220528172837/image-20220528173224443.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>åœ¨ç°å®ç§’æ€ä¸­ï¼Œæ“ä½œä¸€èˆ¬éƒ½æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œè€Œä¸”å¹¶å‘é‡ç‰¹åˆ«é«˜ï¼Œæ¯”å¦‚ï¼Œæ£€æŸ¥å½“å‰è´¦å·æ“ä½œæ˜¯å¦å·²ç»ç§’æ€è¿‡è¯¥å•†å“ï¼Œæ£€æŸ¥è¯¥è´¦å·æ˜¯å¦å­˜åœ¨å­˜åœ¨åˆ·å•è¡Œä¸ºï¼Œè®°å½•ç”¨æˆ·æ“ä½œæ—¥å¿—ç­‰ã€‚</p>
<p>ä¸‹è®¢å•è¿™é‡Œï¼Œæˆ‘ä»¬ä¸€èˆ¬é‡‡ç”¨å¤šçº¿ç¨‹ä¸‹å•ï¼Œä½†å¤šçº¿ç¨‹ä¸­æˆ‘ä»¬åˆéœ€è¦ä¿è¯ç”¨æˆ·æŠ¢å•çš„å…¬å¹³æ€§ï¼Œä¹Ÿå°±æ˜¯å…ˆæŠ¢å…ˆä¸‹å•ã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·å®ç°ï¼Œç”¨æˆ·è¿›å…¥ç§’æ€æŠ¢å•ï¼Œå¦‚æœç”¨æˆ·ç¬¦åˆæŠ¢å•èµ„æ ¼ï¼Œåªéœ€è¦è®°å½•ç”¨æˆ·æŠ¢å•æ•°æ®ï¼Œå­˜å…¥é˜Ÿåˆ—ï¼Œå¤šçº¿ç¨‹ä»é˜Ÿåˆ—ä¸­è¿›è¡Œæ¶ˆè´¹å³å¯ï¼Œå­˜å…¥é˜Ÿåˆ—é‡‡ç”¨å·¦å‹ï¼Œå¤šçº¿ç¨‹ä¸‹å•é‡‡ç”¨å³å–çš„æ–¹å¼ã€‚</p>
<h3 id="62-å¼‚æ­¥å®ç°">6.2 å¼‚æ­¥å®ç°</h3>
<p>è¦æƒ³ä½¿ç”¨Springçš„å¼‚æ­¥æ“ä½œï¼Œéœ€è¦å…ˆå¼€å¯å¼‚æ­¥æ“ä½œï¼Œç”¨<code>@EnableAsync</code>æ³¨è§£å¼€å¯ï¼Œç„¶ååœ¨å¯¹åº”çš„å¼‚æ­¥æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£<code>@Async</code>å³å¯ã€‚</p>
<p>åˆ›å»ºcom.offcn.seckill.task.MultiThreadingCreateOrderç±»ï¼Œåœ¨ç±»ä¸­åˆ›å»ºä¸€ä¸ªcreateOrderæ–¹æ³•ï¼Œå¹¶åœ¨æ–¹æ³•ä¸Šæ·»åŠ <code>@Async</code>,ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">MultiThreadingCreateOrder</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * å¤šçº¿ç¨‹ä¸‹å•æ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Async</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">createOrder</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;å‡†å¤‡æ‰§è¡Œ....&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            Thread<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sleep</span><span style="color:#000;font-weight:bold">(</span>20000<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;å¼€å§‹æ‰§è¡Œ....&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>InterruptedException e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>ä¸Šé¢createOrderæ–¹æ³•è¿›è¡Œäº†ä¼‘çœ é˜»å¡æ“ä½œï¼Œæˆ‘ä»¬åœ¨ä¸‹å•çš„æ–¹æ³•è°ƒç”¨createOrderæ–¹æ³•ï¼Œå¦‚æœä¸‹å•çš„æ–¹æ³•æ²¡æœ‰é˜»å¡ï¼Œç»§ç»­æ‰§è¡Œï¼Œè¯´æ˜å±äºå¼‚æ­¥æ“ä½œï¼Œå¦‚æœé˜»å¡äº†ï¼Œè¯´æ˜æ²¡æœ‰æ‰§è¡Œå¼‚æ­¥æ“ä½œã€‚</p>
<p>ä¿®æ”¹ç§’æ€æŠ¢å•SeckillOrderServiceImplä»£ç ï¼Œæ³¨å…¥MultiThreadingCreateOrder,å¹¶è°ƒç”¨createOrderæ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š
<img src="/posts/project-0/20220528172837/image-20220528173230560.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>æ³¨æ„asyncéœ€è¦åœ¨ä¸»å¯åŠ¨å¼€å¯
<img src="/posts/project-0/20220528172837/image-20220528173234902.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ä½¿ç”¨Postmanæµ‹è¯•å¦‚ä¸‹ï¼š</p>
<p>http://localhost:8001/api/seckillOrder/add?id=1&amp;time=2021061820
<img src="/posts/project-0/20220528172837/image-20220528173240093.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ç•Œé¢å·²ç»æ˜¾ç¤ºäº†ç»“æœï¼Œæ§åˆ¶å°è¿˜æ²¡æœ‰æ‰§è¡Œè¾“å‡ºï¼Œå¼‚æ­¥æ–¹å¼å®Œæˆä»»åŠ¡ã€‚</p>
<h3 id="63-å¤šçº¿ç¨‹æŠ¢å•">6.3 å¤šçº¿ç¨‹æŠ¢å•</h3>
<p><img src="/posts/project-0/20220528172837/image-20220528173246840.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ç”¨æˆ·æ¯æ¬¡ä¸‹å•çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½è®©ä»–ä»¬å…ˆè¿›è¡Œæ’é˜Ÿï¼Œç„¶åé‡‡ç”¨å¤šçº¿ç¨‹çš„æ–¹å¼åˆ›å»ºè®¢å•ï¼Œæ’é˜Ÿæˆ‘ä»¬å¯ä»¥é‡‡ç”¨Redisçš„é˜Ÿåˆ—å®ç°ï¼Œå¤šçº¿ç¨‹ä¸‹å•æˆ‘ä»¬å¯ä»¥é‡‡ç”¨Springçš„å¼‚æ­¥å®ç°ã€‚</p>
<h4 id="631-å¤šçº¿ç¨‹ä¸‹å•">6.3.1 å¤šçº¿ç¨‹ä¸‹å•</h4>
<p>å°†ä¹‹å‰ä¸‹å•çš„ä»£ç å…¨éƒ¨æŒªåˆ°å¤šçº¿ç¨‹çš„æ–¹æ³•ä¸­ï¼Œcom.offcn.seckill.service.impl.SeckillOrderServiceImplç±»çš„æ–¹æ³•å€¼è´Ÿè´£è°ƒç”¨å³å¯ï¼Œä»£ç å¦‚ä¸‹ï¼š
<img src="/posts/project-0/20220528172837/image-20220528173251856.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>å¤šçº¿ç¨‹ä¸‹å•ä»£ç å¦‚ä¸‹å›¾ï¼š
<img src="/posts/project-0/20220528172837/image-20220528173257849.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ä¸Šå›¾ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">MultiThreadingCreateOrder</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> RedisTemplate redisTemplate<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> SeckillGoodsMapper seckillGoodsMapper<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> IdWorker idWorker<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * å¤šçº¿ç¨‹ä¸‹å•æ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Async</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">createOrder</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//æ—¶é—´åŒºé—´
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            String time <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;2019052510&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//ç”¨æˆ·ç™»å½•å
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            String username<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;offcn1234&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//ç”¨æˆ·æŠ¢è´­å•†å“
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            Long id <span style="color:#000;font-weight:bold">=</span> 1131814847898587136L<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//è·å–å•†å“æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            SeckillGoods goods <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>SeckillGoods<span style="color:#000;font-weight:bold">)</span> redisTemplate<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">boundHashOps</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;SeckillGoods_&#34;</span> <span style="color:#000;font-weight:bold">+</span> time<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span>id<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//å¦‚æœæ²¡æœ‰åº“å­˜ï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>goods<span style="color:#000;font-weight:bold">==</span><span style="color:#000;font-weight:bold">null</span> <span style="color:#000;font-weight:bold">||</span> goods<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getStockCount</span><span style="color:#000;font-weight:bold">()&lt;=</span>0<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">throw</span> <span style="color:#000;font-weight:bold">new</span> RuntimeException<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;å·²å”®ç½„!&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//å¦‚æœæœ‰åº“å­˜ï¼Œåˆ™åˆ›å»ºç§’æ€å•†å“è®¢å•
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            SeckillOrder seckillOrder <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> SeckillOrder<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            seckillOrder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setId</span><span style="color:#000;font-weight:bold">(</span>idWorker<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">nextId</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>            seckillOrder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setSeckillId</span><span style="color:#000;font-weight:bold">(</span>id<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            seckillOrder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setMoney</span><span style="color:#000;font-weight:bold">(</span>goods<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getCostPrice</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>            seckillOrder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setUserId</span><span style="color:#000;font-weight:bold">(</span>username<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            seckillOrder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setCreateTime</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> Date<span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>            seckillOrder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setStatus</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;0&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//å°†ç§’æ€è®¢å•å­˜å…¥åˆ°Redisä¸­
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            redisTemplate<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">boundHashOps</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;SeckillOrder&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span>username<span style="color:#000;font-weight:bold">,</span>seckillOrder<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//åº“å­˜å‡å°‘
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            goods<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setStockCount</span><span style="color:#000;font-weight:bold">(</span>goods<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getStockCount</span><span style="color:#000;font-weight:bold">()-</span>1<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//åˆ¤æ–­å½“å‰å•†å“æ˜¯å¦è¿˜æœ‰åº“å­˜
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>goods<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getStockCount</span><span style="color:#000;font-weight:bold">()&lt;=</span>0<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">//å¹¶ä¸”å°†å•†å“æ•°æ®åŒæ­¥åˆ°MySQLä¸­
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                seckillGoodsMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">updateByPrimaryKeySelective</span><span style="color:#000;font-weight:bold">(</span>goods<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">//å¦‚æœæ²¡æœ‰åº“å­˜,åˆ™æ¸…ç©ºRedisç¼“å­˜ä¸­è¯¥å•†å“
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                redisTemplate<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">boundHashOps</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;SeckillGoods_&#34;</span> <span style="color:#000;font-weight:bold">+</span> time<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">delete</span><span style="color:#000;font-weight:bold">(</span>id<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">else</span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#998;font-style:italic">//å¦‚æœæœ‰åº“å­˜ï¼Œåˆ™ç›´æ•°æ®é‡ç½®åˆ°Reidsä¸­
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                redisTemplate<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">boundHashOps</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;SeckillGoods_&#34;</span> <span style="color:#000;font-weight:bold">+</span> time<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span>id<span style="color:#000;font-weight:bold">,</span>goods<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>Exception e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>æ­¤æ—¶æµ‹è¯•ï¼Œæ˜¯å¯ä»¥æ­£å¸¸ä¸‹å•çš„ï¼Œä½†æ˜¯ç”¨æˆ·åå’Œè®¢å•éƒ½å†™æ­»äº†ï¼Œæ­¤å¤„éœ€è¦ç»§ç»­ä¼˜åŒ–ã€‚</p>
<p>http://localhost:8001/api/seckillOrder/add?id=1&amp;time=2021061820</p>
<h4 id="632-æ’é˜Ÿä¸‹å•">6.3.2 æ’é˜Ÿä¸‹å•</h4>
<h5 id="6321-æ’é˜Ÿä¿¡æ¯å°è£…">6.3.2.1 æ’é˜Ÿä¿¡æ¯å°è£…</h5>
<p>ç”¨æˆ·æ¯æ¬¡ä¸‹å•çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—è¿›è¡Œæ’é˜Ÿï¼Œç„¶åé‡‡ç”¨å¤šçº¿ç¨‹çš„æ–¹å¼åˆ›å»ºè®¢å•ï¼Œæ’é˜Ÿæˆ‘ä»¬å¯ä»¥é‡‡ç”¨Redisçš„é˜Ÿåˆ—å®ç°ã€‚ æ’é˜Ÿä¿¡æ¯ä¸­éœ€è¦æœ‰ç”¨æˆ·æŠ¢å•çš„å•†å“ä¿¡æ¯ï¼Œä¸»è¦åŒ…å«å•†å“IDï¼Œå•†å“æŠ¢è´­æ—¶é—´æ®µï¼Œç”¨æˆ·ç™»å½•åã€‚æˆ‘ä»¬å¯ä»¥è®¾è®¡ä¸ªjavabeanï¼Œå¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">SeckillStatus</span> <span style="color:#000;font-weight:bold">implements</span> Serializable <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//ç§’æ€ç”¨æˆ·å
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">private</span> String username<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//åˆ›å»ºæ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">private</span> Date createTime<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//ç§’æ€çŠ¶æ€  1:æ’é˜Ÿä¸­ï¼Œ2:ç§’æ€ç­‰å¾…æ”¯ä»˜,3:æ”¯ä»˜è¶…æ—¶ï¼Œ4:ç§’æ€å¤±è´¥,5:æ”¯ä»˜å®Œæˆ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">private</span> Integer status<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//ç§’æ€çš„å•†å“ID
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">private</span> Long goodsId<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//åº”ä»˜é‡‘é¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">private</span> Float money<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//è®¢å•å·
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">private</span> Long orderId<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//æ—¶é—´æ®µ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">private</span> String time<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#900;font-weight:bold">SeckillStatus</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#900;font-weight:bold">SeckillStatus</span><span style="color:#000;font-weight:bold">(</span>String username<span style="color:#000;font-weight:bold">,</span> Date createTime<span style="color:#000;font-weight:bold">,</span> Integer status<span style="color:#000;font-weight:bold">,</span> Long goodsId<span style="color:#000;font-weight:bold">,</span> String time<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">username</span> <span style="color:#000;font-weight:bold">=</span> username<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createTime</span> <span style="color:#000;font-weight:bold">=</span> createTime<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">status</span> <span style="color:#000;font-weight:bold">=</span> status<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">goodsId</span> <span style="color:#000;font-weight:bold">=</span> goodsId<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">time</span> <span style="color:#000;font-weight:bold">=</span> time<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//getã€set...ç•¥
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h5 id="6322-æ’é˜Ÿå®ç°">6.3.2.2 æ’é˜Ÿå®ç°</h5>
<p>æˆ‘ä»¬å¯ä»¥å°†ç§’æ€æŠ¢å•ä¿¡æ¯å­˜å…¥åˆ°Redisä¸­,è¿™é‡Œé‡‡ç”¨Listæ–¹å¼å­˜å‚¨,Listæœ¬èº«æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œç”¨æˆ·ç‚¹å‡»æŠ¢è´­çš„æ—¶å€™ï¼Œå°±å°†ç”¨æˆ·æŠ¢è´­ä¿¡æ¯å­˜å…¥åˆ°Redisä¸­ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Service</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">SeckillOrderServiceImpl</span> <span style="color:#000;font-weight:bold">implements</span> SeckillOrderService <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> MultiThreadingCreateOrder multiThreadingCreateOrder<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> RedisTemplate redisTemplate<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/****
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * æ·»åŠ è®¢å•
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param id
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param time
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param username
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> Boolean <span style="color:#900;font-weight:bold">add</span><span style="color:#000;font-weight:bold">(</span>Long id<span style="color:#000;font-weight:bold">,</span> String time<span style="color:#000;font-weight:bold">,</span> String username<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//æ’é˜Ÿä¿¡æ¯å°è£…
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        SeckillStatus seckillStatus <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> SeckillStatus<span style="color:#000;font-weight:bold">(</span>username<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">new</span> Date<span style="color:#000;font-weight:bold">(),</span>1<span style="color:#000;font-weight:bold">,</span> id<span style="color:#000;font-weight:bold">,</span>time<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//å°†ç§’æ€æŠ¢å•ä¿¡æ¯å­˜å…¥åˆ°Redisä¸­,è¿™é‡Œé‡‡ç”¨Listæ–¹å¼å­˜å‚¨,Listæœ¬èº«æ˜¯ä¸€ä¸ªé˜Ÿåˆ—
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        redisTemplate<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">boundListOps</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;SeckillOrderQueue&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">leftPush</span><span style="color:#000;font-weight:bold">(</span>seckillStatus<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//å¤šçº¿ç¨‹æ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        multiThreadingCreateOrder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createOrder</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>å¤šçº¿ç¨‹æ¯æ¬¡ä»é˜Ÿåˆ—ä¸­è·å–æ•°æ®ï¼Œåˆ†åˆ«è·å–ç”¨æˆ·åå’Œè®¢å•å•†å“ç¼–å·ä»¥åŠå•†å“ç§’æ€æ—¶é—´æ®µï¼Œè¿›è¡Œä¸‹å•æ“ä½œï¼Œä»£ç å¦‚ä¸‹ï¼š
<img src="/posts/project-0/20220528172837/image-20220528173309368.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ä¸Šå›¾ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * å¤šçº¿ç¨‹ä¸‹å•æ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Async</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">createOrder</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//ä»é˜Ÿåˆ—ä¸­è·å–æ’é˜Ÿä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    SeckillStatus seckillStatus <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>SeckillStatus<span style="color:#000;font-weight:bold">)</span> redisTemplate<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">boundListOps</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;SeckillOrderQueue&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">rightPop</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>seckillStatus<span style="color:#000;font-weight:bold">!=</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//æ—¶é—´åŒºé—´
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            String time <span style="color:#000;font-weight:bold">=</span> seckillStatus<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getTime</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//ç”¨æˆ·ç™»å½•å
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            String username<span style="color:#000;font-weight:bold">=</span>seckillStatus<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getUsername</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//ç”¨æˆ·æŠ¢è´­å•†å“
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            Long id <span style="color:#000;font-weight:bold">=</span> seckillStatus<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getGoodsId</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//...ç•¥
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>Exception e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="633-ä¸‹å•çŠ¶æ€æŸ¥è¯¢">6.3.3 ä¸‹å•çŠ¶æ€æŸ¥è¯¢</h4>
<p>æŒ‰ç…§ä¸Šé¢çš„æµç¨‹ï¼Œè™½ç„¶å¯ä»¥å®ç°ç”¨æˆ·ä¸‹å•å¼‚æ­¥æ“ä½œï¼Œä½†æ˜¯å¹¶ä¸èƒ½ç¡®å®šä¸‹å•æ˜¯å¦æˆåŠŸï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åšä¸€ä¸ªé¡µé¢åˆ¤æ–­ï¼Œæ¯è¿‡1ç§’é’ŸæŸ¥è¯¢ä¸€æ¬¡ä¸‹å•çŠ¶æ€,å¤šçº¿ç¨‹ä¸‹å•çš„æ—¶å€™ï¼Œéœ€è¦ä¿®æ”¹æŠ¢å•çŠ¶æ€ï¼Œæ”¯ä»˜çš„æ—¶å€™ï¼Œæ¸…ç†æŠ¢å•çŠ¶æ€ã€‚</p>
<h5 id="6331-ä¸‹å•æ›´æ–°æŠ¢å•çŠ¶æ€">6.3.3.1 ä¸‹å•æ›´æ–°æŠ¢å•çŠ¶æ€</h5>
<p>ç”¨æˆ·æ¯æ¬¡ç‚¹å‡»æŠ¢è´­çš„æ—¶å€™ï¼Œå¦‚æœæ’é˜ŸæˆåŠŸï¼Œåˆ™å°†ç”¨æˆ·æŠ¢è´­çŠ¶æ€å­˜å‚¨åˆ°Redisä¸­ï¼Œå¤šçº¿ç¨‹æŠ¢å•çš„æ—¶å€™ï¼Œå¦‚æœæŠ¢å•æˆåŠŸï¼Œåˆ™æ›´æ–°æŠ¢å•çŠ¶æ€ã€‚</p>
<p>ä¿®æ”¹SeckillOrderServiceImplçš„addæ–¹æ³•ï¼Œè®°å½•çŠ¶æ€ï¼Œä»£ç å¦‚ä¸‹ï¼š
<img src="/posts/project-0/20220528172837/image-20220528173315680.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ä¸Šå›¾ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">//å°†æŠ¢å•çŠ¶æ€å­˜å…¥åˆ°Redisä¸­
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>redisTemplate<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">boundHashOps</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;UserQueueStatus&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span>username<span style="color:#000;font-weight:bold">,</span>seckillStatus<span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><p>å¤šçº¿ç¨‹æŠ¢å•æ›´æ–°çŠ¶æ€ï¼Œä¿®æ”¹MultiThreadingCreateOrderçš„createOrderæ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š
<img src="/posts/project-0/20220528172837/image-20220528173320083.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ä¸Šå›¾ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">//æŠ¢å•æˆåŠŸï¼Œæ›´æ–°æŠ¢å•çŠ¶æ€,æ’é˜Ÿ-&gt;ç­‰å¾…æ”¯ä»˜
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>seckillStatus<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setStatus</span><span style="color:#000;font-weight:bold">(</span>2<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>seckillStatus<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setOrderId</span><span style="color:#000;font-weight:bold">(</span>seckillOrder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getId</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>seckillStatus<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setMoney</span><span style="color:#000;font-weight:bold">(</span>seckillOrder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMoney</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">floatValue</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>redisTemplate<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">boundHashOps</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;UserQueueStatus&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span>username<span style="color:#000;font-weight:bold">,</span>seckillStatus<span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><h5 id="6332-åå°æŸ¥è¯¢æŠ¢å•çŠ¶æ€">6.3.3.2 åå°æŸ¥è¯¢æŠ¢å•çŠ¶æ€</h5>
<p>åå°æä¾›æŠ¢å•çŠ¶æ€æŸ¥è¯¢æ–¹æ³•ï¼Œä¿®æ”¹SeckillOrderServiceï¼Œæ·»åŠ å¦‚ä¸‹æŸ¥è¯¢æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * æŠ¢å•çŠ¶æ€æŸ¥è¯¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * @param username
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span>SeckillStatus <span style="color:#900;font-weight:bold">queryStatus</span><span style="color:#000;font-weight:bold">(</span>String username<span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><p>ä¿®æ”¹SeckillOrderServiceImpl,æ·»åŠ å¦‚ä¸‹å®ç°æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * æŠ¢å•çŠ¶æ€æŸ¥è¯¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * @param username
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> SeckillStatus <span style="color:#900;font-weight:bold">queryStatus</span><span style="color:#000;font-weight:bold">(</span>String username<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">(</span>SeckillStatus<span style="color:#000;font-weight:bold">)</span> redisTemplate<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">boundHashOps</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;UserQueueStatus&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span>username<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>ä¿®æ”¹SeckillOrderController,æ·»åŠ å¦‚ä¸‹æŸ¥è¯¢æ–¹æ³•ï¼š
<img src="/posts/project-0/20220528172837/image-20220528173326644.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ä¸Šå›¾ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/****
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * æŸ¥è¯¢æŠ¢è´­
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RequestMapping</span><span style="color:#000;font-weight:bold">(</span>value <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;/query&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> Result <span style="color:#900;font-weight:bold">queryStatus</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//è·å–ç”¨æˆ·å
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    String username <span style="color:#000;font-weight:bold">=</span> tokenDcode<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getUserInfo</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;username&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·æŠ¢è´­çŠ¶æ€
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    SeckillStatus seckillStatus <span style="color:#000;font-weight:bold">=</span> seckillOrderService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">queryStatus</span><span style="color:#000;font-weight:bold">(</span>username<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>seckillStatus<span style="color:#000;font-weight:bold">!=</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">new</span> Result<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span>seckillStatus<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getStatus</span><span style="color:#000;font-weight:bold">(),</span><span style="color:#d14">&#34;æŠ¢è´­çŠ¶æ€&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//NOTFOUNDERROR =20006,æ²¡æœ‰å¯¹åº”çš„æŠ¢è´­æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">new</span> Result<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">,</span>StatusCode<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">NOTFOUNDERROR</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;æ²¡æœ‰æŠ¢è´­ä¿¡æ¯&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h5 id="6333-æµ‹è¯•">6.3.3.3 æµ‹è¯•</h5>
<p>ä½¿ç”¨Postmanæµ‹è¯•æŸ¥è¯¢çŠ¶æ€</p>
<p>http://localhost:8001/api/seckillOrder/query
<img src="/posts/project-0/20220528172837/image-20220528173333338.png"
    
    
    
    loading="lazy"
    
    
></p>

    </div>

    

    


    <div class="container-prevnext">
    <div><a href="https://lovemjh.vercel.app/posts/project-0/20220528172145/">â† æ”¯ä»˜å®æ”¯ä»˜</a></div>
    <div><a href="https://lovemjh.vercel.app/posts/project-0/20220528173393/">ç§’æ€é«˜çº§  â†’</a></div>
</div>
</div>

        </div>
        <div id="footer"><div class="container-footer">
    
    <a href="//beian.miit.gov.cn" target="_blank">
        
        è±«ICPå¤‡2022002918å·
        
    </a>
    <a id="s" href="/secrets">&nbsp;</a>
</div></div>
    </body>
</html>
