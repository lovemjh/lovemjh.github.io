<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="ÊêúÁ¥¢Ëß£ÂÜ≥ÊñπÊ°à-Elasticsearch - https://lovemjh.vercel.app/posts/project-0/20220527224880/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>ÊêúÁ¥¢Ëß£ÂÜ≥ÊñπÊ°à-Elasticsearch</title>
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    <link rel="stylesheet" href="https://lovemjh.vercel.app/style.min.824365c118b34524ce845ac2a294220354719cca11af5b27a81b04c173bbba57.css">
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate cool">
        <div id="header"><div class="container-header">
    <div id="vars" class="container-vars" style="display: none;">
	{
		"hasFoldAllCodeBlocks": false,
		"svgColor": "#6c757d",
		"en": false,
		"dark": false
	}
</div>
    <h1 class="title">
        
            ÊêúÁ¥¢Ëß£ÂÜ≥ÊñπÊ°à-Elasticsearch
            
        
    </h1>

    <div class="container-breadcrumb-nav">
    
    <div class="breadcrumb-nav-bar">
        <div><a href="/"><svg t="1656411084410" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2954" width="16" height="16"><path d="M947.5 390.6l-377-290c-34.5-26.5-82.6-26.5-117.1 0l-377 290c-14 10.8-16.6 30.9-5.9 44.9 10.8 14 30.9 16.6 44.9 5.9l28.5-21.9V768c0 88.2 71.8 160 160 160h80c35.3 0 64-28.7 64-64V640c0-17.6 14.4-32 32-32h64c17.6 0 32 14.4 32 32v224c0 35.3 28.7 64 64 64h80c88.2 0 160-71.8 160-160V419.4l28.5 21.9c5.8 4.5 12.7 6.6 19.5 6.6 9.6 0 19.1-4.3 25.4-12.5 10.8-13.9 8.2-34-5.8-44.8zM816 768c0 52.9-43.1 96-96 96h-80V640c0-52.9-43.1-96-96-96h-64c-52.9 0-96 43.1-96 96v224h-80c-52.9 0-96-43.1-96-96V370.2l284.5-218.8c11.5-8.8 27.5-8.8 39 0L816 370.2V768z" fill=#6c757d p-id="2955"></path></svg></a></div>
        <div><a href="/nav"><svg t="1656411531924" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5827" width="16" height="16"><path d="M849.59197473 125.23018519L139.22930586 391.72854662a23.35052669 23.35052669 0 0 0-14.95414244 21.65490745c-0.12257519 9.70384955 5.61801843 18.46795771 14.40255493 22.04306141l318.42928099 129.25528056 119.51057092 320.39047893c3.06437293 8.23295069 10.35758221 13.89182751 18.7335381 14.87242563l2.7170774 0.14300521a22.79893918 22.79893918 0 0 0 21.20546682-15.36272638l259.51158924-729.54564933a23.8612558 23.8612558 0 0 0-5.31158128-24.55584682 22.3290685 22.3290685 0 0 0-23.9021142-5.43415649zM793.65694081 211.64552314l-196.63064161 552.75171747-91.91077952-246.37564122-253.62799211-102.96295445 542.16941324-203.4131218z" p-id="5828" fill=#6c757d></path></svg></a></div>
        <div><a href="/search"><svg t="1656411627509" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1730" width="14" height="14"><path d="M469.333333 85.333333c211.968 0 384 172.032 384 384s-172.032 384-384 384-384-172.032-384-384 172.032-384 384-384z m0 682.666667c164.992 0 298.666667-133.674667 298.666667-298.666667 0-165.034667-133.674667-298.666667-298.666667-298.666666-165.034667 0-298.666667 133.632-298.666666 298.666666 0 164.992 133.632 298.666667 298.666666 298.666667z m362.026667 3.029333l120.704 120.661334-60.373333 60.373333-120.661334-120.704 60.330667-60.330667z" p-id="1731" fill=#6c757d></path></svg></a></div>
        <div><a href="/posts"><svg t="1656411724198" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5655" width="12" height="12"><path d="M811.705761 1024H212.294239c-93.1199 0-174.823046-87.570975-174.823046-187.387854V162.322018C37.471193 69.776145 112.604921 0 212.294239 0H596.190595l7.015883 5.93161c111.74388 95.479788 185.857116 170.741078 279.614824 266.093304 29.65805 30.040735 61.165743 62.122454 96.436499 97.393211l7.271006 7.334787v459.859234c-0.063781 99.816879-81.703145 187.387854-174.823046 187.387854zM212.294239 49.94033c-72.391155 0-124.882716 47.261538-124.882716 112.381688v674.290128c0 71.94469 59.507443 137.383743 124.882716 137.383743h599.411522c65.311492 0 124.882716-65.439053 124.882716-137.383743V397.417876c-32.528184-32.464404-61.73977-62.250016-89.356836-90.377328-90.951355-92.418312-163.278729-165.957521-269.601245-257.163999H212.294239z" fill=#6c757d p-id="5656"></path><path d="M936.588477 449.526752h-212.326129c-99.753099 0-187.324073-81.703145-187.324073-174.823046V49.94033a25.002055 25.002055 0 0 1 49.94033 0v224.763376c0 65.311492 65.502834 124.882716 137.383743 124.882716h212.326129a25.002055 25.002055 0 1 1 0 49.94033z" fill=#6c757d p-id="5657"></path></svg></a></div>
        <div><a href="/archive"><svg t="1656411795742" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7334" width="12" height="12"><path d="M884.224 522.24H504.32V141.824c0-16.896-13.824-30.72-30.72-30.72-120.32 0-233.472 47.616-317.952 134.144S26.112 445.952 29.184 566.784c2.56 114.688 49.152 222.72 131.072 304.128 81.92 81.408 189.952 128 304.64 130.56h10.24c117.76 0 227.84-45.568 312.32-128.512 86.528-85.504 133.632-199.68 132.608-321.024-0.512-2.048-1.536-29.696-35.84-29.696z m-140.288 307.712c-74.752 73.728-173.056 112.64-277.504 110.592-205.824-4.608-370.688-169.472-375.296-374.784-3.072-104.448 35.84-202.752 108.544-277.504 65.536-67.072 151.552-107.52 243.712-114.688v378.88c0 16.896 13.824 30.72 30.72 30.72 129.024 0 311.296 0 382.976 0.512-6.144 93.184-46.08 179.712-113.152 246.272z" fill=#6c757d p-id="7335"></path><path d="M603.136 11.264c-8.192-0.512-15.872 3.072-22.016 8.704-5.632 5.632-9.216 13.824-9.216 22.016v378.88c0 16.896 13.824 30.72 30.72 30.72h378.88c16.896 0 30.72-13.824 30.72-30.72 0-223.744-183.808-407.552-409.088-409.6z m30.208 378.88V74.24c167.424 16.384 301.056 150.016 315.904 315.904h-315.904z" fill=#6c757d p-id="7336"></path></svg></a></div>
        <div id="light-dark" style="cursor: pointer;"><a><svg t="1656411842215" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5086" width="12" height="12"><path d="M1007.492874 384.513055c-8.795694-34.58307-21.189627-67.666874-36.682043-99.05151-2.698679-5.397358-10.894667-3.498287-10.894666 2.598728v0.299853c0 32.484098-6.896624 63.868734-19.890263 92.554691-10.694764 23.488501-25.487523 45.077933-43.978471 64.068635-41.779547 42.679107-99.05151 66.967217-158.722299 67.26707-61.869712 0.299853-119.941284-24.188159-162.920244-68.966238-40.280281-41.979449-62.56937-98.251902-62.269516-156.323473 0.399804-59.270984 23.588452-114.94373 65.567901-156.823229 19.59041-19.59041 42.179351-35.082826 66.667364-46.077443C672.956643 71.166451 704.041426 64.469729 736.125719 64.469729h1.299364c6.097015 0 8.096037-8.096037 2.598728-10.794715C708.739126 37.982696 675.655322 25.488812 641.172203 16.493216 599.492607 5.598549 555.714038-0.098662 510.536154 0.001289 222.37722 0.700947-7.41029 237.38508 0.185992 525.444064c7.096526 271.667008 225.889418 490.559851 497.456474 497.856279 287.559228 7.796183 524.14341-220.891864 525.842579-508.551044 0.299853-44.977981-5.297407-88.656599-15.992171-130.236244z m-83.15929 301.552378c-22.588942 53.27392-54.873137 101.250434-95.953027 142.330323-41.179841 41.179841-89.056403 73.464036-142.330324 95.953027-55.172991 23.288599-113.744317 35.182777-174.314666 35.182777s-119.141675-11.794226-174.314666-35.182777c-53.27392-22.588942-101.250434-54.873137-142.330323-95.953027-41.179841-41.179841-73.464036-89.056403-95.953027-142.330323C75.749001 630.892442 63.954774 572.221164 63.954774 511.750767s11.794226-119.141675 35.182777-174.314666c22.588942-53.27392 54.873137-101.250434 95.953027-142.330323 41.179841-41.179841 89.056403-73.464036 142.330323-95.953027C392.593892 75.7642 451.26517 63.969974 511.735567 63.969974c13.99315 0 27.886348 0.599706 41.679596 1.89907C489.246577 118.643209 448.266638 198.704016 448.266638 288.360126c0 159.022152 128.836929 287.859081 287.859081 287.859081 89.156354 0 168.817357-40.580134 221.691473-104.149015 1.099462 13.09359 1.699168 26.387082 1.699168 39.680575 0 60.470397-11.794226 119.141675-35.182776 174.314666z" p-id="5087" fill=#6c757d></path></svg></a></div>
        
    </div>

    
</div>

            <div id="toc">üìú</div>
        
    
    
</div>
</div>
        <div id="content">












<div class="container-main 
     container-page 
">

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7409" width="12" height="12"><path d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z" p-id="7410" fill="#adb5bd"></path></svg>
            2022-05-27&nbsp;
        </span>
        <span>
            
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="23838" width="11" height="11"><path d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z" p-id="23839" fill="#adb5bd"></path></svg>
            2022-05-27&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="33866" width="12" height="12"><path d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z" fill="#adb5bd" p-id="33867"></path><path d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z" fill="#adb5bd" p-id="33868"></path></svg>
            9081 Â≠ó</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="32892" width="12" height="12"><path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z" p-id="32893" fill="#adb5bd"></path><path d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z" p-id="32894" fill="#adb5bd"></path></svg>
            19 ÂàÜÈíü</span><div class="container-ctgtag">
	<div class="taxonomy">
		
		<div class="ctg">
			
			
			<a href="/categories/"></a>
			
		</div>
		<div class="tag">
			
			 - 
			
			<a href="/tags/"></a>
			
		</div>
	</div>
</div>
    </div>
    
    <div class="toc">
        
        <div class="page-operation">
            <div><a href="#"><img src="/imgs/icons/arrow-up-circle.svg" alt=""></a></div>
            <div><a href="https://lovemjh.vercel.app/posts/project-0/20220527222325/"><img src="/imgs/icons/arrow-left-circle.svg" alt=""></a></div>
            <div><a href="https://lovemjh.vercel.app/posts/project-0/20220527233134/"><img src="/imgs/icons/arrow-right-circle.svg" alt=""></a></div>
        </div>
        
        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#Â≠¶‰π†ÁõÆÊ†á">Â≠¶‰π†ÁõÆÊ†á</a></li>
      </ul>
    </li>
    <li><a href="#‰∏Äelasticsearch-ÂÆâË£Ö">‰∏Ä„ÄÅElasticsearch ÂÆâË£Ö</a>
      <ul>
        <li><a href="#1dockerÈïúÂÉè‰∏ãËΩΩ">(1)dockerÈïúÂÉè‰∏ãËΩΩ</a></li>
        <li><a href="#2ÂÆâË£ÖesÂÆπÂô®">(2)ÂÆâË£ÖesÂÆπÂô®</a></li>
        <li><a href="#3ÂºÄÂêØËøúÁ®ãËøûÊé•ÂèäË∑®ÂüüÈÖçÁΩÆ">(3)ÂºÄÂêØËøúÁ®ãËøûÊé•ÂèäË∑®ÂüüÈÖçÁΩÆ</a></li>
      </ul>
    </li>
    <li><a href="#‰∫åikÂàÜËØçÂô®ÂÆâË£Ö">‰∫å„ÄÅIKÂàÜËØçÂô®ÂÆâË£Ö</a></li>
    <li><a href="#‰∏â-kibana‰ΩøÁî®-ÊéåÊè°dslËØ≠Âè•">‰∏â„ÄÅ Kibana‰ΩøÁî®-ÊéåÊè°DSLËØ≠Âè•</a>
      <ul>
        <li>
          <ul>
            <li><a href="#31--kibana‰∏ãËΩΩÂÆâË£Ö">3.1  Kibana‰∏ãËΩΩÂÆâË£Ö</a></li>
            <li><a href="#32-kibana‰ΩøÁî®">3.2 Kibana‰ΩøÁî®</a>
              <ul>
                <li><a href="#321-ÈÖçÁΩÆÁ¥¢Âºï">3.2.1 ÈÖçÁΩÆÁ¥¢Âºï</a></li>
                <li><a href="#322-Á¥¢ÂºïÁÆ°ÁêÜ">3.2.2 Á¥¢ÂºïÁÆ°ÁêÜ</a></li>
                <li><a href="#323-dslËØ≠Âè•‰ΩøÁî®">3.2.3 DSLËØ≠Âè•‰ΩøÁî®</a>
                  <ul>
                    <li><a href="#3231-query-dslÁªìÊûÑÂåñÊü•ËØ¢‰ªãÁªç">3.2.3.1 Query DSLÁªìÊûÑÂåñÊü•ËØ¢‰ªãÁªç</a></li>
                    <li><a href="#3232-ÊµãËØïÂàÜËØç">3.2.3.2 ÊµãËØïÂàÜËØç</a></li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#ÂõõÊï∞ÊçÆÂØºÂÖ•es">Âõõ„ÄÅÊï∞ÊçÆÂØºÂÖ•ES</a>
      <ul>
        <li>
          <ul>
            <li><a href="#41-springdata-elasticsearch‰ªãÁªç">4.1 SpringData Elasticsearch‰ªãÁªç</a>
              <ul>
                <li><a href="#411-springdata‰ªãÁªç">4.1.1 SpringData‰ªãÁªç</a></li>
                <li><a href="#412-springdata-es‰ªãÁªç">4.1.2 SpringData ES‰ªãÁªç</a></li>
              </ul>
            </li>
            <li><a href="#42-ÊêúÁ¥¢Â∑•Á®ãÊê≠Âª∫">4.2 ÊêúÁ¥¢Â∑•Á®ãÊê≠Âª∫</a></li>
            <li><a href="#43-Êï∞ÊçÆÂØºÂÖ•">4.3 Êï∞ÊçÆÂØºÂÖ•</a>
              <ul>
                <li><a href="#431-ÊñáÊ°£Êò†Â∞ÑbeanÂàõÂª∫">4.3.1 ÊñáÊ°£Êò†Â∞ÑBeanÂàõÂª∫</a></li>
                <li><a href="#432-ÊêúÁ¥¢ÂÆ°Ê†∏ÈÄöËøásku">4.3.2 ÊêúÁ¥¢ÂÆ°Ê†∏ÈÄöËøáSku</a></li>
                <li><a href="#433-skuÂØºÂÖ•esÂÆûÁé∞">4.3.3 SkuÂØºÂÖ•ESÂÆûÁé∞</a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#‰∫îÂÖ≥ÈîÆÂ≠óÊêúÁ¥¢">‰∫î„ÄÅÂÖ≥ÈîÆÂ≠óÊêúÁ¥¢</a>
      <ul>
        <li>
          <ul>
            <li><a href="#51-ÊúçÂä°Â±ÇÂÆûÁé∞">5.1 ÊúçÂä°Â±ÇÂÆûÁé∞</a></li>
            <li><a href="#52-ÊéßÂà∂Â±ÇÂÆûÁé∞">5.2 ÊéßÂà∂Â±ÇÂÆûÁé∞</a></li>
            <li><a href="#53-ÊµãËØï">5.3 ÊµãËØï</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#ÂÖ≠-ÂàÜÁ±ªÁªüËÆ°">ÂÖ≠„ÄÅ ÂàÜÁ±ªÁªüËÆ°</a>
      <ul>
        <li>
          <ul>
            <li><a href="#61-ÂàÜÁ±ªÁªüËÆ°ÂàÜÊûê">6.1 ÂàÜÁ±ªÁªüËÆ°ÂàÜÊûê</a></li>
            <li><a href="#62-ÂàÜÁ±ªÂàÜÁªÑÁªüËÆ°ÂÆûÁé∞">6.2 ÂàÜÁ±ªÂàÜÁªÑÁªüËÆ°ÂÆûÁé∞</a></li>
            <li><a href="#63-ÊµãËØï">6.3 ÊµãËØï</a></li>
            <li><a href="#64-‰ª£Á†Å‰ºòÂåñ">6.4 ‰ª£Á†Å‰ºòÂåñ</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
    </div>

    <div class='content  content '>
        <h1 align = "center">Á¨¨ÂÖ≠Á´†</h1>
<h1 align = "center">ÊêúÁ¥¢Ëß£ÂÜ≥ÊñπÊ°à-Elasticsearch</h1>
<h3 align="center">‰ºòÂ∞±‰∏ö.JAVAÊïôÁ†îÂÆ§</h3>
<h2 id="Â≠¶‰π†ÁõÆÊ†á">Â≠¶‰π†ÁõÆÊ†á</h2>
<ul>
<li>Elasticsearch„ÄÅKibanaÁéØÂ¢ÉÈÖçÁΩÆ</li>
<li>DSLËØ≠Âè•ËÆ≤Ëß£</li>
<li>ÂïÜÂìÅÁ¥¢ÂºïÂ∫ìÂØºÂÖ•ËÆ≤Ëß£</li>
<li>ÂïÜÂìÅÂÖ≥ÈîÆËØçÊêúÁ¥¢ÂÆûÁé∞</li>
<li>ÂàÜÁ±ªÁªüËÆ°ÊêúÁ¥¢</li>
</ul>
<h1 id="‰∏Äelasticsearch-ÂÆâË£Ö">‰∏Ä„ÄÅElasticsearch ÂÆâË£Ö</h1>
<p>ElasticSearchÊòØ‰∏Ä‰∏™Âü∫‰∫éLuceneÁöÑÊêúÁ¥¢ÊúçÂä°Âô®„ÄÇÂÆÉÊèê‰æõ‰∫Ü‰∏Ä‰∏™ÂàÜÂ∏ÉÂºèÂ§öÁî®Êà∑ËÉΩÂäõÁöÑÂÖ®ÊñáÊêúÁ¥¢ÂºïÊìéÔºåÂü∫‰∫éRESTfulwebÊé•Âè£„ÄÇElasticSearchÊòØÁî®JavaÂºÄÂèëÁöÑÔºåÂπ∂‰Ωú‰∏∫ApacheËÆ∏ÂèØÊù°Ê¨æ‰∏ãÁöÑÂºÄÊîæÊ∫êÁ†ÅÂèëÂ∏ÉÔºåÊòØÂΩìÂâçÊµÅË°åÁöÑ‰ºÅ‰∏öÁ∫ßÊêúÁ¥¢ÂºïÊìé„ÄÇËÆæËÆ°Áî®‰∫é‰∫ëËÆ°ÁÆó‰∏≠ÔºåËÉΩÂ§üËææÂà∞ÂÆûÊó∂ÊêúÁ¥¢ÔºåÁ®≥ÂÆöÔºåÂèØÈù†ÔºåÂø´ÈÄüÔºåÂÆâË£Ö‰ΩøÁî®Êñπ‰æø„ÄÇÊûÑÂª∫Âú®ÂÖ®ÊñáÊ£ÄÁ¥¢ÂºÄÊ∫êËΩØ‰ª∂Lucene‰πã‰∏äÁöÑElasticsearchÔºå‰∏ç‰ªÖËÉΩÂØπÊµ∑ÈáèËßÑÊ®°ÁöÑÊï∞ÊçÆÂÆåÊàêÂàÜÂ∏ÉÂºèÁ¥¢Âºï‰∏éÊ£ÄÁ¥¢ÔºåËøòËÉΩÊèê‰æõÊï∞ÊçÆËÅöÂêàÂàÜÊûê„ÄÇÊçÆÂõΩÈôÖÊùÉÂ®ÅÁöÑÊï∞ÊçÆÂ∫ì‰∫ßÂìÅËØÑÊµãÊú∫ÊûÑDBEnginesÁöÑÁªüËÆ°ÔºåÂú®2016Âπ¥1ÊúàÔºåElasticsearchÂ∑≤Ë∂ÖËøáSolrÁ≠âÔºåÊàê‰∏∫ÊéíÂêçÁ¨¨‰∏ÄÁöÑÊêúÁ¥¢ÂºïÊìéÁ±ªÂ∫îÁî®</p>
<p>ÁÆÄ‰πãÔºöElasticSearchÊòØÂü∫‰∫éRestfull‰πêÂáÜÁöÑÈ´òÊâ©Â±ïÈ´òÂèØÁî®ÁöÑÂÆûÊó∂Êï∞ÊçÆÂàÜÊûêÁöÑÂÖ®ÊñáÊêúÁ¥¢Â∑•ÂÖ∑„ÄÇ</p>
<p>Âü∫Êú¨Ê¶ÇÂøµ</p>
<p><img src="/posts/project-0/20220527224880/image-20220527225257010.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>Ê≠§Â§ÑÈúÄË¶ÅÊ≥®ÊÑèÔºöÂÖ≥‰∫éÁ±ªÂûãtypeÂú®‰∏çÂêåÁâàÊú¨ÊòØÊúâÊâÄÂèòÂåñÁöÑ</p>
<p>Elasticsearch ÂÆòÁΩëÊèêÂá∫ÁöÑËøëÊúüÁâàÊú¨ÂØπ type Ê¶ÇÂøµÁöÑÊºîÂèòÊÉÖÂÜµÂ¶Ç‰∏ãÔºö</p>
<p>Âú® <strong>5.X</strong> ÁâàÊú¨‰∏≠Ôºå<strong>‰∏Ä‰∏™ index</strong> ‰∏ã<strong>ÂèØ‰ª•ÂàõÂª∫Â§ö‰∏™ type</strong>Ôºõ</p>
<p>Âú® <strong>6.X</strong> ÁâàÊú¨‰∏≠Ôºå<strong>‰∏Ä‰∏™ index</strong> ‰∏ã<strong>Âè™ËÉΩÂ≠òÂú®‰∏Ä‰∏™ type</strong>Ôºõ</p>
<p>Âú® <strong>7.X</strong> ÁâàÊú¨‰∏≠ÔºåÁõ¥Êé•<strong>ÂéªÈô§‰∫Ü type</strong> ÁöÑÊ¶ÇÂøµÔºåÂ∞±ÊòØËØ¥ <strong>index ‰∏çÂÜç‰ºöÊúâ type</strong>„ÄÇ</p>
<p>‰∏ªË¶ÅÁõÆÁöÑÂ∞±ÊòØ ‰∏∫‰∫Ü‰øùÊåÅ Elasticsearch ‚Äú<strong>‰∏ÄÂàá‰∏∫‰∫ÜÊêúÁ¥¢</strong>‚Äù ÁöÑÂÆóÊó®</p>
<p>Áî±‰∫éÊàë‰ª¨‰πãÂâçÂ∑≤Áªè‰ΩøÁî®Ëøáelasticsearch‰∫ÜÔºåËøôÈáå‰∏çÂÜçÂØπÂÆÉËøõË°åËøáÂ§öÁöÑ‰ªãÁªç‰∫ÜÔºåÁõ¥Êé•‰∏ãËΩΩÂÆâË£ÖÔºåÊú¨Á´†ËäÇÂ∞ÜÈááÁî®DockerÂÆâË£ÖÔºå‰∏çËøáÂú®Â∏ÇÈù¢‰∏äËøòÊúâÂæàÂ§öÈááÁî®linxuÂÆâË£ÖÔºåÂÖ≥‰∫élinuxÂÆâË£ÖÔºåÂ∑≤ÁªèÊèê‰æõ‰∫ÜÂÆâË£ÖÊâãÂÜåÔºåËøôÈáåÂ∞±‰∏çËÆ≤‰∫Ü„ÄÇ</p>
<p>Êàë‰ª¨‰πãÂâçÂ∑≤Áªè‰ΩøÁî®Ëøáelasticsearch‰∫ÜÔºåËøôÈáå‰∏çÂÜçÂØπÂÆÉËøõË°å‰ªãÁªç‰∫ÜÔºåÁõ¥Êé•‰∏ãËΩΩÂÆâË£ÖÔºåÊú¨Á´†ËäÇÂ∞ÜÈááÁî®DockerÂÆâË£ÖÔºå‰∏çËøáÂú®Â∏ÇÈù¢‰∏äËøòÊúâÂæàÂ§öÈááÁî®linxuÂÆâË£ÖÔºåÂÖ≥‰∫élinuxÂÆâË£ÖÔºåÂ∑≤ÁªèÊèê‰æõ‰∫ÜÂÆâË£ÖÊâãÂÜåÔºåËøôÈáåÂ∞±‰∏çËÆ≤‰∫Ü„ÄÇ</p>
<h2 id="1dockerÈïúÂÉè‰∏ãËΩΩ">(1)dockerÈïúÂÉè‰∏ãËΩΩ</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#008080">docker</span> <span style="color:#d14">pull elasticsearch:7.7.0</span>
</span></span></code></pre></div><p>Ê≥®ÊÑèÔºöÂª∫ËÆÆËøòÂéüÈïúÂÉèÂ§á‰ªΩÊñá‰ª∂</p>
<pre tabindex="0"><code>docker load -i elasticsearch7.7.tar
</code></pre><h2 id="2ÂÆâË£ÖesÂÆπÂô®">(2)ÂÆâË£ÖesÂÆπÂô®</h2>
<p>Âõ†‰∏∫elasticsearchÂú®ÂêØÂä®ÁöÑÊó∂ÂÄô‰ºöËøõË°å‰∏Ä‰∫õÊ£ÄÊü•ÔºåÊØîÂ¶ÇÊúÄÂ§öÊâìÂºÄÁöÑÊñá‰ª∂ÁöÑ‰∏™Êï∞‰ª•ÂèäËôöÊãüÂÜÖÂ≠òÂå∫ÂüüÊï∞ÈáèÁ≠âÁ≠âÔºåÊâÄ‰ª•Êàë‰ª¨ÈúÄË¶ÅÂÖàËøõË°åÁ≥ªÁªüË∞É‰ºòÔºåÈúÄË¶ÅÂú®ËôöÊãüÊú∫‰∏ãËÆæÁΩÆ<code>max_map_count</code>ÔºåÂê¶ÂàôelasticsearchÂÆπÂô®‰ºöÂêØÂä®‰∏çËµ∑Êù•
Êü•Áúã<code>max_map_count</code>ÁöÑÂÄº ÈªòËÆ§ÊòØ65530</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat /proc/sys/vm/max_map_count
</span></span></code></pre></div><p>ÈáçÊñ∞ËÆæÁΩÆ<code>max_map_count</code>ÁöÑÂÄº</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sysctl -w vm.max_map_count<span style="color:#000;font-weight:bold">=</span><span style="color:#099">262144</span>
</span></span></code></pre></div><p>ÁÑ∂ÂêéÊâßË°åËøêË°åÂÆπÂô®ÂëΩ‰ª§ÔºåÂ¶Ç‰∏ã</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#008080">docker</span> <span style="color:#d14">run -di --name dym_es -p 9200:9200 -p 9300:9300 -e &#34;discovery.type=single-node&#34; -e &#34;ES_JAVA_OPTS=-Xms512m -Xmx512m&#34;  elasticsearch:7.7.0 </span>
</span></span></code></pre></div><p>ÂëΩ‰ª§Ëß£ÈáäÔºö</p>
<p>9200Á´ØÂè£(WebÁÆ°ÁêÜÂπ≥Âè∞Á´ØÂè£)  9300(ÊúçÂä°ÈªòËÆ§Á´ØÂè£)</p>
<p><code>-e ES_JAVA_OPTS=&quot;-Xms512m -Xmx512m&quot;</code>ÊòØËÆæÁΩÆÂç†Áî®ÂÜÖÂ≠òÂ§ßÂ∞èÔºå‰∏ÄËà¨Á∫ø‰∏äÊ£ÄÁ¥¢ÊúçÂä°Âô®-ESÊúçÂä°Âô®32GÔºåËøôÈáåÂ∞±Â∞è‰∏ÄÁÇπÊµãËØï</p>
<p><code>-e &quot;discovery.type=single-node&quot;</code>Ëøô‰∏™ÊòØËÆæÁΩÆÂçïËäÇÁÇπËøêË°å</p>
<h2 id="3ÂºÄÂêØËøúÁ®ãËøûÊé•ÂèäË∑®ÂüüÈÖçÁΩÆ">(3)ÂºÄÂêØËøúÁ®ãËøûÊé•ÂèäË∑®ÂüüÈÖçÁΩÆ</h2>
<p>Â∞ÜelasticsearchÂÆπÂô®ÂÜÖÈÉ®ÁöÑ/usr/share/elasticsearch/config/elasticsearch.ymlÈÖçÁΩÆÊñá‰ª∂Êã∑Ë¥ùÂà∞ËôöÊãüÊú∫ÁöÑrootÁõÆÂΩï‰∏ãÔºåÁºñËæëÂ¢ûÂä†‰ª•‰∏ãÂëΩ‰ª§„ÄÇ</p>
<p>Êã∑Ë¥ùÂëΩ‰ª§Ôºö</p>
<pre tabindex="0"><code>docker cp dym_es:/usr/share/elasticsearch/config/elasticsearch.yml /root/elasticsearch.yml
</code></pre><p>ÁºñËæëelasticsearch.yml</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#008080">cluster.name</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">my-application</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">http.cors.enabled</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">true</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">http.cors.allow-origin</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;*&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">network.host</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">0.0.0.0</span>
</span></span></code></pre></div><p>ÂÖ∂‰∏≠Ôºö</p>
<p>cluster.nameÔºöËá™ÂÆö‰πâÈõÜÁæ§ÂêçÁß∞„ÄÇ
network.hostÔºöÂΩìÂâçesËäÇÁÇπÁªëÂÆöÁöÑipÂú∞ÂùÄÔºåÈªòËÆ§127.0.0.1ÔºåÂ¶ÇÊûúÈúÄË¶ÅÂºÄÊîæÂØπÂ§ñËÆøÈóÆËøô‰∏™Â±ûÊÄßÂøÖÈ°ªËÆæÁΩÆ„ÄÇhttp.cors.enabled: trueÔºöÊ≠§Ê≠•‰∏∫ÂÖÅËÆ∏elasticsearchË∑®ÂüüËÆøÈóÆÔºåÈªòËÆ§ÊòØfalse„ÄÇ
<code>http.cors.allow-origin: &quot;*&quot;</code>ÔºöË°®Á§∫Ë∑®ÂüüËÆøÈóÆÂÖÅËÆ∏ÁöÑÂüüÂêçÂú∞ÂùÄÔºà*Ë°®Á§∫‰ªªÊÑèÔºâ„ÄÇ</p>
<p>Âà†Èô§‰πãÂâçÁöÑesÂÆπÂô®ÔºåÂπ∂ÈáçÊñ∞ÊâßË°åËøêË°åÂÆπÂô®ÂëΩ‰ª§</p>
<pre tabindex="0"><code>docker rm -f dym_es
</code></pre><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker run -di --name dym_es -p 9200:9200 -p 9300:9300 -e <span style="color:#d14">&#34;discovery.type=single-node&#34;</span> -e <span style="color:#d14">&#34;ES_JAVA_OPTS=-Xms512m -Xmx512m&#34;</span> -v /root/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml elasticsearch:7.7.0
</span></span></code></pre></div><p>ÊµèËßàÂô®ËæìÂÖ•Âú∞ÂùÄËÆøÈóÆÔºö`http://192.168.188.128:9200/
<img src="/posts/project-0/20220527224880/image-20220527230503925.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>Â∞èÊèêÁ§∫ÔºöÂ¶ÇÊûúÊÉ≥ËÆ©ÂÆπÂô®ÂºÄÂêØÈáçÂêØÔºåÂèØ‰ª•ÊâßË°å‰∏ãÈù¢ÂëΩ‰ª§</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#008080">docker</span> <span style="color:#d14">update --restart=always dym_es</span>
</span></span></code></pre></div><h1 id="‰∫åikÂàÜËØçÂô®ÂÆâË£Ö">‰∫å„ÄÅIKÂàÜËØçÂô®ÂÆâË£Ö</h1>
<p>(1)ÂÆâË£ÖikÂàÜËØçÂô®</p>
<p>IKÂàÜËØçÂô®‰∏ãËΩΩÂú∞ÂùÄhttps://github.com/medcl/elasticsearch-analysis-ik/releases</p>
<p>‰∏ä‰º†ÂàÜËØçÂô®ÂéãÁº©Êñá‰ª∂Âà∞linuxÊúçÂä°Âô®ÔºåÊã∑Ë¥ùÊñá‰ª∂Âà∞ESÂÆπÂô®</p>
<pre tabindex="0"><code>docker cp /root/elasticsearch-analysis-ik-7.7.0.zip   dym_es:/usr/share/elasticsearch/plugins/elasticsearch-analysis-ik-7.7.0.zip
</code></pre><p>ËøõÂÖ•ÂÆπÂô®ÂÆâË£ÖikÂàÜËØçÂô®</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#008080">docker</span> <span style="color:#d14">exec -it dym_es /bin/bash</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">cd</span>  <span style="color:#d14">/usr/share/elasticsearch/plugins/</span>
</span></span></code></pre></div><p>Âú®pluginsÁõÆÂΩï‰∏ãÂÆâË£ÖikÂàÜËØçÂô®ÔºåikÂàÜËØçÂô®ÈúÄË¶ÅÂíåesÁâàÊú¨‰∏ÄËá¥</p>
<p>‰ΩøÁî®‰∏ä‰º†ÁöÑÊèí‰ª∂ÂéãÁº©ÂåÖÂÆâË£ÖÔºö</p>
<pre tabindex="0"><code>mkdir ik
mv elasticsearch-analysis-ik-7.7.0.zip  ik/
cd ik
unzip elasticsearch-analysis-ik-7.7.0.zip
</code></pre><p>‰πüÂèØ‰ª•Âü∫‰∫éÁΩëÁªúÂÆâË£ÖÔºö</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#008080">elasticsearch-plugin</span> <span style="color:#d14">install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.7.0/elasticsearch-analysis-ik-7.7.0.zip</span>
</span></span></code></pre></div><p>ÈÄÄÂá∫ÂÆπÂô®Âπ∂ÈáçÂêØ</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker restart dym_es
</span></span></code></pre></div><p>ÊµãËØïÂÆâË£ÖÊàêÂäüÔºåÂú∞ÂùÄÊ†èËæìÂÖ•Ôºö</p>
<p>http://192.168.188.128:9200/_cat/plugins
<img src="/posts/project-0/20220527224880/image-20220527230518571.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>IKÂàÜËØçÂô®Êúâ‰∏§ÁßçÂàÜËØçÊ®°ÂºèÔºöik_max_wordÂíåik_smartÊ®°Âºè„ÄÇ</p>
<p>1„ÄÅik_max_word</p>
<p>‰ºöÂ∞ÜÊñáÊú¨ÂÅöÊúÄÁªÜÁ≤íÂ∫¶ÁöÑÊãÜÂàÜÔºåÊØîÂ¶Ç‰ºöÂ∞Ü‚Äú‰∏≠Âçé‰∫∫Ê∞ëÂÖ±ÂíåÂõΩ‰∫∫Ê∞ëÂ§ß‰ºöÂ†Ç‚ÄùÊãÜÂàÜ‰∏∫‚Äú‰∏≠Âçé‰∫∫Ê∞ë„ÄÅ‰∏≠Âçé„ÄÅÂçé‰∫∫„ÄÅ‰∫∫Ê∞ëÂÖ±ÂíåÂõΩ„ÄÅ‰∫∫Ê∞ë„ÄÅÂÖ±ÂíåÂõΩ„ÄÅÂ§ß‰ºöÂ†Ç„ÄÅÂ§ß‰ºö„ÄÅ‰ºöÂ†ÇÁ≠âËØçËØ≠„ÄÇ</p>
<p>2„ÄÅik_smart
‰ºöÂÅöÊúÄÁ≤óÁ≤íÂ∫¶ÁöÑÊãÜÂàÜÔºåÊØîÂ¶Ç‰ºöÂ∞Ü‚Äú‰∏≠Âçé‰∫∫Ê∞ëÂÖ±ÂíåÂõΩ‰∫∫Ê∞ëÂ§ß‰ºöÂ†Ç‚ÄùÊãÜÂàÜ‰∏∫‰∏≠Âçé‰∫∫Ê∞ëÂÖ±ÂíåÂõΩ„ÄÅ‰∫∫Ê∞ëÂ§ß‰ºöÂ†Ç„ÄÇ</p>
<p>‰∏§ÁßçÂàÜËØçÂô®‰ΩøÁî®ÁöÑÊúÄ‰Ω≥ÂÆûË∑µÊòØÔºöÁ¥¢ÂºïÊó∂Áî®ik_max_wordÔºåÂú®ÊêúÁ¥¢Êó∂Áî®ik_smart„ÄÇ
<strong>Âç≥ÔºöÁ¥¢ÂºïÊó∂ÊúÄÂ§ßÂåñÁöÑÂ∞ÜÊñáÁ´†ÂÜÖÂÆπÂàÜËØçÔºåÊêúÁ¥¢Êó∂Êõ¥Á≤æÁ°ÆÁöÑÊêúÁ¥¢Âà∞ÊÉ≥Ë¶ÅÁöÑÁªìÊûú„ÄÇ</strong></p>
<h1 id="‰∏â-kibana‰ΩøÁî®-ÊéåÊè°dslËØ≠Âè•">‰∏â„ÄÅ Kibana‰ΩøÁî®-ÊéåÊè°DSLËØ≠Âè•</h1>
<p>Êàë‰ª¨ËøôÈáåÈúÄË¶Å‰∏Ä‰∏™Êõ¥‰∏ì‰∏öÁöÑÂ∑•ÂÖ∑ÂÆûÁé∞ÂØπÊó•ÂøóÁöÑÂÆûÊó∂ÂàÜÊûêÔºå‰πüÂ∞±ÊòØÊàë‰ª¨Êé•‰∏ãÊù•Ë¶ÅËÆ≤ÁöÑkibana„ÄÇ</p>
<p>Kibana ÊòØ‰∏ÄÊ¨æÂºÄÊ∫êÁöÑÊï∞ÊçÆÂàÜÊûêÂíåÂèØËßÜÂåñÂπ≥Âè∞ÔºåÂÆÉÊòØ Elastic Stack ÊàêÂëò‰πã‰∏ÄÔºåËÆæËÆ°Áî®‰∫éÂíå Elasticsearch Âçè‰Ωú„ÄÇÊÇ®ÂèØ‰ª•‰ΩøÁî® Kibana ÂØπ Elasticsearch Á¥¢Âºï‰∏≠ÁöÑÊï∞ÊçÆËøõË°åÊêúÁ¥¢„ÄÅÊü•Áúã„ÄÅ‰∫§‰∫íÊìç‰Ωú„ÄÇÊÇ®ÂèØ‰ª•ÂæàÊñπ‰æøÁöÑÂà©Áî®ÂõæË°®„ÄÅË°®Ê†ºÂèäÂú∞ÂõæÂØπÊï∞ÊçÆËøõË°åÂ§öÂÖÉÂåñÁöÑÂàÜÊûêÂíåÂëàÁé∞„ÄÇ</p>
<p>Kibana ÂèØ‰ª•‰ΩøÂ§ßÊï∞ÊçÆÈÄö‰øóÊòìÊáÇ„ÄÇÂÆÉÂæàÁÆÄÂçïÔºåÂü∫‰∫éÊµèËßàÂô®ÁöÑÁïåÈù¢‰æø‰∫éÊÇ®Âø´ÈÄüÂàõÂª∫ÂíåÂàÜ‰∫´Âä®ÊÄÅÊï∞ÊçÆ‰ª™Ë°®ÊùøÊù•ËøΩË∏™ Elasticsearch ÁöÑÂÆûÊó∂Êï∞ÊçÆÂèòÂåñ„ÄÇ</p>
<p>Êê≠Âª∫ Kibana ÈùûÂ∏∏ÁÆÄÂçï„ÄÇÊÇ®ÂèØ‰ª•ÂàÜÂàÜÈíüÂÆåÊàê Kibana ÁöÑÂÆâË£ÖÂπ∂ÂºÄÂßãÊé¢Á¥¢ Elasticsearch ÁöÑÁ¥¢ÂºïÊï∞ÊçÆ‚Äâ‚Äî‚ÄâÊ≤°Êúâ‰ª£Á†Å„ÄÅ‰∏çÈúÄË¶ÅÈ¢ùÂ§ñÁöÑÂü∫Á°ÄËÆæÊñΩ„ÄÇ</p>
<h3 id="31--kibana‰∏ãËΩΩÂÆâË£Ö">3.1  Kibana‰∏ãËΩΩÂÆâË£Ö</h3>
<p>Êàë‰ª¨È°πÁõÆ‰∏≠‰∏çÂÜç‰ΩøÁî®linuxÔºåÁõ¥Êé•‰ΩøÁî®DockerÔºåÊâÄÊúâËøôÈáåÂ∞±‰∏çÊºîÁ§∫Âú®windowsÁöÑ‰∏ãËΩΩÂÆâË£Ö‰∫Ü„ÄÇ</p>
<p>(1)ÈïúÂÉè‰∏ãËΩΩ</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#008080">docker</span> <span style="color:#d14">pull kibana:7.7.0</span>
</span></span></code></pre></div><p>‰∏∫‰∫ÜËäÇÁúÅÊó∂Èó¥,Âª∫ËÆÆËøòÂéüËôöÊãüÊú∫Â§á‰ªΩÊñá‰ª∂</p>
<pre tabindex="0"><code>docker load -i kibana7.7.tar
</code></pre><p>(2)ÂÆâË£ÖkibanaÂÆπÂô®</p>
<p>ÊâßË°åÂ¶Ç‰∏ãÂëΩ‰ª§ÔºåÂºÄÂßãÂÆâË£ÖkibanaÂÆπÂô®</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#008080">docker</span> <span style="color:#d14">run -di --link dym_es:elasticsearch --name kibana --restart=always -p 5601:5601 kibana:7.7.0</span>
</span></span></code></pre></div><p>restart=always:ÊØèÊ¨°ÊúçÂä°ÈÉΩ‰ºöÈáçÂêØÔºå‰πüÂ∞±ÊòØÂºÄÂêØÂêØÂä®</p>
<p>5601:5601:Á´ØÂè£Âè∑</p>
<p>(3)ËÆøÈóÆÊµãËØï</p>
<p>ËÆøÈóÆ<code>http://192.168.188.128:5601</code>Â¶Ç‰∏ãÔºö
<img src="/posts/project-0/20220527224880/image-20220527230531004.png"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="32-kibana‰ΩøÁî®">3.2 Kibana‰ΩøÁî®</h3>
<h4 id="321-ÈÖçÁΩÆÁ¥¢Âºï">3.2.1 ÈÖçÁΩÆÁ¥¢Âºï</h4>
<p>Ê≠§Â§ÑÊàë‰ª¨ÈÄâÊã© Âõæ‰∏≠ÊâÄÁ§∫ÔºöËá™Â∑±ÁöÑÊï∞ÊçÆ
<img src="/posts/project-0/20220527224880/image-20220527230538800.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ÈÄâÊã©‰∏äÂõæÁöÑËÆæÁΩÆÂõæÊ†á</p>
<p><img src="/posts/project-0/20220527224880/image-20220527230551964.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>Êé•‰∏ãÊù•Â∞±ÂèØ‰ª•ÂíåesËøõË°å‰∫§‰∫í‰∫Ü</p>
<h4 id="322-Á¥¢ÂºïÁÆ°ÁêÜ">3.2.2 Á¥¢ÂºïÁÆ°ÁêÜ</h4>
<p>Ë¶Å‰ΩøÁî®KibanaÔºåÊÇ®ÂøÖÈ°ªËá≥Â∞ëÈÖçÁΩÆ‰∏Ä‰∏™Á¥¢ÂºïÔºà‰ΩÜÊòØË¶ÅÊ±ÇElasticsearch‰∏≠Ë¶ÅÊúâÊï∞ÊçÆÔºâ„ÄÇÁ¥¢ÂºïÁî®‰∫éÊ†áËØÜElasticsearchÁ¥¢Âºï‰ª•ËøêË°åÊêúÁ¥¢ÂíåÂàÜÊûê„ÄÇÂÆÉ‰ª¨ËøòÁî®‰∫éÈÖçÁΩÆÂ≠óÊÆµÁ≠â„ÄÇ‰∏ãÈù¢Êàë‰ª¨ÁúãÂ¶Ç‰ΩïÁÆ°ÁêÜÊü•ÁúãÁ¥¢Âºï„ÄÇ</p>
<p>ÁÇπÂáª ËÆæÁΩÆ-ÈÄâÊã©D -Manager space</p>
<p><img src="/posts/project-0/20220527224880/image-20220527230559697.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ÈÄâÊã© Index Patterns</p>
<p><img src="/posts/project-0/20220527224880/image-20220527230612571.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ÂàõÂª∫‰∏Ä‰∏™Á¥¢Âºï</p>
<p><img src="/posts/project-0/20220527224880/image-20220527230621404.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>Ê≤°ÊúâÊï∞ÊçÆÁõÆÂâç‰∏çËÉΩÂª∫Á´ãÁ¥¢Âºï
<img src="/posts/project-0/20220527224880/image-20220527230629462.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ÂêéÈù¢Ê∑ªÂä†ËøáÁ¥¢ÂºïÂèØ‰ª•ÈÄöËøáÂ¶Ç‰∏ãÊñπÊ≥ïÊü•ÁúãÊ∑ªÂä†ÁöÑÁ¥¢Âºï</p>
<p><img src="/posts/project-0/20220527224880/image-20220527230637812.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ËæìÂÖ•Á¥¢ÂºïËßÑÂàôÔºåÁÇπÂáª‰∏ã‰∏ÄÊ≠•
<img src="/posts/project-0/20220527224880/image-20220527230648100.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ÁÇπÂáªÂàõÂª∫
<img src="/posts/project-0/20220527224880/image-20220527230654594.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ÂüüÁöÑÊØè‰∏™Ê†áÈ¢òÈÄâÈ°πÂàÜÂà´‰ª£Ë°®Â¶Ç‰∏ãÊÑèÊÄùÔºö
<img src="/posts/project-0/20220527224880/image-20220527230701373.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>‰πüÂèØ‰ª•Áõ¥Êé•Êü•Áúã ÈÄâÊã© Elasticsearch-Index Managerment Êü•ÁúãÂàõÂª∫ÁöÑÁ¥¢Âºï
<img src="/posts/project-0/20220527224880/image-20220527230709653.png"
    
    
    
    loading="lazy"
    
    
></p>
<h4 id="323-dslËØ≠Âè•‰ΩøÁî®">3.2.3 DSLËØ≠Âè•‰ΩøÁî®</h4>
<h5 id="3231-query-dslÁªìÊûÑÂåñÊü•ËØ¢‰ªãÁªç">3.2.3.1 Query DSLÁªìÊûÑÂåñÊü•ËØ¢‰ªãÁªç</h5>
<p>Query DSLÊòØ‰∏Ä‰∏™JavaÂºÄÊ∫êÊ°ÜÊû∂Áî®‰∫éÊûÑÂª∫Á±ªÂûãÂÆâÂÖ®ÁöÑSQLÊü•ËØ¢ËØ≠Âè•„ÄÇÈááÁî®API‰ª£Êõø‰º†ÁªüÁöÑÊãºÊé•Â≠óÁ¨¶‰∏≤Êù•ÊûÑÈÄ†Êü•ËØ¢ËØ≠Âè•„ÄÇÁõÆÂâçQuerydslÊîØÊåÅÁöÑÂπ≥Âè∞ÂåÖÊã¨JPA,JDOÔºåSQLÔºåJava CollectionsÔºåRDFÔºåLuceneÔºåHibernate Search„ÄÇelasticsearchÊèê‰æõ‰∫Ü‰∏ÄÊï¥Â•óÂü∫‰∫éJSONÁöÑÊü•ËØ¢DSLËØ≠Ë®ÄÊù•ÂÆö‰πâÊü•ËØ¢„ÄÇ
Query DSLÂΩì‰ΩúÊòØ‰∏ÄÁ≥ªÂàóÁöÑÊäΩË±°ÁöÑÊü•ËØ¢Ë°®ËææÂºèÊ†ë(AST)ÁâπÂÆöÊü•ËØ¢ËÉΩÂ§üÂåÖÂê´ÂÖ∂ÂÆÉÁöÑÊü•ËØ¢Ôºå(Â¶Ç bool ), Êúâ‰∫õÊü•ËØ¢ËÉΩÂ§üÂåÖÂê´ËøáÊª§Âô®(Â¶Ç constant_score), ËøòÊúâÁöÑÂèØ‰ª•ÂêåÊó∂ÂåÖÂê´Êü•ËØ¢ÂíåËøáÊª§Âô® (Â¶Ç filtered). ÈÉΩËÉΩÂ§ü‰ªéESÊîØÊåÅÊü•ËØ¢ÈõÜÂêàÈáåÈù¢ÈÄâÊã©‰ªªÊÑè‰∏Ä‰∏™Êü•ËØ¢ÊàñËÄÖÊòØ‰ªéËøáÊª§Âô®ÈõÜÂêàÈáåÈù¢ÊåëÈÄâÂá∫‰ªªÊÑè‰∏Ä‰∏™ËøáÊª§Âô®, ËøôÊ†∑ÁöÑËØùÔºåÊàë‰ª¨Â∞±ÂèØ‰ª•ÊûÑÈÄ†Âá∫‰ªªÊÑèÂ§çÊùÇÔºàmaybe ÈùûÂ∏∏ÊúâË∂£ÔºâÁöÑÊü•ËØ¢‰∫Ü„ÄÇ</p>
<h5 id="3232-ÊµãËØïÂàÜËØç">3.2.3.2 ÊµãËØïÂàÜËØç</h5>
<p>Ôºà1Ôºâik_smart
<img src="/posts/project-0/20220527224880/image-20220527230718701.png"
    
    
    
    loading="lazy"
    
    
></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">POST</span> <span style="color:#a61717;background-color:#e3d2d2">_analyze</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;analyzer&#34;</span>: <span style="color:#d14">&#34;ik_smart&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;text&#34;</span>: <span style="color:#d14">&#34;‰∏≠Âçé‰∫∫Ê∞ëÂÖ±ÂíåÂõΩ‰∫∫Ê∞ëÂ§ß‰ºöÂ†Ç&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>(2) ik_max_word
<img src="/posts/project-0/20220527224880/image-20220527230726538.png"
    
    
    
    loading="lazy"
    
    
></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">POST</span> <span style="color:#a61717;background-color:#e3d2d2">_analyze</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;analyzer&#34;</span>: <span style="color:#d14">&#34;ik_max_word&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;text&#34;</span>: <span style="color:#d14">&#34;‰∏≠Âçé‰∫∫Ê∞ëÂÖ±ÂíåÂõΩ‰∫∫Ê∞ëÂ§ß‰ºöÂ†Ç&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="ÂõõÊï∞ÊçÆÂØºÂÖ•es">Âõõ„ÄÅÊï∞ÊçÆÂØºÂÖ•ES</h1>
<h3 id="41-springdata-elasticsearch‰ªãÁªç">4.1 SpringData Elasticsearch‰ªãÁªç</h3>
<h4 id="411-springdata‰ªãÁªç">4.1.1 SpringData‰ªãÁªç</h4>
<p>Spring DataÊòØ‰∏Ä‰∏™Áî®‰∫éÁÆÄÂåñÊï∞ÊçÆÂ∫ìËÆøÈóÆÔºåÂπ∂ÊîØÊåÅ‰∫ëÊúçÂä°ÁöÑÂºÄÊ∫êÊ°ÜÊû∂„ÄÇÂÖ∂‰∏ªË¶ÅÁõÆÊ†áÊòØ‰ΩøÂæóÂØπÊï∞ÊçÆÁöÑËÆøÈóÆÂèòÂæóÊñπ‰æøÂø´Êç∑ÔºåÂπ∂ÊîØÊåÅmap-reduceÊ°ÜÊû∂Âíå‰∫ëËÆ°ÁÆóÊï∞ÊçÆÊúçÂä°„ÄÇ Spring DataÂèØ‰ª•ÊûÅÂ§ßÁöÑÁÆÄÂåñJPAÁöÑÂÜôÊ≥ïÔºåÂèØ‰ª•Âú®Âá†‰πé‰∏çÁî®ÂÜôÂÆûÁé∞ÁöÑÊÉÖÂÜµ‰∏ãÔºåÂÆûÁé∞ÂØπÊï∞ÊçÆÁöÑËÆøÈóÆÂíåÊìç‰Ωú„ÄÇÈô§‰∫ÜCRUDÂ§ñÔºåËøòÂåÖÊã¨Â¶ÇÂàÜÈ°µ„ÄÅÊéíÂ∫èÁ≠â‰∏Ä‰∫õÂ∏∏Áî®ÁöÑÂäüËÉΩ„ÄÇ</p>
<p>Spring DataÁöÑÂÆòÁΩëÔºöhttps://spring.io/projects/spring-data</p>
<h4 id="412-springdata-es‰ªãÁªç">4.1.2 SpringData ES‰ªãÁªç</h4>
<p>Spring Data ElasticSearch Âü∫‰∫é spring data API ÁÆÄÂåñ elasticSearchÊìç‰ΩúÔºåÂ∞ÜÂéüÂßãÊìç‰ΩúelasticSearchÁöÑÂÆ¢Êà∑Á´ØAPI ËøõË°åÂ∞ÅË£Ö „ÄÇSpring Data‰∏∫ElasticsearchÈ°πÁõÆÊèê‰æõÈõÜÊàêÊêúÁ¥¢ÂºïÊìé„ÄÇSpring Data Elasticsearch POJOÁöÑÂÖ≥ÈîÆÂäüËÉΩÂå∫Âüü‰∏∫‰∏≠ÂøÉÁöÑÊ®°Âûã‰∏éElastichsearch‰∫§‰∫íÊñáÊ°£ÂíåËΩªÊùæÂú∞ÁºñÂÜô‰∏Ä‰∏™Â≠òÂÇ®Â∫ìÊï∞ÊçÆËÆøÈóÆÂ±Ç„ÄÇ ÂÆòÊñπÁΩëÁ´ôÔºöhttps://spring.io/projects/spring-data-elasticsearch</p>
<h3 id="42-ÊêúÁ¥¢Â∑•Á®ãÊê≠Âª∫">4.2 ÊêúÁ¥¢Â∑•Á®ãÊê≠Âª∫</h3>
<p>ÂàõÂª∫ÊêúÁ¥¢ÂæÆÊúçÂä°Â∑•Á®ãÔºådongyimai-search-service,ËØ•Â∑•Á®ã‰∏ªË¶ÅÊèê‰æõÊêúÁ¥¢ÊúçÂä°‰ª•ÂèäÁ¥¢ÂºïÊï∞ÊçÆÁöÑÊõ¥Êñ∞Êìç‰Ωú„ÄÇ</p>
<p>(1)APIÂ∑•Á®ãÊê≠Âª∫</p>
<p>È¶ñÂÖàÂàõÂª∫searchÁöÑAPIÂ∑•Á®ã,Âú®dongyimai-service-api‰∏≠ÂàõÂª∫dongyimai-search-service-apiÔºåÂ¶Ç‰∏ãÂõæÔºö
<img src="/posts/project-0/20220527224880/image-20220527230738835.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>pom.xmlÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;project</span> <span style="color:#008080">xmlns=</span><span style="color:#d14">&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#008080">xmlns:xsi=</span><span style="color:#d14">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#008080">xsi:schemaLocation=</span><span style="color:#d14">&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;parent&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>dongyimai-service-api<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>com.offcn<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>0.0.1<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/parent&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;modelVersion&gt;</span>4.0.0<span style="color:#000080">&lt;/modelVersion&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;artifactId&gt;</span>dongyimai-search-service-api<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;properties&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;maven.compiler.source&gt;</span>8<span style="color:#000080">&lt;/maven.compiler.source&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;maven.compiler.target&gt;</span>8<span style="color:#000080">&lt;/maven.compiler.target&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/properties&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependencies&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&lt;!--goods API‰æùËµñ--&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;groupId&gt;</span>com.offcn<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;artifactId&gt;</span>dongyimai-sellergoods-serivce-api<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;version&gt;</span>1.0<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">&lt;!--SpringDataES‰æùËµñ--&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;artifactId&gt;</span>spring-boot-starter-data-elasticsearch<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependencies&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/project&gt;</span>
</span></span></code></pre></div><p>(2)ÊêúÁ¥¢ÂæÆÊúçÂä°Êê≠Âª∫</p>
<p>Âú®dongyimai-service‰∏≠Êê≠Âª∫dongyimai-search-serviceÂæÆÊúçÂä°ÔºåÂπ∂ËøõË°åÁõ∏ÂÖ≥ÈÖçÁΩÆ„ÄÇ</p>
<p><strong>pom.xmlÈÖçÁΩÆ</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;project</span> <span style="color:#008080">xmlns=</span><span style="color:#d14">&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#008080">xmlns:xsi=</span><span style="color:#d14">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#008080">xsi:schemaLocation=</span><span style="color:#d14">&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;parent&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>dongyimai-service<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>com.offcn<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>0.0.1<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/parent&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;modelVersion&gt;</span>4.0.0<span style="color:#000080">&lt;/modelVersion&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;artifactId&gt;</span>dongyimai-search-service<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;properties&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;maven.compiler.source&gt;</span>8<span style="color:#000080">&lt;/maven.compiler.source&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;maven.compiler.target&gt;</span>8<span style="color:#000080">&lt;/maven.compiler.target&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/properties&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;dependencies&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;groupId&gt;</span>com.offcn<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;artifactId&gt;</span>dongyimai-search-service-api<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;version&gt;</span>1.0<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependencies&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/project&gt;</span>
</span></span></code></pre></div><p><strong>application.ymlÈÖçÁΩÆ</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#008080">server</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008080">port</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">9005</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">spring</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008080">application</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">name</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">search</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008080">elasticsearch</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">rest</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#008080">uris</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">192.168.188.128:9200  #Ê≠§Â§ÑÈÖçÁΩÆelasticsearchÁöÑËÆøÈóÆÂú∞ÂùÄ  </span>
</span></span><span style="display:flex;"><span><span style="color:#008080">eureka</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008080">client</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">service-url</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#008080">defaultZone</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">http://127.0.0.1:8761/eureka</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008080">instance</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">prefer-ip-address</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">true</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">feign</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008080">hystrix</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">enabled</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">true</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#Ë∂ÖÊó∂ÈÖçÁΩÆ</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">ribbon</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008080">ReadTimeout</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">300000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#008080">hystrix</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#008080">command</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">default</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#008080">execution</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#008080">isolation</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">thread</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#008080">timeoutInMilliseconds</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">10000</span>
</span></span></code></pre></div><p>(3)ÂêØÂä®Á±ª</p>
<p>ÂàõÂª∫SearchApplication‰Ωú‰∏∫ÊêúÁ¥¢ÂæÆÊúçÂä°Â∑•Á®ãÁöÑÂêØÂä®Á±ªÔºå‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@SpringBootApplication</span><span style="color:#000;font-weight:bold">(</span>exclude <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>DruidDataSourceAutoConfigure<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span> DataSourceAutoConfiguration<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@EnableEurekaClient</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">SearchApplication</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        SpringApplication<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">run</span><span style="color:#000;font-weight:bold">(</span>SearchApplication<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span>args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>ÂàÜÂà´ÂàõÂª∫ÂØπÂ∫îÁöÑÂåÖÔºådao„ÄÅservice„ÄÅcontrollerÔºåÂ¶Ç‰∏ãÂõæÔºö
<img src="/posts/project-0/20220527224880/image-20220527230750192.png"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="43-Êï∞ÊçÆÂØºÂÖ•">4.3 Êï∞ÊçÆÂØºÂÖ•</h3>
<p>Áé∞Âú®ÈúÄË¶ÅÂ∞ÜÊï∞ÊçÆ‰ªéÊï∞ÊçÆÂ∫ì‰∏≠Êü•ËØ¢Âá∫Êù•ÔºåÁÑ∂ÂêéÂ∞ÜÊï∞ÊçÆÂØºÂÖ•Âà∞ES‰∏≠„ÄÇ
<img src="/posts/project-0/20220527224880/image-20220527230758388.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>Êï∞ÊçÆÂØºÂÖ•ÊµÅÁ®ãÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">1.ËØ∑Ê±ÇsearchÊúçÂä°,Ë∞ÉÁî®Êï∞ÊçÆÂØºÂÖ•Âú∞ÂùÄ</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">2.Ê†πÊçÆÊ≥®ÂÜå‰∏≠ÂøÉ‰∏≠ÁöÑÊ≥®ÂÜåÁöÑgoodsÊúçÂä°ÁöÑÂú∞ÂùÄÔºå‰ΩøÁî®FeignÊñπÂºèÊü•ËØ¢ÊâÄÊúâÂ∑≤ÁªèÂÆ°Ê†∏ÁöÑSku</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">3.‰ΩøÁî®SpringData</span> <span style="color:#d14">EsÂ∞ÜÊü•ËØ¢Âà∞ÁöÑSkuÈõÜÂêàÂØºÂÖ•Âà∞ES‰∏≠</span>
</span></span></code></pre></div><h4 id="431-ÊñáÊ°£Êò†Â∞ÑbeanÂàõÂª∫">4.3.1 ÊñáÊ°£Êò†Â∞ÑBeanÂàõÂª∫</h4>
<p>ÊêúÁ¥¢ÂïÜÂìÅÁöÑÊó∂ÂÄôÔºå‰ºöÊ†πÊçÆÂ¶Ç‰∏ãÂ±ûÊÄßÊêúÁ¥¢Êï∞ÊçÆ,Âπ∂‰∏î‰∏çÊòØÊâÄÊúâÁöÑÂ±ûÊÄßÈÉΩÈúÄË¶ÅÂàÜËØçÊêúÁ¥¢ÔºåÊàë‰ª¨ÂàõÂª∫JavaBeanÔºåÂ∞ÜJavaBeanÊï∞ÊçÆÂ≠òÂÖ•Âà∞ES‰∏≠Ë¶Å‰ª•ÊêúÁ¥¢Êù°‰ª∂ÂíåÊêúÁ¥¢Â±ïÁ§∫ÁªìÊûú‰∏∫‰æùÊçÆÔºåÈÉ®ÂàÜÂÖ≥ÈîÆÊêúÁ¥¢Êù°‰ª∂ÂàÜÊûêÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">1.ÂèØËÉΩ‰ºöÊ†πÊçÆÂïÜÂìÅÂêçÁß∞ÊêúÁ¥¢ÔºåËÄå‰∏îÂèØ‰ª•ÊêúÁ¥¢ÂïÜÂìÅÂêçÁß∞‰∏≠ÁöÑ‰ªªÊÑè‰∏Ä‰∏™ËØçËØ≠ÔºåÊâÄ‰ª•ÈúÄË¶ÅÂàÜËØç</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">2.ÂèØËÉΩ‰ºöÊ†πÊçÆÂïÜÂìÅÂàÜÁ±ªÊêúÁ¥¢ÔºåÂïÜÂìÅÂàÜÁ±ª‰∏çÈúÄË¶ÅÂàÜËØç</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">3.ÂèØËÉΩ‰ºöÊ†πÊçÆÂïÜÂìÅÂìÅÁâåÊêúÁ¥¢ÔºåÂïÜÂìÅÂìÅÁâå‰∏çÈúÄË¶ÅÂàÜËØç</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">4.ÂèØËÉΩ‰ºöÊ†πÊçÆÂïÜÂìÅÂïÜÂÆ∂ÊêúÁ¥¢ÔºåÂïÜÂìÅÂïÜÂÆ∂‰∏çÈúÄË¶ÅÂàÜËØç</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">5.ÂèØËÉΩÊ†πÊçÆËßÑÊ†ºËøõË°åÊêúÁ¥¢ÔºåËßÑÊ†ºÊó∂‰∏Ä‰∏™ÈîÆÂÄºÂØπÁªìÊûÑÔºåÁî®Map</span>
</span></span></code></pre></div><p>Ê†πÊçÆ‰∏äÈù¢ÁöÑÂàÜÊûêÔºåÊàë‰ª¨ÂèØ‰ª•Âú®dongyimai-search-service-apiÂ∑•Á®ã‰∏≠ÂàõÂª∫com.offcn.search.pojo.SkuInfoÔºåÂ¶Ç‰∏ã</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Document</span><span style="color:#000;font-weight:bold">(</span>indexName <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;skuinfo&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">SkuInfo</span> <span style="color:#000;font-weight:bold">implements</span> Serializable <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//ÂïÜÂìÅidÔºåÂêåÊó∂‰πüÊòØÂïÜÂìÅÁºñÂè∑
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#3c5d5d;font-weight:bold">@Id</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> Long id<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//SKUÂêçÁß∞
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#3c5d5d;font-weight:bold">@Field</span><span style="color:#000;font-weight:bold">(</span>type <span style="color:#000;font-weight:bold">=</span> FieldType<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Text</span><span style="color:#000;font-weight:bold">,</span> analyzer <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;ik_smart&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> String title<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//ÂïÜÂìÅ‰ª∑Ê†ºÔºåÂçï‰Ωç‰∏∫ÔºöÂÖÉ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#3c5d5d;font-weight:bold">@Field</span><span style="color:#000;font-weight:bold">(</span>type <span style="color:#000;font-weight:bold">=</span> FieldType<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Double</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> BigDecimal price<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//Â∫ìÂ≠òÊï∞Èáè
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">private</span> Integer num<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//ÂïÜÂìÅÂõæÁâá
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">private</span> String image<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//ÂïÜÂìÅÁä∂ÊÄÅÔºå1-Ê≠£Â∏∏Ôºå2-‰∏ãÊû∂Ôºå3-Âà†Èô§
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">private</span> String status<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//ÂàõÂª∫Êó∂Èó¥
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">private</span> Date createTime<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//Êõ¥Êñ∞Êó∂Èó¥
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">private</span> Date updateTime<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//ÊòØÂê¶ÈªòËÆ§
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">private</span> String isDefault<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//goodsId
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">private</span> Long goodsId<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//Á±ªÁõÆID
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">private</span> Long categoryId<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//Á±ªÁõÆÂêçÁß∞
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>   <span style="color:#998;font-style:italic">// @Field(type = FieldType.Keyword)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">private</span> String category<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//ÂìÅÁâåÂêçÁß∞
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>   <span style="color:#998;font-style:italic">// @Field(type = FieldType.Keyword)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">private</span> String brand<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//ËßÑÊ†º
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">private</span> String spec<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//ËßÑÊ†ºÂèÇÊï∞
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">private</span> Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span>Object<span style="color:#000;font-weight:bold">&gt;</span> specMap<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//ÂØπÂ∫îÁöÑget„ÄÅsetÊñπÊ≥ïÁúÅÁï•
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">....</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="432-ÊêúÁ¥¢ÂÆ°Ê†∏ÈÄöËøásku">4.3.2 ÊêúÁ¥¢ÂÆ°Ê†∏ÈÄöËøáSku</h4>
<p>‰øÆÊîπdongyimai-sellergoods-serviceÂæÆÊúçÂä°ÔºåÊ∑ªÂä†ÊêúÁ¥¢ÂÆ°Ê†∏ÈÄöËøáÁöÑSkuÔºå‰æõsearchÂæÆÊúçÂä°Ë∞ÉÁî®„ÄÇ</p>
<p><strong>‰∏ãÈù¢ÈÉΩÊòØÈíàÂØπgoodsÂæÆÊúçÂä°ÁöÑÊìç‰Ωú„ÄÇ</strong></p>
<p>‰øÆÊîπItemServiceÊé•Âè£ÔºåÊ∑ªÂä†Ê†πÊçÆÁä∂ÊÄÅÊü•ËØ¢SkuÊñπÊ≥ïÔºå‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * Ê†πÊçÆÁä∂ÊÄÅÊü•ËØ¢SKUÂàóË°®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span>  List<span style="color:#000;font-weight:bold">&lt;</span>Item<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">findByStatus</span><span style="color:#000;font-weight:bold">(</span>String status<span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><p>‰øÆÊîπItemServiceImplÔºåÊ∑ªÂä†Ê†πÊçÆÁä∂ÊÄÅÊü•ËØ¢SkuÂÆûÁé∞ÊñπÊ≥ïÔºå‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> List<span style="color:#000;font-weight:bold">&lt;</span>Item<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">findByStatus</span><span style="color:#000;font-weight:bold">(</span>String status<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        QueryWrapper<span style="color:#000;font-weight:bold">&lt;</span>Item<span style="color:#000;font-weight:bold">&gt;</span> queryWrapper <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> QueryWrapper<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>        queryWrapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">eq</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;status&#34;</span><span style="color:#000;font-weight:bold">,</span>status<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">list</span><span style="color:#000;font-weight:bold">(</span>queryWrapper<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>‰øÆÊîπcom.offcn.sellergoods.controller.ItemControllerÔºåÊ∑ªÂä†Ê†πÊçÆÂÆ°Ê†∏Áä∂ÊÄÅÊü•ËØ¢SkuÊñπÊ≥ïÔºå‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> <span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * Ê†πÊçÆÂÆ°Ê†∏Áä∂ÊÄÅÊü•ËØ¢Sku
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param status
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@GetMapping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/status/{status}&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> Result<span style="color:#000;font-weight:bold">&lt;</span>List<span style="color:#000;font-weight:bold">&lt;</span>Item<span style="color:#000;font-weight:bold">&gt;&gt;</span> <span style="color:#900;font-weight:bold">findByStatus</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3c5d5d;font-weight:bold">@PathVariable</span> String status<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        List<span style="color:#000;font-weight:bold">&lt;</span>Item<span style="color:#000;font-weight:bold">&gt;</span> list <span style="color:#000;font-weight:bold">=</span> itemService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findByStatus</span><span style="color:#000;font-weight:bold">(</span>status<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">new</span> Result<span style="color:#000;font-weight:bold">&lt;</span>List<span style="color:#000;font-weight:bold">&lt;</span>Item<span style="color:#000;font-weight:bold">&gt;&gt;(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span>StatusCode<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">OK</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;Êü•ËØ¢ÊàêÂäü&#34;</span><span style="color:#000;font-weight:bold">,</span>list<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>ËÆøÈóÆÂú∞ÂùÄÔºöhttp://localhost:9001/item/status/1
<img src="/posts/project-0/20220527224880/image-20220527230811094.png"
    
    
    
    loading="lazy"
    
    
></p>
<h4 id="433-skuÂØºÂÖ•esÂÆûÁé∞">4.3.3 SkuÂØºÂÖ•ESÂÆûÁé∞</h4>
<p>(1) FeignÈÖçÁΩÆ</p>
<p>‰øÆÊîπdongyimai-sellergoods-service-apiÂ∑•Á®ãÔºåÂú®com.offcn.sellergoods.feign.ItemFeign‰∏äÊ∑ªÂä†findSkuListÊñπÊ≥ïÔºå‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@FeignClient</span><span style="color:#000;font-weight:bold">(</span>value<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;dym-sellergoods&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">interface</span> <span style="color:#458;font-weight:bold">ItemFeign</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * Ê†πÊçÆÂÆ°Ê†∏Áä∂ÊÄÅÊü•ËØ¢Sku
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param status
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@GetMapping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/item/status/{status}&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    Result<span style="color:#000;font-weight:bold">&lt;</span>List<span style="color:#000;font-weight:bold">&lt;</span>Item<span style="color:#000;font-weight:bold">&gt;&gt;</span> <span style="color:#900;font-weight:bold">findByStatus</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3c5d5d;font-weight:bold">@PathVariable</span> String status<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>(2) DaoÂàõÂª∫</p>
<p>‰øÆÊîπdongyimai-search-serviceÂ∑•Á®ãÔºåÂàõÂª∫com.dongyimai.search.dao.SkuEsMapper,ËØ•Êé•Âè£‰∏ªË¶ÅÁî®‰∫éÁ¥¢ÂºïÊï∞ÊçÆÊìç‰ΩúÔºå‰∏ªË¶Å‰ΩøÁî®ÂÆÉÊù•ÂÆûÁé∞Â∞ÜÊï∞ÊçÆÂØºÂÖ•Âà∞ESÁ¥¢ÂºïÂ∫ì‰∏≠Ôºå‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Repository</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">interface</span> <span style="color:#458;font-weight:bold">SkuEsMapper</span> <span style="color:#000;font-weight:bold">extends</span> ElasticsearchRepository<span style="color:#000;font-weight:bold">&lt;</span>SkuInfo<span style="color:#000;font-weight:bold">,</span>Long<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>(3) ÊúçÂä°Â±ÇÂàõÂª∫</p>
<p>‰øÆÊîπdongyimai-search-serviceÂ∑•Á®ãÔºåÂàõÂª∫com.dongyimai.search.service.SkuService,‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">interface</span> <span style="color:#458;font-weight:bold">SkuService</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * ÂØºÂÖ•SKUÊï∞ÊçÆ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">importSku</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>‰øÆÊîπdongyimai-search-serviceÂ∑•Á®ãÔºåÂàõÂª∫com.offcn.search.service.impl.SkuServiceImpl,ÂÆûÁé∞SkuÊï∞ÊçÆÂØºÂÖ•Âà∞ES‰∏≠Ôºå‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Service</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">SkuServiceImpl</span> <span style="color:#000;font-weight:bold">implements</span> SkuService <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> SkuEsMapper skuEsMapper<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> ItemFeign itemFeign<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">importSku</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//Ë∞ÉÁî®ÂïÜÂìÅÂæÆÊúçÂä°ÔºåËé∑ÂèñskuÂïÜÂìÅÊï∞ÊçÆ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        Result<span style="color:#000;font-weight:bold">&lt;</span>List<span style="color:#000;font-weight:bold">&lt;</span>Item<span style="color:#000;font-weight:bold">&gt;&gt;</span> result <span style="color:#000;font-weight:bold">=</span> itemFeign<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findByStatus</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;1&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>       <span style="color:#998;font-style:italic">//ÊääËøîÂõûÁöÑÁªìÊûúËøîÂõûÊêúÁ¥¢ÂÆû‰ΩìÁ±ªÊï∞ÊçÆÈõÜÂêà(ÈááÁî®Ê∑±ÂÖãÈöÜÊäÄÊúØÔºåÊääItemÂØπË±°Â±ûÊÄßÂÄºÂ§çÂà∂Âà∞SkuInfoÂØπË±°)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        List<span style="color:#000;font-weight:bold">&lt;</span>SkuInfo<span style="color:#000;font-weight:bold">&gt;</span> skuInfoList <span style="color:#000;font-weight:bold">=</span> JSON<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">parseArray</span><span style="color:#000;font-weight:bold">(</span>JSON<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">toJSONString</span><span style="color:#000;font-weight:bold">(</span>result<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getData</span><span style="color:#000;font-weight:bold">()),</span> SkuInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//ÈÅçÂéÜskuÈõÜÂêà
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>SkuInfo skuInfo <span style="color:#000;font-weight:bold">:</span> skuInfoList<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//Ëé∑ÂèñËßÑÊ†ºjsonÂ≠óÁ¨¶‰∏≤ÔºåËΩ¨Êç¢‰∏∫mapÂØπË±°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>          Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span>Object<span style="color:#000;font-weight:bold">&gt;</span> map <span style="color:#000;font-weight:bold">=</span> JSON<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">parseObject</span><span style="color:#000;font-weight:bold">(</span>skuInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getSpec</span><span style="color:#000;font-weight:bold">(),</span> Map<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>          <span style="color:#998;font-style:italic">//ÂÖ≥ËÅîËÆæÁΩÆÂà∞specMap
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            skuInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setSpecMap</span><span style="color:#000;font-weight:bold">(</span>specMap<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//‰øùÂ≠òskuÈõÜÂêàÊï∞ÊçÆÂà∞es
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        skuEsMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">saveAll</span><span style="color:#000;font-weight:bold">(</span>skuInfoList<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>(4)ÊéßÂà∂Â±ÇÈÖçÁΩÆ</p>
<p>‰øÆÊîπdongyimai-search-serviceÂ∑•Á®ãÔºåÂú®com.offcn.search.controller.SkuControllerÁ±ª‰∏≠Ê∑ªÂä†Â¶Ç‰∏ãÊñπÊ≥ïË∞ÉÁî®‰∏äËø∞ÂØºÂÖ•ÊñπÊ≥ïÔºå‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RestController</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RequestMapping</span><span style="color:#000;font-weight:bold">(</span>value <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;/search&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@CrossOrigin</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">SkuController</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> SkuService skuService<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * ÂØºÂÖ•Êï∞ÊçÆ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@GetMapping</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/import&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> Result <span style="color:#900;font-weight:bold">search</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        skuService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">importSku</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">new</span> Result<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span> StatusCode<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">OK</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;ÂØºÂÖ•Êï∞ÊçÆÂà∞Á¥¢ÂºïÂ∫ì‰∏≠ÊàêÂäüÔºÅ&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>(5)‰øÆÊîπÂêØÂä®Á±ª</p>
<p>ÂêØÂä®Á±ª‰∏≠ÈúÄË¶ÅÂºÄÂêØFeignÂÆ¢Êà∑Á´ØÔºåÂπ∂‰∏îÈúÄË¶ÅÊ∑ªÂä†ESÂåÖÊâ´ÊèèÔºå‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@SpringBootApplication</span><span style="color:#000;font-weight:bold">(</span>exclude<span style="color:#000;font-weight:bold">={</span>DataSourceAutoConfiguration<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@EnableEurekaClient</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@EnableFeignClients</span><span style="color:#000;font-weight:bold">(</span>basePackages <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;com.offcn.sellergoods.feign&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@EnableElasticsearchRepositories</span><span style="color:#000;font-weight:bold">(</span>basePackages <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;com.offcn.search.dao&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">SearchApplication</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        SpringApplication<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">run</span><span style="color:#000;font-weight:bold">(</span>SearchApplication<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span>args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>Ê≥®ÊÑèÂ¶ÇÊûúÂá∫Áé∞ÈîôËØØÔºö
<img src="/posts/project-0/20220527224880/image-20220527230823397.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>Ëß£ÂÜ≥ÂäûÊ≥ïÔºå‰øÆÊîπapplication.ymlÂ¢ûÂä†Â¶Ç‰∏ãÈÖçÁΩÆÔºö</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">spring</span>:<span style="color:#bbb">  
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">main</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">allow-bean-definition-overriding</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">
</span></span></span></code></pre></div><p>(6)ÊµãËØï</p>
<p>Ë∞ÉÁî®http://localhost:9005/search/importËøõË°åÊµãËØï</p>
<p>ÊâìÂºÄKibanaÂèØ‰ª•ÁúãÂà∞Â¶Ç‰∏ãÊï∞ÊçÆÔºö</p>
<p><code>http://192.168.188.128:5601</code></p>
<pre tabindex="0"><code>GET /skuinfo/_search
</code></pre><p><img src="/posts/project-0/20220527224880/image-20220527230830310.png"
    
    
    
    loading="lazy"
    
    
></p>
<h1 id="‰∫îÂÖ≥ÈîÆÂ≠óÊêúÁ¥¢">‰∫î„ÄÅÂÖ≥ÈîÆÂ≠óÊêúÁ¥¢</h1>
<p><img src="/posts/project-0/20220527224880/image-20220527230835463.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>Êàë‰ª¨ÂÖà‰ΩøÁî®SpringDataElasticsearchÂÆûÁé∞‰∏Ä‰∏™ÁÆÄÂçïÁöÑÊêúÁ¥¢ÂäüËÉΩÔºåÂÖàÂÆûÁé∞Ê†πÊçÆÂÖ≥ÈîÆÂ≠óÊêúÁ¥¢Ôºå‰ªé‰∏äÈù¢ÊêúÁ¥¢ÂõæÁâáÂèØ‰ª•ÁúãÂæóÂà∞ÔºåÊØèÊ¨°ÊêúÁ¥¢ÁöÑÊó∂ÂÄôÔºåÈô§‰∫ÜÂÖ≥ÈîÆÂ≠óÂ§ñÔºåËøòÊúâÂèØËÉΩÊúâÂìÅÁâå„ÄÅÂàÜÁ±ª„ÄÅËßÑÊ†ºÁ≠âÔºåÂêéÂè∞Êé•Êî∂ÊêúÁ¥¢Êù°‰ª∂‰ΩøÁî®MapÊé•Êî∂ÊØîËæÉÂêàÈÄÇ„ÄÇ</p>
<h3 id="51-ÊúçÂä°Â±ÇÂÆûÁé∞">5.1 ÊúçÂä°Â±ÇÂÆûÁé∞</h3>
<p>‰øÆÊîπsearchÊúçÂä°ÁöÑcom.offcn.search.service.SkuService,Ê∑ªÂä†ÊêúÁ¥¢ÊñπÊ≥ïÔºå‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * ÊêúÁ¥¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * @param searchMap
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span>Map <span style="color:#900;font-weight:bold">search</span><span style="color:#000;font-weight:bold">(</span>Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> String<span style="color:#000;font-weight:bold">&gt;</span> searchMap<span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><p>‰øÆÊîπsearchÊúçÂä°ÁöÑcom.dongyimai.search.service.impl.SkuServiceImpl,Ê∑ªÂä†ÊêúÁ¥¢ÂÆûÁé∞ÊñπÊ≥ï,‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">private</span> ElasticsearchRestTemplate elasticsearchRestTemplate<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> Map <span style="color:#900;font-weight:bold">search</span><span style="color:#000;font-weight:bold">(</span>Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> String<span style="color:#000;font-weight:bold">&gt;</span> searchMap<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#998;font-style:italic">//1.Ëé∑ÂèñÂÖ≥ÈîÆÂ≠óÁöÑÂÄº
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>   String keywords <span style="color:#000;font-weight:bold">=</span> searchMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;keywords&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>StringUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">isEmpty</span><span style="color:#000;font-weight:bold">(</span>keywords<span style="color:#000;font-weight:bold">))</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        keywords <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Âçé‰∏∫&#34;</span><span style="color:#000;font-weight:bold">;</span><span style="color:#998;font-style:italic">//ËµãÂÄºÁªô‰∏Ä‰∏™ÈªòËÆ§ÁöÑÂÄº
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>   <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>       <span style="color:#998;font-style:italic">//2.ÂàõÂª∫Êü•ËØ¢ÂØπË±° ÁöÑÊûÑÂª∫ÂØπË±°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>      NativeSearchQueryBuilder nativeSearchQueryBuilder <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> NativeSearchQueryBuilder<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>         <span style="color:#998;font-style:italic">//3.ËÆæÁΩÆÊü•ËØ¢ÁöÑÊù°‰ª∂
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//‰ΩøÁî®ÔºöQueryBuilders.matchQuery(&#34;title&#34;, keywords) ÔºåÊêúÁ¥¢Âçé‰∏∫ ---&gt; Âçé    ‰∏∫ ‰∫åÂ≠óÂèØ‰ª•ÊãÜÂàÜÊü•ËØ¢Ôºå
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//‰ΩøÁî®ÔºöQueryBuilders.matchPhraseQuery(&#34;title&#34;, keywords) Âçé‰∏∫‰∫åÂ≠ó‰∏çÊãÜÂàÜÊü•ËØ¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        nativeSearchQueryBuilder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">withQuery</span><span style="color:#000;font-weight:bold">(</span>QueryBuilders<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">matchQuery</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;title&#34;</span><span style="color:#000;font-weight:bold">,</span> keywords<span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//4.ÊûÑÂª∫Êü•ËØ¢ÂØπË±°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        NativeSearchQuery query <span style="color:#000;font-weight:bold">=</span> nativeSearchQueryBuilder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">build</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//5.ÊâßË°åÊü•ËØ¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        SearchHits<span style="color:#000;font-weight:bold">&lt;</span>SkuInfo<span style="color:#000;font-weight:bold">&gt;</span> searchHits <span style="color:#000;font-weight:bold">=</span> elasticsearchRestTemplate<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">search</span><span style="color:#000;font-weight:bold">(</span>query<span style="color:#000;font-weight:bold">,</span> SkuInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//ÂØπÊêúÁ¥¢searchHitsÈõÜÂêàËøõË°åÂàÜÈ°µÂ∞ÅË£Ö
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        SearchPage<span style="color:#000;font-weight:bold">&lt;</span>SkuInfo<span style="color:#000;font-weight:bold">&gt;</span> skuPage <span style="color:#000;font-weight:bold">=</span> SearchHitSupport<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">searchPageFor</span><span style="color:#000;font-weight:bold">(</span>searchHits<span style="color:#000;font-weight:bold">,</span> query<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getPageable</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//ÈÅçÂéÜÂèñÂá∫Êü•ËØ¢ÁöÑÂïÜÂìÅ‰ø°ÊÅØ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        List<span style="color:#000;font-weight:bold">&lt;</span>SkuInfo<span style="color:#000;font-weight:bold">&gt;</span> skuList<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">new</span> ArrayList<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>SearchHit<span style="color:#000;font-weight:bold">&lt;</span>SkuInfo<span style="color:#000;font-weight:bold">&gt;</span> searchHit <span style="color:#000;font-weight:bold">:</span>skuPage<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getContent</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#998;font-style:italic">// Ëé∑ÂèñÊêúÁ¥¢Âà∞ÁöÑÊï∞ÊçÆ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            SkuInfo content <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>SkuInfo<span style="color:#000;font-weight:bold">)</span> searchHit<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getContent</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            SkuInfo skuInfo <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> SkuInfo<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//Êää‰∏Ä‰∏™ÂØπË±°Â±ûÊÄßÂÄºÂ§çÂà∂Âà∞Âè¶Â§ñ‰∏Ä‰∏™ÂØπË±°Ôºö‰∏§‰∏™ÂØπË±°Â±ûÊÄßÂêçÁß∞ÂøÖÈ°ª‰∏ÄËá¥ÔºåÂ±ûÊÄßÁ±ªÂûãÂøÖÈ°ªÁõ∏Âêå
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            BeanUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">copyProperties</span><span style="color:#000;font-weight:bold">(</span>content<span style="color:#000;font-weight:bold">,</span> skuInfo<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            skuList<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>skuInfo<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//6.ËøîÂõûÁªìÊûú
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        Map resultMap <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> HashMap<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>        resultMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;rows&#34;</span><span style="color:#000;font-weight:bold">,</span> skuList<span style="color:#000;font-weight:bold">);</span><span style="color:#998;font-style:italic">//Ëé∑ÂèñÊâÄÈúÄSkuInfoÈõÜÂêàÊï∞ÊçÆÂÜÖÂÆπ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        resultMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;total&#34;</span><span style="color:#000;font-weight:bold">,</span>searchHits<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getTotalHits</span><span style="color:#000;font-weight:bold">());</span><span style="color:#998;font-style:italic">//ÊÄªËÆ∞ÂΩïÊï∞
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        resultMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;totalPages&#34;</span><span style="color:#000;font-weight:bold">,</span> skuPage<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getTotalPages</span><span style="color:#000;font-weight:bold">());</span><span style="color:#998;font-style:italic">//ÊÄªÈ°µÊï∞
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">return</span> resultMap<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p><strong>Ê≥®ÊÑè</strong>: ElasticSearchTemplateÊõ¥Â§öÊòØÂØπESRepositoryÁöÑË°•ÂÖÖÔºåÈáåÈù¢Êèê‰æõ‰∫Ü‰∏Ä‰∫õÊõ¥Â∫ïÂ±ÇÁöÑÊñπÊ≥ï,Êõ¥Âä†ÈÄÇÁî®‰∫éÊü•ËØ¢Êï∞ÊçÆ</p>
<h3 id="52-ÊéßÂà∂Â±ÇÂÆûÁé∞">5.2 ÊéßÂà∂Â±ÇÂÆûÁé∞</h3>
<p>‰øÆÊîπcom.offcn.search.controller.SkuControllerÔºåÂú®ÊéßÂà∂Â±ÇË∞ÉÁî®ServiceÂ±ÇÂç≥ÂèØÔºå‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * ÊêúÁ¥¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * @param searchMap
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@PostMapping</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> Map <span style="color:#900;font-weight:bold">search</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3c5d5d;font-weight:bold">@RequestBody</span><span style="color:#000;font-weight:bold">(</span>required <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">)</span> Map searchMap<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span>  skuService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">search</span><span style="color:#000;font-weight:bold">(</span>searchMap<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="53-ÊµãËØï">5.3 ÊµãËØï</h3>
<p>‰ΩøÁî®PostmanÂ∑•ÂÖ∑ÔºåËæìÂÖ•http://localhost:9005/search</p>
<p>ÈÄâ‰∏≠POSTÊèê‰∫§
<img src="/posts/project-0/20220527224880/image-20220527230845070.png"
    
    
    
    loading="lazy"
    
    
></p>
<h1 id="ÂÖ≠-ÂàÜÁ±ªÁªüËÆ°">ÂÖ≠„ÄÅ ÂàÜÁ±ªÁªüËÆ°</h1>
<h3 id="61-ÂàÜÁ±ªÁªüËÆ°ÂàÜÊûê">6.1 ÂàÜÁ±ªÁªüËÆ°ÂàÜÊûê</h3>
<p>Áúã‰∏ãÈù¢ÁöÑSQLËØ≠Âè•ÔºåÊàë‰ª¨Âú®ÊâßË°åÊêúÁ¥¢ÁöÑÊó∂ÂÄôÔºåÁ¨¨1Êù°SQLËØ≠Âè•ÊòØÊâßË°åÊêúÔºåÁ¨¨2Êù°ËØ≠Âè•ÊòØÊ†πÊçÆÂàÜÁ±ªÂêçÂ≠óÂàÜÁªÑÊü•ÁúãÊúâÂ§öÂ∞ëÂàÜÁ±ªÔºåÂ§ßÊ¶ÇÊâßË°å‰∫Ü2‰∏™Ê≠•È™§Â∞±ÂèØ‰ª•Ëé∑ÂèñÊï∞ÊçÆÁªìÊûú‰ª•ÂèäÂàÜÁ±ªÁªüËÆ°ÔºåÊàë‰ª¨ÂèØ‰ª•ÂèëÁé∞‰ªñ‰ª¨ÁöÑÊêúÁ¥¢Êù°‰ª∂ÂÆåÂÖ®‰∏ÄÊ†∑„ÄÇ</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#998;font-style:italic">-- Êü•ËØ¢ÊâÄÊúâ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">*</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>tb_item<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">WHERE</span><span style="color:#bbb"> </span>title<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">LIKE</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;%ÊâãÊú∫%&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">-- Ê†πÊçÆÂàÜÁ±ªÂêçÂ≠óÂàÜÁªÑÊü•ËØ¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>category<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">FROM</span><span style="color:#bbb">  </span>tb_item<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">WHERE</span><span style="color:#bbb"> </span>title<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">LIKE</span><span style="color:#bbb"> </span><span style="color:#d14">&#39;%ÊâãÊú∫%&#39;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">GROUP</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">BY</span><span style="color:#bbb"> </span>category;<span style="color:#bbb">
</span></span></span></code></pre></div><p><img src="/posts/project-0/20220527224880/image-20220527230852516.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>Êàë‰ª¨ÊØèÊ¨°ÊâßË°åÊêúÁ¥¢ÁöÑÊó∂ÂÄôÔºåÈúÄË¶ÅÊòæÁ§∫ÂïÜÂìÅÂàÜÁ±ªÂêçÁß∞ÔºåËøôÈáåË¶ÅÊòæÁ§∫ÁöÑÂàÜÁ±ªÂêçÁß∞ÂÖ∂ÂÆûÂ∞±ÊòØÁ¨¶ÂêàÊêúÁ¥†Êù°‰ª∂ÁöÑÊâÄÊúâÂïÜÂìÅÁöÑÂàÜÁ±ªÈõÜÂêàÔºåÊàë‰ª¨ÂèØ‰ª•ÊåâÁÖß‰∏äÈù¢ÁöÑÂÆûÁé∞ÊÄùË∑ØÔºå‰ΩøÁî®ESÊ†πÊçÆÂàÜÁªÑÂêçÁß∞ÂÅö‰∏ÄÊ¨°ÂàÜÁªÑÊü•ËØ¢Âç≥ÂèØÂÆûÁé∞„ÄÇ</p>
<h3 id="62-ÂàÜÁ±ªÂàÜÁªÑÁªüËÆ°ÂÆûÁé∞">6.2 ÂàÜÁ±ªÂàÜÁªÑÁªüËÆ°ÂÆûÁé∞</h3>
<p>‰øÆÊîπsearchÂæÆÊúçÂä°ÁöÑcom.offcn.search.service.impl.SkuServiceImplÁ±ªÔºåÊï¥‰Ωì‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">public</span> Map <span style="color:#900;font-weight:bold">search</span><span style="color:#000;font-weight:bold">(</span>Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> String<span style="color:#000;font-weight:bold">&gt;</span> searchMap<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//1.Ëé∑ÂèñÂÖ≥ÈîÆÂ≠óÁöÑÂÄº
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        String keywords <span style="color:#000;font-weight:bold">=</span> searchMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;keywords&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>StringUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">isEmpty</span><span style="color:#000;font-weight:bold">(</span>keywords<span style="color:#000;font-weight:bold">))</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            keywords <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Âçé‰∏∫&#34;</span><span style="color:#000;font-weight:bold">;</span><span style="color:#998;font-style:italic">//ËµãÂÄºÁªô‰∏Ä‰∏™ÈªòËÆ§ÁöÑÂÄº
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//2.ÂàõÂª∫Êü•ËØ¢ÂØπË±° ÁöÑÊûÑÂª∫ÂØπË±°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        NativeSearchQueryBuilder nativeSearchQueryBuilder <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> NativeSearchQueryBuilder<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// ËÆæÁΩÆÂàÜÁªÑÁöÑÊù°‰ª∂  termsÂêéË°®Á§∫ÂàÜÁªÑÊü•ËØ¢ÂêéÁöÑÂàóÂêç,Ê≥®ÊÑèÊêúÁ¥¢Â≠óÊÆµÂêéÈù¢Âä†.keyword
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        nativeSearchQueryBuilder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addAggregation</span><span style="color:#000;font-weight:bold">(</span>AggregationBuilders<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">terms</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;skuCategorygroup&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">field</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;category.keyword&#34;</span><span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//3.ËÆæÁΩÆÊü•ËØ¢ÁöÑÊù°‰ª∂
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//‰ΩøÁî®ÔºöQueryBuilders.matchQuery(&#34;title&#34;, keywords) ÔºåÊêúÁ¥¢Âçé‰∏∫ ---&gt; Âçé    ‰∏∫ ‰∫åÂ≠óÂèØ‰ª•ÊãÜÂàÜÊü•ËØ¢Ôºå
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//‰ΩøÁî®ÔºöQueryBuilders.matchPhraseQuery(&#34;title&#34;, keywords) Âçé‰∏∫‰∫åÂ≠ó‰∏çÊãÜÂàÜÊü•ËØ¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        nativeSearchQueryBuilder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">withQuery</span><span style="color:#000;font-weight:bold">(</span>QueryBuilders<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">matchQuery</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;title&#34;</span><span style="color:#000;font-weight:bold">,</span> keywords<span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//4.ÊûÑÂª∫Êü•ËØ¢ÂØπË±°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        NativeSearchQuery query <span style="color:#000;font-weight:bold">=</span> nativeSearchQueryBuilder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">build</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//5.ÊâßË°åÊü•ËØ¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        SearchHits<span style="color:#000;font-weight:bold">&lt;</span>SkuInfo<span style="color:#000;font-weight:bold">&gt;</span> searchHits <span style="color:#000;font-weight:bold">=</span> elasticsearchRestTemplate<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">search</span><span style="color:#000;font-weight:bold">(</span>query<span style="color:#000;font-weight:bold">,</span> SkuInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//ÂØπÊêúÁ¥¢searchHitsÈõÜÂêàËøõË°åÂàÜÈ°µÂ∞ÅË£Ö
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        SearchPage<span style="color:#000;font-weight:bold">&lt;</span>SkuInfo<span style="color:#000;font-weight:bold">&gt;</span> skuPage <span style="color:#000;font-weight:bold">=</span> SearchHitSupport<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">searchPageFor</span><span style="color:#000;font-weight:bold">(</span>searchHits<span style="color:#000;font-weight:bold">,</span> query<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getPageable</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//Ëé∑ÂèñÂàÜÁªÑÁªìÊûú
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        Terms terms <span style="color:#000;font-weight:bold">=</span> searchHits<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getAggregations</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;skuCategorygroup&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// Ëé∑ÂèñÂàÜÁ±ªÂêçÁß∞ÈõÜÂêà
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        List<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">&gt;</span> categoryList <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> ArrayList<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>terms <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>Terms<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Bucket</span> bucket <span style="color:#000;font-weight:bold">:</span> terms<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getBuckets</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                String keyAsString <span style="color:#000;font-weight:bold">=</span> bucket<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getKeyAsString</span><span style="color:#000;font-weight:bold">();</span><span style="color:#998;font-style:italic">// ÂàÜÁªÑÁöÑÂÄºÔºàÂàÜÁ±ªÂêçÁß∞Ôºâ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                categoryList<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>keyAsString<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//ÈÅçÂéÜÂèñÂá∫Êü•ËØ¢ÁöÑÂïÜÂìÅ‰ø°ÊÅØ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        List<span style="color:#000;font-weight:bold">&lt;</span>SkuInfo<span style="color:#000;font-weight:bold">&gt;</span> skuList<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">new</span> ArrayList<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>SearchHit<span style="color:#000;font-weight:bold">&lt;</span>SkuInfo<span style="color:#000;font-weight:bold">&gt;</span> searchHit <span style="color:#000;font-weight:bold">:</span>skuPage<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getContent</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#998;font-style:italic">// Ëé∑ÂèñÊêúÁ¥¢Âà∞ÁöÑÊï∞ÊçÆ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            SkuInfo content <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>SkuInfo<span style="color:#000;font-weight:bold">)</span> searchHit<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getContent</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            SkuInfo skuInfo <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> SkuInfo<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            BeanUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">copyProperties</span><span style="color:#000;font-weight:bold">(</span>content<span style="color:#000;font-weight:bold">,</span> skuInfo<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            skuList<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>skuInfo<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//6.ËøîÂõûÁªìÊûú
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        Map resultMap <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> HashMap<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>        resultMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;rows&#34;</span><span style="color:#000;font-weight:bold">,</span> skuList<span style="color:#000;font-weight:bold">);</span><span style="color:#998;font-style:italic">//Ëé∑ÂèñÊâÄÈúÄSkuInfoÈõÜÂêàÊï∞ÊçÆÂÜÖÂÆπ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        resultMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;total&#34;</span><span style="color:#000;font-weight:bold">,</span>searchHits<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getTotalHits</span><span style="color:#000;font-weight:bold">());</span><span style="color:#998;font-style:italic">//ÊÄªËÆ∞ÂΩïÊï∞
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        resultMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;totalPages&#34;</span><span style="color:#000;font-weight:bold">,</span> skuPage<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getTotalPages</span><span style="color:#000;font-weight:bold">());</span><span style="color:#998;font-style:italic">//ÊÄªÈ°µÊï∞
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        resultMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;categoryList&#34;</span><span style="color:#000;font-weight:bold">,</span>categoryList<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> resultMap<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>Ê∑ªÂä†ÁöÑ‰ª£Á†ÅÂ¶Ç‰∏ã:
<img src="/posts/project-0/20220527224880/image-20220527230901579.png"
    
    
    
    loading="lazy"
    
    
></p>
<p><img src="/posts/project-0/20220527224880/image-20220527230908138.png"
    
    
    
    loading="lazy"
    
    
></p>
<p><img src="/posts/project-0/20220527224880/image-20220527230914696.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>Ê≥®ÊÑèÂàÜÁªÑÊêúÁ¥¢Ë¶ÅÂä†keywordÔºåÂõ†‰∏∫Êï∞ÊçÆÂ≠òÂÇ®ÁªìÊûÑÊòØkeywordÁ±ªÂûã</p>
<p>ÂÖ∑‰ΩìÊü•ÁúãÊï∞ÊçÆÁªìÊûÑÂèØ‰ª•‰ΩøÁî®Â¶Ç‰∏ãÊåá‰ª§Ôºö</p>
<pre tabindex="0"><code>GET /skuinfo/_mapping
</code></pre><p><img src="/posts/project-0/20220527224880/image-20220527230921890.png"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="63-ÊµãËØï">6.3 ÊµãËØï</h3>
<p>ËØ∑Ê±Çhttp://localhost:9005/search
<img src="/posts/project-0/20220527224880/image-20220527230928474.png"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="64-‰ª£Á†Å‰ºòÂåñ">6.4 ‰ª£Á†Å‰ºòÂåñ</h3>
<p>Â¶Ç‰∏ä,ÂèØ‰ª•Â∞ÜËé∑ÂèñÂàÜÁªÑÁöÑ‰ª£Á†ÅËøõË°åÊèêÂèñ,Â¶Ç‰∏ã‰ª£Á†ÅÊâÄÁ§∫:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * Ëé∑ÂèñÂàÜÁ±ªÂàóË°®Êï∞ÊçÆ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param terms
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     **/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> List<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">getStringsCategoryList</span><span style="color:#000;font-weight:bold">(</span>Terms terms<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        List<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">&gt;</span> categoryList <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> ArrayList<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>terms <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>Terms<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Bucket</span> bucket <span style="color:#000;font-weight:bold">:</span> terms<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getBuckets</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                String keyAsString <span style="color:#000;font-weight:bold">=</span> bucket<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getKeyAsString</span><span style="color:#000;font-weight:bold">();</span><span style="color:#998;font-style:italic">// ÂàÜÁªÑÁöÑÂÄºÔºàÂàÜÁ±ªÂêçÁß∞Ôºâ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                categoryList<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>keyAsString<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> categoryList<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>Âú®searchÊñπÊ≥ï‰∏≠ËøõË°åË∞ÉÁî®:
<img src="/posts/project-0/20220527224880/image-20220527230939376.png"
    
    
    
    loading="lazy"
    
    
></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// Ëé∑ÂèñÂàÜÁ±ªÂêçÁß∞ÈõÜÂêà
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        List<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">&gt;</span> categoryList <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getStringsCategoryList</span><span style="color:#000;font-weight:bold">(</span>terms<span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><p>Êï¥‰Ωì‰ª£Á†ÅÂ¶Ç‰∏ãÔºö</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">package</span> <span style="color:#555">com.offcn.search.service.impl</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.alibaba.fastjson.JSON</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.offcn.entity.Result</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.offcn.search.dao.SkuEsMapper</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.offcn.search.pojo.SkuInfo</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.offcn.search.service.SkuService</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.offcn.sellergoods.feign.SkuFeign</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">com.offcn.sellergoods.pojo.Item</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.apache.commons.lang.StringUtils</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.elasticsearch.index.query.QueryBuilders</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.elasticsearch.search.aggregations.AggregationBuilders</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.elasticsearch.search.aggregations.bucket.terms.Terms</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.beans.BeanUtils</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.beans.factory.annotation.Autowired</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.data.elasticsearch.core.*</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.data.elasticsearch.core.query.NativeSearchQuery</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.data.elasticsearch.core.query.NativeSearchQueryBuilder</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.springframework.stereotype.Service</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.ArrayList</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.HashMap</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.List</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.Map</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Service</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">SkuServiceImpl</span> <span style="color:#000;font-weight:bold">implements</span> SkuService <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> SkuEsMapper skuEsMapper<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> SkuFeign skuFeign<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * ÂØºÂÖ•SKUÊï∞ÊçÆ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">importSku</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//Ë∞ÉÁî®ÂïÜÂìÅÂæÆÊúçÂä°ÔºåËé∑ÂèñskuÂïÜÂìÅÊï∞ÊçÆ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        Result<span style="color:#000;font-weight:bold">&lt;</span>List<span style="color:#000;font-weight:bold">&lt;</span>Item<span style="color:#000;font-weight:bold">&gt;&gt;</span> result <span style="color:#000;font-weight:bold">=</span> skuFeign<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findByStatus</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;1&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//ÊääÊï∞ÊçÆËΩ¨Êç¢‰∏∫ÊêúÁ¥¢ÂÆû‰ΩìÁ±ªÊï∞ÊçÆ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        List<span style="color:#000;font-weight:bold">&lt;</span>SkuInfo<span style="color:#000;font-weight:bold">&gt;</span> skuInfoList <span style="color:#000;font-weight:bold">=</span> JSON<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">parseArray</span><span style="color:#000;font-weight:bold">(</span>JSON<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">toJSONString</span><span style="color:#000;font-weight:bold">(</span>result<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getData</span><span style="color:#000;font-weight:bold">()),</span> SkuInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//ÈÅçÂéÜskuÈõÜÂêà
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>SkuInfo skuInfo <span style="color:#000;font-weight:bold">:</span> skuInfoList<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//Ëé∑ÂèñËßÑÊ†º
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">&gt;</span> specMap <span style="color:#000;font-weight:bold">=</span> JSON<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">parseObject</span><span style="color:#000;font-weight:bold">(</span>skuInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getSpec</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//ÂÖ≥ËÅîËÆæÁΩÆÂà∞specMap
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            skuInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setSpecMap</span><span style="color:#000;font-weight:bold">(</span>specMap<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//‰øùÂ≠òskuÈõÜÂêàÊï∞ÊçÆÂà∞es
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        skuEsMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">saveAll</span><span style="color:#000;font-weight:bold">(</span>skuInfoList<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> ElasticsearchRestTemplate elasticsearchRestTemplate<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> Map <span style="color:#900;font-weight:bold">search</span><span style="color:#000;font-weight:bold">(</span>Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> String<span style="color:#000;font-weight:bold">&gt;</span> searchMap<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//1.Ëé∑ÂèñÂÖ≥ÈîÆÂ≠óÁöÑÂÄº
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        String keywords <span style="color:#000;font-weight:bold">=</span> searchMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;keywords&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>StringUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">isEmpty</span><span style="color:#000;font-weight:bold">(</span>keywords<span style="color:#000;font-weight:bold">))</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            keywords <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Âçé‰∏∫&#34;</span><span style="color:#000;font-weight:bold">;</span><span style="color:#998;font-style:italic">//ËµãÂÄºÁªô‰∏Ä‰∏™ÈªòËÆ§ÁöÑÂÄº
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//2.ÂàõÂª∫Êü•ËØ¢ÂØπË±° ÁöÑÊûÑÂª∫ÂØπË±°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        NativeSearchQueryBuilder nativeSearchQueryBuilder <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> NativeSearchQueryBuilder<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// ËÆæÁΩÆÂàÜÁªÑÁöÑÊù°‰ª∂  termsÂêéË°®Á§∫ÂàÜÁªÑÊü•ËØ¢ÂêéÁöÑÂàóÂêç
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        nativeSearchQueryBuilder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addAggregation</span><span style="color:#000;font-weight:bold">(</span>AggregationBuilders<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">terms</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;skuCategorygroup&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">field</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;category.keyword&#34;</span><span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//3.ËÆæÁΩÆÊü•ËØ¢ÁöÑÊù°‰ª∂
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//‰ΩøÁî®ÔºöQueryBuilders.matchQuery(&#34;title&#34;, keywords) ÔºåÊêúÁ¥¢Âçé‰∏∫ ---&gt; Âçé    ‰∏∫ ‰∫åÂ≠óÂèØ‰ª•ÊãÜÂàÜÊü•ËØ¢Ôºå
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//‰ΩøÁî®ÔºöQueryBuilders.matchPhraseQuery(&#34;title&#34;, keywords) Âçé‰∏∫‰∫åÂ≠ó‰∏çÊãÜÂàÜÊü•ËØ¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        nativeSearchQueryBuilder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">withQuery</span><span style="color:#000;font-weight:bold">(</span>QueryBuilders<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">matchQuery</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;title&#34;</span><span style="color:#000;font-weight:bold">,</span> keywords<span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//4.ÊûÑÂª∫Êü•ËØ¢ÂØπË±°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        NativeSearchQuery query <span style="color:#000;font-weight:bold">=</span> nativeSearchQueryBuilder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">build</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//5.ÊâßË°åÊü•ËØ¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        SearchHits<span style="color:#000;font-weight:bold">&lt;</span>SkuInfo<span style="color:#000;font-weight:bold">&gt;</span> searchHits <span style="color:#000;font-weight:bold">=</span> elasticsearchRestTemplate<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">search</span><span style="color:#000;font-weight:bold">(</span>query<span style="color:#000;font-weight:bold">,</span> SkuInfo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//ÂØπÊêúÁ¥¢searchHitsÈõÜÂêàËøõË°åÂàÜÈ°µÂ∞ÅË£Ö
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        SearchPage<span style="color:#000;font-weight:bold">&lt;</span>SkuInfo<span style="color:#000;font-weight:bold">&gt;</span> skuPage <span style="color:#000;font-weight:bold">=</span> SearchHitSupport<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">searchPageFor</span><span style="color:#000;font-weight:bold">(</span>searchHits<span style="color:#000;font-weight:bold">,</span> query<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getPageable</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//Ëé∑ÂèñÂàÜÁªÑÁªìÊûú
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        Terms terms <span style="color:#000;font-weight:bold">=</span> searchHits<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getAggregations</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;skuCategorygroup&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// Ëé∑ÂèñÂàÜÁ±ªÂêçÁß∞ÈõÜÂêà
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        List<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">&gt;</span> categoryList <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getStringsCategoryList</span><span style="color:#000;font-weight:bold">(</span>terms<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//ÈÅçÂéÜÂèñÂá∫Êü•ËØ¢ÁöÑÂïÜÂìÅ‰ø°ÊÅØ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        List<span style="color:#000;font-weight:bold">&lt;</span>SkuInfo<span style="color:#000;font-weight:bold">&gt;</span> skuList<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">new</span> ArrayList<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>SearchHit<span style="color:#000;font-weight:bold">&lt;</span>SkuInfo<span style="color:#000;font-weight:bold">&gt;</span> searchHit <span style="color:#000;font-weight:bold">:</span>skuPage<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getContent</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#998;font-style:italic">// Ëé∑ÂèñÊêúÁ¥¢Âà∞ÁöÑÊï∞ÊçÆ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            SkuInfo content <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>SkuInfo<span style="color:#000;font-weight:bold">)</span> searchHit<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getContent</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            SkuInfo skuInfo <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> SkuInfo<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            BeanUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">copyProperties</span><span style="color:#000;font-weight:bold">(</span>content<span style="color:#000;font-weight:bold">,</span> skuInfo<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            skuList<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>skuInfo<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//6.ËøîÂõûÁªìÊûú
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        Map resultMap <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> HashMap<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>        resultMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;rows&#34;</span><span style="color:#000;font-weight:bold">,</span> skuList<span style="color:#000;font-weight:bold">);</span><span style="color:#998;font-style:italic">//Ëé∑ÂèñÊâÄÈúÄSkuInfoÈõÜÂêàÊï∞ÊçÆÂÜÖÂÆπ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        resultMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;total&#34;</span><span style="color:#000;font-weight:bold">,</span>searchHits<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getTotalHits</span><span style="color:#000;font-weight:bold">());</span><span style="color:#998;font-style:italic">//ÊÄªËÆ∞ÂΩïÊï∞
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        resultMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;totalPages&#34;</span><span style="color:#000;font-weight:bold">,</span> skuPage<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getTotalPages</span><span style="color:#000;font-weight:bold">());</span><span style="color:#998;font-style:italic">//ÊÄªÈ°µÊï∞
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        resultMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;categoryList&#34;</span><span style="color:#000;font-weight:bold">,</span>categoryList<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> resultMap<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * Ëé∑ÂèñÂàÜÁ±ªÂàóË°®Êï∞ÊçÆ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param terms
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     **/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> List<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">getStringsCategoryList</span><span style="color:#000;font-weight:bold">(</span>Terms terms<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        List<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">&gt;</span> categoryList <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> ArrayList<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>terms <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>Terms<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Bucket</span> bucket <span style="color:#000;font-weight:bold">:</span> terms<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getBuckets</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                String keyAsString <span style="color:#000;font-weight:bold">=</span> bucket<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getKeyAsString</span><span style="color:#000;font-weight:bold">();</span><span style="color:#998;font-style:italic">// ÂàÜÁªÑÁöÑÂÄºÔºàÂàÜÁ±ªÂêçÁß∞Ôºâ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>                categoryList<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>keyAsString<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> categoryList<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div>
    </div>

    

    


    <div class="container-prevnext">
    <div><a href="https://lovemjh.vercel.app/posts/project-0/20220527222325/">‚Üê ÂπøÂëäÁÆ°ÁêÜ‰∏éLua„ÄÅCanalÂÆûÁé∞ÂπøÂëäÁºìÂ≠ò</a></div>
    <div><a href="https://lovemjh.vercel.app/posts/project-0/20220527233134/">Ê∂àÊÅØÈòüÂàóÂèäÁü≠‰ø°ÂèëÈÄÅÂπ≥Âè∞  ‚Üí</a></div>
</div>
</div>

        </div>
        <div id="footer"><div class="container-footer">
    
    <a href="//beian.miit.gov.cn" target="_blank">
        
        Ë±´ICPÂ§á2022002918Âè∑
        
    </a>
    <a id="s" href="/secrets">&nbsp;</a>
</div></div>
    </body>
</html>
