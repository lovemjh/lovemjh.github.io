<!DOCTYPE html>
<html><head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,user-scalable=no">
  <meta name="description" content="MJH Blog & MEET HTML Theme">
  <title>tk-题库项目开发3</title>
  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery.fancybox@2.1.5/source/jquery.fancybox.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.4/tocbot.css">
  
  <link rel="stylesheet" href="https://npm.elemecdn.com/lxgw-wenkai-webfont@1.1.0/lxgwwenkai-regular.css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/agate.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js"></script>
  <script>
    hljs.highlightAll();
  </script>
  
  <link rel="stylesheet" href="https://unpkg.com/animate.css@3.5.2/animate.min.css">
  <script type="text/javascript">
    if (!!window.ActiveXObject || "ActiveXObject" in window) { 
      alert('朋友，上古浏览器不支持呢~');
    }
  </script>

  <style>
    .sidebar {
      z-index: 998;
      position: fixed;
      left: -200px;
      width: 200px;
      height: 100%;
      background: #ffffff;
      transition: all .5s ease;
    }

    .sidebar .top {
      font-size: 22px;
      color: rgb(0, 0, 0);
      text-align: center;
      height: 60px;
      line-height: 60px;
      background-color: rgb(255, 255, 255);
      user-select: none;

    }

    .sidebar ul {
      list-style: none;
    }

    .sidebar ul a {
      display: block;
      height: 100%;
      width: 100%;
      text-align: center;
      line-height: 45px;
      font-size: 18px;
      color: rgb(0, 0, 0);
      box-sizing: border-box;
      border-top: 1px solid rgb(255, 0, 0);
      border-bottom: 1px solid rgb(0, 17, 255);
      transition: .4s;
    }

    .sidebar ul li:hover a {
      padding-left: 30px;
      color: #7c4242;
      border-left: 5px solid #ffffff;
      transition: all 0.5s;
    }

    .sidebar ul a i {
      margin-right: 16px;
    }

    #check {
      display: none;
    }

    label #btn,
    label #cancel {
      position: fixed;
      cursor: pointer;
      background-color: #000000;
      border-radius: 3px;
    }

    label #btn {
      left: 5px;
      top: 7px;
      font-size: 25px;
      color: #fff;
      padding: 6px 10px;
      transition: all .5s;
      z-index: 999;
    }

    label #cancel {
      z-index: 999;
      left: -145px;
      top: 10px;
      font-size: 25px;
      color: rgb(255, 255, 255);
      padding: 4px 9px;
      transition: all .5s ease;
    }

    #check:checked~.sidebar {
      left: 0;
    }

    #check:checked~label #btn {
      left: 10px;
      opacity: 0;
      pointer-events: none;
    }

    #check:checked~label #cancel {
      left: 150px;
    }







     
    ::-webkit-scrollbar {
      width: 8px;
      height: 6px
    }

     
    ::-webkit-scrollbar-track {
      background-color: transparent;
      -webkit-border-radius: 2em;
      -moz-border-radius: 2em;
      border-radius: 2em
    }

     
    ::-webkit-scrollbar-thumb {
      background-color: #30B07F;
      background-image: -webkit-linear-gradient(45deg, rgba(255, 255, 255, .4) 100%, transparent 100%, transparent 50%, rgba(255, 255, 255, .4) 50%, rgba(255, 255, 255, .4) 75%, transparent 75%, transparent);
      -webkit-border-radius: 2em;
      -moz-border-radius: 2em;
      border-radius: 2em
    }






     
    .navigation {
      width: 100%;
      height: 50px;
       
      position: fixed;
      left: 0;
      top: 0;
      text-align: center;
      transition: top 0.5s;
      z-index: 999;

      background: rgba(255, 255, 255, .4) !important;
      -webkit-backdrop-filter: saturate(180%) blur(20px);
      backdrop-filter: saturate(180%) blur(20px) !important;
    }

     
    .hide {
      top: -60px;
    }



     
    .btn {
      width: 120px;
      height: 40px;
      background: linear-gradient(315deg, #a4d8fa 0%, #5eb1e9 74%);
      border: none;
      border-radius: 10px;
      font-family: 'Lato', sans-serif;
      font-weight: 500;
      font-size: smaller;
      color: #fff;
      box-shadow: inset 2px 2px 2px 0px rgba(255, 255, 255, .5),
        7px 7px 20px 0px rgba(0, 0, 0, .1),
        4px 4px 5px 0px rgba(0, 0, 0, .1);
      outline: none;
      position: relative;
      z-index: 0;
    }

    .btn::before {
      position: absolute;
      content: '';
      left: 0;
      bottom: 0;
      width: 100%;
      height: 0;
      transition: all 0.3s ease;
      border-radius: 10px;
      background: linear-gradient(315deg, #4dccc6 0%, #96e4df 74%);
      z-index: -1;
    }

    .btn:hover::before {
      top: 0;
      height: 100%;
    }

    .btn:active {
      top: 2px;
    }




     
     

     
    * {
      font-family: LXGW WenKai
    }

    * {
      font-weight: bold
    }

    body {
      font-family: LXGW WenKai;
    }




     
    .pagination {
      display: flex;
      flex-flow: row nowrap;
      justify-content: center;
      align-items: center;
      height: 50px;
      margin: 0px;
    }

    .pagination a {
      text-decoration: none;
      font-size: 22px;
      color: rgb(0, 0, 0);
    }

    .page-item {
      display: inline;
      margin-right: 20px;
    }

    #Background_animation { 
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    }

  </style>

</head>
    <body style="background-color: rgb(229, 204, 15);">
    
<svg xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" viewBox="0 0 100 100" id="Background_animation">
  <defs>
      <style>
          @keyframes rotate {
              100% {
                  transform: rotate(360deg);
              }
          }
          .out-top {
              animation: rotate 20s linear infinite;
              transform-origin: 13px 25px;
          }
          .in-top {
              animation: rotate 10s linear infinite;
              transform-origin: 13px 25px;
          }
          .out-bottom {
              animation: rotate 25s linear infinite;
              transform-origin: 84px 93px;
          }
          .in-bottom {
              animation: rotate 15s linear infinite;
              transform-origin: 84px 93px;
          }
      </style>
  </defs>
  <path fill="#9b5de5" class="out-top" d="M37-5C25.1-14.7,5.7-19.1-9.2-10-28.5,1.8-32.7,31.1-19.8,49c15.5,21.5,52.6,22,67.2,2.3C59.4,35,53.7,8.5,37-5Z"/>
  <path fill="#f15bb5" class="in-top" d="M20.6,4.1C11.6,1.5-1.9,2.5-8,11.2-16.3,23.1-8.2,45.6,7.4,50S42.1,38.9,41,24.5C40.2,14.1,29.4,6.6,20.6,4.1Z"/>
  <path fill="#00bbf9" class="out-bottom" d="M105.9,48.6c-12.4-8.2-29.3-4.8-39.4.8-23.4,12.8-37.7,51.9-19.1,74.1s63.9,15.3,76-5.6c7.6-13.3,1.8-31.1-2.3-43.8C117.6,63.3,114.7,54.3,105.9,48.6Z"/>
  <path fill="#00f5d4" class="in-bottom" d="M102,67.1c-9.6-6.1-22-3.1-29.5,2-15.4,10.7-19.6,37.5-7.6,47.8s35.9,3.9,44.5-12.5C115.5,92.6,113.9,74.6,102,67.1Z"/>
</svg>

  <input type="checkbox" id="check">
<label for="check">
  <i class="fa fa-bars" id="btn"></i>
  <i class="fa fa-times" id="cancel"></i>
</label>
<div class="sidebar">
  <div class="top">Hi~</div>
  <ul>
    
    <li class="lii">
      <a href="/">
        <div class="burger-item">
          <i class='fa fa-home'></i> 主页
        </div>
      </a>
    </li>
    
    <li class="lii">
      <a href="/posts">
        <div class="burger-item">
          <i class='fa fa-archive'></i> 文章
        </div>
      </a>
    </li>
    
    <li class="lii">
      <a href="/categories">
        <div class="burger-item">
          <i class='fa fa-folder-open'></i> 分类
        </div>
      </a>
    </li>
    
    <li class="lii">
      <a href="/archive">
        <div class="burger-item">
          <i class='fa fa-folder-open'></i> 归档
        </div>
      </a>
    </li>
    
    <li class="lii">
      <a href="/tags">
        <div class="burger-item">
          <i class='fa fa-tags'></i> 标签
        </div>
      </a>
    </li>
    
    <li class="lii">
      <a href="/about">
        <div class="burger-item">
          <i class='fa fa-info-circle'></i> 关于
        </div>
      </a>
    </li>
    
  </ul>
</div><nav class="navigation">
  <ul class="ull">
    
    <li class="lii">
      <a href="/">
        <div class="burger-item">
          <i class='fa fa-home'></i> 主页
        </div>
      </a>
    </li>
    
    <li class="lii">
      <a href="/posts">
        <div class="burger-item">
          <i class='fa fa-archive'></i> 文章
        </div>
      </a>
    </li>
    
    <li class="lii">
      <a href="/categories">
        <div class="burger-item">
          <i class='fa fa-folder-open'></i> 分类
        </div>
      </a>
    </li>
    
    <li class="lii">
      <a href="/archive">
        <div class="burger-item">
          <i class='fa fa-folder-open'></i> 归档
        </div>
      </a>
    </li>
    
    <li class="lii">
      <a href="/tags">
        <div class="burger-item">
          <i class='fa fa-tags'></i> 标签
        </div>
      </a>
    </li>
    
    <li class="lii">
      <a href="/about">
        <div class="burger-item">
          <i class='fa fa-info-circle'></i> 关于
        </div>
      </a>
    </li>
    
  </ul>
</nav>
<div id="body-wrap">
  
  <div style="width: 100%; height: 65vh;">
    <div id="page_site-info">
      <div id="site-title">
        <input type="checkbox" id="check">
        <br>
        <span class="blogtitle"></span>
        
        
        <div class="post-header">
          <span>
            
            <i class="fa fa-calendar"></i>
            2022-05-28&nbsp;
          </span>
          <span>
            
            <i class="fa fa-calendar-check-o"></i>
            2022-05-28&nbsp;&nbsp;&nbsp;
          </span>
          <span>
            
            <i class="fa fa-edit"></i>
            11693 字
          </span>&nbsp;
          <span>
            
            <i class="fa fa-paper-plane"></i>
            24 分钟
          </span>
        </div><div class="container-ctgtag">
	<div class="taxonomy" style="display: flex; justify-content: center;">
		
		<div class="ctg" style="display: flex; justify-content: center; margin-right: 20px;">
			
			<div style="margin-right: 10px;">
				
				<a href="/categories/"></a>
			</div>
			
		</div>
		<div class="tag" style="display: flex; justify-content: center;">
			
			<div style="margin-right: 10px;">
				
				<a href="/tags/"></a></i>
			</div>
			
		</div>
	</div>
</div>

        <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11"></script>
        <script>
          var typed = new Typed(".blogtitle", {
            strings: ['tk-题库项目开发3'],
            startDelay: 300,
            typeSpeed: 100,
            loop: true,
            backSpeed: 50,
            showCursor: true
          });
        </script>
      </div>
    </div>
  </div>
  
<main id="content-outer">
    <div class="layout_page" id="content-inner">
        <article id="page" style="margin-right: 10px;">
            
            <div class="js-toc-content" style="height: 100%;">
                <h1 align = "center">第五章</h1>
<h1 align = "center">优学题库项目开发3</h1>
<h3 align="center">优就业.JAVA教研室</h3>
<h2 id="学习目标">学习目标</h2>
<ul>
<li>掌握OSS云存储、账号开通、上传测试</li>
<li>掌握图片上传到OSS云存储</li>
<li>掌握开发广告内容前端维护功能</li>
<li>掌握开发用户管理前端维护功能</li>
<li>掌握微信小程序登录及验证调用接口</li>
<li>掌握开发微信小程序分类、题库、广告轮播图调用接口</li>
<li>了解接口文档生成方式</li>
</ul>
<h1 id="1oss云存储介绍开通上传测试">1、OSS云存储介绍，开通、上传测试</h1>
<p>文件上传在系统中用的很频繁，所以我们需要将上传的文件进行存储，传统的将文件上传到本机已不适用分布式系统。自己搭建文件服务器有复杂性和维护成本。所以我们可以采用市面上成熟的文件存储服务，如阿里云的OSS对象存储服务。</p>
<h2 id="11-登录阿里云开通oss存储">1.1 登录阿里云开通OSS存储</h2>
<p>产品-&gt;精选-&gt;对象存储OSS
<img src="/posts/project/20220528234610/image-20220528234806997.png"
    
    
    
    loading="lazy"
    
    
>
立即开通
<img src="/posts/project/20220528234610/image-20220528234851515.png"
    
    
    
    loading="lazy"
    
    
>
需要实名认证后才能开通
<img src="/posts/project/20220528234610/image-20220528234904172.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="12创建bucket">1.2、创建Bucket</h2>
<p><img src="/posts/project/20220528234610/image-20220528234912769.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>点击创建Bucket按钮，弹出创建Bucket界面</p>
<p>特别强调这里的读写权限一定设置为“公共的”。
<img src="/posts/project/20220528234610/image-20220528234929492.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>新建文件夹[pic,video],点击目录可以上传图片,并可以访问
<img src="/posts/project/20220528234610/image-20220528234935960.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="13accesskey申请">1.3、accesskey申请</h2>
<p>管理控制台，右上角，点击用户头像，弹出菜单：
<img src="/posts/project/20220528234610/image-20220528234942326.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>选择：AccessKey管理，弹出提示，选择： 开始使用子用户 AccessKey
<img src="/posts/project/20220528234610/image-20220528234951185.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>点击： 开始使用子用户AccessKey</p>
<p>出现创建用户界面：输入登录用户名、显示用户名，勾选 编程访问，点击 确定即可创建用户。
<img src="/posts/project/20220528234610/image-20220528234957120.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>l 选择左边菜单的用户连接，进入用户列表
<img src="/posts/project/20220528234610/image-20220528235005280.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>l 选择用户，点击左下角的 添加权限按钮，即可进入设置权限页面
<img src="/posts/project/20220528234610/image-20220528235022780.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>点击确定，出现授权成功提示
<img src="/posts/project/20220528234610/image-20220528235029220.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>l 选择用户，设置用户AccessKey</p>
<p>点击用户列表，中的用户名，进入用户设置界面
<img src="/posts/project/20220528234610/image-20220528235034493.png"
    
    
    
    loading="lazy"
    
    
></p>
<p><img src="/posts/project/20220528234610/image-20220528235041599.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>l 点击创建AccessKey，弹出Accesskey创建成功页面，复制并保存好相关秘钥
<img src="/posts/project/20220528234610/image-20220528235047996.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="14引入sdk">1.4、引入sdk</h2>
<p><a class="link" href="/posts/project/https://help.aliyun.com/document_detail/32009.html"  target="_blank" rel="noopener"
    >https://help.aliyun.com/document_detail/32009.html</a></p>
<p>SDK依赖：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>com.aliyun.oss<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>aliyun-sdk-oss<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>3.8.0<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><h2 id="15java编程方式上传文件到oss">1.5、java编程方式上传文件到oss</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.offcn.utils</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OSSTest</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * OSS 使用步骤 阿里云
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 1）、引入SDK
</span></span></span><span class="line"><span class="cl"><span class="cm">     * 2）、配置好相应的属性
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span><span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Endpoint以北京为例，其它Region请按实际情况填写。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">String</span> <span class="n">endpoint</span> <span class="o">=</span> <span class="s">&#34;http://oss-cn-beijing.aliyuncs.com&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 云账号AccessKey有所有API访问权限，建议遵循阿里云安全最佳实践，创建并使用RAM子账号进行API访问或日常运维，请登录 https://ram.console.aliyun.com 创建。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">String</span> <span class="n">accessKeyId</span> <span class="o">=</span> <span class="s">&#34;LTAI4F***33p318BifWc&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">accessKeySecret</span> <span class="o">=</span> <span class="s">&#34;epNR5QdCC44***bwW4FW8P3UEW&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 创建OSSClient实例。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">OSS</span> <span class="n">ossClient</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OSSClientBuilder</span><span class="o">().</span><span class="na">build</span><span class="o">(</span><span class="n">endpoint</span><span class="o">,</span> <span class="n">accessKeyId</span><span class="o">,</span> <span class="n">accessKeySecret</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 上传文件流。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">InputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&#34;D:\\007.jpg&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl"><span class="c1">//要存放的存储桶名称，存储文件名 ，文件输入流
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">ossClient</span><span class="o">.</span><span class="na">putObject</span><span class="o">(</span><span class="s">&#34;offcn20200330&#34;</span><span class="o">,</span> <span class="s">&#34;pic/008.jpg&#34;</span><span class="o">,</span> <span class="n">inputStream</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 关闭OSSClient。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">ossClient</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;测试完成&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>执行上传程序成功，查看oss服务器端
<img src="/posts/project/20220528234610/image-20220528235056259.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>访问图片地址：</p>
<p>Bucket+域名 + 图片路径 + 文件名</p>
<p><a class="link" href="/posts/project/https://offcn20200330.oss-cn-beijing.aliyuncs.com/pic/008.jpg"  target="_blank" rel="noopener"
    >https://offcn20200330.oss-cn-beijing.aliyuncs.com/pic/008.jpg</a></p>
<p>**</p>
<h1 id="2实现图片上传到oss云存储">2、实现图片上传到oss云存储</h1>
<h2 id="21上传原理">2.1、上传原理</h2>
<h3 id="211通过应用服务器中转上传">2.1.1、通过应用服务器中转上传</h3>
<p>每个 OSS 的用户都会用到上传服务。Web 端常见的上传方法是用户在浏览器或 APP 端上传文件到应用服务器，应用服务器再把文件上传到 OSS。具体流程如下图所示。
<img src="/posts/project/20220528234610/image-20220528235107425.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>和数据直传到 OSS 相比，以上方法有三个缺点：</p>
<p>上传慢：用户数据需先上传到应用服务器，之后再上传到OSS。网络传输时间比直传到OSS多一倍。如果用户数据不通过应用服务器中转，而是直传到OSS，速度将大大提升。而且OSS采用BGP带宽，能保证各地各运营商之间的传输速度。
扩展性差：如果后续用户多了，应用服务器会成为瓶颈。
费用高：需要准备多台应用服务器。由于OSS上传流量是免费的，如果数据直传到OSS，不通过应用服务器，可以节省应用服务器</p>
<h3 id="212直接javascript客户端上传到oss">2.1.2、直接javaScript客户端上传到oss</h3>
<p>采用JavaScript客户端直接签名（参见<a class="link" href="/posts/project/https://help.aliyun.com/document_detail/31925.html#concept-frd-4gy-5db"  target="_blank" rel="noopener"
    >JavaScript客户端签名直传</a>）时，AccessKeyID和AcessKeySecret会暴露在前端页面，因此存在严重的安全隐患。因此，OSS提供了服务端签名后直传的方案。</p>
<h4 id="服务器端获取签名客户端直接上传到oss原理">服务器端获取签名，客户端直接上传到oss原理</h4>
<p><img src="/posts/project/20220528234610/image-20220528235200272.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>服务端签名后直传的原理如下：</p>
<ol>
<li>
<p>用户发送上传Policy请求到应用服务器。</p>
</li>
<li>
<p>应用服务器返回上传Policy和签名给用户。</p>
</li>
<li>
<p>用户直接上传数据到OSS。
<img src="/posts/project/20220528234610/image-20220528235208188.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>参考官方文档：https://help.aliyun.com/document_detail/31926.htm</p>
</li>
</ol>
<h2 id="22搭建获取oss签名微服务">2.2、搭建获取oss签名微服务</h2>
<h3 id="221创建新模块u-oss标准springboot工程">2.2.1、创建新模块u-oss（标准springboot工程）</h3>
<p><img src="/posts/project/20220528234610/image-20220528235217896.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>最终创建好模块
<img src="/posts/project/20220528234610/image-20220528235224247.png"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="222pomxml引入依赖">2.2.2、pom.xml引入依赖</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="na">xsi:schemaLocation=</span><span class="s">&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;parent&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>2.3.6.RELEASE<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;relativePath/&gt;</span> <span class="c">&lt;!-- lookup parent from repository --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/parent&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>u-oss<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;properties&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;java.version&gt;</span>1.8<span class="nt">&lt;/java.version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;spring-cloud.version&gt;</span>Hoxton.SR9<span class="nt">&lt;/spring-cloud.version&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;spring-cloud-alibaba.version&gt;</span>2.2.0.RELEASE<span class="nt">&lt;/spring-cloud-alibaba.version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/properties&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-alicloud-oss<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependencies&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependencyManagement&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>spring-cloud-dependencies<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${spring-cloud.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;artifactId&gt;</span>spring-cloud-alibaba-dependencies<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;version&gt;</span>${spring-cloud-alibaba.version}<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependencies&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependencyManagement&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/project&gt;</span>
</span></span></code></pre></div><h3 id="223配置文件applicationyml">2.2.3、配置文件application.yml</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">server</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">14000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">u-oss</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">discovery</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8848</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">alicloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">access-key</span><span class="p">:</span><span class="w"> </span><span class="l">LTAI4G7***xizdRu</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">secret-key</span><span class="p">:</span><span class="w"> </span><span class="l">aSHoxLMB&amp;&amp;&amp;&amp;GFSeb5nsLmJIYTwf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">oss</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="l">oss-cn-beijing.aliyuncs.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">bucket</span><span class="p">:</span><span class="w"> </span><span class="l">java0817-001</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">logging</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">level</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">com.offcn.oss</span><span class="p">:</span><span class="w"> </span><span class="l">debug</span><span class="w">
</span></span></span></code></pre></div><p>14.2.4、编写获取oss服务器签名OssController</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.offcn.oss.controller</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.aliyun.oss.OSS</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.aliyun.oss.common.utils.BinaryUtil</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.aliyun.oss.model.MatchMode</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.aliyun.oss.model.PolicyConditions</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Value</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RestController</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.LinkedHashMap</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@RestController</span>
</span></span><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/thirdparty/v1/admin/oss&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OssController</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl">    <span class="n">OSS</span> <span class="n">ossClient</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;${spring.cloud.alicloud.access-key}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">accessId</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;${spring.cloud.alicloud.oss.endpoint}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">endpoint</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;${spring.cloud.alicloud.oss.bucket}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">bucket</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/getPolicy&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="nf">getPolicy</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">host</span> <span class="o">=</span> <span class="s">&#34;https://&#34;</span> <span class="o">+</span> <span class="n">bucket</span> <span class="o">+</span> <span class="s">&#34;.&#34;</span> <span class="o">+</span> <span class="n">endpoint</span><span class="o">;</span> <span class="c1">// host的格式为 bucketname.endpoint
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">String</span> <span class="n">formatDate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="o">(</span><span class="s">&#34;yyyy-MM-dd&#34;</span><span class="o">).</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">dir</span> <span class="o">=</span> <span class="n">formatDate</span> <span class="o">+</span> <span class="s">&#34;/&#34;</span><span class="o">;</span> <span class="c1">// 用户上传文件时指定的前缀。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">respMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="kt">long</span> <span class="n">expireTime</span> <span class="o">=</span> <span class="n">30</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="kt">long</span> <span class="n">expireEndTime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">+</span> <span class="n">expireTime</span> <span class="o">*</span> <span class="n">1000</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">Date</span> <span class="n">expiration</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">(</span><span class="n">expireEndTime</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">PolicyConditions</span> <span class="n">policyConds</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PolicyConditions</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="c1">//PostObject请求最大可支持的文件大小为5 GB，即CONTENT_LENGTH_RANGE为5*1024*1024*1024。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">policyConds</span><span class="o">.</span><span class="na">addConditionItem</span><span class="o">(</span><span class="n">PolicyConditions</span><span class="o">.</span><span class="na">COND_CONTENT_LENGTH_RANGE</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">1048576000</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">policyConds</span><span class="o">.</span><span class="na">addConditionItem</span><span class="o">(</span><span class="n">MatchMode</span><span class="o">.</span><span class="na">StartWith</span><span class="o">,</span> <span class="n">PolicyConditions</span><span class="o">.</span><span class="na">COND_KEY</span><span class="o">,</span> <span class="n">dir</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//获取授权策略
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">String</span> <span class="n">postPolicy</span> <span class="o">=</span> <span class="n">ossClient</span><span class="o">.</span><span class="na">generatePostPolicy</span><span class="o">(</span><span class="n">expiration</span><span class="o">,</span> <span class="n">policyConds</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="kt">byte</span><span class="o">[]</span> <span class="n">binaryData</span> <span class="o">=</span> <span class="n">postPolicy</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="s">&#34;utf-8&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">String</span> <span class="n">encodedPolicy</span> <span class="o">=</span> <span class="n">BinaryUtil</span><span class="o">.</span><span class="na">toBase64String</span><span class="o">(</span><span class="n">binaryData</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//获取授权策略签名
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">String</span> <span class="n">postSignature</span> <span class="o">=</span> <span class="n">ossClient</span><span class="o">.</span><span class="na">calculatePostSignature</span><span class="o">(</span><span class="n">postPolicy</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">//封装accessid、签名等信息返回
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">respMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;accessid&#34;</span><span class="o">,</span> <span class="n">accessId</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">respMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;policy&#34;</span><span class="o">,</span> <span class="n">encodedPolicy</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">respMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;signature&#34;</span><span class="o">,</span> <span class="n">postSignature</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">respMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;dir&#34;</span><span class="o">,</span> <span class="n">dir</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">respMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;host&#34;</span><span class="o">,</span> <span class="n">host</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">respMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;expire&#34;</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">expireEndTime</span> <span class="o">/</span> <span class="n">1000</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// Assert.fail(e.getMessage());
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">ossClient</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">respMap</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h3 id="224编写主启动类">2.2.4、编写主启动类</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@SpringBootApplication</span>
</span></span><span class="line"><span class="cl"><span class="nd">@EnableDiscoveryClient</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OssStartApplication</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">OssStartApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">args</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h3 id="225启动服务访问controller获取签名">2.2.5、启动服务，访问controller获取签名</h3>
<p>访问地址：http://localhost:14000/thirdparty/v1/admin/oss/getPolicy
<img src="/posts/project/20220528234610/image-20220528235238410.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="23修改网关配置获取签名路由">2.3、修改网关配置获取签名路由</h2>
<h3 id="打开java服务cloud-gateway修改配置文件applicationyml">打开java服务cloud-gateway，修改配置文件application.yml</h3>
<p>增加到获取签名微服务的路由，<strong>注意配置顺序要在renren-fast 之前</strong>。
<img src="/posts/project/20220528234610/image-20220528235244638.png"
    
    
    
    loading="lazy"
    
    
></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">oss-route</span><span class="w"> </span><span class="c"># oss服务路由</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">lb://u-oss</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">Path=/api/thirdparty/**</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">filters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">RewritePath=/api/(?&lt;segment&gt;.*),/$\{segment}</span><span class="w">
</span></span></span></code></pre></div><p>http://localhost:8888/api/thirdparty/v1/admin/oss/getPolicy</p>
<h2 id="24开发前端工程配置上传">2.4、开发前端工程，配置上传</h2>
<h3 id="241新建获取签名的js">2.4.1、新建获取签名的js</h3>
<p>在前端工程renren-fast-vue目录src/utils/ 新建获取签名js文件 policy.js</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">http</span> <span class="nx">from</span> <span class="s1">&#39;@/utils/httpRequest.js&#39;</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kd">function</span> <span class="nx">policy</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">http</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">url</span><span class="o">:</span> <span class="nx">http</span><span class="p">.</span><span class="nx">adornUrl</span><span class="p">(</span><span class="s1">&#39;/thirdparty/v1/admin/oss/getPolicy&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;get&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">params</span><span class="o">:</span> <span class="nx">http</span><span class="p">.</span><span class="nx">adornParams</span><span class="p">({})</span>
</span></span><span class="line"><span class="cl">    <span class="p">}).</span><span class="nx">then</span><span class="p">(({</span> <span class="nx">data</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">resolve</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="242新建文件上传控件页面">2.4.2、新建文件上传控件页面</h3>
<p>在前端工程renren-fast-vue目录src/views/modules/common目录下  创建上传页面 singleUpload.vue</p>
<p>注意：**修改下面 action属性 ** 指向oss存储桶地址：http://java0817-001.oss-cn-guangzhou.aliyuncs.com！</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">el-upload</span>
</span></span><span class="line"><span class="cl">      <span class="na">action</span><span class="o">=</span><span class="s">&#34;http://java0817-001.oss-cn-guangzhou.aliyuncs.com&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">:data</span><span class="s">=&#34;dataObj&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="na">list</span><span class="nt">-type</span><span class="err">=&#34;</span><span class="na">picture</span><span class="err">&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">:multiple</span><span class="s">=&#34;false&#34;</span> <span class="nt">:show-file-list</span><span class="s">=&#34;showFileList&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">:auto-upload</span><span class="s">=&#34;true&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">:file-list</span><span class="s">=&#34;fileList&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">:before-upload</span><span class="s">=&#34;beforeUpload&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">:on-remove</span><span class="s">=&#34;handleRemove&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">:on-success</span><span class="s">=&#34;handleUploadSuccess&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">:on-preview</span><span class="s">=&#34;handlePreview&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">el-button</span> <span class="na">size</span><span class="o">=</span><span class="s">&#34;small&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;primary&#34;</span><span class="p">&gt;</span><span class="nx">点击上传</span><span class="o">&lt;</span><span class="err">/el-button&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">slot</span><span class="o">=</span><span class="s">&#34;tip&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;el-upload__tip&#34;</span><span class="p">&gt;</span><span class="nx">只能上传jpg</span><span class="o">/</span><span class="nx">png文件</span><span class="err">，</span><span class="nx">且不超过10MB</span><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/el-upload&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">el-dialog</span> <span class="nt">:visible.sync</span><span class="s">=&#34;dialogVisible&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">img</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;100%&#34;</span> <span class="nt">:src</span><span class="s">=&#34;fileList[0].url&#34;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/el-dialog&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="kr">import</span> <span class="p">{</span><span class="nx">policy</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@/utils/policy&#39;</span>
</span></span><span class="line"><span class="cl">   <span class="kr">import</span> <span class="p">{</span> <span class="nx">getUUID</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@/utils&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;singleUpload&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">value</span><span class="o">:</span> <span class="nb">String</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">computed</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">imageUrl</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nx">imageName</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">!==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">lastIndexOf</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nx">fileList</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">name</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">imageName</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">url</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">imageUrl</span>
</span></span><span class="line"><span class="cl">        <span class="p">}]</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nx">showFileList</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">!==</span> <span class="s1">&#39;&#39;</span><span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="o">!==</span><span class="kc">undefined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nx">set</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">newValue</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">dataObj</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">policy</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">signature</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">key</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">ossaccessKeyId</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">dir</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">host</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="c1">// callback:&#39;&#39;,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nx">dialogVisible</span><span class="o">:</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">emitInput</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nx">handleRemove</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">fileList</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">emitInput</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nx">handlePreview</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">dialogVisible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nx">beforeUpload</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">let</span> <span class="nx">_self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">policy</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// console.log(response)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">_self</span><span class="p">.</span><span class="nx">dataObj</span><span class="p">.</span><span class="nx">policy</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">policy</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">_self</span><span class="p">.</span><span class="nx">dataObj</span><span class="p">.</span><span class="nx">signature</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">signature</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">_self</span><span class="p">.</span><span class="nx">dataObj</span><span class="p">.</span><span class="nx">ossaccessKeyId</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">accessid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">_self</span><span class="p">.</span><span class="nx">dataObj</span><span class="p">.</span><span class="nx">key</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">dir</span> <span class="o">+</span> <span class="nx">getUUID</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;_${filename}&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">_self</span><span class="p">.</span><span class="nx">dataObj</span><span class="p">.</span><span class="nx">dir</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">dir</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">_self</span><span class="p">.</span><span class="nx">dataObj</span><span class="p">.</span><span class="nx">host</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">host</span><span class="p">;</span>           
</span></span><span class="line"><span class="cl">            <span class="nx">resolve</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nx">reject</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nx">handleUploadSuccess</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;上传成功...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">showFileList</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">fileList</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">fileList</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="nx">file</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">url</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">dataObj</span><span class="p">.</span><span class="nx">host</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">dataObj</span><span class="p">.</span><span class="nx">key</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&#34;${filename}&#34;</span><span class="p">,</span><span class="nx">file</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">emitInput</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">fileList</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">url</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span></code></pre></div><h3 id="243修改题目分类新增页面增加上传控件">2.4.3、修改题目分类新增页面，增加上传控件</h3>
<p>在前端工程renren-fast-vue目录src/views/modules/question目录下 修改页面 type-add-or-update.vue</p>
<p>引入上传控件</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">SingleUpload</span> <span class="nx">from</span> <span class="s2">&#34;../common/singleUpload&#34;</span> <span class="c1">// 引入单文件上传组件
</span></span></span></code></pre></div><p>注册上传组件：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">components</span><span class="o">:</span><span class="p">{</span> <span class="nx">SingleUpload</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span>
</span></span></code></pre></div><p>修改分类logo输入框，改成上传按钮</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">el-form-item</span> <span class="na">label</span><span class="o">=</span><span class="s">&#34;类型logo路径&#34;</span> <span class="na">prop</span><span class="o">=</span><span class="s">&#34;logoUrl&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">     <span class="p">&lt;</span><span class="nt">single-upload</span> <span class="nt">v-model</span><span class="s">=&#34;dataForm.logoUrl&#34;</span><span class="p">&gt;</span><span class="err">&lt;/</span><span class="na">single</span><span class="nt">-upload</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/el-form-item&gt;</span>
</span></span></code></pre></div><h3 id="244测试上传">2.4.4、测试上传</h3>
<p><img src="/posts/project/20220528234610/image-20220528235704495.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>点击上传 按钮，选择要上传的图片
<img src="/posts/project/20220528234610/image-20220529000009827.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>上传图片成功：
<img src="/posts/project/20220528234610/image-20220529000014905.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>注意：oss服务器存储桶一定要设置允许跨域</p>
<p>配置跨域访问</p>
<ol>
<li>登录<a class="link" href="/posts/project/https://oss.console.aliyun.com/"  target="_blank" rel="noopener"
    >OSS管理控制台</a>。</li>
<li>单击<strong>Bucket列表</strong>，之后单击目标Bucket名称。</li>
<li>单击<strong><em>权限管理</em> &gt; <em>跨域设置</em></strong>，在<strong>跨域设置</strong>区域单击<strong>设置</strong>。</li>
<li>单击<strong>创建规则</strong>，配置如下图所示。
<img src="/posts/project/20220528234610/image-20220529000023076.png"
    
    
    
    loading="lazy"
    
    
></li>
</ol>
<p><img src="/posts/project/20220528234610/image-20220529000030212.png"
    
    
    
    loading="lazy"
    
    
></p>
<p><img src="/posts/project/20220528234610/image-20220529000036596.jpeg"
    
    
    
    loading="lazy"
    
    
></p>
<h1 id="3开发广告内容前端维护管理">3、开发广告内容前端维护管理</h1>
<h2 id="31添加广告内容管理目录一级菜单">3.1、添加广告内容管理目录（一级菜单）</h2>
<p>选择管理界面&ndash;系统管理&ndash;菜单管理，点击 新增按钮
<img src="/posts/project/20220528234610/image-20220529000043364.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="32添加广告轮播图管理菜单二级菜单">3.2、添加广告轮播图管理菜单（二级菜单）</h2>
<p><img src="/posts/project/20220528234610/image-20220529000049213.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="33添加广告资讯管理菜单二级菜单">3.3、添加广告资讯管理菜单（二级菜单）</h2>
<p><img src="/posts/project/20220528234610/image-20220529000054827.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="34生成广告前端页面">3.4、生成广告前端页面</h2>
<p>用renren-generator自动生成前端代码</p>
<p>注意配置数据库连接文件application.yml,指向数据库 uxue_cms</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">datasource</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">com.alibaba.druid.pool.DruidDataSource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c">#MySQL配置</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">driverClassName</span><span class="p">:</span><span class="w"> </span><span class="l">com.mysql.cj.jdbc.Driver</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">jdbc:mysql://localhost:3306/uxue_cms?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span></span></span></code></pre></div><p>修改模板生成属性配置文件generator.properties</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-properties" data-lang="properties"><span class="line"><span class="cl"><span class="na">mainPath</span><span class="o">=</span><span class="s">com.offcn</span>
</span></span><span class="line"><span class="cl"><span class="c1">#\u5305\u540D</span>
</span></span><span class="line"><span class="cl"><span class="na">package</span><span class="o">=</span><span class="s">com.offcn</span>
</span></span><span class="line"><span class="cl"><span class="na">moduleName</span><span class="o">=</span><span class="s">context</span>
</span></span><span class="line"><span class="cl"><span class="c1">#\u4F5C\u8005</span>
</span></span><span class="line"><span class="cl"><span class="na">author</span><span class="o">=</span><span class="s">sunny</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Email</span>
</span></span><span class="line"><span class="cl"><span class="na">email</span><span class="o">=</span><span class="s">hk109@126.com</span>
</span></span><span class="line"><span class="cl"><span class="c1">#\u8868\u524D\u7F00(\u7C7B\u540D\u4E0D\u4F1A\u5305\u542B\u8868\u524D\u7F00)</span>
</span></span><span class="line"><span class="cl"><span class="na">tablePrefix</span><span class="o">=</span><span class="s">cms_</span>
</span></span></code></pre></div><p>启动renren-generator</p>
<p><img src="/posts/project/20220528234610/image-20220529000102472.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="35拷贝前端代码到-前端工程renren-fast-vue">3.5、拷贝前端代码到 前端工程renren-fast-vue</h2>
<p>拷贝\main\resources\src\views\modules\context目录到前端目录 renren-fast-vue\src\views\modules
<img src="/posts/project/20220528234610/image-20220529000108928.png"
    
    
    
    loading="lazy"
    
    
></p>
<p><img src="/posts/project/20220528234610/image-20220529000116180.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="36配置网关转发">3.6、配置网关转发</h2>
<p>找到cloud-gateway,修改配置文件application.yml</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl">- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">cms-route</span><span class="w"> </span><span class="c"># 广告微服务路由</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">lb://u-context</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span>- <span class="l">Path=/api/context/**</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">filters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span>- <span class="l">RewritePath=/api/(?&lt;segment&gt;.*),/$\{segment}        </span><span class="w">
</span></span></span></code></pre></div><h2 id="37测试广告轮播图广告资讯基本管理"><code>3.7、测试广告轮播图、广告资讯基本管理</code></h2>
<p>刷新页面，点击菜单 广告内容管理&mdash;》广告轮播图
<img src="/posts/project/20220528234610/image-20220529000123065.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>点击菜单 广告内容管理&mdash;》广告资讯
<img src="/posts/project/20220528234610/image-20220529000127663.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>分别测试增删改</p>
<p>注意测试新增前，先把日期时间字段改成不是必须输入</p>
<p>修改banner-add-or-update.vue、news-add-or-update.vue</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">createTime</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;创建时间不能为空&#39;</span><span class="p">,</span> <span class="nx">trigger</span><span class="o">:</span> <span class="s1">&#39;blur&#39;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">],</span>
</span></span><span class="line"><span class="cl">          <span class="nx">updateTime</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span> <span class="nx">required</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;更新时间不能为空&#39;</span><span class="p">,</span> <span class="nx">trigger</span><span class="o">:</span> <span class="s1">&#39;blur&#39;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">]</span>
</span></span></code></pre></div><h2 id="38修改广告轮播图广告配图上传">3.8、修改广告轮播图广告配图上传</h2>
<p>在前端工程renren-fast-vue目录src/views/modules/context目录下 修改页面 banner-add-or-update.vue</p>
<p>引入上传控件</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">SingleUpload</span> <span class="nx">from</span> <span class="s2">&#34;../common/singleUpload&#34;</span> <span class="c1">// 引入单文件上传组件
</span></span></span></code></pre></div><p>注册上传组件：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">components</span><span class="o">:</span><span class="p">{</span> <span class="nx">SingleUpload</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>修改图片路径输入框，改成上传按钮</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">el-form-item</span> <span class="na">label</span><span class="o">=</span><span class="s">&#34;图片路径&#34;</span> <span class="na">prop</span><span class="o">=</span><span class="s">&#34;imgUrl&#34;</span><span class="p">&gt;</span>      
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">single-upload</span> <span class="nt">v-model</span><span class="s">=&#34;dataForm.imgUrl&#34;</span><span class="p">&gt;</span><span class="err">&lt;/</span><span class="na">single</span><span class="nt">-upload</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/el-form-item&gt;</span>
</span></span></code></pre></div><p>实际运行效果：
<img src="/posts/project/20220528234610/image-20220529000135944.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="39修改广告资讯广告配图上传">3.9、修改广告资讯广告配图上传</h2>
<p>在前端工程renren-fast-vue目录src/views/modules/context目录下 修改页面 news-add-or-update.vue</p>
<p>具体修改方式和广告轮播相同</p>
<h1 id="4开发用户管理前端维护管理">4、开发用户管理前端维护管理</h1>
<h2 id="41添加用户管理目录一级菜单">4.1、添加用户管理目录（一级菜单）</h2>
<p>选择管理界面&ndash;系统管理&ndash;菜单管理，点击 新增按钮
<img src="/posts/project/20220528234610/image-20220529000142975.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="42添加用户列表管理菜单二级菜单">4.2、添加用户列表管理菜单（二级菜单）</h2>
<p><img src="/posts/project/20220528234610/image-20220529000148699.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="43添加用户充值记录管理菜单二级菜单">4.3、添加用户充值记录管理菜单（二级菜单）</h2>
<p><img src="/posts/project/20220528234610/image-20220529000153806.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="44生成用户服务相关前端页面">4.4、生成用户服务相关前端页面</h2>
<p>用renren-generator自动生成前端代码</p>
<p>注意配置数据库连接文件application.yml,指向数据库 uxue_cms</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">datasource</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">com.alibaba.druid.pool.DruidDataSource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c">#MySQL配置</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">driverClassName</span><span class="p">:</span><span class="w"> </span><span class="l">com.mysql.cj.jdbc.Driver</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">jdbc:mysql://localhost:3306/uxue_ums?useUnicode=true&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l">root</span><span class="w">
</span></span></span></code></pre></div><p>修改模板生成属性配置文件generator.properties</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-properties" data-lang="properties"><span class="line"><span class="cl"><span class="na">mainPath</span><span class="o">=</span><span class="s">com.offcn</span>
</span></span><span class="line"><span class="cl"><span class="c1">#\u5305\u540D</span>
</span></span><span class="line"><span class="cl"><span class="na">package</span><span class="o">=</span><span class="s">com.offcn</span>
</span></span><span class="line"><span class="cl"><span class="na">moduleName</span><span class="o">=</span><span class="s">member</span>
</span></span><span class="line"><span class="cl"><span class="c1">#\u4F5C\u8005</span>
</span></span><span class="line"><span class="cl"><span class="na">author</span><span class="o">=</span><span class="s">sunny</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Email</span>
</span></span><span class="line"><span class="cl"><span class="na">email</span><span class="o">=</span><span class="s">hk109@126.com</span>
</span></span><span class="line"><span class="cl"><span class="c1">#\u8868\u524D\u7F00(\u7C7B\u540D\u4E0D\u4F1A\u5305\u542B\u8868\u524D\u7F00)</span>
</span></span><span class="line"><span class="cl"><span class="na">tablePrefix</span><span class="o">=</span><span class="s">ums_</span>
</span></span></code></pre></div><p>启动renren-generator</p>
<p><img src="/posts/project/20220528234610/image-20220529000202073.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="45拷贝前端代码到-前端工程renren-fast-vue">4.5、拷贝前端代码到 前端工程renren-fast-vue</h2>
<p>拷贝\main\resources\src\views\modules\member目录到前端目录 renren-fast-vue\src\views\modules</p>
<p><img src="/posts/project/20220528234610/image-20220529000217429.png"
    
    
    
    loading="lazy"
    
    
></p>
<p><img src="/posts/project/20220528234610/image-20220529000207461.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="46配置网关转发">4.6、配置网关转发</h2>
<p>找到cloud-gateway,修改配置文件application.yml</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">discovery</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="l">http://localhost:8848</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">routes</span><span class="p">:</span><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">ums-route</span><span class="w"> </span><span class="c"># 用户微服务路由</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">lb://u-member</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">Path=/api/member/**</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">filters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">RewritePath=/api/(?&lt;segment&gt;.*),/$\{segment}       </span><span class="w">
</span></span></span></code></pre></div><h2 id="47测试用户列表充值记录基本管理">4.7、测试用户列表、充值记录基本管理</h2>
<p>刷新页面，点击菜单用户管理&mdash;》用户列表
<img src="/posts/project/20220528234610/image-20220529000230366.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>点击菜单用户管理&mdash;》用户充值记录
<img src="/posts/project/20220528234610/image-20220529000235602.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>分别测试增删改</p>
<p>注意测试新增前，先把日期时间字段改成不是必须输入</p>
<p>修改member-add-or-update.vue、growthchangehistory-add-or-update.vue</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">createTime:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span> <span class="err">required:</span> <span class="err">false,</span> <span class="err">message:</span> <span class="err">&#39;创建时间不能为空&#39;,</span> <span class="err">trigger:</span> <span class="err">&#39;blur&#39;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">]</span><span class="err">,</span>
</span></span><span class="line"><span class="cl">          <span class="err">updateTime:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span> <span class="err">required:</span> <span class="err">false,</span> <span class="err">message:</span> <span class="err">&#39;更新时间不能为空&#39;,</span> <span class="err">trigger:</span> <span class="err">&#39;blur&#39;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">]</span>
</span></span></code></pre></div><h2 id="48用户注册数量统计分析">4.8．用户注册数量统计分析</h2>
<h3 id="481-编写java后端代码">4.8.1 编写java后端代码</h3>
<p>打开java模块u-member ，编辑接口MemberService新增统计注册数量方法</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberService</span> <span class="kd">extends</span> <span class="n">IService</span><span class="o">&lt;</span><span class="n">MemberEntity</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span>  <span class="nf">countByDateTime</span><span class="o">(</span><span class="n">String</span> <span class="n">beginTime</span><span class="o">,</span> <span class="n">String</span> <span class="n">endTime</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>编辑接口实现类MemberServiceImpl,编写统计注册数量实现方法</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">MemberDao</span> <span class="n">memberDao</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">     <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="nf">countByDateTime</span><span class="o">(</span><span class="n">String</span> <span class="n">beginTime</span><span class="o">,</span> <span class="n">String</span> <span class="n">endTime</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">QueryWrapper</span><span class="o">&lt;</span><span class="n">MemberEntity</span><span class="o">&gt;</span> <span class="n">queryWrapper</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QueryWrapper</span><span class="o">&lt;</span><span class="n">MemberEntity</span><span class="o">&gt;().</span><span class="na">select</span><span class="o">(</span><span class="s">&#34;DATE_FORMAT(create_time,&#39;%Y-%m-%d&#39;) AS NAME ,COUNT(id) AS VALUE&#34;</span><span class="o">).</span><span class="na">between</span><span class="o">(</span><span class="s">&#34;create_time&#34;</span><span class="o">,</span> <span class="n">beginTime</span><span class="o">+</span><span class="s">&#34; 00:00:00&#34;</span><span class="o">,</span> <span class="n">endTime</span><span class="o">+</span><span class="s">&#34; 23:59:59&#34;</span><span class="o">).</span><span class="na">groupBy</span><span class="o">(</span><span class="s">&#34;NAME&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="n">mapList</span> <span class="o">=</span> <span class="n">memberDao</span><span class="o">.</span><span class="na">selectMaps</span><span class="o">(</span><span class="n">queryWrapper</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">mapList</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></div><p>编辑MemberController,新增统计注册数量方法</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"> <span class="c1">//根据开始时间，结束时间，统计每日注册账号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;countAccountCreate&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">R</span> <span class="nf">countAccountCreate</span><span class="o">(</span><span class="n">String</span> <span class="n">beginTime</span><span class="o">,</span><span class="n">String</span> <span class="n">endTime</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">        <span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="n">mapList</span> <span class="o">=</span> <span class="n">memberService</span><span class="o">.</span><span class="na">countByDateTime</span><span class="o">(</span><span class="n">beginTime</span><span class="o">,</span> <span class="n">endTime</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">R</span><span class="o">.</span><span class="na">ok</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;mapList&#34;</span><span class="o">,</span><span class="n">mapList</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></div><h3 id="482-编写前端代码">4.8.2 编写前端代码</h3>
<p>前端项目renren-fast-vue/src/views/modules/member目录 新增统计注册用户数量页面 echarts.vue</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span> 
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;mod-demo-echarts&#34;</span><span class="p">&gt;</span>   
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--</span><span class="nx">表单</span><span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">el-form</span> <span class="nt">:inline</span><span class="s">=&#34;true&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;demo-form-inline&#34;</span><span class="p">&gt;</span><span class="err">​</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">el-form-item</span> <span class="na">label</span><span class="o">=</span><span class="s">&#34;开始日期&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">el-date-picker</span>
</span></span><span class="line"><span class="cl">          <span class="nt">v-model</span><span class="s">=&#34;beginTime&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">          type=&#34;date&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">          placeholder=&#34;选择要统计的开始日期&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">          value-format=&#34;yyyy-MM-dd&#34; /&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">      &lt;/el-form-item&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">        &lt;el-form-item label=&#34;结束日期&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">        &lt;el-date-picker
</span></span></span><span class="line"><span class="cl"><span class="s">          v-model=&#34;endTime&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">          type=&#34;date&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">          placeholder=&#34;选择要统计的结束日期&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">          value-format=&#34;yyyy-MM-dd&#34; /&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">      &lt;/el-form-item&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">      &lt;el-button
</span></span></span><span class="line"><span class="cl"><span class="s">        :disabled=&#34;btnDisabled&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">        type=&#34;primary&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">        @click=&#34;create()&#34;&gt;生成&lt;/el-button&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">    &lt;/el-form&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">    &lt;el-row :gutter=&#34;20&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">      
</span></span></span><span class="line"><span class="cl"><span class="s">      &lt;el-col </span><span class="nt">:span</span><span class="s">=&#34;24&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">el-card</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;J_chartBarBox&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;chart-box&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="err">/el-card&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="err">/el-col&gt;      </span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/el-row&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="kr">import</span> <span class="nx">echarts</span> <span class="nx">from</span> <span class="s1">&#39;echarts&#39;</span>
</span></span><span class="line"><span class="cl">  <span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">data</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="p">{</span>       
</span></span><span class="line"><span class="cl">        <span class="nx">chartBar</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nx">beginTime</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nx">endTime</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nx">mapList</span><span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">         <span class="nx">xData</span><span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">         <span class="nx">yData</span><span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">         <span class="nx">btnDisabled</span><span class="o">:</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">mounted</span> <span class="p">()</span> <span class="p">{</span>     
</span></span><span class="line"><span class="cl">         
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">activated</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// 由于给echart添加了resize事件, 在组件激活时需要重新resize绘画一次, 否则出现空白bug     
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">chartBar</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">chartBar</span><span class="p">.</span><span class="nx">resize</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>     
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>      
</span></span><span class="line"><span class="cl">      <span class="nx">create</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="k">this</span><span class="p">.</span> <span class="nx">getDataList</span> <span class="p">()</span>
</span></span><span class="line"><span class="cl">         <span class="k">this</span><span class="p">.</span><span class="nx">initChartBar</span><span class="p">()</span>  
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">       <span class="c1">// 获取数据列表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">getDataList</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">dataListLoading</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">$http</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">          <span class="nx">url</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">$http</span><span class="p">.</span><span class="nx">adornUrl</span><span class="p">(</span><span class="s1">&#39;/member/member/countAccountCreate&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;get&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">params</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">$http</span><span class="p">.</span><span class="nx">adornParams</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;beginTime&#39;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">beginTime</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;endTime&#39;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">endTime</span>
</span></span><span class="line"><span class="cl">          <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="p">}).</span><span class="nx">then</span><span class="p">(({</span><span class="nx">data</span><span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">if</span> <span class="p">(</span><span class="nx">data</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">code</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>            
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="p">.</span><span class="nx">mapList</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">mapList</span>   
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="p">.</span><span class="nx">xData</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="p">.</span><span class="nx">yData</span> <span class="o">=</span> <span class="p">[]</span>         
</span></span><span class="line"><span class="cl">            <span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">j</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">mapList</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="p">.</span><span class="nx">xData</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">mapList</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">NAME</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="p">.</span><span class="nx">yData</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">mapList</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">VALUE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">             <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">xData</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">yData</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="p">.</span><span class="nx">chartBar</span><span class="p">.</span><span class="nx">resize</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">          <span class="c1">// this.xData= this.mapList.map(obj =&gt; n.NAME);       
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="c1">// this.yData= this.mapList.map(obj =&gt; n.VALUE);  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="k">this</span><span class="p">.</span><span class="nx">chartBar</span><span class="p">.</span><span class="nx">setOption</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">             <span class="nx">xAxis</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;category&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="nx">data</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">xData</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">],</span>
</span></span><span class="line"><span class="cl">          <span class="nx">yAxis</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;value&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">],</span>
</span></span><span class="line"><span class="cl">          <span class="nx">series</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;每日注册用户数&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;line&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="nx">data</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">yData</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">]</span>
</span></span><span class="line"><span class="cl">          <span class="p">})</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="p">.</span><span class="nx">mapList</span> <span class="o">=</span> <span class="p">[]</span>           
</span></span><span class="line"><span class="cl">          <span class="p">}</span>        
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// 柱状图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">initChartBar</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">option</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">tooltip</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">trigger</span><span class="o">:</span> <span class="s1">&#39;axis&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">axisPointer</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;shadow&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="nx">legend</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">data</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;每日注册用户数&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="nx">grid</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">left</span><span class="o">:</span> <span class="s1">&#39;3%&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">right</span><span class="o">:</span> <span class="s1">&#39;4%&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">bottom</span><span class="o">:</span> <span class="s1">&#39;3%&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">containLabel</span><span class="o">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="nx">xAxis</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;category&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="nx">data</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">xData</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">],</span>
</span></span><span class="line"><span class="cl">          <span class="nx">yAxis</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;value&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">],</span>
</span></span><span class="line"><span class="cl">          <span class="nx">series</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;每日注册用户数&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="nx">data</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">yData</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">chartBar</span> <span class="o">=</span> <span class="nx">echarts</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;J_chartBarBox&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">       <span class="c1">// this.chartBar.setOption(option)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;resize&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">this</span><span class="p">.</span><span class="nx">chartBar</span><span class="p">.</span><span class="nx">resize</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>     
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">style</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;scss&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">mod</span><span class="o">-</span><span class="nx">demo</span><span class="o">-</span><span class="nx">echarts</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">&gt;</span> <span class="p">.</span><span class="nx">el</span><span class="o">-</span><span class="nx">alert</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">margin</span><span class="o">-</span><span class="nx">bottom</span><span class="o">:</span> <span class="mi">10</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">&gt;</span> <span class="p">.</span><span class="nx">el</span><span class="o">-</span><span class="nx">row</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">margin</span><span class="o">-</span><span class="nx">top</span><span class="o">:</span> <span class="o">-</span><span class="mi">10</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">margin</span><span class="o">-</span><span class="nx">bottom</span><span class="o">:</span> <span class="o">-</span><span class="mi">10</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">el</span><span class="o">-</span><span class="nx">col</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">padding</span><span class="o">-</span><span class="nx">top</span><span class="o">:</span> <span class="mi">10</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">padding</span><span class="o">-</span><span class="nx">bottom</span><span class="o">:</span> <span class="mi">10</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">chart</span><span class="o">-</span><span class="nx">box</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">min</span><span class="o">-</span><span class="nx">height</span><span class="o">:</span> <span class="mi">400</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span></code></pre></div><h3 id="483-配置用户注册统计菜单">4.8.3 配置用户注册统计菜单</h3>
<p><img src="/posts/project/20220528234610/image-20220529000326920.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>新增菜单后，刷新，即可查看菜单
<img src="/posts/project/20220528234610/image-20220529000332483.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>选中开始日期，结束日期，点击 生成按钮 出现统计折线图
<img src="/posts/project/20220528234610/image-20220529000337844.png"
    
    
    
    loading="lazy"
    
    
></p>
<h1 id="5开发微信小程序登录及验证调用接口">5、开发微信小程序登录及验证调用接口</h1>
<h2 id="51编写jwt工具类">5.1．编写JWT工具类</h2>
<h3 id="511-打开模块u-common编辑pomxml">5.1.1 打开模块u-common,编辑pom.xml</h3>
<p>引入jwt依赖库</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;groupId&gt;</span>io.jsonwebtoken<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;artifactId&gt;</span>jjwt<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;version&gt;</span>0.9.0<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><h3 id="512-jwt工具类-jwtutil">5.1.2 JWT工具类 JWTUtil</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.offcn.common.utils</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">io.jsonwebtoken.*</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JWTUtil</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">&#34;u-member-offcn123&#34;</span><span class="o">;</span> <span class="c1">//秘钥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">TOKEN_EXPIRE_TIME</span> <span class="o">=</span> <span class="n">5</span> <span class="o">*</span> <span class="n">60</span> <span class="o">*</span> <span class="n">1000</span><span class="o">;</span> <span class="c1">//token过期时间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">REFRESH_TOKEN_EXPIRE_TIME</span> <span class="o">=</span> <span class="n">10</span> <span class="o">*</span> <span class="n">60</span> <span class="o">*</span> <span class="n">1000</span><span class="o">;</span> <span class="c1">//refreshToken过期时间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">ISSUER</span> <span class="o">=</span> <span class="s">&#34;offcn&#34;</span><span class="o">;</span> <span class="c1">//签发人
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">//生成签名
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">generateToken</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">        <span class="n">Date</span> <span class="n">now</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">       <span class="k">return</span>   <span class="n">Jwts</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">             <span class="o">.</span><span class="na">setIssuer</span><span class="o">(</span><span class="n">ISSUER</span><span class="o">)</span> <span class="c1">//签发人
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>             <span class="o">.</span><span class="na">setIssuedAt</span><span class="o">(</span><span class="n">now</span><span class="o">)</span><span class="c1">//签发时间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>             <span class="o">.</span><span class="na">setExpiration</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">(</span><span class="n">now</span><span class="o">.</span><span class="na">getTime</span><span class="o">()+</span><span class="n">TOKEN_EXPIRE_TIME</span><span class="o">))</span><span class="c1">//过期时间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>             <span class="o">.</span><span class="na">claim</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">,</span><span class="n">username</span><span class="o">)</span><span class="c1">//用户名
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>             <span class="o">.</span><span class="na">signWith</span><span class="o">(</span><span class="n">SignatureAlgorithm</span><span class="o">.</span><span class="na">HS256</span><span class="o">,</span><span class="n">SECRET_KEY</span><span class="o">)</span><span class="c1">//签名算法、秘钥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>             <span class="o">.</span><span class="na">compact</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//解析token
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Claims</span> <span class="nf">parseToken</span><span class="o">(</span><span class="n">String</span> <span class="n">token</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">     <span class="k">return</span>    <span class="n">Jwts</span><span class="o">.</span><span class="na">parser</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">setSigningKey</span><span class="o">(</span><span class="n">SECRET_KEY</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">parseClaimsJws</span><span class="o">(</span><span class="n">token</span><span class="o">).</span><span class="na">getBody</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//验证签名
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">verify</span><span class="o">(</span><span class="n">String</span> <span class="n">token</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">       <span class="c1">//尝试解析token
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Claims</span> <span class="n">claims</span> <span class="o">=</span> <span class="n">parseToken</span><span class="o">(</span><span class="n">token</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">           <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">           <span class="c1">// e.printStackTrace();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;签名验证失败&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//从token获取用户名
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getUsername</span><span class="o">(</span><span class="n">String</span> <span class="n">token</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Claims</span> <span class="n">claims</span> <span class="o">=</span> <span class="n">parseToken</span><span class="o">(</span><span class="n">token</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">String</span> <span class="n">username</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">claims</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">username</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">           <span class="c1">// e.printStackTrace();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;解析令牌失败&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s">&#34;&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h2 id="52编写用户登录接口">5.2．编写用户登录接口</h2>
<p>打开模块u-member,MemberService增加登录接口</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemberService</span> <span class="kd">extends</span> <span class="n">IService</span><span class="o">&lt;</span><span class="n">MemberEntity</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">MemberEntity</span> <span class="nf">login</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">,</span><span class="n">String</span> <span class="n">password</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>打开模块u-member,MemberServiceImpl增加登录实现方法</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">MemberEntity</span> <span class="nf">login</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">,</span> <span class="n">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">MemberEntity</span> <span class="n">memberEntity</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getOne</span><span class="o">(</span><span class="k">new</span> <span class="n">QueryWrapper</span><span class="o">&lt;</span><span class="n">MemberEntity</span><span class="o">&gt;().</span><span class="na">eq</span><span class="o">(</span><span class="s">&#34;user_name&#34;</span><span class="o">,</span> <span class="n">username</span><span class="o">).</span><span class="na">eq</span><span class="o">(</span><span class="s">&#34;PASSWORD&#34;</span><span class="o">,</span> <span class="n">password</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">memberEntity</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h2 id="53编写用户登录刷新token控制器"><code>5.3．编写用户登录、刷新token控制器</code></h2>
<p>u-member添加依赖</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;dependency&gt;
</span></span><span class="line"><span class="cl">	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
</span></span><span class="line"><span class="cl">	&lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
</span></span><span class="line"><span class="cl">&lt;/dependency&gt;
</span></span></code></pre></div><p>在memberController</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">StringRedisTemplate</span> <span class="n">stringRedisTemplate</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//登录
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">&#34;/login&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">R</span> <span class="nf">login</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">,</span><span class="n">String</span> <span class="n">password</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">        <span class="n">MemberEntity</span> <span class="n">memberEntity</span> <span class="o">=</span> <span class="n">memberService</span><span class="o">.</span><span class="na">login</span><span class="o">(</span><span class="n">username</span><span class="o">,</span> <span class="n">password</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="o">(</span><span class="n">memberEntity</span><span class="o">!=</span><span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">String</span> <span class="n">token</span> <span class="o">=</span> <span class="n">JWTUtil</span><span class="o">.</span><span class="na">generateToken</span><span class="o">(</span><span class="n">memberEntity</span><span class="o">.</span><span class="na">getUserName</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//生成refreshToken
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">String</span> <span class="n">refreshToken</span> <span class="o">=</span> <span class="n">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">().</span><span class="na">replace</span><span class="o">(</span><span class="s">&#34;-&#34;</span><span class="o">,</span> <span class="s">&#34;&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">stringRedisTemplate</span><span class="o">.</span><span class="na">opsForHash</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="n">refreshToken</span><span class="o">,</span> <span class="s">&#34;token&#34;</span><span class="o">,</span> <span class="n">token</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">stringRedisTemplate</span><span class="o">.</span><span class="na">opsForHash</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="n">refreshToken</span><span class="o">,</span> <span class="s">&#34;username&#34;</span><span class="o">,</span> <span class="n">username</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//设置token的过期时间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">stringRedisTemplate</span><span class="o">.</span><span class="na">expire</span><span class="o">(</span><span class="n">refreshToken</span><span class="o">,</span> <span class="n">JWTUtil</span><span class="o">.</span><span class="na">REFRESH_TOKEN_EXPIRE_TIME</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">R</span><span class="o">.</span><span class="na">ok</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;token&#34;</span><span class="o">,</span><span class="n">token</span><span class="o">).</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;refreshToken&#34;</span><span class="o">,</span><span class="n">refreshToken</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">R</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;账号密码错误&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//刷新token
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">&#34;/refreshtoken&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">R</span> <span class="nf">refreshToken</span><span class="o">(</span><span class="n">String</span> <span class="n">refreshToken</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//根据refreshToken从redis读取用户名
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>       <span class="n">String</span> <span class="n">username</span><span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">stringRedisTemplate</span><span class="o">.</span><span class="na">boundHashOps</span><span class="o">(</span><span class="n">refreshToken</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="k">if</span><span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">username</span><span class="o">)){</span>
</span></span><span class="line"><span class="cl">           <span class="k">return</span> <span class="n">R</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;刷新token失败&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">       <span class="o">}</span>
</span></span><span class="line"><span class="cl">       <span class="c1">//根据用户名生成新的token
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">String</span> <span class="n">token</span> <span class="o">=</span> <span class="n">JWTUtil</span><span class="o">.</span><span class="na">generateToken</span><span class="o">(</span><span class="n">username</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//更新token到redis
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">stringRedisTemplate</span><span class="o">.</span><span class="na">boundHashOps</span><span class="o">(</span><span class="n">refreshToken</span><span class="o">).</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;token&#34;</span><span class="o">,</span><span class="n">token</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">          <span class="c1">//设置token的过期时间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">stringRedisTemplate</span><span class="o">.</span><span class="na">expire</span><span class="o">(</span><span class="n">refreshToken</span><span class="o">,</span> <span class="n">JWTUtil</span><span class="o">.</span><span class="na">REFRESH_TOKEN_EXPIRE_TIME</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">R</span><span class="o">.</span><span class="na">ok</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;token&#34;</span><span class="o">,</span><span class="n">token</span><span class="o">).</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;refreshToken&#34;</span><span class="o">,</span><span class="n">refreshToken</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">redis:
</span></span><span class="line"><span class="cl">    host: localhost
</span></span><span class="line"><span class="cl">    port: 6379
</span></span></code></pre></div><h2 id="54测试用户登录刷新token">5.4．测试用户登录、刷新token</h2>
<p>登录地址：http://localhost:10002/member/member/login</p>
<p>传递参数: username  用户账号   password  密码
<img src="/posts/project/20220528234610/image-20220529000352738.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>刷新token地址：http://localhost:10002/member/member/refreshtoken</p>
<p>传递参数：refreshToken</p>
<p>返回结果：
<img src="/posts/project/20220528234610/image-20220529000358203.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="55配置网关路由转发">5.5、配置网关路由转发</h2>
<p>修改cloud-gateway模块，配置文件application.yml增加登录路由转发</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">weixin-login-ums-route</span><span class="w"> </span><span class="c"># 提供微信客户端调用的，用户微服务路由</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">lb://u-member</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">Path=/member/member/login/**          </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">weixin-register-ums-route</span><span class="w"> </span><span class="c"># 提供微信客户端调用的，用户微服务路由</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">lb://u-member</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">Path=/member/member/save/**          </span><span class="w">
</span></span></span></code></pre></div><p>测试网关访问地址：</p>
<p>http://localhost:8888/member/member/login?username=test&amp;password=123</p>
<p>响应：
<img src="/posts/project/20220528234610/image-20220529000404159.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="56用户注册接口">5.6、用户注册接口</h2>
<p>http://localhost:8888/member/member/save</p>
<p>请求参数：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;miniOpenid&#34;</span><span class="p">:</span> <span class="s2">&#34;1001&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;mpOpenid&#34;</span><span class="p">:</span> <span class="s2">&#34;8877111&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;unionid&#34;</span><span class="p">:</span> <span class="s2">&#34;test001&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;levelId&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;userName&#34;</span><span class="p">:</span> <span class="s2">&#34;test003&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;password&#34;</span><span class="p">:</span> <span class="s2">&#34;456&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;nickname&#34;</span><span class="p">:</span> <span class="s2">&#34;NickName&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;phone&#34;</span><span class="p">:</span> <span class="s2">&#34;17562128765&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;email&#34;</span><span class="p">:</span> <span class="s2">&#34;hk109@139.com&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;avatar&#34;</span><span class="p">:</span> <span class="s2">&#34;1.jpg&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;gender&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;city&#34;</span><span class="p">:</span> <span class="s2">&#34;北京&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;birth&#34;</span><span class="p">:</span> <span class="s2">&#34;1978-09-11&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;sourceType&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;integration&#34;</span><span class="p">:</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="57配置网关过滤器拦截微信客户端请求验证token">5.7、配置网关过滤器，拦截微信客户端请求验证token</h2>
<h3 id="571修改pomxml引入common依赖排除不需要的mybatis-plus-boot-starter依赖">5.7.1、修改pom.xml引入common依赖，排除不需要的mybatis-plus-boot-starter依赖</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"> <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>com.offcn<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>u-common<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;exclusions&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;exclusion&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;artifactId&gt;</span>mybatis-plus-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;groupId&gt;</span>com.baomidou<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/exclusion&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/exclusions&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><h3 id="572编写网关过滤器类">5.7.2、编写网关过滤器类</h3>
<p>编写自定义过滤器实现类：InnerFilter</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.offcn.filter</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.offcn.common.utils.JWTUtil</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.cloud.gateway.filter.GatewayFilter</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.cloud.gateway.filter.GatewayFilterChain</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.core.Ordered</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.core.io.buffer.DataBuffer</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.http.HttpHeaders</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.http.server.reactive.ServerHttpRequest</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.http.server.reactive.ServerHttpResponse</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.util.StringUtils</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.web.server.ServerWebExchange</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">reactor.core.publisher.Mono</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">InnerFilter</span> <span class="kd">implements</span> <span class="n">GatewayFilter</span><span class="o">,</span> <span class="n">Ordered</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">JwtCheckGatewayFilterFactory</span><span class="o">.</span><span class="na">Config</span> <span class="n">config</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">InnerFilter</span><span class="o">(</span><span class="n">JwtCheckGatewayFilterFactory</span><span class="o">.</span><span class="na">Config</span> <span class="n">config</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">config</span><span class="o">=</span><span class="n">config</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Mono</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="nf">filter</span><span class="o">(</span><span class="n">ServerWebExchange</span> <span class="n">exchange</span><span class="o">,</span> <span class="n">GatewayFilterChain</span> <span class="n">chain</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ServerHttpRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="n">exchange</span><span class="o">.</span><span class="na">getRequest</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">ServerHttpResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="n">exchange</span><span class="o">.</span><span class="na">getResponse</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//尝试从请求头获取令牌
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">String</span> <span class="n">token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeaders</span><span class="o">().</span><span class="na">getFirst</span><span class="o">(</span><span class="s">&#34;Authorization&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//判断令牌如果不为空
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span><span class="o">(!</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">token</span><span class="o">)){</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//调用令牌工具类，校验令牌
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="kt">boolean</span> <span class="n">verify</span> <span class="o">=</span> <span class="n">JWTUtil</span><span class="o">.</span><span class="na">verify</span><span class="o">(</span><span class="n">token</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//判断令牌校验失败
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span><span class="o">(!</span><span class="n">verify</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//令牌校验失败，结束转发
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">Mono</span> <span class="n">mono</span> <span class="o">=</span> <span class="n">returnFail</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span>    <span class="n">response</span><span class="o">.</span><span class="na">writeWith</span><span class="o">(</span><span class="n">mono</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//令牌校验成功，放行
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">return</span>     <span class="n">chain</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">exchange</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//令牌不存在，结束转发
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Mono</span> <span class="n">mono</span> <span class="o">=</span> <span class="n">returnFail</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span>   <span class="n">response</span><span class="o">.</span><span class="na">writeWith</span><span class="o">(</span><span class="n">mono</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//返回失败方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="n">Mono</span> <span class="nf">returnFail</span><span class="o">(</span><span class="n">ServerHttpResponse</span> <span class="n">response</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//获取响应对象头
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">HttpHeaders</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getHeaders</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//设置响应头内容Content-Type 响应内容类型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">headers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;Content-Type&#34;</span><span class="o">,</span><span class="s">&#34;application/json; charset=UTF-8&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//禁止缓存
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">headers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;Cache-Control&#34;</span><span class="o">,</span> <span class="s">&#34;no-store, no-cache, must-revalidate, max-age=0&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//设置响应内容
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">String</span> <span class="n">body</span><span class="o">=</span><span class="s">&#34;token验证失败&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">DataBuffer</span> <span class="n">dataBuffer</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">bufferFactory</span><span class="o">().</span><span class="na">wrap</span><span class="o">(</span><span class="n">body</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//把内容写入到响应对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="n">Mono</span><span class="o">.</span><span class="na">just</span><span class="o">(</span><span class="n">dataBuffer</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getOrder</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>编写自定义网关过滤器</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.offcn.filter</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.cloud.gateway.filter.GatewayFilter</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.cloud.gateway.filter.factory.AbstractGatewayFilterFactory</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JwtCheckGatewayFilterFactory</span> <span class="kd">extends</span> <span class="n">AbstractGatewayFilterFactory</span><span class="o">&lt;</span><span class="n">JwtCheckGatewayFilterFactory</span><span class="o">.</span><span class="na">Config</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">   <span class="c1">//要向父类传递配置类，要不然就会报类型转换错误
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">public</span> <span class="nf">JwtCheckGatewayFilterFactory</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">super</span><span class="o">(</span><span class="n">Config</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">GatewayFilter</span> <span class="nf">apply</span><span class="o">(</span><span class="n">Config</span> <span class="n">config</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">InnerFilter</span><span class="o">(</span><span class="n">config</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//定义一个内部类，配置过滤器属性,必须是静态的
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Config</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h3 id="573配置网关过滤器">5.7.3、配置网关过滤器</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.offcn.config</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.offcn.filter.JwtCheckGatewayFilterFactory</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.web.cors.CorsConfiguration</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.web.cors.reactive.CorsWebFilter</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.web.cors.reactive.UrlBasedCorsConfigurationSource</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GatewayCorsConfiguration</span> <span class="o">{</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">JwtCheckGatewayFilterFactory</span> <span class="nf">jwtCheckGatewayFilterFactory</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">JwtCheckGatewayFilterFactory</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h3 id="574修改网关配置">5.7.4、修改网关配置</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">discovery</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="l">http://localhost:8848</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">routes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">weixin-login-ums-route</span><span class="w"> </span><span class="c"># 提供微信客户端调用的，用户微服务路由</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">lb://u-member</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">Path=/member/member/login/**</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">filters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">RewritePath=/(?&lt;segment&gt;.*),/$\{segment}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">weixin-test-ums-route</span><span class="w"> </span><span class="c"># 提供微信客户端调用的，用户微服务路由</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">lb://u-member</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">Path=/member/member/refreshtoken/**</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">filters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">RewritePath=/(?&lt;segment&gt;.*),/$\{segment}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">JwtCheck</span><span class="w">
</span></span></span></code></pre></div><p><strong>刷新token接口，启用token校验过滤器，填上过滤器前缀就可以 JwtCheck</strong></p>
<h3 id="575测试">5.7.5、测试</h3>
<p>访问登录接口地址:http://localhost:8888/member/member/login?username=test&amp;password=123</p>
<p>不需要token验证。</p>
<p>访问刷新token接口地址：http://localhost:8888/member/member/refreshtoken?refreshToken=4257e35399db461ca0bfac3b6b3a61f9</p>
<p>在请求头不带参数，提示toekn验证失败
<img src="/posts/project/20220528234610/image-20220529000416578.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>在请求头带上参数 Authorization
<img src="/posts/project/20220528234610/image-20220529000422984.png"
    
    
    
    loading="lazy"
    
    
></p>
<h1 id="6开发微信小程序分类及题库广告轮播图读取调用接口">6、开发微信小程序分类、及题库、广告轮播图读取调用接口</h1>
<h2 id="61获取题库分类接口">6.1．获取题库分类接口</h2>
<h3 id="611修改网关路由配置添加获取题库分类接口路由">6.1.1、修改网关路由配置添加获取题库分类接口路由</h3>
<p>修改application.yml</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">discovery</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="l">http://localhost:8848</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">routes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">weixin-question-route</span><span class="w"> </span><span class="c"># 提供微信客户端调用的，题库微服务路由</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">lb://u-question</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">Path=/question/**</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">filters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">RewritePath=/(?&lt;segment&gt;.*),/$\{segment}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">JwtCheck</span><span class="w">
</span></span></span></code></pre></div><p>访问路径：http://localhost:8888/question/type/findall
<img src="/posts/project/20220528234610/image-20220529000429654.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="62获取题库数据接口">6.2．获取题库数据接口</h2>
<h3 id="621获取根据分类获取题库列表数据接口">6.2.1．获取根据分类获取题库列表数据接口</h3>
<p>访问路径：http://localhost:8888/question/question/list
<img src="/posts/project/20220528234610/image-20220529000434726.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>可以传递参数：key 等于题库分类编号</p>
<p>http://localhost:8888/question/question/list?key=6</p>
<h2 id="63获取根据实体编号获取题目详情数据接口">6.3．获取根据实体编号获取题目详情数据接口</h2>
<p>http://localhost:8888/question/question/info/50</p>
<h2 id="64获取广告轮播图数据接口">6.4．获取广告轮播图数据接口</h2>
<h3 id="641获取广告轮播图列表数据接口">6.4.1．获取广告轮播图列表数据接口</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w"> </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">weixin-context-route</span><span class="w"> </span><span class="c"># 提供微信客户端调用的，用户微服务路由</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">lb://u-context</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span>- <span class="l">Path=/context/**</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">filters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span>- <span class="l">RewritePath=/(?&lt;segment&gt;.*),/$\{segment}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span>- <span class="l">JwtCheck</span><span class="w">
</span></span></span></code></pre></div><p>访问路径：http://localhost:8888/context/banner/list?page=1&amp;limit=5
<img src="/posts/project/20220528234610/image-20220529000441947.png"
    
    
    
    loading="lazy"
    
    
></p>
<h1 id="7接口文档">7、接口文档</h1>
<p><img src="/posts/project/20220528234610/image-20220529000448862.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="71用户注册">7.1、用户注册</h2>
<p><code>&lt;a id=用户注册&gt; &lt;/a&gt;</code></p>
<h3 id="基本信息">基本信息</h3>
<p><strong>Path：</strong> /member/member/save</p>
<p><strong>Method：</strong> POST</p>
<p><strong>接口描述：</strong></p>
<p><br></p>
<h3 id="request">Request</h3>
<p><strong>Headers</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数值</th>
<th>是否必须</th>
<th>示例</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>Content-Type</td>
<td>application/json</td>
<td>是</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Body</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;miniOpenid&#34;</span><span class="p">:</span> <span class="s2">&#34;1001&#34;</span><span class="p">,</span> <span class="c1">//小程序openid
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nt">&#34;mpOpenid&#34;</span><span class="p">:</span> <span class="s2">&#34;8877111&#34;</span><span class="p">,</span> <span class="c1">//服务号openid
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nt">&#34;unionid&#34;</span><span class="p">:</span> <span class="s2">&#34;test001&#34;</span><span class="p">,</span> <span class="c1">//微信unionid
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nt">&#34;levelId&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1">//会员等级id 整数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nt">&#34;userName&#34;</span><span class="p">:</span> <span class="s2">&#34;test003&#34;</span><span class="p">,</span> <span class="c1">//用户登录账号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nt">&#34;password&#34;</span><span class="p">:</span> <span class="s2">&#34;456&#34;</span><span class="p">,</span> <span class="c1">//用户密码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nt">&#34;nickname&#34;</span><span class="p">:</span> <span class="s2">&#34;NickName&#34;</span><span class="p">,</span><span class="c1">//用户昵称
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nt">&#34;phone&#34;</span><span class="p">:</span> <span class="s2">&#34;17562128765&#34;</span><span class="p">,</span> <span class="c1">//用户手机号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nt">&#34;email&#34;</span><span class="p">:</span> <span class="s2">&#34;hk109@139.com&#34;</span><span class="p">,</span><span class="c1">//用户邮箱
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nt">&#34;avatar&#34;</span><span class="p">:</span> <span class="s2">&#34;1.jpg&#34;</span><span class="p">,</span><span class="c1">//用户头像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nt">&#34;gender&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="c1">//性别 0 女 1男
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nt">&#34;city&#34;</span><span class="p">:</span> <span class="s2">&#34;北京&#34;</span><span class="p">,</span> <span class="c1">//用户地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nt">&#34;birth&#34;</span><span class="p">:</span> <span class="s2">&#34;1978-09-11&#34;</span><span class="p">,</span><span class="c1">//用户生日
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nt">&#34;sourceType&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span><span class="c1">//来源 1 微信 2 app
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nt">&#34;integration&#34;</span><span class="p">:</span> <span class="mi">1</span> <span class="c1">//积分，初始化注册积分为1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><h3 id="reponse">Reponse</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;msg&#34;</span><span class="o">:</span> <span class="s2">&#34;success&#34;</span><span class="p">,</span> <span class="c1">//操作结果
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="s2">&#34;code&#34;</span><span class="o">:</span> <span class="mi">0</span>  <span class="c1">//状态码 0 成功
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><h2 id="72用户登录">7.2、用户登录</h2>
<p><code>&lt;a id=用户登录&gt; &lt;/a&gt;</code></p>
<h3 id="基本信息-1">基本信息</h3>
<p><strong>Path：</strong> /member/member/login</p>
<p><strong>Method：</strong> GET</p>
<p><strong>接口描述：</strong></p>
<p><br></p>
<h3 id="request-1">Request</h3>
<p><strong>Query</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>是否必须</th>
<th>示例</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>username</td>
<td>是</td>
<td>test001</td>
<td>用户账号</td>
</tr>
<tr>
<td>password</td>
<td>是</td>
<td>123</td>
<td>密码</td>
</tr>
</tbody>
</table>
<h3 id="reponse-1">Reponse</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;msg&#34;</span><span class="p">:</span> <span class="s2">&#34;success&#34;</span><span class="p">,</span><span class="c1">//响应成功消息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nt">&#34;code&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span><span class="c1">//响应状态码 0 成功
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//token ,注意后续访问 获取分类、题库数据接口 需要鉴权 请求头里面带 token
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//请求头参数 Authorization  token值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nt">&#34;token&#34;</span><span class="p">:</span> <span class="s2">&#34;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJvZmZjbiIsImV4cCI6MTYwODY1MDMyMywiaWF0IjoxNjA4NjM4MzIzLCJ1c2VybmFtZSI6InRlc3QifQ.1JV-O3o7IXOuTnjdzZjHKm5FiIHrtviqy2CXEY4DZB4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//token失效，刷新token使用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nt">&#34;refreshToken&#34;</span><span class="p">:</span> <span class="s2">&#34;2bd89f56c6ba4befae70fc7399edda44&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="73刷新token">7.3、刷新token</h2>
<p><code>&lt;a id=刷新token&gt; &lt;/a&gt;</code></p>
<h3 id="基本信息-2">基本信息</h3>
<p><strong>Path：</strong>/member/member/refreshtoken</p>
<p><strong>Method：</strong> POST</p>
<p><strong>接口描述：</strong></p>
<p><br></p>
<h3 id="request-2">Request</h3>
<p><strong>Headers</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数值</th>
<th>是否必须</th>
<th>示例</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>Content-Type</td>
<td>application/x-www-form-urlencoded</td>
<td>是</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Query</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>是否必须</th>
<th>示例</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>refreshToken</td>
<td>是</td>
<td></td>
<td>refreshToken 登录成功后有返回</td>
</tr>
</tbody>
</table>
<p><strong>Body</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>是否必须</th>
<th>示例</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>refreshToken</td>
<td>text</td>
<td>是</td>
<td></td>
<td>refreshToken登录成功后有返回</td>
</tr>
</tbody>
</table>
<h3 id="reponse-2">Reponse</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;msg&#34;</span><span class="p">:</span> <span class="s2">&#34;success&#34;</span><span class="p">,</span><span class="c1">//消息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nt">&#34;code&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span><span class="c1">//状态码 0 成功
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//最新的token
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nt">&#34;token&#34;</span><span class="p">:</span> <span class="s2">&#34;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJvZmZjbiIsImV4cCI6MTYwODY1MDY4MywiaWF0IjoxNjA4NjM4NjgzLCJ1c2VybmFtZSI6InRlc3QifQ.G_0WcKRnWAZcL4sI-9KO3H-Sj1wJGzNUAmxQeGzmTdQ&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="c1">//刷新token的值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nt">&#34;refreshToken&#34;</span><span class="p">:</span> <span class="s2">&#34;9332b3bfd3ce46e590ae0720579b8bc1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="74获取广告轮播图">7.4、获取广告轮播图</h2>
<p><code>&lt;a id=获取广告轮播图&gt; &lt;/a&gt;</code></p>
<h3 id="基本信息-3">基本信息</h3>
<p><strong>Path：</strong> /context/banner/list</p>
<p><strong>Method：</strong> GET</p>
<p><strong>接口描述：</strong></p>
<p><br></p>
<h3 id="request-3">Request</h3>
<p><strong>Headers</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数值</th>
<th>是否必须</th>
<th>示例</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>Authorization</td>
<td></td>
<td>是</td>
<td>必须</td>
<td>登录获取到token</td>
</tr>
</tbody>
</table>
<p><strong>Query</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>是否必须</th>
<th>示例</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>page</td>
<td>是</td>
<td>1</td>
<td>页码</td>
</tr>
<tr>
<td>limit</td>
<td>是</td>
<td>5</td>
<td>轮播图数量</td>
</tr>
</tbody>
</table>
<h3 id="reponse-3">Reponse</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="s2">&#34;msg&#34;</span><span class="o">:</span> <span class="s2">&#34;success&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="s2">&#34;code&#34;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="s2">&#34;page&#34;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;totalCount&#34;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;pageSize&#34;</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;totalPage&#34;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;currPage&#34;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;list&#34;</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;imgUrl&#34;</span><span class="o">:</span> <span class="s2">&#34;https://java0817-001.oss-cn-guangzhou.aliyuncs.com/2021-01-06/1533d9e1-d221-4c48-8804-118f32fdd173_6.png&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;title&#34;</span><span class="o">:</span> <span class="s2">&#34;github&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;displayOrder&#34;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;enable&#34;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;renderType&#34;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;renderUrl&#34;</span><span class="o">:</span> <span class="s2">&#34;http://www.ujiuye.com&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;delFlag&#34;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;createTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2021-01-06T04:30:29.000+00:00&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;updateTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2021-01-06T04:30:29.000+00:00&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="p">},</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;imgUrl&#34;</span><span class="o">:</span> <span class="s2">&#34;https://java0817-001.oss-cn-guangzhou.aliyuncs.com/2021-01-06/cb1fa277-1fce-4a1e-882d-a3c3cce551f2_7.png&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;title&#34;</span><span class="o">:</span> <span class="s2">&#34;9&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;displayOrder&#34;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;enable&#34;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;renderType&#34;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;renderUrl&#34;</span><span class="o">:</span> <span class="s2">&#34;http://www.baidu.com&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;delFlag&#34;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;createTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2021-01-06T04:38:04.000+00:00&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;updateTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2021-01-06T04:38:04.000+00:00&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="p">},</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;imgUrl&#34;</span><span class="o">:</span> <span class="s2">&#34;https://java0817-001.oss-cn-guangzhou.aliyuncs.com/2021-01-06/21cf3022-14f1-4a65-8889-acc196d84239_2.png&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;title&#34;</span><span class="o">:</span> <span class="s2">&#34;222&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;displayOrder&#34;</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;enable&#34;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;renderType&#34;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;renderUrl&#34;</span><span class="o">:</span> <span class="s2">&#34;http://www.offcn.com&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;delFlag&#34;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;createTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2021-01-06T04:38:37.000+00:00&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;updateTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2021-01-06T04:38:37.000+00:00&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="75获取试题分类">7.5、获取试题分类</h2>
<p><code>&lt;a id=获取试题分类&gt; &lt;/a&gt;</code></p>
<h3 id="基本信息-4">基本信息</h3>
<p><strong>Path：</strong> /api/question/type/findall</p>
<p><strong>Method：</strong> GET</p>
<p><strong>接口描述：</strong></p>
<p><br></p>
<h3 id="request-4">Request</h3>
<p><strong>Headers</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数值</th>
<th>是否必须</th>
<th>示例</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>Authorization</td>
<td></td>
<td>是</td>
<td>必须</td>
<td>登录成功获取到的token</td>
</tr>
</tbody>
</table>
<h3 id="reponse-4">Reponse</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="s2">&#34;msg&#34;</span><span class="o">:</span> <span class="s2">&#34;success&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="s2">&#34;code&#34;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="s2">&#34;data&#34;</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;id&#34;</span><span class="o">:</span> <span class="mi">6</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;type&#34;</span><span class="o">:</span> <span class="s2">&#34;JAVA基础&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;comments&#34;</span><span class="o">:</span> <span class="s2">&#34;JAVA基础&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;logoUrl&#34;</span><span class="o">:</span> <span class="s2">&#34;https://java0817-001.oss-cn-guangzhou.aliyuncs.com/2020-12-18/0cdabddd-3f3b-4b49-8cd5-e008b3e6ad08_1.jpg&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;delFlag&#34;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;createTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2020-12-18T11:44:18.000+00:00&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;updateTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2020-12-18T11:44:18.000+00:00&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;id&#34;</span><span class="o">:</span> <span class="mi">7</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;type&#34;</span><span class="o">:</span> <span class="s2">&#34;多线程&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;comments&#34;</span><span class="o">:</span> <span class="s2">&#34;多线程&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;logoUrl&#34;</span><span class="o">:</span> <span class="s2">&#34;https://java0817-001.oss-cn-guangzhou.aliyuncs.com/2020-12-18/b4d68e14-7abe-4680-8645-e9d8584b6159_thread.png&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;delFlag&#34;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;createTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2020-12-18T11:48:11.000+00:00&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;updateTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2020-12-18T11:48:11.000+00:00&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;id&#34;</span><span class="o">:</span> <span class="mi">8</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;type&#34;</span><span class="o">:</span> <span class="s2">&#34;分布式架构&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;comments&#34;</span><span class="o">:</span> <span class="s2">&#34;分布式架构&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;logoUrl&#34;</span><span class="o">:</span> <span class="s2">&#34;https://java0817-001.oss-cn-guangzhou.aliyuncs.com/2020-12-18/ccc99163-69a9-44f4-8ee4-75fbdced3291_jichu.png&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;delFlag&#34;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;createTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2020-12-18T11:50:18.000+00:00&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;updateTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2020-12-18T11:50:18.000+00:00&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;id&#34;</span><span class="o">:</span> <span class="mi">9</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;type&#34;</span><span class="o">:</span> <span class="s2">&#34;业务逻辑&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;comments&#34;</span><span class="o">:</span> <span class="s2">&#34;业务逻辑&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;logoUrl&#34;</span><span class="o">:</span> <span class="s2">&#34;https://java0817-001.oss-cn-guangzhou.aliyuncs.com/2020-12-18/3478c4fe-80b6-412a-88f1-8788a09ff3c9_yewu.png&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;delFlag&#34;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;createTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2020-12-18T11:51:09.000+00:00&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;updateTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2020-12-18T11:51:09.000+00:00&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;id&#34;</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;type&#34;</span><span class="o">:</span> <span class="s2">&#34;智能运维&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;comments&#34;</span><span class="o">:</span> <span class="s2">&#34;运维&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;logoUrl&#34;</span><span class="o">:</span> <span class="s2">&#34;https://java0817-001.oss-cn-guangzhou.aliyuncs.com/2020-12-18/8ab19994-c80f-4dce-8f85-7d4be876f073_运维.png&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;delFlag&#34;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;createTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2020-12-18T11:51:45.000+00:00&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;updateTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2020-12-18T11:51:45.000+00:00&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="76读取指定分类对应的试题列表">7.6、读取指定分类对应的试题列表</h2>
<p><code>&lt;a id=读取指定分类对应的试题&gt; &lt;/a&gt;</code></p>
<h3 id="基本信息-5">基本信息</h3>
<p><strong>Path：</strong> /api/question/question/list</p>
<p><strong>Method：</strong> GET</p>
<p><strong>接口描述：</strong></p>
<p><br></p>
<h3 id="request-5">Request</h3>
<p><strong>Headers</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数值</th>
<th>是否必须</th>
<th>示例</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>Authorization</td>
<td></td>
<td>是</td>
<td>必须</td>
<td>登录成功获取到token</td>
</tr>
</tbody>
</table>
<p><strong>Query</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>是否必须</th>
<th>示例</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>page</td>
<td>是</td>
<td>1</td>
<td>页码</td>
</tr>
<tr>
<td>limit</td>
<td>是</td>
<td>10</td>
<td>每页显示记录数</td>
</tr>
<tr>
<td>key</td>
<td>否</td>
<td>1</td>
<td>分类编号</td>
</tr>
</tbody>
</table>
<h3 id="reponse-5">Reponse</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="s2">&#34;msg&#34;</span><span class="o">:</span> <span class="s2">&#34;success&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="s2">&#34;code&#34;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="s2">&#34;page&#34;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;totalCount&#34;</span><span class="o">:</span> <span class="mi">8</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;pageSize&#34;</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;totalPage&#34;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;currPage&#34;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;list&#34;</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="o">:</span> <span class="mi">50</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;title&#34;</span><span class="o">:</span> <span class="s2">&#34;请介绍一下SpringSecurity是做什么的？&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;answer&#34;</span><span class="o">:</span> <span class="s2">&#34;SpringSecurity是一个能够为基于Spring的企业应用系统提供声明式的安全访问控制解决方案的安全框架。它提供了一组可以在Spring应用上下文中配置的Bean，充分利用了Spring IoC，DI（控制反转Inversion of Control ,DI:Dependency Injection 依赖注入）和AOP（面向切面编程）功能，为应用系统提供声明式的安全访问控制功能，减少了为企业系统安全控制编写大量重复代码的工作。&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;level&#34;</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;displayOrder&#34;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;subTitle&#34;</span><span class="o">:</span> <span class="s2">&#34;SpringSecurity&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;type&#34;</span><span class="o">:</span> <span class="mi">6</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;enable&#34;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;delFlag&#34;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;createTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2020-12-18T11:54:36.000+00:00&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;updateTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2020-12-18T11:54:36.000+00:00&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="p">},</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="o">:</span> <span class="mi">51</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;title&#34;</span><span class="o">:</span> <span class="s2">&#34;介绍一下商品图片的上传流程？&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;answer&#34;</span><span class="o">:</span> <span class="s2">&#34;客户端发送请求到trackerServer 由trackerServer去查询可用StorageServer.返回给客户端.客户端找到StorageServer进行文件上传.StorageServer保存数据并且生产file_id.并将file_id(路径信息和文件名)返回给客户端.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;level&#34;</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;displayOrder&#34;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;subTitle&#34;</span><span class="o">:</span> <span class="s2">&#34;图片的上传流程&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;type&#34;</span><span class="o">:</span> <span class="mi">6</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;enable&#34;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;delFlag&#34;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;createTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2020-12-18T11:55:33.000+00:00&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;updateTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2020-12-18T11:55:33.000+00:00&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="p">},</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="o">:</span> <span class="mi">52</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;title&#34;</span><span class="o">:</span> <span class="s2">&#34;什么是富文本编辑器？&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;answer&#34;</span><span class="o">:</span> <span class="s2">&#34;富文本编辑器，Rich Text Editor, 简称 RTE, 它提供类似于 Microsoft Word 的编辑功能。常用的富文本编辑器：\nKindEditor    http://kindeditor.net/\nUEditor         http://ueditor.baidu.com/website/\nCKEditor      http://ckeditor.com/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;level&#34;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;displayOrder&#34;</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;subTitle&#34;</span><span class="o">:</span> <span class="s2">&#34;富文本编辑器&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;type&#34;</span><span class="o">:</span> <span class="mi">6</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;enable&#34;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;delFlag&#34;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;createTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2020-12-18T11:56:10.000+00:00&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;updateTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2020-12-18T11:56:10.000+00:00&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="p">},</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="o">:</span> <span class="mi">53</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;title&#34;</span><span class="o">:</span> <span class="s2">&#34;什么是逻辑删除？&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;answer&#34;</span><span class="o">:</span> <span class="s2">&#34;逻辑删除：顾名思义，就是“假删除”。在企业开发中，一般做真实的物理删除情况较少，我们大多数都是通过一些标记字段，来表示该数据是否被删除，这样后期的统计、分析、研究数据都比较方便，便于积累大量的用户数据。&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;level&#34;</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;displayOrder&#34;</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;subTitle&#34;</span><span class="o">:</span> <span class="s2">&#34;逻辑删除&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;type&#34;</span><span class="o">:</span> <span class="mi">6</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;enable&#34;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;delFlag&#34;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;createTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2020-12-18T11:56:42.000+00:00&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;updateTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2020-12-18T11:56:42.000+00:00&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="p">},</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="o">:</span> <span class="mi">54</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;title&#34;</span><span class="o">:</span> <span class="s2">&#34;简单说明redis存储的流程？&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;answer&#34;</span><span class="o">:</span> <span class="s2">&#34;1.直接从reids中获取数据。\n2.判断获取的数据是否为空\n3.如果为空，则从数据库中获取数据，并将从数据库中获取的数据，存储到redis中，再返回。\n4.如果不为空，则直接将redis中获取的数据返回&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;level&#34;</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;displayOrder&#34;</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;subTitle&#34;</span><span class="o">:</span> <span class="s2">&#34;redis存储&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;type&#34;</span><span class="o">:</span> <span class="mi">6</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;enable&#34;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;delFlag&#34;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;createTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2020-12-18T11:57:15.000+00:00&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;updateTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2020-12-18T11:57:15.000+00:00&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="p">},</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="o">:</span> <span class="mi">55</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;title&#34;</span><span class="o">:</span> <span class="s2">&#34;solr是什么？有什么优点？&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;answer&#34;</span><span class="o">:</span> <span class="s2">&#34;基于Lucene的全文搜索服务器。同时对其进行了扩展，提供了比\nLucene更为丰富的查询语言，同时实现了可配置、可扩展并对查询性能进行了优化，并且提供了一个完善的功能管理界面，是一款非常优秀的全文搜索引擎&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;level&#34;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;displayOrder&#34;</span><span class="o">:</span> <span class="mi">6</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;subTitle&#34;</span><span class="o">:</span> <span class="s2">&#34;solr&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;type&#34;</span><span class="o">:</span> <span class="mi">6</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;enable&#34;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;delFlag&#34;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;createTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2020-12-18T11:57:44.000+00:00&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;updateTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2020-12-18T11:57:44.000+00:00&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="p">},</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="o">:</span> <span class="mi">56</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;title&#34;</span><span class="o">:</span> <span class="s2">&#34;activemq的作用以及原理&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;answer&#34;</span><span class="o">:</span> <span class="s2">&#34;Activemq 的作用就是系统之间进行通信。 当然可以使用其他方式进行系统间通信， 如果使用 Activemq 的话可以对系统之间的调用进行解耦， 实现系统间的异步通信。 原理就是生产者生产消息， 把消息发送给activemq。 Activemq 接收到消息， 然后查看有多少个消费者， 然后把消息转发给消费者， 此过程中生产者无需参与。 消费者接收到消息后做相应的处理和生产者没有任何关系&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;level&#34;</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;displayOrder&#34;</span><span class="o">:</span> <span class="mi">7</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;subTitle&#34;</span><span class="o">:</span> <span class="s2">&#34;activemq&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;type&#34;</span><span class="o">:</span> <span class="mi">7</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;enable&#34;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;delFlag&#34;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;createTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2020-12-18T11:58:30.000+00:00&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;updateTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2020-12-18T11:58:30.000+00:00&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="p">},</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;id&#34;</span><span class="o">:</span> <span class="mi">57</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;title&#34;</span><span class="o">:</span> <span class="s2">&#34;什么是 Freemarker&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;answer&#34;</span><span class="o">:</span> <span class="s2">&#34;FreeMarker 是一个用 Java 语言编写的模板引擎，它基于模板来生成文本输出。\nFreeMarker与 Web 容器无关，即在 Web 运行时，它并不知道 Servlet 或 HTTP。\n它不仅可以用作表现层的实现技术，而且还可以用于生成 XML，JSP 或 Java 等。&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;level&#34;</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;displayOrder&#34;</span><span class="o">:</span> <span class="mi">7</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;subTitle&#34;</span><span class="o">:</span> <span class="s2">&#34; Freemarker&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;type&#34;</span><span class="o">:</span> <span class="mi">7</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;enable&#34;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;delFlag&#34;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;createTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2020-12-18T11:59:01.000+00:00&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;updateTime&#34;</span><span class="o">:</span> <span class="s2">&#34;2020-12-18T11:59:01.000+00:00&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="77获取试题详情">7.7、获取试题详情</h2>
<p><code>&lt;a id=获取试题详情&gt; &lt;/a&gt;</code></p>
<h3 id="基本信息-6">基本信息</h3>
<p><strong>Path：</strong> /question/question/info/{id}</p>
<p><strong>Method：</strong> GET</p>
<p><strong>接口描述：</strong></p>
<p><br></p>
<h3 id="request-6">Request</h3>
<p><strong>路径参数</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>示例</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>1</td>
<td>题目id</td>
</tr>
</tbody>
</table>
<h3 id="reponse-6">Reponse</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;msg&#34;</span><span class="p">:</span> <span class="s2">&#34;success&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;code&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;question&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;title&#34;</span><span class="p">:</span> <span class="s2">&#34;请介绍一下SpringSecurity是做什么的？&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;answer&#34;</span><span class="p">:</span> <span class="s2">&#34;SpringSecurity是一个能够为基于Spring的企业应用系统提供声明式的安全访问控制解决方案的安全框架。它提供了一组可以在Spring应用上下文中配置的Bean，充分利用了Spring IoC，DI（控制反转Inversion of Control ,DI:Dependency Injection 依赖注入）和AOP（面向切面编程）功能，为应用系统提供声明式的安全访问控制功能，减少了为企业系统安全控制编写大量重复代码的工作。&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;level&#34;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;displayOrder&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;subTitle&#34;</span><span class="p">:</span> <span class="s2">&#34;SpringSecurity&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;enable&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;delFlag&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;createTime&#34;</span><span class="p">:</span> <span class="s2">&#34;2020-12-18 11:54:36&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;updateTime&#34;</span><span class="p">:</span> <span class="s2">&#34;2020-12-18T11:54:36.000+00:00&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>具体参见线上接口文档</p>
<p><a class="link" href="/posts/project/https://www.25xt.com/html5css3/16782.html"  target="_blank" rel="noopener"
    >https://www.25xt.com/html5css3/16782.html</a></p>
<p><a class="link" href="/posts/project/https://mock.yonyoucloud.com/"  target="_blank" rel="noopener"
    >https://mock.yonyoucloud.com/</a>
账号:hk109@126.com
密码：offcn123</p>

            </div>
            <hr>
            <div style="text-align: center;">
                <button class="btn"><a href="https://lovemjh.github.io/posts/project/20220528232959/">← tk-题库项目开发2</a></button>
                <button class="btn"><a href="https://lovemjh.github.io/posts/project-0/20220528174166/">分布式事务 →</a></button>
            </div>

            
        </article><div class="aside_content" id="aside_content">
    <div class="card-widget card-info">
        <div class="card-content">
            <div class="card-info-avatar is-center">
                <img class="avatar-img" src="http://q1.qlogo.cn/g?b=qq&nk=2409741052&s=640" alt="avatar">
                <div class="author-info__name">青山</div>
                <div class="author-info__description">悟已往之不谏 知来者之可追</div>
            </div>
            
            <div class="card-info-social-icons is-center">
                <a class="social-icon" href="https://github.com/xioyito" target="_blank">
                    <i class="fa fa-github"></i>
                </a>
            </div>
            

        </div>
    </div>


    <div class="card-widget">
        <div class="card-content">
            <meting-js auto="https://y.qq.com/n/yqq/playlist/7713574197.html">
            </meting-js>
        </div>
    </div>

    <div class="card-widget">
        <div class="card-content">
            <div class="item-headline">
                <i class="fa fa-bullhorn" aria-hidden="true"></i>
                <span>一言</span>
            </div>
            <div id="hitokoto"></div>
        </div>
    </div>
    <div class="card-widget">
        <div class="card-content">
            <div class="item-headline">
                <i class="fa fa-calendar" aria-hidden="true"></i>
                <span>今日诗词</span>
            </div>
            <div id="jinrishici-sentence"></div>
        </div>
    </div>

    <div class="card-widget">
        <div class="card-content">
            <div class="item-headline">
                <i class="fa fa-line-chart" aria-hidden="true"></i>
                <span>站点信息</span>
            </div>
            <div class="webinfo">
                <div class="webinfo-item">
                    <div class="webinfo-site-uv-name">本站访客数 :</div>
                    <div class="webinfo-site-uv-count" id="busuanzi_value_site_uv"></div>
                </div>
                <div class="webinfo-item">
                    <div class="webinfo-site-name">本站总访问量 :</div>
                    <div class="webinfo-site-pv-count" id="busuanzi_value_site_pv"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="card-widget js-toc-w" id="js-toc-w">
        <div class="card-content js-toc">
            
        </div>
    </div>
    
</div></div>
</main>
<footer id="footer">
    <div id="footer-wrap">
        <div class="copyright">&copy;2019 - 2021 BY QING SHAN KE</div>
    </div>
</footer>
</div>

<div class="fan" id="fan" style="
position: fixed;
width: 40px;
height: 120px;
right: -200px;
bottom: 0px;
transition: all 0.5s;
z-index: 99999;
 ">
    <i class="fa fa-cog fa-spin fa-2x"></i><br>
    <i class="fa fa-align-justify fa-2x" id="ff"></i><br>
    <i class="fa fa fa-arrow-up fa-2x" id="aa"></i><br>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>


  
  <script src="/js/jquery.pjax.js"></script> 

    <script type="text/javascript">
            $(function () {
                $(document).pjax('a', '#page', {
                    fragment: '#page',
                    timeout: 5000,
                    cache: false
                });
                $(document).on({
                    'pjax:click': function () {
                        
                        console.log("点击链接");
                    },
                    'pjax:start': function () {
                        
                        console.log("获取请求");
                    },
                    'pjax:end': function () {
                        
                        console.log("请求完成");
                        addNumbers();

                    }
                });
            });
                    function addNumbers() {
                        
                        
                        var myElement = document.getElementById('js-toc-w');
                        if (window.location.href.includes('/posts/')) {
                            
                            console.log('地址栏中包含 "/posts/"');
                            tocbot.refresh();
                            myElement.style.display = 'block';
                        } else {
                            
                            console.log('地址栏中不包含 "/posts/"');
                            myElement.style.display = 'none';
                        }

                    }
        </script>





<script>
  const imgArr = [
    "https://pic1.zhimg.com/80/v2-23d671bf74a246c54b1256bd2322d461_720w.webp?source=1940ef5c",
    "https://pic1.zhimg.com/80/v2-3afad658b44f596b10ec13b2b6d4299d_720w.webp?source=1940ef5c",
    "https://picx.zhimg.com/80/v2-b83d637fafb72fd13a5922aa0038bff9_720w.webp?source=1940ef5c",
    "https://pic1.zhimg.com/80/v2-3afad658b44f596b10ec13b2b6d4299d_720w.webp?source=1940ef5c",
    "https://pic1.zhimg.com/80/v2-7ee6f104979814d2bf420461e3872475_720w.webp?source=1940ef5c",
    "https://picx.zhimg.com/80/v2-585754b4ab4d49f480b833cbbbf4839f_720w.webp?source=1940ef5c",
    "https://pic1.zhimg.com/80/v2-b3d8f74192b2940a1112c93797cc0815_720w.webp?source=1940ef5c",
  ];
  var objs = document.getElementsByClassName('page-img');
  for (var i = 0; i < objs.length; i++) {
    objs[i].id = "myid" + i;
    let randNum = Math.floor(Math.random() * imgArr.length);
    var odiv = document.getElementById("myid" + i);
    odiv.style.backgroundImage = `url(${imgArr[randNum]})`;
    
    odiv.style.backgroundRepeat = "no-repeat";
    odiv.style.backgroundPosition = "0px 0px";
  }
</script>

<script>
    var a = 0;
    ff.onclick = function () {
        if (a === 0) {
            $(".js-toc-w").css("position", "fixed"); 
            $(".js-toc-w").css("bottom", "10px");
            $(".js-toc-w").css("right", "40px");

            a++;
        } else {
            $(".js-toc-w").css("position", "static");
            a--;
        }
    }

    aa.onclick = function () {
        window.scrollTo({     
            top: 0,            
            behavior: "smooth"   
        })
    }

    
    window.onload = function () {
        $(".aplayer").css("background", "rgba(0, 0, 0, 0)");
        
        addNumbers();
        
    } 
</script>
<script>
    $(window).scroll(function () {
        var scrollY = document.documentElement.scrollTop || document.body.scrollTop
        if (scrollY > 40) {
            $('.fan').css("right", "0px");
        } else {
            $('.fan').css("right", "-220px");
        }
    });
    $(function () {
        
        var start_height = $(document).scrollTop();
        
        var navigation_height = $('.navigation').outerHeight();
        $(window).scroll(function () {
            
            var end_height = $(document).scrollTop();
            
            if (end_height > navigation_height) {
                $('.navigation').addClass('hide');
            } else {
                $('.navigation').removeClass('hide');
            }
            
            if (end_height < start_height) {
                $('.navigation').removeClass('hide');
            }
            
            start_height = $(document).scrollTop();
        });
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/jquery.fancybox@2.1.5/source/jquery.fancybox.js"></script>

<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script src="https://cdn.jsdelivr.net/npm/instant.page@3.0.0/instantpage.js" type="module"></script>

<script src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.0/lazysizes.min.js" async></script>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>


<script src="https://unpkg.com/nplayer@latest/dist/index.min.js"></script>


<script src="https://v1.hitokoto.cn/?encode=js&select=%23hitokoto" defer></script>
<script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>





<script src="https://cdn.jsdelivr.net/gh/TRHX/CDN-for-itrhx.com@3.0.8/js/maodian.js"></script>



<script type="text/javascript">
    
    tocbot.init({
    
    tocSelector: '.js-toc',
    
    contentSelector: '.js-toc-content',
    
    headingSelector: 'h1, h2, h3, h4, h5 ,h6',
    
    hasInnerContainers: false,
    
    });
    console.clear();
    console.log("%c 有朋自远方来, 不亦说乎.", "background:#24272A; color:#ffffff", "");
    console.log("%c Github %c", "background:#24272A; color:#ffffff", "", "https://github.com/laoxuai");
    console.log("%c 版本号: %c", "background:#24272A; color:#ffffff", "", "1.0.0");

    (function ($) {
        $.fn.snow = function (options) {
            var $flake = $('<div id="snowbox" />').css({ 'position': 'absolute', 'z-index': '9999', 'top': '-50px' }).html('&#10052;'),
                documentHeight = $(document).height(),
                documentWidth = $(document).width(),
                defaults = {
                    minSize: 10,
                    maxSize: 20,
                    newOn: 1000,
                    flakeColor: "#AFDAEF"  
                },
                options = $.extend({}, defaults, options);
            var interval = setInterval(function () {
                var startPositionLeft = Math.random() * documentWidth - 100,
                    startOpacity = 0.5 + Math.random(),
                    sizeFlake = options.minSize + Math.random() * options.maxSize,
                    endPositionTop = documentHeight - 200,
                    endPositionLeft = startPositionLeft - 500 + Math.random() * 500,
                    durationFall = documentHeight * 10 + Math.random() * 5000;
                $flake.clone().appendTo('body').css({
                    left: startPositionLeft,
                    opacity: startOpacity,
                    'font-size': sizeFlake,
                    color: options.flakeColor
                }).animate({
                    top: endPositionTop,
                    left: endPositionLeft,
                    opacity: 0.2
                }, durationFall, 'linear', function () {
                    $(this).remove()
                });
            }, options.newOn);
        };
    })(jQuery);
    $(function () {
        $.fn.snow({
            minSize: 5,  
            maxSize: 50, 
            newOn: 800   
        });
    });

    
    var OriginTitle = document.title;
    var titleTime;
    document.addEventListener('visibilitychange', function () {
        if (document.hidden) {
            
            document.title = '╭(°A°`)╮ 页面崩溃啦 ~';
            clearTimeout(titleTime);
        }
        else {
            $('[rel="icon"]').attr('href', "/favicon.ico");
            document.title = '(ฅ>ω<*ฅ) 噫又好啦 ~' + OriginTitle;
            titleTime = setTimeout(function () {
                document.title = OriginTitle;
            }, 2000);
        }
    });
</script></body>
</html>