<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="å¾®æœåŠ¡ç½‘å…³å’ŒJwtä»¤ç‰Œ - https://lovemjh.github.io/posts/project-0/20220528162731/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>å¾®æœåŠ¡ç½‘å…³å’ŒJwtä»¤ç‰Œ</title>
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    <link rel="stylesheet" href="https://lovemjh.github.io/style.min.824365c118b34524ce845ac2a294220354719cca11af5b27a81b04c173bbba57.css">
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate cool">
        <div id="header"><div class="container-header">
    <div id="vars" class="container-vars" style="display: none;">
	{
		"hasFoldAllCodeBlocks": false,
		"svgColor": "#6c757d",
		"en": false,
		"dark": false
	}
</div>
    <h1 class="title">
        
            å¾®æœåŠ¡ç½‘å…³å’ŒJwtä»¤ç‰Œ
            
        
    </h1>

    <div class="container-breadcrumb-nav">
    
    <div class="breadcrumb-nav-bar">
        <div><a href="/"><svg t="1656411084410" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2954" width="16" height="16"><path d="M947.5 390.6l-377-290c-34.5-26.5-82.6-26.5-117.1 0l-377 290c-14 10.8-16.6 30.9-5.9 44.9 10.8 14 30.9 16.6 44.9 5.9l28.5-21.9V768c0 88.2 71.8 160 160 160h80c35.3 0 64-28.7 64-64V640c0-17.6 14.4-32 32-32h64c17.6 0 32 14.4 32 32v224c0 35.3 28.7 64 64 64h80c88.2 0 160-71.8 160-160V419.4l28.5 21.9c5.8 4.5 12.7 6.6 19.5 6.6 9.6 0 19.1-4.3 25.4-12.5 10.8-13.9 8.2-34-5.8-44.8zM816 768c0 52.9-43.1 96-96 96h-80V640c0-52.9-43.1-96-96-96h-64c-52.9 0-96 43.1-96 96v224h-80c-52.9 0-96-43.1-96-96V370.2l284.5-218.8c11.5-8.8 27.5-8.8 39 0L816 370.2V768z" fill=#6c757d p-id="2955"></path></svg></a></div>
        <div><a href="/nav"><svg t="1656411531924" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5827" width="16" height="16"><path d="M849.59197473 125.23018519L139.22930586 391.72854662a23.35052669 23.35052669 0 0 0-14.95414244 21.65490745c-0.12257519 9.70384955 5.61801843 18.46795771 14.40255493 22.04306141l318.42928099 129.25528056 119.51057092 320.39047893c3.06437293 8.23295069 10.35758221 13.89182751 18.7335381 14.87242563l2.7170774 0.14300521a22.79893918 22.79893918 0 0 0 21.20546682-15.36272638l259.51158924-729.54564933a23.8612558 23.8612558 0 0 0-5.31158128-24.55584682 22.3290685 22.3290685 0 0 0-23.9021142-5.43415649zM793.65694081 211.64552314l-196.63064161 552.75171747-91.91077952-246.37564122-253.62799211-102.96295445 542.16941324-203.4131218z" p-id="5828" fill=#6c757d></path></svg></a></div>
        <div><a href="/search"><svg t="1656411627509" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1730" width="14" height="14"><path d="M469.333333 85.333333c211.968 0 384 172.032 384 384s-172.032 384-384 384-384-172.032-384-384 172.032-384 384-384z m0 682.666667c164.992 0 298.666667-133.674667 298.666667-298.666667 0-165.034667-133.674667-298.666667-298.666667-298.666666-165.034667 0-298.666667 133.632-298.666666 298.666666 0 164.992 133.632 298.666667 298.666666 298.666667z m362.026667 3.029333l120.704 120.661334-60.373333 60.373333-120.661334-120.704 60.330667-60.330667z" p-id="1731" fill=#6c757d></path></svg></a></div>
        <div><a href="/posts"><svg t="1656411724198" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5655" width="12" height="12"><path d="M811.705761 1024H212.294239c-93.1199 0-174.823046-87.570975-174.823046-187.387854V162.322018C37.471193 69.776145 112.604921 0 212.294239 0H596.190595l7.015883 5.93161c111.74388 95.479788 185.857116 170.741078 279.614824 266.093304 29.65805 30.040735 61.165743 62.122454 96.436499 97.393211l7.271006 7.334787v459.859234c-0.063781 99.816879-81.703145 187.387854-174.823046 187.387854zM212.294239 49.94033c-72.391155 0-124.882716 47.261538-124.882716 112.381688v674.290128c0 71.94469 59.507443 137.383743 124.882716 137.383743h599.411522c65.311492 0 124.882716-65.439053 124.882716-137.383743V397.417876c-32.528184-32.464404-61.73977-62.250016-89.356836-90.377328-90.951355-92.418312-163.278729-165.957521-269.601245-257.163999H212.294239z" fill=#6c757d p-id="5656"></path><path d="M936.588477 449.526752h-212.326129c-99.753099 0-187.324073-81.703145-187.324073-174.823046V49.94033a25.002055 25.002055 0 0 1 49.94033 0v224.763376c0 65.311492 65.502834 124.882716 137.383743 124.882716h212.326129a25.002055 25.002055 0 1 1 0 49.94033z" fill=#6c757d p-id="5657"></path></svg></a></div>
        <div><a href="/archive"><svg t="1656411795742" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7334" width="12" height="12"><path d="M884.224 522.24H504.32V141.824c0-16.896-13.824-30.72-30.72-30.72-120.32 0-233.472 47.616-317.952 134.144S26.112 445.952 29.184 566.784c2.56 114.688 49.152 222.72 131.072 304.128 81.92 81.408 189.952 128 304.64 130.56h10.24c117.76 0 227.84-45.568 312.32-128.512 86.528-85.504 133.632-199.68 132.608-321.024-0.512-2.048-1.536-29.696-35.84-29.696z m-140.288 307.712c-74.752 73.728-173.056 112.64-277.504 110.592-205.824-4.608-370.688-169.472-375.296-374.784-3.072-104.448 35.84-202.752 108.544-277.504 65.536-67.072 151.552-107.52 243.712-114.688v378.88c0 16.896 13.824 30.72 30.72 30.72 129.024 0 311.296 0 382.976 0.512-6.144 93.184-46.08 179.712-113.152 246.272z" fill=#6c757d p-id="7335"></path><path d="M603.136 11.264c-8.192-0.512-15.872 3.072-22.016 8.704-5.632 5.632-9.216 13.824-9.216 22.016v378.88c0 16.896 13.824 30.72 30.72 30.72h378.88c16.896 0 30.72-13.824 30.72-30.72 0-223.744-183.808-407.552-409.088-409.6z m30.208 378.88V74.24c167.424 16.384 301.056 150.016 315.904 315.904h-315.904z" fill=#6c757d p-id="7336"></path></svg></a></div>
        <div id="light-dark" style="cursor: pointer;"><a><svg t="1656411842215" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5086" width="12" height="12"><path d="M1007.492874 384.513055c-8.795694-34.58307-21.189627-67.666874-36.682043-99.05151-2.698679-5.397358-10.894667-3.498287-10.894666 2.598728v0.299853c0 32.484098-6.896624 63.868734-19.890263 92.554691-10.694764 23.488501-25.487523 45.077933-43.978471 64.068635-41.779547 42.679107-99.05151 66.967217-158.722299 67.26707-61.869712 0.299853-119.941284-24.188159-162.920244-68.966238-40.280281-41.979449-62.56937-98.251902-62.269516-156.323473 0.399804-59.270984 23.588452-114.94373 65.567901-156.823229 19.59041-19.59041 42.179351-35.082826 66.667364-46.077443C672.956643 71.166451 704.041426 64.469729 736.125719 64.469729h1.299364c6.097015 0 8.096037-8.096037 2.598728-10.794715C708.739126 37.982696 675.655322 25.488812 641.172203 16.493216 599.492607 5.598549 555.714038-0.098662 510.536154 0.001289 222.37722 0.700947-7.41029 237.38508 0.185992 525.444064c7.096526 271.667008 225.889418 490.559851 497.456474 497.856279 287.559228 7.796183 524.14341-220.891864 525.842579-508.551044 0.299853-44.977981-5.297407-88.656599-15.992171-130.236244z m-83.15929 301.552378c-22.588942 53.27392-54.873137 101.250434-95.953027 142.330323-41.179841 41.179841-89.056403 73.464036-142.330324 95.953027-55.172991 23.288599-113.744317 35.182777-174.314666 35.182777s-119.141675-11.794226-174.314666-35.182777c-53.27392-22.588942-101.250434-54.873137-142.330323-95.953027-41.179841-41.179841-73.464036-89.056403-95.953027-142.330323C75.749001 630.892442 63.954774 572.221164 63.954774 511.750767s11.794226-119.141675 35.182777-174.314666c22.588942-53.27392 54.873137-101.250434 95.953027-142.330323 41.179841-41.179841 89.056403-73.464036 142.330323-95.953027C392.593892 75.7642 451.26517 63.969974 511.735567 63.969974c13.99315 0 27.886348 0.599706 41.679596 1.89907C489.246577 118.643209 448.266638 198.704016 448.266638 288.360126c0 159.022152 128.836929 287.859081 287.859081 287.859081 89.156354 0 168.817357-40.580134 221.691473-104.149015 1.099462 13.09359 1.699168 26.387082 1.699168 39.680575 0 60.470397-11.794226 119.141675-35.182776 174.314666z" p-id="5087" fill=#6c757d></path></svg></a></div>
        
    </div>

    
</div>

            <div id="toc">ğŸ“œ</div>
        
    
    
</div>
</div>
        <div id="content">












<div class="container-main 
     container-page 
">

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7409" width="12" height="12"><path d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z" p-id="7410" fill="#adb5bd"></path></svg>
            2022-05-28&nbsp;
        </span>
        <span>
            
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="23838" width="11" height="11"><path d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z" p-id="23839" fill="#adb5bd"></path></svg>
            2022-05-28&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="33866" width="12" height="12"><path d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z" fill="#adb5bd" p-id="33867"></path><path d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z" fill="#adb5bd" p-id="33868"></path></svg>
            10517 å­—</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="32892" width="12" height="12"><path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z" p-id="32893" fill="#adb5bd"></path><path d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z" p-id="32894" fill="#adb5bd"></path></svg>
            21 åˆ†é’Ÿ</span><div class="container-ctgtag">
	<div class="taxonomy">
		
		<div class="ctg">
			
			
			<a href="/categories/"></a>
			
		</div>
		<div class="tag">
			
			 - 
			
			<a href="/tags/"></a>
			
		</div>
	</div>
</div>
    </div>
    
    <div class="toc">
        
        <div class="page-operation">
            <div><a href="#"><img src="/imgs/icons/arrow-up-circle.svg" alt=""></a></div>
            <div><a href="https://lovemjh.github.io/posts/project-0/20220528174166/"><img src="/imgs/icons/arrow-left-circle.svg" alt=""></a></div>
            <div><a href="https://lovemjh.github.io/posts/project-0/20220528171137/"><img src="/imgs/icons/arrow-right-circle.svg" alt=""></a></div>
        </div>
        
        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#å­¦ä¹ ç›®æ ‡">å­¦ä¹ ç›®æ ‡</a></li>
        <li><a href="#1-å¾®æœåŠ¡ç½‘å…³">1 å¾®æœåŠ¡ç½‘å…³</a>
          <ul>
            <li><a href="#11-å¾®æœåŠ¡ç½‘å…³çš„æ¦‚è¿°">1.1 å¾®æœåŠ¡ç½‘å…³çš„æ¦‚è¿°</a></li>
            <li><a href="#12-å¾®æœåŠ¡ç½‘å…³æŠ€æœ¯">1.2 å¾®æœåŠ¡ç½‘å…³æŠ€æœ¯</a></li>
          </ul>
        </li>
        <li><a href="#2-ç½‘å…³ç³»ç»Ÿä½¿ç”¨">2 ç½‘å…³ç³»ç»Ÿä½¿ç”¨</a>
          <ul>
            <li><a href="#21-éœ€æ±‚åˆ†æ">2.1 éœ€æ±‚åˆ†æ</a></li>
            <li><a href="#22-æ­å»ºåå°ç½‘å…³ç³»ç»Ÿ">2.2 æ­å»ºåå°ç½‘å…³ç³»ç»Ÿ</a>
              <ul>
                <li><a href="#221-æ­å»ºåˆ†æ">2.2.1 æ­å»ºåˆ†æ</a></li>
                <li><a href="#222-å·¥ç¨‹æ­å»º">2.2.2 å·¥ç¨‹æ­å»º</a></li>
              </ul>
            </li>
            <li><a href="#23-è·¨åŸŸé…ç½®">2.3 è·¨åŸŸé…ç½®</a></li>
            <li><a href="#24-ç½‘å…³è¿‡æ»¤é…ç½®">2.4 ç½‘å…³è¿‡æ»¤é…ç½®</a>
              <ul>
                <li><a href="#241-host-è·¯ç”±">2.4.1 Host è·¯ç”±</a></li>
                <li><a href="#242-è·¯å¾„åŒ¹é…è¿‡æ»¤é…ç½®">2.4.2 è·¯å¾„åŒ¹é…è¿‡æ»¤é…ç½®</a></li>
                <li><a href="#243-prefixpath-è¿‡æ»¤é…ç½®">2.4.3 PrefixPath è¿‡æ»¤é…ç½®</a></li>
                <li><a href="#244-stripprefix-è¿‡æ»¤é…ç½®">2.4.4 StripPrefix è¿‡æ»¤é…ç½®</a></li>
                <li><a href="#245-loadbalancerclient-è·¯ç”±è¿‡æ»¤å™¨å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡">2.4.5 LoadBalancerClient è·¯ç”±è¿‡æ»¤å™¨(å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡)</a></li>
              </ul>
            </li>
            <li><a href="#25-ç½‘å…³é™æµ">2.5 ç½‘å…³é™æµ</a>
              <ul>
                <li><a href="#251-æ€è·¯åˆ†æ">2.5.1 æ€è·¯åˆ†æ</a></li>
                <li><a href="#252-ä»¤ç‰Œæ¡¶ç®—æ³•">2.5.2 ä»¤ç‰Œæ¡¶ç®—æ³•</a></li>
                <li><a href="#253-ä½¿ç”¨ä»¤ç‰Œæ¡¶è¿›è¡Œè¯·æ±‚æ¬¡æ•°é™æµ">2.5.3 ä½¿ç”¨ä»¤ç‰Œæ¡¶è¿›è¡Œè¯·æ±‚æ¬¡æ•°é™æµ</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#3-ç”¨æˆ·ç™»å½•">3 ç”¨æˆ·ç™»å½•</a>
          <ul>
            <li><a href="#31-è¡¨ç»“æ„ä»‹ç»">3.1 è¡¨ç»“æ„ä»‹ç»</a></li>
            <li><a href="#32-ç™»å½•">3.2 ç™»å½•</a></li>
            <li><a href="#34-ç½‘å…³å…³è”">3.4 ç½‘å…³å…³è”</a></li>
          </ul>
        </li>
        <li><a href="#4-jwtè®²è§£">4 JWTè®²è§£</a>
          <ul>
            <li><a href="#41-éœ€æ±‚åˆ†æ">4.1 éœ€æ±‚åˆ†æ</a></li>
            <li><a href="#42-ä»€ä¹ˆæ˜¯jwt">4.2 ä»€ä¹ˆæ˜¯JWT</a></li>
            <li><a href="#43-jwtçš„æ„æˆ">4.3 JWTçš„æ„æˆ</a></li>
            <li><a href="#44-jjwtçš„ä»‹ç»å’Œä½¿ç”¨">4.4 JJWTçš„ä»‹ç»å’Œä½¿ç”¨</a>
              <ul>
                <li><a href="#441-åˆ›å»ºtoken">4.4.1 åˆ›å»ºTOKEN</a></li>
                <li><a href="#442-tokenè§£æ">4.4.2 TOKENè§£æ</a></li>
                <li><a href="#443-è®¾ç½®è¿‡æœŸæ—¶é—´">4.4.3 è®¾ç½®è¿‡æœŸæ—¶é—´</a>
                  <ul>
                    <li><a href="#4431-tokenè¿‡æœŸè®¾ç½®">4.4.3.1 tokenè¿‡æœŸè®¾ç½®</a></li>
                    <li><a href="#4432-è§£ætoken">4.4.3.2 è§£æTOKEN</a></li>
                  </ul>
                </li>
                <li><a href="#444-è‡ªå®šä¹‰claims">4.4.4 è‡ªå®šä¹‰claims</a></li>
              </ul>
            </li>
            <li><a href="#45-é‰´æƒå¤„ç†">4.5 é‰´æƒå¤„ç†</a>
              <ul>
                <li><a href="#451-æ€è·¯åˆ†æ">4.5.1 æ€è·¯åˆ†æ</a></li>
                <li><a href="#452ç”¨æˆ·ç™»å½•ç­¾å‘token">4.5.2ç”¨æˆ·ç™»å½•ç­¾å‘TOKEN</a></li>
                <li><a href="#453-ç½‘å…³è¿‡æ»¤å™¨æ‹¦æˆªè¯·æ±‚å¤„ç†">4.5.3 ç½‘å…³è¿‡æ»¤å™¨æ‹¦æˆªè¯·æ±‚å¤„ç†</a></li>
                <li><a href="#454-é…ç½®è¿‡æ»¤è§„åˆ™">4.5.4 é…ç½®è¿‡æ»¤è§„åˆ™</a></li>
              </ul>
            </li>
            <li><a href="#46-ä¼šè¯ä¿æŒ">4.6 ä¼šè¯ä¿æŒ</a>
              <ul>
                <li><a href="#461-ç™»å½•å°è£…cookie">4.6.1 ç™»å½•å°è£…Cookie</a></li>
                <li><a href="#462-è¿‡æ»¤å™¨è·å–ä»¤ç‰Œæ•°æ®">4.6.2 è¿‡æ»¤å™¨è·å–ä»¤ç‰Œæ•°æ®</a></li>
                <li><a href="#463-æ·»åŠ headerä¿¡æ¯">4.6.3 æ·»åŠ Headerä¿¡æ¯</a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
    </div>

    <div class='content  content '>
        <h1 align = "center">ç¬¬åç« </h1>
<h1 align = "center">å¾®æœåŠ¡ç½‘å…³å’ŒJwtä»¤ç‰Œ</h1>
<h3 align="center">ä¼˜å°±ä¸š.JAVAæ•™ç ”å®¤</h3>
<h2 id="å­¦ä¹ ç›®æ ‡">å­¦ä¹ ç›®æ ‡</h2>
<ul>
<li>
<p>æŒæ¡å¾®æœåŠ¡ç½‘å…³çš„ç³»ç»Ÿæ­å»º</p>
</li>
<li>
<p>äº†è§£ä»€ä¹ˆæ˜¯å¾®æœåŠ¡ç½‘å…³ä»¥åŠå®ƒçš„ä½œç”¨</p>
</li>
<li>
<p>æŒæ¡ç³»ç»Ÿä¸­å¿ƒå¾®æœåŠ¡çš„æ­å»º</p>
</li>
<li>
<p>æŒæ¡ç”¨æˆ·å¯†ç åŠ å¯†å­˜å‚¨bcrypt</p>
</li>
<li>
<p>äº†è§£JWTé‰´æƒçš„ä»‹ç»</p>
</li>
<li>
<p>æŒæ¡JWTçš„é‰´æƒçš„ä½¿ç”¨</p>
<p>ä½¿ç”¨Jwtä»¤ç‰Œæ¥å­˜å‚¨ç”¨æˆ·ç™»å½•ä¿¡æ¯ï¼Œåœ¨å¾®æœåŠ¡ç½‘å…³ä¸­è¯†åˆ«ç™»å½•ä¿¡æ¯(ç”¨æˆ·çš„èº«ä»½)</p>
</li>
<li>
<p>æŒæ¡ç½‘å…³ä½¿ç”¨JWTè¿›è¡Œæ ¡éªŒ</p>
</li>
<li>
<p>æŒæ¡ç½‘å…³é™æµ</p>
</li>
</ul>
<h2 id="1-å¾®æœåŠ¡ç½‘å…³">1 å¾®æœåŠ¡ç½‘å…³</h2>
<h3 id="11-å¾®æœåŠ¡ç½‘å…³çš„æ¦‚è¿°">1.1 å¾®æœåŠ¡ç½‘å…³çš„æ¦‚è¿°</h3>
<p>ä¸åŒçš„å¾®æœåŠ¡ä¸€èˆ¬ä¼šæœ‰ä¸åŒçš„ç½‘ç»œåœ°å€ï¼Œè€Œå¤–éƒ¨å®¢æˆ·ç«¯å¯èƒ½éœ€è¦è°ƒç”¨å¤šä¸ªæœåŠ¡çš„æ¥å£æ‰èƒ½å®Œæˆä¸€ä¸ªä¸šåŠ¡éœ€æ±‚ï¼Œå¦‚æœè®©å®¢æˆ·ç«¯ç›´æ¥ä¸å„ä¸ªå¾®æœåŠ¡é€šä¿¡ï¼Œä¼šæœ‰ä»¥ä¸‹çš„é—®é¢˜ï¼š</p>
<ul>
<li>å®¢æˆ·ç«¯ä¼šå¤šæ¬¡è¯·æ±‚ä¸åŒçš„å¾®æœåŠ¡ï¼Œå¢åŠ äº†å®¢æˆ·ç«¯çš„å¤æ‚æ€§</li>
<li>å­˜åœ¨è·¨åŸŸè¯·æ±‚ï¼Œåœ¨ä¸€å®šåœºæ™¯ä¸‹å¤„ç†ç›¸å¯¹å¤æ‚</li>
<li>è®¤è¯å¤æ‚ï¼Œæ¯ä¸ªæœåŠ¡éƒ½éœ€è¦ç‹¬ç«‹è®¤è¯</li>
<li>éš¾ä»¥é‡æ„ï¼Œéšç€é¡¹ç›®çš„è¿­ä»£ï¼Œå¯èƒ½éœ€è¦é‡æ–°åˆ’åˆ†å¾®æœåŠ¡ã€‚ä¾‹å¦‚ï¼Œå¯èƒ½å°†å¤šä¸ªæœåŠ¡åˆå¹¶æˆä¸€ä¸ªæˆ–è€…å°†ä¸€ä¸ªæœåŠ¡æ‹†åˆ†æˆå¤šä¸ªã€‚å¦‚æœå®¢æˆ·ç«¯ç›´æ¥ä¸å¾®æœåŠ¡é€šä¿¡ï¼Œé‚£ä¹ˆé‡æ„å°†ä¼šå¾ˆéš¾å®æ–½</li>
<li>æŸäº›å¾®æœåŠ¡å¯èƒ½ä½¿ç”¨äº†é˜²ç«å¢™/æµè§ˆå™¨ä¸å‹å¥½çš„åè®®ï¼Œç›´æ¥è®¿é—®ä¼šæœ‰ä¸€å®šçš„å›°éš¾</li>
</ul>
<p>ä»¥ä¸Šè¿™äº›é—®é¢˜å¯ä»¥å€ŸåŠ©ç½‘å…³è§£å†³ã€‚</p>
<p>ç½‘å…³æ˜¯ä»‹äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä¹‹é—´çš„ä¸­é—´å±‚ï¼Œæ‰€æœ‰çš„å¤–éƒ¨è¯·æ±‚éƒ½ä¼šå…ˆç»è¿‡ç½‘å…³è¿™ä¸€å±‚ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒAPI çš„å®ç°æ–¹é¢æ›´å¤šçš„è€ƒè™‘ä¸šåŠ¡é€»è¾‘ï¼Œè€Œå®‰å…¨ã€æ€§èƒ½ã€ç›‘æ§å¯ä»¥äº¤ç”±ç½‘å…³æ¥åšï¼Œè¿™æ ·æ—¢æé«˜ä¸šåŠ¡çµæ´»æ€§åˆä¸ç¼ºå®‰å…¨æ€§ï¼Œå…¸å‹çš„æ¶æ„å›¾å¦‚å›¾æ‰€ç¤ºï¼š
<img src="/posts/project-0/20220528162731/image-20220528164602577.png"
    
    
    
    loading="lazy"
    
    
>
ä¼˜ç‚¹å¦‚ä¸‹ï¼š</p>
<ul>
<li>å®‰å…¨ï¼Œåªæœ‰ç½‘å…³ç³»ç»Ÿå¯¹å¤–è¿›è¡Œæš´éœ²ï¼Œå¾®æœåŠ¡å¯ä»¥éšè—åœ¨å†…ç½‘ï¼Œé€šè¿‡é˜²ç«å¢™ä¿æŠ¤ã€‚</li>
<li>æ˜“äºç›‘æ§ã€‚å¯ä»¥åœ¨ç½‘å…³æ”¶é›†ç›‘æ§æ•°æ®å¹¶å°†å…¶æ¨é€åˆ°å¤–éƒ¨ç³»ç»Ÿè¿›è¡Œåˆ†æã€‚</li>
<li>æ˜“äºè®¤è¯ã€‚å¯ä»¥åœ¨ç½‘å…³ä¸Šè¿›è¡Œè®¤è¯ï¼Œç„¶åå†å°†è¯·æ±‚è½¬å‘åˆ°åç«¯çš„å¾®æœåŠ¡ï¼Œè€Œæ— é¡»åœ¨æ¯ä¸ªå¾®æœåŠ¡ä¸­è¿›è¡Œè®¤è¯ã€‚</li>
<li>å‡å°‘äº†å®¢æˆ·ç«¯ä¸å„ä¸ªå¾®æœåŠ¡ä¹‹é—´çš„äº¤äº’æ¬¡æ•°</li>
<li>æ˜“äºç»Ÿä¸€æˆæƒã€‚</li>
</ul>
<p>æ€»ç»“ï¼šå¾®æœåŠ¡ç½‘å…³å°±æ˜¯ä¸€ä¸ªç³»ç»Ÿï¼Œé€šè¿‡æš´éœ²è¯¥å¾®æœåŠ¡ç½‘å…³ç³»ç»Ÿï¼Œæ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œç›¸å…³çš„é‰´æƒï¼Œå®‰å…¨æ§åˆ¶ï¼Œæ—¥å¿—ç»Ÿä¸€å¤„ç†ï¼Œæ˜“äºç›‘æ§çš„ç›¸å…³åŠŸèƒ½ã€‚</p>
<h3 id="12-å¾®æœåŠ¡ç½‘å…³æŠ€æœ¯">1.2 å¾®æœåŠ¡ç½‘å…³æŠ€æœ¯</h3>
<p>å®ç°å¾®æœåŠ¡ç½‘å…³çš„æŠ€æœ¯æœ‰å¾ˆå¤šï¼Œ</p>
<ul>
<li>nginx  Nginx (tengine x)æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„<a class="link" href="/posts/project-0/https://baike.baidu.com/item/HTTP"  target="_blank" rel="noopener"
    >HTTP</a>å’Œ<a class="link" href="/posts/project-0/https://baike.baidu.com/item/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/7793488"  target="_blank" rel="noopener"
    >åå‘ä»£ç†</a>webæœåŠ¡å™¨ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†IMAP/POP3/SMTPæœåŠ¡</li>
<li>zuul ,Zuul æ˜¯ Netflix å‡ºå“çš„ä¸€ä¸ªåŸºäº JVM è·¯ç”±å’ŒæœåŠ¡ç«¯çš„è´Ÿè½½å‡è¡¡å™¨ã€‚</li>
<li>spring-cloud-gateway,æ˜¯spring å‡ºå“çš„åŸºäºspring çš„ç½‘å…³é¡¹ç›®ï¼Œé›†æˆæ–­è·¯å™¨ï¼Œè·¯å¾„é‡å†™ï¼Œæ€§èƒ½æ¯”Zuulå¥½ã€‚</li>
</ul>
<p>æˆ‘ä»¬ä½¿ç”¨gatewayè¿™ä¸ªç½‘å…³æŠ€æœ¯ï¼Œæ— ç¼è¡”æ¥åˆ°åŸºäºspring cloudçš„å¾®æœåŠ¡å¼€å‘ä¸­æ¥ã€‚</p>
<p>gatewayå®˜ç½‘ï¼š</p>
<p><a class="link" href="/posts/project-0/https://spring.io/projects/spring-cloud-gateway"  target="_blank" rel="noopener"
    >https://spring.io/projects/spring-cloud-gateway</a></p>
<h2 id="2-ç½‘å…³ç³»ç»Ÿä½¿ç”¨">2 ç½‘å…³ç³»ç»Ÿä½¿ç”¨</h2>
<h3 id="21-éœ€æ±‚åˆ†æ">2.1 éœ€æ±‚åˆ†æ</h3>
<p>â€‹	ç”±äºæˆ‘ä»¬å¼€å‘çš„ç³»ç»Ÿæœ‰åŒ…æ‹¬å‰å°ç³»ç»Ÿå’Œåå°ç³»ç»Ÿï¼Œåå°çš„ç³»ç»Ÿç»™ç®¡ç†å‘˜ä½¿ç”¨ã€‚é‚£ä¹ˆä¹Ÿéœ€è¦è°ƒç”¨å„ç§å¾®æœåŠ¡ï¼Œæ‰€ä»¥æˆ‘ä»¬é’ˆå¯¹ç³»ç»Ÿç®¡ç†æ­å»ºä¸€ä¸ªç½‘å…³ç³»ç»Ÿã€‚åˆ†æå¦‚ä¸‹ï¼š
<img src="/posts/project-0/20220528162731/image-20220528164616303.png"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="22-æ­å»ºåå°ç½‘å…³ç³»ç»Ÿ">2.2 æ­å»ºåå°ç½‘å…³ç³»ç»Ÿ</h3>
<h4 id="221-æ­å»ºåˆ†æ">2.2.1 æ­å»ºåˆ†æ</h4>
<p>ç”±ä¸Šå¯çŸ¥é“ï¼Œç”±äºéœ€è¦æœ‰å¤šä¸ªç½‘å…³ï¼Œæ‰€ä»¥ä¸ºäº†ç®¡ç†æ–¹ä¾¿ã€‚æˆ‘ä»¬æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œæ‰“åŒ…æ–¹å¼ä¸ºpom,åœ¨é‡Œé¢å»ºç«‹å„ç§ç½‘å…³ç³»ç»Ÿæ¨¡å—å³å¯ã€‚å¦‚å›¾æ‰€ç¤ºï¼š
<img src="/posts/project-0/20220528162731/image-20220528164635790.png"
    
    
    
    loading="lazy"
    
    
></p>
<h4 id="222-å·¥ç¨‹æ­å»º">2.2.2 å·¥ç¨‹æ­å»º</h4>
<p>(1)å¼•å…¥ä¾èµ–</p>
<p>ä¿®æ”¹dongyimai-gatewayå·¥ç¨‹ï¼Œæ‰“åŒ…æ–¹å¼ä¸ºpom</p>
<p>pom.xmlå¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;project</span> <span style="color:#008080">xmlns=</span><span style="color:#d14">&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#008080">xmlns:xsi=</span><span style="color:#d14">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#008080">xsi:schemaLocation=</span><span style="color:#d14">&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;parent&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;artifactId&gt;</span>dongyimai-parent<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>com.offcn<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>1.0<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/parent&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;modelVersion&gt;</span>4.0.0<span style="color:#000080">&lt;/modelVersion&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;artifactId&gt;</span>dongyimai-gateway<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;packaging&gt;</span>pom<span style="color:#000080">&lt;/packaging&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;modules&gt;</span>
</span></span><span style="display:flex;"><span>    		<span style="color:#000080">&lt;module&gt;</span>dongyimai-gateway-web<span style="color:#000080">&lt;/module&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/modules&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--ç½‘å…³ä¾èµ–--&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000080">&lt;dependencies&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>        		<span style="color:#000080">&lt;groupId&gt;</span>org.springframework.cloud<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        		<span style="color:#000080">&lt;artifactId&gt;</span>spring-cloud-starter-gateway<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;groupId&gt;</span>org.springframework.cloud<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;artifactId&gt;</span>spring-cloud-starter-netflix-hystrix<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;groupId&gt;</span>org.springframework.cloud<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000080">&lt;artifactId&gt;</span>spring-cloud-starter-netflix-eureka-client<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/dependencies&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/project&gt;</span>
</span></span></code></pre></div><p>åœ¨dongyimai-gatewayå·¥ç¨‹ä¸­ï¼Œåˆ›å»º dongyimai-gateway-webå·¥ç¨‹ï¼Œè¯¥ç½‘å…³ä¸»è¦ç”¨äºå¯¹åå°å¾®æœåŠ¡è¿›è¡Œä¸€ä¸ªè°ƒç”¨æ“ä½œï¼Œå°†å¤šä¸ªå¾®æœåŠ¡ä¸²è”åˆ°ä¸€èµ·ã€‚</p>
<p>pom.xml:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;project</span> <span style="color:#008080">xmlns=</span><span style="color:#d14">&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#008080">xmlns:xsi=</span><span style="color:#d14">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#008080">xsi:schemaLocation=</span><span style="color:#d14">&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;parent&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;artifactId&gt;</span>dongyimai-gateway<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;groupId&gt;</span>com.offcn<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&lt;version&gt;</span>1.0-SNAPSHOT<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/parent&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;modelVersion&gt;</span>4.0.0<span style="color:#000080">&lt;/modelVersion&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;artifactId&gt;</span>dongyimai-gateway-web<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;description&gt;</span>
</span></span><span style="display:flex;"><span>    	æ™®é€šwebè¯·æ±‚ç½‘å…³
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;/description&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/project&gt;</span>
</span></span></code></pre></div><p>(2)å¯åŠ¨ç±»</p>
<p>åœ¨dongyimai-gateway-webä¸­åˆ›å»ºä¸€ä¸ªå¼•å¯¼ç±»com.offcn.GatewayWebApplicationï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@SpringBootApplication</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@EnableEurekaClient</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">GatewayWebApplication</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">main</span><span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>   		SpringApplication<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">run</span><span style="color:#000;font-weight:bold">(</span>GatewayWebApplication<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">,</span>args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>   <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>(3)application.ymlé…ç½®</p>
<p>åœ¨dongyimai-gateway-webçš„resourcesä¸‹åˆ›å»ºapplication.yml,ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">spring</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 	</span><span style="color:#000080">application</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 		</span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>gateway-web<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">server</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 	</span><span style="color:#000080">port</span>:<span style="color:#bbb"> </span><span style="color:#099">8001</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">eureka</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 	</span><span style="color:#000080">client</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 		</span><span style="color:#000080">service-url</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 			</span><span style="color:#000080">defaultZone</span>:<span style="color:#bbb"> </span>http://localhost:8761/eureka<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">management</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 	</span><span style="color:#000080">endpoint</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 		</span><span style="color:#000080">gateway</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 			</span><span style="color:#000080">enabled</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 	</span><span style="color:#000080">web</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 		</span><span style="color:#000080">exposure</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 			</span><span style="color:#000080">include</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">
</span></span></span></code></pre></div><h3 id="23-è·¨åŸŸé…ç½®">2.3 è·¨åŸŸé…ç½®</h3>
<p>æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ‰€æœ‰å¾®æœåŠ¡è·¨åŸŸè¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œåˆ™å¯ä»¥åœ¨gatewayä¸­è¿›è¡Œè·¨åŸŸæ”¯æŒã€‚ä¿®æ”¹application.yml,æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">spring</span>:<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">cloud</span>:<span style="color:#bbb">    
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">gateway</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">globalcors</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#000080">cors-configurations</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">&#39;[/**]&#39;</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#000080">allowCredentials</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#000080">allowedOrigins</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;*&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#000080">allowedMethods</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;*&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#000080">allowedHeaders</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;*&#34;</span><span style="color:#bbb">
</span></span></span></code></pre></div><p>æœ€ç»ˆæ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">spring</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">application</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>gateway-web<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">cloud</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">gateway</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">globalcors</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#000080">cors-configurations</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">&#39;[/**]&#39;</span>:<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">#åŒ¹é…æ‰€æœ‰è¯·æ±‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#000080">allowedOrigins</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;*&#34;</span><span style="color:#998;font-style:italic">#è·¨åŸŸå¤„ç†å…è®¸æ‰€æœ‰çš„åŸŸ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#000080">allowedMethods</span>:<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">#æ”¯æŒçš„æ–¹æ³•</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>- GET<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>- POST<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>- PUT<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>- DELETE<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">server</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 	</span><span style="color:#000080">port</span>:<span style="color:#bbb"> </span><span style="color:#099">8001</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">eureka</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 	</span><span style="color:#000080">client</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 		</span><span style="color:#000080">service-url</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 			</span><span style="color:#000080">defaultZone</span>:<span style="color:#bbb"> </span>http://localhost:8761/eureka<span style="color:#bbb">
</span></span></span></code></pre></div><h3 id="24-ç½‘å…³è¿‡æ»¤é…ç½®">2.4 ç½‘å…³è¿‡æ»¤é…ç½®</h3>
<p><img src="/posts/project-0/20220528162731/image-20220528164706189.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>è·¯ç”±è¿‡æ»¤å™¨å…è®¸ä»¥æŸç§æ–¹å¼ä¿®æ”¹ä¼ å…¥çš„HTTPè¯·æ±‚æˆ–ä¼ å‡ºçš„HTTPå“åº”ã€‚è·¯å¾„è¿‡æ»¤å™¨çš„èŒƒå›´é™å®šä¸ºç‰¹å®šè·¯å¾„ã€‚ Spring Cloud GatewayåŒ…å«è®¸å¤šå†…ç½®çš„GatewayFilterå·¥å‚ã€‚å¦‚ä¸Šå›¾ï¼Œæ ¹æ®è¯·æ±‚è·¯å¾„è·¯ç”±åˆ°ä¸åŒå¾®æœåŠ¡å»ï¼Œè¿™å—å¯ä»¥ä½¿ç”¨Gatewayçš„è·¯ç”±è¿‡æ»¤åŠŸèƒ½å®ç°ã€‚</p>
<p>è¿‡æ»¤å™¨æœ‰20 å¤šä¸ªå®ç°ç±»ï¼ŒåŒ…æ‹¬å¤´éƒ¨è¿‡æ»¤å™¨ã€è·¯å¾„ç±»è¿‡æ»¤å™¨ã€ Hystrix è¿‡æ»¤å™¨å’Œå˜æ›´è¯·æ±‚ URL çš„è¿‡æ»¤å™¨ï¼Œè¿˜æœ‰å‚æ•°å’ŒçŠ¶æ€ç ç­‰å…¶ä»–ç±»å‹çš„è¿‡æ»¤å™¨ã€‚</p>
<p>å†…ç½®çš„è¿‡æ»¤å™¨å·¥å‚æœ‰22ä¸ªå®ç°ç±»ï¼ŒåŒ…æ‹¬å¤´éƒ¨è¿‡æ»¤å™¨ã€è·¯å¾„è¿‡æ»¤å™¨ã€Hystrix è¿‡æ»¤å™¨ã€è¯·æ±‚URL å˜æ›´è¿‡æ»¤å™¨ï¼Œè¿˜æœ‰å‚æ•°å’ŒçŠ¶æ€ç ç­‰å…¶ä»–ç±»å‹çš„è¿‡æ»¤å™¨ã€‚æ ¹æ®è¿‡æ»¤å™¨å·¥å‚çš„ç”¨é€”æ¥åˆ’åˆ†ï¼Œå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼šHeaderã€Parameterã€Pathã€Bodyã€Statusã€Sessionã€Redirectã€Retryã€RateLimiterå’ŒHystrixã€‚</p>
<h4 id="241-host-è·¯ç”±">2.4.1 Host è·¯ç”±</h4>
<p>æ¯”å¦‚ç”¨æˆ·è¯·æ±‚cloud.ujiuye.comçš„æ—¶å€™ï¼Œå¯ä»¥å°†è¯·æ±‚è·¯ç”±ç»™http://localhost:9001æœåŠ¡å¤„ç†ï¼Œå¦‚ä¸‹é…ç½®ï¼š
<img src="/posts/project-0/20220528162731/image-20220528164714373.jpeg"
    
    
    
    loading="lazy"
    
    
></p>
<p>ä¸Šå›¾é…ç½®å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span>      <span style="color:#008080">routes</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#008080">-</span> <span style="color:#d14">id: dongyimai_goods_route</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">uri</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">http://localhost:9001</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">predicates</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">-</span> <span style="color:#d14">Host=cloud.ujiuye.com**</span>
</span></span></code></pre></div><p>æµ‹è¯•è¯·æ±‚<code>http://cloud.ujiuye.com:8001/brand</code>,æ•ˆæœå¦‚ä¸‹ï¼š
<img src="/posts/project-0/20220528162731/image-20220528164721375.jpeg"
    
    
    
    loading="lazy"
    
    
></p>
<p>æ³¨æ„ï¼šæ­¤æ—¶è¦æƒ³è®©cloud.ujiuye.comè®¿é—®æœ¬åœ°è®¡ç®—æœºï¼Œè¦é…ç½®<code>C:\Windows\System32\drivers\etc\hosts</code>æ–‡ä»¶,æ˜ å°„é…ç½®å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>127.0.0.1 cloud.ujiuye.com
</code></pre><h4 id="242-è·¯å¾„åŒ¹é…è¿‡æ»¤é…ç½®">2.4.2 è·¯å¾„åŒ¹é…è¿‡æ»¤é…ç½®</h4>
<p>æˆ‘ä»¬è¿˜å¯ä»¥æ ¹æ®è¯·æ±‚è·¯å¾„å®ç°å¯¹åº”çš„è·¯ç”±è¿‡æ»¤æ“ä½œï¼Œä¾‹å¦‚è¯·æ±‚ä¸­ä»¥<code>/brand/</code>è·¯å¾„å¼€å§‹çš„è¯·æ±‚ï¼Œéƒ½ç›´æ¥äº¤ç»™<code>http://localhost:9001</code>æœåŠ¡å¤„ç†ï¼Œå¦‚ä¸‹é…ç½®ï¼š
<img src="/posts/project-0/20220528162731/image-20220528164728166.jpeg"
    
    
    
    loading="lazy"
    
    
></p>
<p>ä¸Šå›¾é…ç½®å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span> <span style="color:#008080">routes</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>		<span style="color:#008080">-</span> <span style="color:#d14">id: dongyimai_goods_route</span>
</span></span><span style="display:flex;"><span> 		<span style="color:#008080">uri</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">http://localhost:9001</span>
</span></span><span style="display:flex;"><span> 		<span style="color:#008080">predicates</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>		<span style="color:#008080">-</span> <span style="color:#d14">Path=/brand**</span>
</span></span></code></pre></div><p>æµ‹è¯•è¯·æ±‚<code>http://localhost:8001/brand</code>,æ•ˆæœå¦‚ä¸‹ï¼š
<img src="/posts/project-0/20220528162731/image-20220528164736491.jpeg"
    
    
    
    loading="lazy"
    
    
></p>
<h4 id="243-prefixpath-è¿‡æ»¤é…ç½®">2.4.3 PrefixPath è¿‡æ»¤é…ç½®</h4>
<p>ç”¨æˆ·æ¯æ¬¡è¯·æ±‚è·¯å¾„çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ç»™çœŸå®è¯·æ±‚åŠ ä¸€ä¸ªç»Ÿä¸€å‰ç¼€ï¼Œä¾‹å¦‚ç”¨æˆ·è¯·æ±‚<code>http://localhost:8001</code>çš„æ—¶å€™æˆ‘ä»¬è®©å®ƒè¯·æ±‚çœŸå®åœ°å€<code>http://localhost:8001/brand</code>ï¼Œå¦‚ä¸‹é…ç½®ï¼š
<img src="/posts/project-0/20220528162731/image-20220528164743528.jpeg"
    
    
    
    loading="lazy"
    
    
></p>
<p>ä¸Šå›¾é…ç½®å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span> <span style="color:#008080">routes</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>		<span style="color:#008080">-</span> <span style="color:#d14">id: dongyimai_goods_route</span>
</span></span><span style="display:flex;"><span> 		<span style="color:#008080">uri</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">http://localhost:9001</span>
</span></span><span style="display:flex;"><span> 		<span style="color:#008080">predicates</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>		<span style="color:#998;font-style:italic">#- Host=cloud.ujiuye.com**</span>
</span></span><span style="display:flex;"><span>		<span style="color:#008080">-</span> <span style="color:#d14">Path=/**</span>
</span></span><span style="display:flex;"><span> 		<span style="color:#008080">filters</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>		<span style="color:#008080">-</span> <span style="color:#d14">PrefixPath=/brand</span>
</span></span></code></pre></div><p>æµ‹è¯•è¯·æ±‚<code>http://localhost:8001/</code>æ•ˆæœå¦‚ä¸‹ï¼š
<img src="/posts/project-0/20220528162731/image-20220528164750557.jpeg"
    
    
    
    loading="lazy"
    
    
></p>
<h4 id="244-stripprefix-è¿‡æ»¤é…ç½®">2.4.4 StripPrefix è¿‡æ»¤é…ç½®</h4>
<p>å¾ˆå¤šæ—¶å€™ä¹Ÿä¼šæœ‰è¿™ä¹ˆä¸€ç§è¯·æ±‚ï¼Œç”¨æˆ·è¯·æ±‚è·¯å¾„æ˜¯<code>/api/brand</code>,è€ŒçœŸå®è·¯å¾„æ˜¯<code>/brand</code>ï¼Œè¿™æ—¶å€™æˆ‘ä»¬éœ€è¦å»æ‰<code>/api</code>æ‰æ˜¯çœŸå®è·¯å¾„ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨StripPrefixåŠŸèƒ½æ¥å®ç°è·¯å¾„çš„è¿‡æ»¤æ“ä½œï¼Œå¦‚ä¸‹é…ç½®ï¼š
<img src="/posts/project-0/20220528162731/image-20220528164756182.jpeg"
    
    
    
    loading="lazy"
    
    
></p>
<p>ä¸Šå›¾é…ç½®å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span>     <span style="color:#008080">routes</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#008080">-</span> <span style="color:#d14">id: dongyimai_goods_route</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">uri</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">http://localhost:9001</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">predicates</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#008080">-</span> <span style="color:#d14">Path=/api/brand**</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">filters</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#008080">-</span> <span style="color:#d14">StripPrefix=1</span>
</span></span></code></pre></div><p>æµ‹è¯•è¯·æ±‚<code>http://localhost:8001/api/brand</code>,æ•ˆæœå¦‚ä¸‹ï¼š
<img src="/posts/project-0/20220528162731/image-20220528164809921.jpeg"
    
    
    
    loading="lazy"
    
    
></p>
<h4 id="245-loadbalancerclient-è·¯ç”±è¿‡æ»¤å™¨å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡">2.4.5 LoadBalancerClient è·¯ç”±è¿‡æ»¤å™¨(å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡)</h4>
<p>ä¸Šé¢çš„è·¯ç”±é…ç½®æ¯æ¬¡éƒ½ä¼šå°†è¯·æ±‚ç»™æŒ‡å®šçš„<code>URL</code>å¤„ç†ï¼Œä½†å¦‚æœåœ¨ä»¥åç”Ÿäº§ç¯å¢ƒï¼Œå¹¶å‘é‡è¾ƒå¤§çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®æœåŠ¡çš„åç§°åˆ¤æ–­æ¥åšè´Ÿè½½å‡è¡¡æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨<code>LoadBalancerClientFilter</code>æ¥å®ç°è´Ÿè½½å‡è¡¡è°ƒç”¨ã€‚<code>LoadBalancerClientFilter</code>ä¼šä½œç”¨åœ¨urlä»¥lbå¼€å¤´çš„è·¯ç”±ï¼Œç„¶ååˆ©ç”¨<code>loadBalancer</code>æ¥è·å–æœåŠ¡å®ä¾‹ï¼Œæ„é€ ç›®æ ‡<code>requestUrl</code>ï¼Œè®¾ç½®åˆ°<code>GATEWAY_REQUEST_URL_ATTR</code>å±æ€§ä¸­ï¼Œä¾›<code>NettyRoutingFilter</code>ä½¿ç”¨ã€‚</p>
<p>ä¿®æ”¹application.ymlé…ç½®æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š
<img src="/posts/project-0/20220528162731/image-20220528164816766.jpeg"
    
    
    
    loading="lazy"
    
    
></p>
<p>ä¸Šå›¾é…ç½®å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span> <span style="color:#008080">routes</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>		<span style="color:#008080">-</span> <span style="color:#d14">id: dongyimai_goods_route</span>
</span></span><span style="display:flex;"><span>			<span style="color:#998;font-style:italic">#uri: http://localhost:9001</span>
</span></span><span style="display:flex;"><span> 			<span style="color:#008080">uri</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">lb://goods</span>
</span></span><span style="display:flex;"><span> 			<span style="color:#008080">predicates</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>			<span style="color:#998;font-style:italic">#- Host=cloud.ujiuye.com**</span>
</span></span><span style="display:flex;"><span>			  <span style="color:#008080">-</span> <span style="color:#d14">Path=/**</span>
</span></span><span style="display:flex;"><span> 			<span style="color:#008080">filters</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>			<span style="color:#998;font-style:italic">#- PrefixPath=/brand</span>
</span></span><span style="display:flex;"><span>			  <span style="color:#008080">-</span> <span style="color:#d14">StripPrefix=1</span>
</span></span></code></pre></div><p>æµ‹è¯•è¯·æ±‚è·¯å¾„<code>http://localhost:8001/api/brand</code>
<img src="/posts/project-0/20220528162731/image-20220528164823400.jpeg"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="25-ç½‘å…³é™æµ">2.5 ç½‘å…³é™æµ</h3>
<p>ç½‘å…³å¯ä»¥åšå¾ˆå¤šçš„äº‹æƒ…ï¼Œæ¯”å¦‚ï¼Œé™æµï¼Œå½“æˆ‘ä»¬çš„ç³»ç»Ÿè¢«é¢‘ç¹çš„è¯·æ±‚çš„æ—¶å€™ï¼Œå°±æœ‰å¯èƒ½å°†ç³»ç»Ÿå‹å®ï¼Œæ‰€ä»¥ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦åœ¨æ¯ä¸€ä¸ªå¾®æœåŠ¡ä¸­åšé™æµæ“ä½œï¼Œä½†æ˜¯å¦‚æœæœ‰äº†ç½‘å…³ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨ç½‘å…³ç³»ç»Ÿåšé™æµï¼Œå› ä¸ºæ‰€æœ‰çš„è¯·æ±‚éƒ½éœ€è¦å…ˆé€šè¿‡ç½‘å…³ç³»ç»Ÿæ‰èƒ½è·¯ç”±åˆ°å¾®æœåŠ¡ä¸­ã€‚</p>
<h4 id="251-æ€è·¯åˆ†æ">2.5.1 æ€è·¯åˆ†æ</h4>
<p><img src="/posts/project-0/20220528162731/image-20220528164829610.png"
    
    
    
    loading="lazy"
    
    
></p>
<h4 id="252-ä»¤ç‰Œæ¡¶ç®—æ³•">2.5.2 ä»¤ç‰Œæ¡¶ç®—æ³•</h4>
<p>ä»¤ç‰Œæ¡¶ç®—æ³•æ˜¯æ¯”è¾ƒå¸¸è§çš„é™æµç®—æ³•ä¹‹ä¸€ï¼Œå¤§æ¦‚æè¿°å¦‚ä¸‹ï¼š
1ï¼‰æ‰€æœ‰çš„è¯·æ±‚åœ¨å¤„ç†ä¹‹å‰éƒ½éœ€è¦æ‹¿åˆ°ä¸€ä¸ªå¯ç”¨çš„ä»¤ç‰Œæ‰ä¼šè¢«å¤„ç†ï¼›
2ï¼‰æ ¹æ®é™æµå¤§å°ï¼Œè®¾ç½®æŒ‰ç…§ä¸€å®šçš„é€Ÿç‡å¾€æ¡¶é‡Œæ·»åŠ ä»¤ç‰Œï¼›
3ï¼‰æ¡¶è®¾ç½®æœ€å¤§çš„æ”¾ç½®ä»¤ç‰Œé™åˆ¶ï¼Œå½“æ¡¶æ»¡æ—¶ã€æ–°æ·»åŠ çš„ä»¤ç‰Œå°±è¢«ä¸¢å¼ƒæˆ–è€…æ‹’ç»ï¼›
4ï¼‰è¯·æ±‚è¾¾åˆ°åé¦–å…ˆè¦è·å–ä»¤ç‰Œæ¡¶ä¸­çš„ä»¤ç‰Œï¼Œæ‹¿ç€ä»¤ç‰Œæ‰å¯ä»¥è¿›è¡Œå…¶ä»–çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¤„ç†å®Œä¸šåŠ¡é€»è¾‘ä¹‹åï¼Œå°†ä»¤ç‰Œç›´æ¥åˆ é™¤ï¼›
5ï¼‰ä»¤ç‰Œæ¡¶æœ‰æœ€ä½é™é¢ï¼Œå½“æ¡¶ä¸­çš„ä»¤ç‰Œè¾¾åˆ°æœ€ä½é™é¢çš„æ—¶å€™ï¼Œè¯·æ±‚å¤„ç†å®Œä¹‹åå°†ä¸ä¼šåˆ é™¤ä»¤ç‰Œï¼Œä»¥æ­¤ä¿è¯è¶³å¤Ÿçš„é™æµ</p>
<p>å¦‚ä¸‹å›¾ï¼š
<img src="/posts/project-0/20220528162731/image-20220528164835622.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>è¿™ä¸ªç®—æ³•çš„å®ç°ï¼Œæœ‰å¾ˆå¤šæŠ€æœ¯ï¼ŒGuauaæ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œrediså®¢æˆ·ç«¯ä¹Ÿæœ‰å…¶å®ç°ã€‚</p>
<h4 id="253-ä½¿ç”¨ä»¤ç‰Œæ¡¶è¿›è¡Œè¯·æ±‚æ¬¡æ•°é™æµ">2.5.3 ä½¿ç”¨ä»¤ç‰Œæ¡¶è¿›è¡Œè¯·æ±‚æ¬¡æ•°é™æµ</h4>
<p>spring cloud gateway é»˜è®¤ä½¿ç”¨redisçš„RateLimteré™æµç®—æ³•æ¥å®ç°ã€‚æ‰€ä»¥æˆ‘ä»¬è¦ä½¿ç”¨é¦–å…ˆéœ€è¦å¼•å…¥redisçš„ä¾èµ–</p>
<p>(1)å¼•å…¥redisä¾èµ–</p>
<p>åœ¨dongyimai-gatewayçš„pom.xmlä¸­å¼•å…¥redisçš„ä¾èµ–</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--redis--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>  	<span style="color:#000080">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>  	<span style="color:#000080">&lt;artifactId&gt;</span>spring-boot-starter-data-redis-reactive<span style="color:#000080">&lt;/artifactId&gt;</span>  	
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>(2)å®šä¹‰KeyResolver</p>
<p>åœ¨Applicatioinå¼•å¯¼ç±»ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼ŒKeyResolverç”¨äºè®¡ç®—æŸä¸€ä¸ªç±»å‹çš„é™æµçš„KEYä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥é€šè¿‡KeyResolveræ¥æŒ‡å®šé™æµçš„Keyã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æ ¹æ®IPæ¥é™æµï¼Œæ¯”å¦‚æ¯ä¸ªIPæ¯ç§’é’Ÿåªèƒ½è¯·æ±‚ä¸€æ¬¡ï¼Œåœ¨GatewayWebApplicationå®šä¹‰keyçš„è·å–ï¼Œè·å–å®¢æˆ·ç«¯IPï¼Œå°†IPä½œä¸ºkeyï¼Œå¦‚ä¸‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">* IPé™æµ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*@return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Bean</span><span style="color:#000;font-weight:bold">(</span>name<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;ipKeyResolver&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> KeyResolver <span style="color:#900;font-weight:bold">userKeyResolver</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">new</span> KeyResolver<span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>		<span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span> 		<span style="color:#000;font-weight:bold">public</span> Mono<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">resolve</span><span style="color:#000;font-weight:bold">(</span>ServerWebExchange exchange<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>      <span style="color:#998;font-style:italic">//è·å–è¿œç¨‹å®¢æˆ·ç«¯IP
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>      String hostName <span style="color:#000;font-weight:bold">=</span> exchange<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getRequest</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">getRemoteAddress</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">getAddress</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">getHostAddress</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>      System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;hostName:&#34;</span><span style="color:#000;font-weight:bold">+</span>hostName<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">return</span> Mono<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">just</span><span style="color:#000;font-weight:bold">(</span>hostName<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>(3)ä¿®æ”¹application.ymlä¸­é…ç½®é¡¹ï¼ŒæŒ‡å®šé™åˆ¶æµé‡çš„é…ç½®ä»¥åŠREDISçš„é…ç½®ï¼Œå¦‚å›¾</p>
<p>ä¿®æ”¹å¦‚ä¸‹å›¾ï¼š
<img src="/posts/project-0/20220528162731/image-20220528164842878.jpeg"
    
    
    
    loading="lazy"
    
    
></p>
<p>é…ç½®ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">spring</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">cloud</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">gateway</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">globalcors</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#000080">cors-configurations</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">&#39;[/**]&#39;</span>:<span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># åŒ¹é…æ‰€æœ‰è¯·æ±‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#000080">allowedOrigins</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;*&#34;</span><span style="color:#bbb"> </span><span style="color:#998;font-style:italic">#è·¨åŸŸå¤„ç† å…è®¸æ‰€æœ‰çš„åŸŸ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#000080">allowedMethods</span>:<span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># æ”¯æŒçš„æ–¹æ³•</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>- GET<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>- POST<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>- PUT<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>- DELETE<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">routes</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>- <span style="color:#000080">id</span>:<span style="color:#bbb"> </span>dongyimai_goods_route<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">uri</span>:<span style="color:#bbb"> </span>lb://DYM-SELLERGOODS<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">predicates</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#998;font-style:italic"># - Host=cloud.ujiuye.com**</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- Path=/api/album/**,/api/brand/**<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#000080">filters</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span>- StripPrefix=1<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>RequestRateLimiter<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">#è¯·æ±‚æ•°é™æµ åå­—ä¸èƒ½éšä¾¿å†™ ï¼Œä½¿ç”¨é»˜è®¤çš„facatory</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#000080">args</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span><span style="color:#000080">key-resolver</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;#{@ipKeyResolver}&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span><span style="color:#000080">redis-rate-limiter.replenishRate</span>:<span style="color:#bbb"> </span><span style="color:#099">1</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span><span style="color:#000080">redis-rate-limiter.burstCapacity</span>:<span style="color:#bbb"> </span><span style="color:#099">1</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#000080">application</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>gateway-web<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#998;font-style:italic">#Redisé…ç½®</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">redis</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">   </span><span style="color:#000080">host</span>:<span style="color:#bbb"> </span><span style="color:#099">192.168.188.129</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">   </span><span style="color:#000080">port</span>:<span style="color:#bbb"> </span><span style="color:#099">6379</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">server</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">port</span>:<span style="color:#bbb"> </span><span style="color:#099">8001</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">eureka</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">client</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">service-url</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">defaultZone</span>:<span style="color:#bbb"> </span>http://localhost:8761/eureka<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">instance</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">lease-renewal-interval-in-seconds</span>:<span style="color:#bbb"> </span><span style="color:#099">5</span><span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># æ¯éš”5ç§’å‘é€ä¸€æ¬¡å¿ƒè·³</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">lease-expiration-duration-in-seconds</span>:<span style="color:#bbb"> </span><span style="color:#099">10</span><span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># 10ç§’ä¸å‘é€å°±è¿‡æœŸ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">prefer-ip-address</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">ip-address</span>:<span style="color:#bbb"> </span><span style="color:#099">127.0.0.1</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">instance-id</span>:<span style="color:#bbb"> </span>${spring.application.name}:${server.port}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">management</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">endpoint</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">gateway</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">enabled</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">web</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">exposure</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#000080">include</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">
</span></span></span></code></pre></div><p>è§£é‡Šï¼š</p>
<p><code>redis-rate-limiter.replenishRate</code>æ˜¯æ‚¨å¸Œæœ›å…è®¸ç”¨æˆ·æ¯ç§’æ‰§è¡Œå¤šå°‘è¯·æ±‚ï¼Œè€Œä¸ä¼šä¸¢å¼ƒä»»ä½•è¯·æ±‚ã€‚è¿™æ˜¯ä»¤ç‰Œæ¡¶å¡«å……çš„é€Ÿç‡</p>
<p><code>redis-rate-limiter.burstCapacity</code>æ˜¯æŒ‡ä»¤ç‰Œæ¡¶çš„å®¹é‡ï¼Œå…è®¸åœ¨ä¸€ç§’é’Ÿå†…å®Œæˆçš„æœ€å¤§è¯·æ±‚æ•°,å°†æ­¤å€¼è®¾ç½®ä¸ºé›¶å°†é˜»æ­¢æ‰€æœ‰è¯·æ±‚ã€‚</p>
<p>key-resolver: &ldquo;#{@ipKeyResolver}&ldquo;ç”¨äºé€šè¿‡SPELè¡¨è¾¾å¼æ¥æŒ‡å®šä½¿ç”¨å“ªä¸€ä¸ªKeyResolver.</p>
<p>å¦‚ä¸Šé…ç½®ï¼š</p>
<p>è¡¨ç¤ºä¸€ç§’å†…ï¼Œå…è®¸ä¸€ä¸ªè¯·æ±‚é€šè¿‡ï¼Œä»¤ç‰Œæ¡¶çš„å¡«å……é€Ÿç‡ä¹Ÿæ˜¯ä¸€ç§’é’Ÿæ·»åŠ ä¸€ä¸ªä»¤ç‰Œã€‚</p>
<p>æœ€å¤§çªå‘çŠ¶å†µä¹Ÿåªå…è®¸ä¸€ç§’å†…æœ‰ä¸€æ¬¡è¯·æ±‚ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡æ¥è°ƒæ•´ã€‚</p>
<h2 id="3-ç”¨æˆ·ç™»å½•">3 ç”¨æˆ·ç™»å½•</h2>
<p>é¡¹ç›®ä¸­æœ‰2ä¸ªé‡è¦è§’è‰²ï¼Œåˆ†åˆ«ä¸ºç®¡ç†å‘˜å’Œç”¨æˆ·ï¼Œä¸‹é¢å‡ ç« æˆ‘ä»¬å°†å®ç°è´­ç‰©ä¸‹å•å’Œæ”¯ä»˜ï¼Œç”¨æˆ·å¦‚æœæ²¡ç™»å½•æ˜¯æ²¡æ³•ä¸‹å•å’Œæ”¯ä»˜çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œéœ€è¦å®ç°ä¸€ä¸ªç™»å½•åŠŸèƒ½ã€‚</p>
<h3 id="31-è¡¨ç»“æ„ä»‹ç»">3.1 è¡¨ç»“æ„ä»‹ç»</h3>
<p>tb_userè¡¨ç»“æ„å¦‚ä¸‹ï¼š
<img src="/posts/project-0/20220528162731/image-20220528164851330.jpeg"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="32-ç™»å½•">3.2 ç™»å½•</h3>
<p>ç™»å½•çš„æ—¶å€™ï¼Œéœ€è¦è¿›è¡Œå¯†ç æ ¡éªŒï¼Œè¿™é‡Œé‡‡ç”¨äº†BCryptPasswordEncoderè¿›è¡ŒåŠ å¯†ï¼Œéœ€è¦å°†èµ„æ–™ä¸­çš„BCryptå¯¼å…¥åˆ°commonå·¥ç¨‹ä¸­ï¼Œå…¶ä¸­BCrypt.checkpw(&ldquo;æ˜æ–‡&rdquo;,&ldquo;å¯†æ–‡&rdquo;)ç”¨äºå¯¹æ¯”å¯†ç æ˜¯å¦ä¸€è‡´ã€‚</p>
<p>ä¿®æ”¹dongyimai-service-userçš„com.offcn.user.service.UserServiceæ·»åŠ æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>User <span style="color:#900;font-weight:bold">findByUsername</span><span style="color:#000;font-weight:bold">(</span>String username<span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><p>ä¿®æ”¹æœåŠ¡å®ç°ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> User <span style="color:#900;font-weight:bold">findByUsername</span><span style="color:#000;font-weight:bold">(</span>String username<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>       User user <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> User<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        user<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setUsername</span><span style="color:#000;font-weight:bold">(</span>username<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        List<span style="color:#000;font-weight:bold">&lt;</span>User<span style="color:#000;font-weight:bold">&gt;</span> userList <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findList</span><span style="color:#000;font-weight:bold">(</span>user<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>userList<span style="color:#000;font-weight:bold">!=</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">&amp;&amp;</span>userList<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">size</span><span style="color:#000;font-weight:bold">()&gt;</span>0<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> userList<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span>0<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>ä¿®æ”¹dongyimai-service-userçš„com.offcn.user.controller.UserControlleræ·»åŠ ç™»å½•æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*ç”¨æˆ·ç™»å½•
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RequestMapping</span><span style="color:#000;font-weight:bold">(</span>value <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;/login&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> Result <span style="color:#900;font-weight:bold">login</span><span style="color:#000;font-weight:bold">(</span>String username<span style="color:#000;font-weight:bold">,</span>String password<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>	<span style="color:#998;font-style:italic">//æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span> 	User user <span style="color:#000;font-weight:bold">=</span>  userService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findByUsername</span><span style="color:#000;font-weight:bold">(</span>username<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> 	<span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>user<span style="color:#000;font-weight:bold">!=</span><span style="color:#000;font-weight:bold">null</span> <span style="color:#000;font-weight:bold">&amp;&amp;</span> BCrypt<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">checkpw</span><span style="color:#000;font-weight:bold">(</span>password<span style="color:#000;font-weight:bold">,</span>user<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getPassword</span><span style="color:#000;font-weight:bold">())){</span>
</span></span><span style="display:flex;"><span> 		<span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">new</span> Result<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span>StatusCode<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">OK</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;ç™»å½•æˆåŠŸï¼&#34;</span><span style="color:#000;font-weight:bold">,</span>user<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span> 	<span style="color:#000;font-weight:bold">return</span>  <span style="color:#000;font-weight:bold">new</span> Result<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">,</span>StatusCode<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">LOGINERROR</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;è´¦å·æˆ–è€…å¯†ç é”™è¯¯ï¼&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>æ³¨æ„ï¼šè¿™é‡Œå¯†ç è¿›è¡Œäº†åŠ å¯†ï¼Œä½¿ç”¨BCrypt.checkpwæ¯”å¯¹å¯†ç ã€‚</p>
<p><a class="link" href="/posts/project-0///%e6%a0%b9%e6%8d%ae%e7%99%bb%e5%bd%95%e7%94%a8%e6%88%b7%e5%90%8d%e8%8e%b7%e5%8f%96%e7%94%a8%e6%88%b7%e4%bf%a1%e6%81%af" ></a></p>
<p>ä½¿ç”¨Postmanæµ‹è¯•å¦‚ä¸‹ï¼š
<img src="/posts/project-0/20220528162731/image-20220528164859911.jpeg"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="34-ç½‘å…³å…³è”">3.4 ç½‘å…³å…³è”</h3>
<p><img src="/posts/project-0/20220528162731/image-20220528164906758.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>åœ¨æˆ‘ä»¬å¹³æ—¶å·¥ä½œä¸­ï¼Œå¹¶ä¸ä¼šç›´æ¥å°†å¾®æœåŠ¡æš´éœ²å‡ºå»ï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨ç½‘å…³å¯¹æ¥ï¼Œå®ç°å¯¹å¾®æœåŠ¡çš„ä¸€ä¸ªä¿æŠ¤ä½œç”¨ï¼Œå¦‚ä¸Šå›¾ï¼Œå½“ç”¨æˆ·è®¿é—®<code>/api/user/</code>çš„æ—¶å€™æˆ‘ä»¬å†æ ¹æ®ç”¨æˆ·è¯·æ±‚è°ƒç”¨ç”¨æˆ·å¾®æœåŠ¡çš„æŒ‡å®šæ–¹æ³•ã€‚å½“ç„¶ï¼Œé™¤äº†<code>/api/user/</code>è¿˜æœ‰<code>/api/address/</code>ã€<code>/api/areas/</code>ã€<code>/api/cities/</code>ã€<code>/api/provinces/</code>éƒ½éœ€è¦ç”±userå¾®æœåŠ¡å¤„ç†ï¼Œä¿®æ”¹ç½‘å…³å·¥ç¨‹<code>dongyimai-gateway-web</code>çš„application.ymlé…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹ä»£ç ï¼š
<img src="/posts/project-0/20220528162731/image-20220528164912299.jpeg"
    
    
    
    loading="lazy"
    
    
></p>
<p>ä¸Šå›¾ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#008080">spring</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span> 	<span style="color:#008080">cloud</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span> 		<span style="color:#008080">gateway</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span> 			<span style="color:#008080">globalcors</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span> 				<span style="color:#008080">cors-configurations</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>					<span style="color:#008080">&#39;[/**]&#39;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">#åŒ¹é…æ‰€æœ‰è¯·æ±‚</span>
</span></span><span style="display:flex;"><span>           <span style="color:#008080">allowedOrigins</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;*&#34;#è·¨åŸŸå¤„ç†å…è®¸æ‰€æœ‰çš„åŸŸ</span>
</span></span><span style="display:flex;"><span>           <span style="color:#008080">allowedMethods</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">#æ”¯æŒçš„æ–¹æ³•</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">-</span> <span style="color:#d14">GET</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">-</span> <span style="color:#d14">POST</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">-</span> <span style="color:#d14">PUT</span>
</span></span><span style="display:flex;"><span>          <span style="color:#008080">-</span> <span style="color:#d14">DELETE</span>
</span></span><span style="display:flex;"><span> <span style="color:#008080">routes</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>		<span style="color:#008080">-</span> <span style="color:#d14">id: dongyimai_goods_route</span>
</span></span><span style="display:flex;"><span> 		<span style="color:#008080">uri</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">lb://DYM-SELLERGOODS</span>
</span></span><span style="display:flex;"><span> 		<span style="color:#008080">predicates</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">#- Host=cloud.ujiuye.com**</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">-</span> <span style="color:#d14">Path=/api/brand**</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">filters</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">-</span> <span style="color:#d14">StripPrefix=1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">-</span> <span style="color:#d14">name: RequestRateLimiter #è¯·æ±‚æ•°é™æµåå­—ä¸èƒ½éšä¾¿å†™ï¼Œä½¿ç”¨é»˜è®¤çš„facatory</span>
</span></span><span style="display:flex;"><span>    		<span style="color:#008080">args</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>           <span style="color:#008080">key-resolver</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">&#34;#{@ipKeyResolver}&#34;</span>
</span></span><span style="display:flex;"><span>           <span style="color:#008080">redis-rate-limiter.replenishRate</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">1</span>
</span></span><span style="display:flex;"><span>           <span style="color:#008080">redis-rate-limiter.burstCapacity</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">1</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#ç”¨æˆ·å¾®æœåŠ¡</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">-</span> <span style="color:#d14">id: dongyimai_user_route</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">uri</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">lb://DYM-USER</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">predicates</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    	<span style="color:#008080">-</span> <span style="color:#d14">Path=/api/user/**,/api/address/**,/api/areas/**,/api/cities/**,/api/provinces/**</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008080">filters</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    	<span style="color:#008080">-</span> <span style="color:#d14">StripPrefix=1</span>
</span></span><span style="display:flex;"><span> <span style="color:#008080">application</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>     <span style="color:#008080">name</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">gateway-web</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#Redisé…ç½®</span>
</span></span><span style="display:flex;"><span> <span style="color:#008080">redis</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span> 		<span style="color:#008080">host</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">192.168.188.129</span>
</span></span><span style="display:flex;"><span> 		<span style="color:#008080">port</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">6379</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#008080">server</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span> 	<span style="color:#008080">port</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">8001</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">eureka</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span> 	<span style="color:#008080">client</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span> 		<span style="color:#008080">service-url</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span> 			<span style="color:#008080">defaultZone</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">http://localhost:8761/eureka</span>
</span></span><span style="display:flex;"><span> 	<span style="color:#008080">instance</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span> 		<span style="color:#008080">prefer-ip-address</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">true</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">management</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span> 	<span style="color:#008080">endpoint</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span> 		<span style="color:#008080">gateway</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span> 			<span style="color:#008080">enabled</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">true</span>
</span></span><span style="display:flex;"><span> 	<span style="color:#008080">web</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span> 		<span style="color:#008080">exposure</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span> 			<span style="color:#008080">include</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#d14">true</span>
</span></span></code></pre></div><p>ä½¿ç”¨Postmanè®¿é—®[<code>http://localhost:8001/api/user/login](//æ ¹æ®ç™»å½•ç”¨æˆ·åè·å–ç”¨æˆ·ä¿¡æ¯)?username=dongyimai&amp;password=dongyimai</code>ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š
<img src="/posts/project-0/20220528162731/image-20220528164920110.jpeg"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="4-jwtè®²è§£">4 JWTè®²è§£</h2>
<h3 id="41-éœ€æ±‚åˆ†æ">4.1 éœ€æ±‚åˆ†æ</h3>
<p>æˆ‘ä»¬ä¹‹å‰å·²ç»æ­å»ºè¿‡äº†ç½‘å…³ï¼Œä½¿ç”¨ç½‘å…³åœ¨ç½‘å…³ç³»ç»Ÿä¸­æ¯”è¾ƒé€‚åˆè¿›è¡Œæƒé™æ ¡éªŒã€‚
<img src="/posts/project-0/20220528162731/image-20220528164927029.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é‡‡ç”¨JWTçš„æ–¹å¼æ¥å®ç°é‰´æƒæ ¡éªŒã€‚</p>
<h3 id="42-ä»€ä¹ˆæ˜¯jwt">4.2 ä»€ä¹ˆæ˜¯JWT</h3>
<p>JSON Web Tokenï¼ˆJWTï¼‰æ˜¯ä¸€ä¸ªéå¸¸è½»å·§çš„è§„èŒƒã€‚è¿™ä¸ªè§„èŒƒå…è®¸æˆ‘ä»¬ä½¿ç”¨JWTåœ¨ç”¨æˆ·å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ é€’å®‰å…¨å¯é çš„ä¿¡æ¯ã€‚</p>
<h3 id="43-jwtçš„æ„æˆ">4.3 JWTçš„æ„æˆ</h3>
<p>ä¸€ä¸ªJWTå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œå¤´éƒ¨ã€è½½è·ä¸ç­¾åã€‚</p>
<p><strong>å¤´éƒ¨ï¼ˆHeaderï¼‰</strong></p>
<p>å¤´éƒ¨ç”¨äºæè¿°å…³äºè¯¥JWTçš„æœ€åŸºæœ¬çš„ä¿¡æ¯ï¼Œä¾‹å¦‚å…¶ç±»å‹ä»¥åŠç­¾åæ‰€ç”¨çš„ç®—æ³•ç­‰ã€‚è¿™ä¹Ÿå¯ä»¥è¢«è¡¨ç¤ºæˆä¸€ä¸ªJSONå¯¹è±¡ã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{<span style="color:#000080">&#34;typ&#34;</span>:<span style="color:#d14">&#34;JWT&#34;</span>,<span style="color:#000080">&#34;alg&#34;</span>:<span style="color:#d14">&#34;HS256&#34;</span>}
</span></span></code></pre></div><p>åœ¨å¤´éƒ¨æŒ‡æ˜äº†ç­¾åç®—æ³•æ˜¯HS256ç®—æ³•ã€‚æˆ‘ä»¬è¿›è¡ŒBASE64ç¼–ç https://base64.us/ï¼Œç¼–ç åçš„å­—ç¬¦ä¸²å¦‚ä¸‹ï¼š</p>
<pre tabindex="0"><code>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9
</code></pre><blockquote>
<p>å°çŸ¥è¯†ï¼šBase64æ˜¯ä¸€ç§åŸºäº64ä¸ªå¯æ‰“å°å­—ç¬¦æ¥è¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®çš„è¡¨ç¤ºæ–¹æ³•ã€‚ç”±äº2çš„6æ¬¡æ–¹ç­‰äº64ï¼Œæ‰€ä»¥æ¯6ä¸ªæ¯”ç‰¹ä¸ºä¸€ä¸ªå•å…ƒï¼Œå¯¹åº”æŸä¸ªå¯æ‰“å°å­—ç¬¦ã€‚ä¸‰ä¸ªå­—èŠ‚æœ‰24ä¸ªæ¯”ç‰¹ï¼Œå¯¹åº”äº4ä¸ªBase64å•å…ƒï¼Œå³3ä¸ªå­—èŠ‚éœ€è¦ç”¨4ä¸ªå¯æ‰“å°å­—ç¬¦æ¥è¡¨ç¤ºã€‚JDK ä¸­æä¾›äº†éå¸¸æ–¹ä¾¿çš„Â <strong>BASE64Encoder</strong>Â å’ŒÂ <strong>BASE64Decoder</strong>ï¼Œç”¨å®ƒä»¬å¯ä»¥éå¸¸æ–¹ä¾¿çš„å®ŒæˆåŸºäº BASE64 çš„ç¼–ç å’Œè§£ç </p>
</blockquote>
<p><strong>è½½è·ï¼ˆplayloadï¼‰</strong></p>
<p>è½½è·å°±æ˜¯å­˜æ”¾æœ‰æ•ˆä¿¡æ¯çš„åœ°æ–¹ã€‚è¿™ä¸ªåå­—åƒæ˜¯ç‰¹æŒ‡é£æœºä¸Šæ‰¿è½½çš„è´§å“ï¼Œè¿™äº›æœ‰æ•ˆä¿¡æ¯åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†</p>
<p>ï¼ˆ1ï¼‰æ ‡å‡†ä¸­æ³¨å†Œçš„å£°æ˜ï¼ˆå»ºè®®ä½†ä¸å¼ºåˆ¶ä½¿ç”¨ï¼‰</p>
<pre tabindex="0"><code>iss: jwtç­¾å‘è€…
sub: jwtæ‰€é¢å‘çš„ç”¨æˆ·
aud: æ¥æ”¶jwtçš„ä¸€æ–¹
exp: jwtçš„è¿‡æœŸæ—¶é—´ï¼Œè¿™ä¸ªè¿‡æœŸæ—¶é—´å¿…é¡»è¦å¤§äºç­¾å‘æ—¶é—´
nbf: å®šä¹‰åœ¨ä»€ä¹ˆæ—¶é—´ä¹‹å‰ï¼Œè¯¥jwtéƒ½æ˜¯ä¸å¯ç”¨çš„.
iat: jwtçš„ç­¾å‘æ—¶é—´
jti: jwtçš„å”¯ä¸€èº«ä»½æ ‡è¯†ï¼Œä¸»è¦ç”¨æ¥ä½œä¸ºä¸€æ¬¡æ€§token,ä»è€Œå›é¿é‡æ”¾æ”»å‡»ã€‚
</code></pre><p>ï¼ˆ2ï¼‰å…¬å…±çš„å£°æ˜</p>
<p>å…¬å…±çš„å£°æ˜å¯ä»¥æ·»åŠ ä»»ä½•çš„ä¿¡æ¯ï¼Œä¸€èˆ¬æ·»åŠ ç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯æˆ–å…¶ä»–ä¸šåŠ¡éœ€è¦çš„å¿…è¦ä¿¡æ¯.ä½†ä¸å»ºè®®æ·»åŠ æ•æ„Ÿä¿¡æ¯ï¼Œå› ä¸ºè¯¥éƒ¨åˆ†åœ¨å®¢æˆ·ç«¯å¯è§£å¯†.</p>
<p>ï¼ˆ3ï¼‰ç§æœ‰çš„å£°æ˜</p>
<p>ç§æœ‰å£°æ˜æ˜¯æä¾›è€…å’Œæ¶ˆè´¹è€…æ‰€å…±åŒå®šä¹‰çš„å£°æ˜ï¼Œä¸€èˆ¬ä¸å»ºè®®å­˜æ”¾æ•æ„Ÿä¿¡æ¯ï¼Œå› ä¸ºbase64æ˜¯å¯¹ç§°è§£å¯†çš„ï¼Œæ„å‘³ç€è¯¥éƒ¨åˆ†ä¿¡æ¯å¯ä»¥å½’ç±»ä¸ºæ˜æ–‡ä¿¡æ¯ã€‚</p>
<p>è¿™ä¸ªæŒ‡çš„å°±æ˜¯è‡ªå®šä¹‰çš„claimã€‚æ¯”å¦‚ä¸‹é¢é¢ç»“æ„ä¸¾ä¾‹ä¸­çš„adminå’Œnameéƒ½å±äºè‡ªå®šçš„claimã€‚è¿™äº›claimè·ŸJWTæ ‡å‡†è§„å®šçš„claimåŒºåˆ«åœ¨äºï¼šJWTè§„å®šçš„claimï¼ŒJWTçš„æ¥æ”¶æ–¹åœ¨æ‹¿åˆ°JWTä¹‹åï¼Œéƒ½çŸ¥é“æ€ä¹ˆå¯¹è¿™äº›æ ‡å‡†çš„claimè¿›è¡ŒéªŒè¯(è¿˜ä¸çŸ¥é“æ˜¯å¦èƒ½å¤ŸéªŒè¯)ï¼›è€Œprivate claimsä¸ä¼šéªŒè¯ï¼Œé™¤éæ˜ç¡®å‘Šè¯‰æ¥æ”¶æ–¹è¦å¯¹è¿™äº›claimè¿›è¡ŒéªŒè¯ä»¥åŠè§„åˆ™æ‰è¡Œã€‚</p>
<p>å®šä¹‰ä¸€ä¸ªpayload:</p>
<pre tabindex="0"><code>{&#34;sub&#34;:&#34;1234567890&#34;,&#34;name&#34;:&#34;John Doe&#34;,&#34;admin&#34;:true}
</code></pre><p>ç„¶åå°†å…¶è¿›è¡Œbase64åŠ å¯†ï¼Œå¾—åˆ°Jwtçš„ç¬¬äºŒéƒ¨åˆ†ã€‚</p>
<pre tabindex="0"><code>eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9
</code></pre><p><strong>ç­¾è¯ï¼ˆsignatureï¼‰</strong></p>
<p>jwtçš„ç¬¬ä¸‰éƒ¨åˆ†æ˜¯ä¸€ä¸ªç­¾è¯ä¿¡æ¯ï¼Œè¿™ä¸ªç­¾è¯ä¿¡æ¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p>
<blockquote>
<p>header (base64åçš„)</p>
<p>payload (base64åçš„)</p>
<p>secret</p>
</blockquote>
<p>è¿™ä¸ªéƒ¨åˆ†éœ€è¦base64åŠ å¯†åçš„headerå’Œbase64åŠ å¯†åçš„payloadä½¿ç”¨.è¿æ¥ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œç„¶åé€šè¿‡headerä¸­å£°æ˜çš„åŠ å¯†æ–¹å¼è¿›è¡ŒåŠ ç›secretç»„åˆåŠ å¯†ï¼Œç„¶åå°±æ„æˆäº†jwtçš„ç¬¬ä¸‰éƒ¨åˆ†ã€‚</p>
<pre tabindex="0"><code>TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ
</code></pre><p>å°†è¿™ä¸‰éƒ¨åˆ†ç”¨.è¿æ¥æˆä¸€ä¸ªå®Œæ•´çš„å­—ç¬¦ä¸²,æ„æˆäº†æœ€ç»ˆçš„jwt:</p>
<pre tabindex="0"><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ
</code></pre><p><strong>æ³¨æ„</strong>ï¼šsecretæ˜¯ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯çš„ï¼Œjwtçš„ç­¾å‘ç”Ÿæˆä¹Ÿæ˜¯åœ¨æœåŠ¡å™¨ç«¯çš„ï¼Œsecretå°±æ˜¯ç”¨æ¥è¿›è¡Œjwtçš„ç­¾å‘å’Œjwtçš„éªŒè¯ï¼Œæ‰€ä»¥ï¼Œå®ƒå°±æ˜¯ä½ æœåŠ¡ç«¯çš„ç§é’¥ï¼Œåœ¨ä»»ä½•åœºæ™¯éƒ½ä¸åº”è¯¥æµéœ²å‡ºå»ã€‚ä¸€æ—¦å®¢æˆ·ç«¯å¾—çŸ¥è¿™ä¸ªsecret,é‚£å°±æ„å‘³ç€å®¢æˆ·ç«¯æ˜¯å¯ä»¥è‡ªæˆ‘ç­¾å‘jwtäº†ã€‚</p>
<h3 id="44-jjwtçš„ä»‹ç»å’Œä½¿ç”¨">4.4 JJWTçš„ä»‹ç»å’Œä½¿ç”¨</h3>
<p>JJWTæ˜¯ä¸€ä¸ªæä¾›ç«¯åˆ°ç«¯çš„JWTåˆ›å»ºå’ŒéªŒè¯çš„Javaåº“ã€‚æ°¸è¿œå…è´¹å’Œå¼€æº(Apache Licenseï¼Œç‰ˆæœ¬2.0)ï¼ŒJJWTå¾ˆå®¹æ˜“ä½¿ç”¨å’Œç†è§£ã€‚å®ƒè¢«è®¾è®¡æˆä¸€ä¸ªä»¥å»ºç­‘ä¸ºä¸­å¿ƒçš„æµç•…ç•Œé¢ï¼Œéšè—äº†å®ƒçš„å¤§éƒ¨åˆ†å¤æ‚æ€§ã€‚</p>
<p>å®˜æ–¹æ–‡æ¡£ï¼š</p>
<p><a class="link" href="/posts/project-0/https://github.com/jwtk/jjwt"  target="_blank" rel="noopener"
    >https://github.com/jwtk/jjwt</a></p>
<h4 id="441-åˆ›å»ºtoken">4.4.1 åˆ›å»ºTOKEN</h4>
<p>(1)ä¾èµ–å¼•å…¥</p>
<p>åœ¨dongyimai-parenté¡¹ç›®ä¸­çš„pom.xmlä¸­æ·»åŠ ä¾èµ–ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--é‰´æƒ--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;groupId&gt;</span>io.jsonwebtoken<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;artifactId&gt;</span>jjwt<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;version&gt;</span>0.9.0<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>(2)åˆ›å»ºæµ‹è¯•</p>
<p>åœ¨dongyimai-commonçš„/test/javaä¸‹åˆ›å»ºæµ‹è¯•ç±»ï¼Œå¹¶è®¾ç½®æµ‹è¯•æ–¹æ³•</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">JwtTest</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">/****
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*åˆ›å»ºJwtä»¤ç‰Œ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*/</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testCreateJwt</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>       	JwtBuilder builder<span style="color:#000;font-weight:bold">=</span> Jwts<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">builder</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>      	<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setId</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;888&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#998;font-style:italic">//è®¾ç½®å”¯ä¸€ç¼–å·
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>      	<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setSubject</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;å°ç™½&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#998;font-style:italic">//è®¾ç½®ä¸»é¢˜å¯ä»¥æ˜¯JSONæ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>      	<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setIssuedAt</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> Date<span style="color:#000;font-weight:bold">())</span><span style="color:#998;font-style:italic">//è®¾ç½®ç­¾å‘æ—¥æœŸ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>      	<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">signWith</span><span style="color:#000;font-weight:bold">(</span>SignatureAlgorithm<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">HS256</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;ujiuye&#34;</span><span style="color:#000;font-weight:bold">);</span><span style="color:#998;font-style:italic">//è®¾ç½®ç­¾åä½¿ç”¨HS256ç®—æ³•ï¼Œå¹¶è®¾ç½®SecretKey(å­—ç¬¦ä¸²)
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>      	<span style="color:#998;font-style:italic">//æ„å»ºå¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>       	System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span> builder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">compact</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>è¿è¡Œæ‰“å°ç»“æœï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI4ODgiLCJzdWIiOiLlsI_nmb0iLCJpYXQiOjE2MTI3ODk0MjN9.adpNtewLbNZ-r6WUr8fyRLxFj1KF6PPP2UQq_VOxICo</span>
</span></span></code></pre></div><p>å†æ¬¡è¿è¡Œï¼Œä¼šå‘ç°æ¯æ¬¡è¿è¡Œçš„ç»“æœæ˜¯ä¸ä¸€æ ·çš„ï¼Œå› ä¸ºæˆ‘ä»¬çš„è½½è·ä¸­åŒ…å«äº†æ—¶é—´ã€‚</p>
<h4 id="442-tokenè§£æ">4.4.2 TOKENè§£æ</h4>
<p>æˆ‘ä»¬åˆšæ‰å·²ç»åˆ›å»ºäº†token ï¼Œåœ¨webåº”ç”¨ä¸­è¿™ä¸ªæ“ä½œæ˜¯ç”±æœåŠ¡ç«¯è¿›è¡Œç„¶åå‘ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯åœ¨ä¸‹æ¬¡å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚æ—¶éœ€è¦æºå¸¦è¿™ä¸ªtokenï¼ˆè¿™å°±å¥½åƒæ˜¯æ‹¿ç€ä¸€å¼ é—¨ç¥¨ä¸€æ ·ï¼‰ï¼Œé‚£æœåŠ¡ç«¯æ¥åˆ°è¿™ä¸ªtoken åº”è¯¥è§£æå‡ºtokenä¸­çš„ä¿¡æ¯ï¼ˆä¾‹å¦‚ç”¨æˆ·idï¼‰,æ ¹æ®è¿™äº›ä¿¡æ¯æŸ¥è¯¢æ•°æ®åº“è¿”å›ç›¸åº”çš„ç»“æœã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*è§£æJwtä»¤ç‰Œæ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testParseJwt</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span> 		String 			compactJwt<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI4ODgiLCJzdWIiOiLlsI_nmb0iLCJpYXQiOjE1NjIwNjIyODd9.RBLpZ79USMplQyfJCZFD2muHV_KLks7M1ZsjTu6Aez4&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span> 		Claims claims <span style="color:#000;font-weight:bold">=</span> Jwts<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">parser</span><span style="color:#000;font-weight:bold">().</span>
</span></span><span style="display:flex;"><span> 		setSigningKey<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;ujiuye&#34;</span><span style="color:#000;font-weight:bold">).</span>
</span></span><span style="display:flex;"><span> 		parseClaimsJws<span style="color:#000;font-weight:bold">(</span>compactJwt<span style="color:#000;font-weight:bold">).</span>
</span></span><span style="display:flex;"><span> 		getBody<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span> 		System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>claims<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>è¿è¡Œæ‰“å°æ•ˆæœï¼š</p>
<pre tabindex="0"><code>{jti=888, sub=å°ç™½, iat=1562062287}
</code></pre><p>è¯•ç€å°†tokenæˆ–ç­¾åç§˜é’¥ç¯¡æ”¹ä¸€ä¸‹ï¼Œä¼šå‘ç°è¿è¡Œæ—¶å°±ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥è§£ætokenä¹Ÿå°±æ˜¯éªŒè¯token.</p>
<h4 id="443-è®¾ç½®è¿‡æœŸæ—¶é—´">4.4.3 è®¾ç½®è¿‡æœŸæ—¶é—´</h4>
<p>æœ‰å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸å¸Œæœ›ç­¾å‘çš„tokenæ˜¯æ°¸ä¹…ç”Ÿæ•ˆçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸ºtokenæ·»åŠ ä¸€ä¸ªè¿‡æœŸæ—¶é—´ã€‚</p>
<h5 id="4431-tokenè¿‡æœŸè®¾ç½®">4.4.3.1 tokenè¿‡æœŸè®¾ç½®</h5>
<p><img src="/posts/project-0/20220528162731/image-20220528164946738.jpeg"
    
    
    
    loading="lazy"
    
    
></p>
<p>è§£é‡Šï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">.setExpiration(date)//ç”¨äºè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå‚æ•°ä¸ºDateç±»å‹æ•°æ®</span>
</span></span></code></pre></div><p>è¿è¡Œï¼Œæ‰“å°æ•ˆæœå¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI4ODgiLCJzdWIiOiLlsI_nmb0iLCJpYXQiOjE1NjIwNjI5MjUsImV4cCI6MTU2MjA2MjkyNX0._vs4METaPkCza52LuN0-2NGGWIIO7v51xt40DHY1U1Q</span>
</span></span></code></pre></div><h5 id="4432-è§£ætoken">4.4.3.2 è§£æTOKEN</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*è§£æJwtä»¤ç‰Œæ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testParseJwt</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>     String compactJwt<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI4ODgiLCJzdWIiOiLlsI_nmb0iLCJpYXQiOjE1NjIwNjI5MjUsImV4cCI6MTU2MjA2MjkyNX0._vs4METaPkCza52LuN0-2NGGWIIO7v51xt40DHY1U1Q&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>     Claims claims <span style="color:#000;font-weight:bold">=</span> Jwts<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">parser</span><span style="color:#000;font-weight:bold">().</span>
</span></span><span style="display:flex;"><span>     setSigningKey<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;ujiuye&#34;</span><span style="color:#000;font-weight:bold">).</span>
</span></span><span style="display:flex;"><span>     parseClaimsJws<span style="color:#000;font-weight:bold">(</span>compactJwt<span style="color:#000;font-weight:bold">).</span>
</span></span><span style="display:flex;"><span>     getBody<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>     System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>claims<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>æ‰“å°æ•ˆæœï¼š
<img src="/posts/project-0/20220528162731/image-20220528164953754.jpeg"
    
    
    
    loading="lazy"
    
    
></p>
<p>å½“å‰æ—¶é—´è¶…è¿‡è¿‡æœŸæ—¶é—´ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚</p>
<p>å¯ä»¥è®¾ç½®ç§˜é’¥çš„è¿‡æœŸæ—¶é—´ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setExpiration</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> Date<span style="color:#000;font-weight:bold">(</span>System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">currentTimeMillis</span><span style="color:#000;font-weight:bold">()+</span>100000<span style="color:#000;font-weight:bold">));</span><span style="color:#998;font-style:italic">//è®¾ç½®è¿‡æœŸæ—¶é—´
</span></span></span></code></pre></div><h4 id="444-è‡ªå®šä¹‰claims">4.4.4 è‡ªå®šä¹‰claims</h4>
<p>æˆ‘ä»¬åˆšæ‰çš„ä¾‹å­åªæ˜¯å­˜å‚¨äº†idå’Œsubjectä¸¤ä¸ªä¿¡æ¯ï¼Œå¦‚æœä½ æƒ³å­˜å‚¨æ›´å¤šçš„ä¿¡æ¯ï¼ˆä¾‹å¦‚è§’è‰²ï¼‰å¯ä»¥å®šä¹‰è‡ªå®šä¹‰claimsã€‚</p>
<p>åˆ›å»ºæµ‹è¯•ç±»ï¼Œå¹¶è®¾ç½®æµ‹è¯•æ–¹æ³•ï¼š</p>
<p>åˆ›å»ºtoken:
<img src="/posts/project-0/20220528162731/image-20220528164959390.jpeg"
    
    
    
    loading="lazy"
    
    
></p>
<p>è¿è¡Œæ‰“å°æ•ˆæœï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI4ODgiLCJzdWIiOiLlsI_nmb0iLCJpYXQiOjE2MTI3OTAyOTAsImV4cCI6MTYxMjc5MDI5MCwiYWRkcmVzcyI6IuWMl-S6rOW4guacnemYs-WMuuS6lOaWueahpeWfuuWcsCIsIm5hbWUiOiLkuK3lhazkvJjlsLHkuJoifQ.VwVrb-wuxb_BCLlSn2GY_m8z2pWpdU-KdtkeAY8gp5k</span>
</span></span></code></pre></div><p>è§£æTOKEN:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-JAVA" data-lang="JAVA"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*è§£æJwtä»¤ç‰Œæ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testParseJwt</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span> 		String compactJwt<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI4ODgiLCJzdWIiOiLlsI_nmb0iLCJpYXQiOjE2MTI3OTA2NTAsImFkZHJlc3MiOiLljJfkuqzluILmnJ3pmLPljLrkupTmlrnmoaXln7rlnLAiLCJuYW1lIjoi5Lit5YWs5LyY5bCx5LiaIn0.zHmA-MY0wg-aDSV9xrf16_ExvxUKcwNrTCsFSjFOUuc&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span> 		Claims claims <span style="color:#000;font-weight:bold">=</span> Jwts<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">parser</span><span style="color:#000;font-weight:bold">().</span>
</span></span><span style="display:flex;"><span> 		setSigningKey<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;ujiuye&#34;</span><span style="color:#000;font-weight:bold">).</span>
</span></span><span style="display:flex;"><span> 		parseClaimsJws<span style="color:#000;font-weight:bold">(</span>compactJwt<span style="color:#000;font-weight:bold">).</span>
</span></span><span style="display:flex;"><span> 		getBody<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span> 		System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>claims<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>è¿è¡Œæ•ˆæœï¼š
<img src="/posts/project-0/20220528162731/image-20220528165006261.jpeg"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="45-é‰´æƒå¤„ç†">4.5 é‰´æƒå¤„ç†</h3>
<h4 id="451-æ€è·¯åˆ†æ">4.5.1 æ€è·¯åˆ†æ</h4>
<p><img src="/posts/project-0/20220528162731/image-20220528165012604.png"
    
    
    
    loading="lazy"
    
    
></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">1.ç”¨æˆ·é€šè¿‡è®¿é—®å¾®æœåŠ¡ç½‘å…³è°ƒç”¨å¾®æœåŠ¡ï¼ŒåŒæ—¶æºå¸¦å¤´æ–‡ä»¶ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">2.åœ¨å¾®æœåŠ¡ç½‘å…³è¿™é‡Œè¿›è¡Œæ‹¦æˆªï¼Œæ‹¦æˆªåè·å–ç”¨æˆ·è¦è®¿é—®çš„è·¯å¾„</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">3.è¯†åˆ«ç”¨æˆ·è®¿é—®çš„è·¯å¾„æ˜¯å¦éœ€è¦ç™»å½•ï¼Œå¦‚æœéœ€è¦ï¼Œè¯†åˆ«ç”¨æˆ·çš„èº«ä»½æ˜¯å¦èƒ½è®¿é—®è¯¥è·¯å¾„[è¿™é‡Œå¯ä»¥åŸºäºæ•°æ®åº“è®¾è®¡ä¸€å¥—æƒé™]</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">4.å¦‚æœéœ€è¦æƒé™è®¿é—®ï¼Œç”¨æˆ·å·²ç»ç™»å½•ï¼Œåˆ™æ”¾è¡Œ</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">5.å¦‚æœéœ€è¦æƒé™è®¿é—®ï¼Œä¸”ç”¨æˆ·æœªç™»å½•ï¼Œåˆ™æç¤ºç”¨æˆ·éœ€è¦ç™»å½•</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">6.ç”¨æˆ·é€šè¿‡ç½‘å…³è®¿é—®ç”¨æˆ·å¾®æœåŠ¡ï¼Œè¿›è¡Œç™»å½•éªŒè¯</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">7.éªŒè¯é€šè¿‡åï¼Œç”¨æˆ·å¾®æœåŠ¡ä¼šé¢å‘ä¸€ä¸ªä»¤ç‰Œç»™ç½‘å…³ï¼Œç½‘å…³ä¼šå°†ç”¨æˆ·ä¿¡æ¯å°è£…åˆ°å¤´æ–‡ä»¶ä¸­ï¼Œå¹¶å“åº”ç”¨æˆ·</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">8.ç”¨æˆ·ä¸‹æ¬¡è®¿é—®ï¼Œæºå¸¦å¤´æ–‡ä»¶ä¸­çš„ä»¤ç‰Œä¿¡æ¯å³å¯è¯†åˆ«æ˜¯å¦ç™»å½•</span>
</span></span></code></pre></div><h4 id="452ç”¨æˆ·ç™»å½•ç­¾å‘token">4.5.2ç”¨æˆ·ç™»å½•ç­¾å‘TOKEN</h4>
<p>(1)ç”Ÿæˆä»¤ç‰Œå·¥å…·ç±»</p>
<p>åœ¨dongyimai-commonä¸­åˆ›å»ºç±»utils.JwtUtilï¼Œä¸»è¦è¾…åŠ©ç”ŸæˆJwtä»¤ç‰Œä¿¡æ¯ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">JwtUtil</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//æœ‰æ•ˆæœŸä¸º
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>     <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">final</span> Long JWT_TTL <span style="color:#000;font-weight:bold">=</span> 3600000L<span style="color:#000;font-weight:bold">;</span><span style="color:#998;font-style:italic">//60 *60 *1000 ä¸€ä¸ªå°æ—¶
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//Jwtä»¤ç‰Œä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>     <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">final</span> String JWT_KEY <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;ujiuye&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     *ç”Ÿæˆtokenä»¤ç‰Œæ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     *
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     **/</span>
</span></span><span style="display:flex;"><span>     <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> String <span style="color:#900;font-weight:bold">createJWT</span><span style="color:#000;font-weight:bold">(</span>String id<span style="color:#000;font-weight:bold">,</span> String subject<span style="color:#000;font-weight:bold">,</span> Long ttlMillis<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//æŒ‡å®šç­¾åç®—æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>     SignatureAlgorithm signatureAlgorithm <span style="color:#000;font-weight:bold">=</span> SignatureAlgorithm<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">HS256</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//å½“å‰ç³»ç»Ÿæ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>     <span style="color:#458;font-weight:bold">long</span> nowMillis <span style="color:#000;font-weight:bold">=</span> System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">currentTimeMillis</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//ä»¤ç‰Œç­¾å‘æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>     Date now <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Date<span style="color:#000;font-weight:bold">(</span>nowMillis<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//å¦‚æœä»¤ç‰Œæœ‰æ•ˆæœŸä¸ºnullï¼Œåˆ™é»˜è®¤è®¾ç½®æœ‰æ•ˆæœŸ1å°æ—¶
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>     <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>ttlMillis<span style="color:#000;font-weight:bold">==</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>     ttlMillis<span style="color:#000;font-weight:bold">=</span>JwtUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">JWT_TTL</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//ä»¤ç‰Œè¿‡æœŸæ—¶é—´è®¾ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>     <span style="color:#458;font-weight:bold">long</span> expMillis <span style="color:#000;font-weight:bold">=</span> nowMillis <span style="color:#000;font-weight:bold">+</span> ttlMillis<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>     Date expDate <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Date<span style="color:#000;font-weight:bold">(</span>expMillis<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//ç”Ÿæˆç§˜é’¥
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>     SecretKey secretKey <span style="color:#000;font-weight:bold">=</span> generalKey<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//å°è£…Jwtä»¤ç‰Œä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>     JwtBuilder builder <span style="color:#000;font-weight:bold">=</span> Jwts<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">builder</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setId</span><span style="color:#000;font-weight:bold">(</span>id<span style="color:#000;font-weight:bold">)</span><span style="color:#998;font-style:italic">//å”¯ä¸€çš„ID
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setSubject</span><span style="color:#000;font-weight:bold">(</span>subject<span style="color:#000;font-weight:bold">)</span><span style="color:#998;font-style:italic">//ä¸»é¢˜å¯ä»¥æ˜¯JSONæ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setIssuer</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;admin&#34;</span><span style="color:#000;font-weight:bold">)</span><span style="color:#998;font-style:italic">//ç­¾å‘è€…
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setIssuedAt</span><span style="color:#000;font-weight:bold">(</span>now<span style="color:#000;font-weight:bold">)</span><span style="color:#998;font-style:italic">//ç­¾å‘æ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">signWith</span><span style="color:#000;font-weight:bold">(</span>signatureAlgorithm<span style="color:#000;font-weight:bold">,</span> secretKey<span style="color:#000;font-weight:bold">)</span><span style="color:#998;font-style:italic">//ç­¾åç®—æ³•ä»¥åŠå¯†åŒ™
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setExpiration</span><span style="color:#000;font-weight:bold">(</span>expDate<span style="color:#000;font-weight:bold">);</span> <span style="color:#998;font-style:italic">//è®¾ç½®è¿‡æœŸæ—¶é—´
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>         <span style="color:#000;font-weight:bold">return</span> builder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">compact</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    *ç”ŸæˆåŠ å¯† secretKey
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    *@return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span>
</span></span><span style="display:flex;"><span>     <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> SecretKey <span style="color:#900;font-weight:bold">generalKey</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>         <span style="color:#458;font-weight:bold">byte</span><span style="color:#000;font-weight:bold">[]</span> encodedKey <span style="color:#000;font-weight:bold">=</span> Base64<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getEncoder</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">encode</span><span style="color:#000;font-weight:bold">(</span>JwtUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">JWT_KEY</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getBytes</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>         SecretKey key <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> SecretKeySpec<span style="color:#000;font-weight:bold">(</span>encodedKey<span style="color:#000;font-weight:bold">,</span>0<span style="color:#000;font-weight:bold">,</span> encodedKey<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">length</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;AES&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>         <span style="color:#000;font-weight:bold">return</span> key<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    *è§£æä»¤ç‰Œæ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    *@param jwt
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    *@return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    *@throws Exception
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span>
</span></span><span style="display:flex;"><span>     <span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> Claims <span style="color:#900;font-weight:bold">parseJWT</span><span style="color:#000;font-weight:bold">(</span>String jwt<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Exception <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>         SecretKey secretKey <span style="color:#000;font-weight:bold">=</span> generalKey<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>         <span style="color:#000;font-weight:bold">return</span> Jwts<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">parser</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setSigningKey</span><span style="color:#000;font-weight:bold">(</span>secretKey<span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">parseClaimsJws</span><span style="color:#000;font-weight:bold">(</span>jwt<span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getBody</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>(2)ç”¨æˆ·ç™»å½•æˆåŠŸåˆ™ç­¾å‘TOKENï¼Œä¿®æ”¹ç™»å½•çš„æ–¹æ³•ï¼š
<img src="/posts/project-0/20220528162731/image-20220528165023156.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*ç”¨æˆ·ç™»å½•
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@RequestMapping</span><span style="color:#000;font-weight:bold">(</span>value <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;/login&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> Result <span style="color:#900;font-weight:bold">login</span><span style="color:#000;font-weight:bold">(</span>String username<span style="color:#000;font-weight:bold">,</span>String password<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>     User user <span style="color:#000;font-weight:bold">=</span> userService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findById</span><span style="color:#000;font-weight:bold">(</span>username<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>     <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>user<span style="color:#000;font-weight:bold">!=</span><span style="color:#000;font-weight:bold">null</span> <span style="color:#000;font-weight:bold">&amp;&amp;</span> BCrypt<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">checkpw</span><span style="color:#000;font-weight:bold">(</span>password<span style="color:#000;font-weight:bold">,</span>user<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getPassword</span><span style="color:#000;font-weight:bold">())){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//è®¾ç½®ä»¤ç‰Œä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>         Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span>Object<span style="color:#000;font-weight:bold">&gt;</span> info <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> HashMap<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span>Object<span style="color:#000;font-weight:bold">&gt;();</span>
</span></span><span style="display:flex;"><span>         info<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;role&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;USER&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>         info<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;success&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;SUCCESS&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>         info<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;username&#34;</span><span style="color:#000;font-weight:bold">,</span>username<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//ç”Ÿæˆä»¤ç‰Œ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>         String jwt <span style="color:#000;font-weight:bold">=</span> JwtUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createJWT</span><span style="color:#000;font-weight:bold">(</span>UUID<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">randomUUID</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">toString</span><span style="color:#000;font-weight:bold">(),</span> JSON<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">toJSONString</span><span style="color:#000;font-weight:bold">(</span>info<span style="color:#000;font-weight:bold">),</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>         <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">new</span> Result<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span>StatusCode<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">OK</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;ç™»å½•æˆåŠŸï¼&#34;</span><span style="color:#000;font-weight:bold">,</span>jwt<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#000;font-weight:bold">return</span>  <span style="color:#000;font-weight:bold">new</span> Result<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">,</span>StatusCode<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">LOGINERROR</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;è´¦å·æˆ–è€…å¯†ç é”™è¯¯ï¼&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="453-ç½‘å…³è¿‡æ»¤å™¨æ‹¦æˆªè¯·æ±‚å¤„ç†">4.5.3 ç½‘å…³è¿‡æ»¤å™¨æ‹¦æˆªè¯·æ±‚å¤„ç†</h4>
<p>è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨ï¼Œåˆ›å»ºè¿‡æ»¤å™¨ç±»ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š
<img src="/posts/project-0/20220528162731/image-20220528165029839.jpeg"
    
    
    
    loading="lazy"
    
    
></p>
<p>AuthorizeFilterä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">AuthorizeFilter</span> <span style="color:#000;font-weight:bold">implements</span> GlobalFilter<span style="color:#000;font-weight:bold">,</span> Ordered <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#998;font-style:italic">//ä»¤ç‰Œå¤´åå­—
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span> 		<span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#000;font-weight:bold">final</span> String AUTHORIZE_TOKEN <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;Authorization&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    *å…¨å±€è¿‡æ»¤å™¨
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    *@param exchange
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    *@param chain
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    *@return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> Mono<span style="color:#000;font-weight:bold">&lt;</span>Void<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">filter</span><span style="color:#000;font-weight:bold">(</span>ServerWebExchange exchange<span style="color:#000;font-weight:bold">,</span> GatewayFilterChain chain<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//è·å–Requestã€Responseå¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        ServerHttpRequest request <span style="color:#000;font-weight:bold">=</span> exchange<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getRequest</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        ServerHttpResponse response <span style="color:#000;font-weight:bold">=</span> exchange<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getResponse</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//è·å–è¯·æ±‚çš„URI
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        String path <span style="color:#000;font-weight:bold">=</span> request<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getURI</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">getPath</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//å¦‚æœæ˜¯ç™»å½•ã€goodsç­‰å¼€æ”¾çš„å¾®æœåŠ¡[è¿™é‡Œçš„goodséƒ¨åˆ†å¼€æ”¾],åˆ™ç›´æ¥æ”¾è¡Œ,è¿™é‡Œä¸åšå®Œæ•´æ¼”ç¤ºï¼Œå®Œæ•´æ¼”ç¤ºéœ€è¦è®¾è®¡ä¸€å¥—æƒé™ç³»ç»Ÿ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>path<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">startsWith</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/api/user/login&#34;</span><span style="color:#000;font-weight:bold">)||</span> path<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">startsWith</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/api/brand/search/&#34;</span><span style="color:#000;font-weight:bold">)){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//æ”¾è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            Mono<span style="color:#000;font-weight:bold">&lt;</span>Void<span style="color:#000;font-weight:bold">&gt;</span> filter <span style="color:#000;font-weight:bold">=</span> chain<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">filter</span><span style="color:#000;font-weight:bold">(</span>exchange<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> filter<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//è·å–å¤´æ–‡ä»¶ä¸­çš„ä»¤ç‰Œä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        String tokent <span style="color:#000;font-weight:bold">=</span> request<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getHeaders</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">getFirst</span><span style="color:#000;font-weight:bold">(</span>AUTHORIZE_TOKEN<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//å¦‚æœå¤´æ–‡ä»¶ä¸­æ²¡æœ‰ï¼Œåˆ™ä»è¯·æ±‚å‚æ•°ä¸­è·å–
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>StringUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">isEmpty</span><span style="color:#000;font-weight:bold">(</span>tokent<span style="color:#000;font-weight:bold">)){</span>
</span></span><span style="display:flex;"><span>            tokent <span style="color:#000;font-weight:bold">=</span> request<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getQueryParams</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">getFirst</span><span style="color:#000;font-weight:bold">(</span>AUTHORIZE_TOKEN<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//å¦‚æœä¸ºç©ºï¼Œåˆ™è¾“å‡ºé”™è¯¯ä»£ç 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>StringUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">isEmpty</span><span style="color:#000;font-weight:bold">(</span>tokent<span style="color:#000;font-weight:bold">)){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//è®¾ç½®æ–¹æ³•ä¸å…è®¸è¢«è®¿é—®ï¼Œ405é”™è¯¯ä»£ç 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            response<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setStatusCode</span><span style="color:#000;font-weight:bold">(</span>HttpStatus<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">METHOD_NOT_ALLOWED</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> response<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setComplete</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//è§£æä»¤ç‰Œæ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            Claims claims <span style="color:#000;font-weight:bold">=</span> JwtUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">parseJWT</span><span style="color:#000;font-weight:bold">(</span>tokent<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>Exception e<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>            e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//è§£æå¤±è´¥ï¼Œå“åº”401é”™è¯¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            response<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setStatusCode</span><span style="color:#000;font-weight:bold">(</span>HttpStatus<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">UNAUTHORIZED</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> response<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setComplete</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//æ”¾è¡Œ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">return</span> chain<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">filter</span><span style="color:#000;font-weight:bold">(</span>exchange<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>	
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    *è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    *@return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">getOrder</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">return</span> 0<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>éœ€è¦åœ¨dongyimai-gateway-webå¼•å…¥dongyimai-commonçš„ä¾èµ–</p>
<pre tabindex="0"><code> &lt;dependency&gt;
            &lt;groupId&gt;com.offcn&lt;/groupId&gt;
            &lt;artifactId&gt;dongyimai-common&lt;/artifactId&gt;
            &lt;version&gt;1.0&lt;/version&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
</code></pre><p>æ³¨æ„ï¼šéœ€è¦æ’é™¤spring-boot-starter-webçš„ä¾èµ–</p>
<p>å¼•å…¥ä¹‹åï¼Œå¯åŠ¨ç½‘å…³ä¼šåŒ…ä¸€ä¸ªé”™è¯¯ï¼Œå’ŒSpringMVCå†²çª
<img src="/posts/project-0/20220528162731/image-20220528165038544.png"
    
    
    
    loading="lazy"
    
    
></p>
<h4 id="454-é…ç½®è¿‡æ»¤è§„åˆ™">4.5.4 é…ç½®è¿‡æ»¤è§„åˆ™</h4>
<p>ä¿®æ”¹ç½‘å…³ç³»ç»Ÿçš„ymlæ–‡ä»¶ï¼š
<img src="/posts/project-0/20220528162731/image-20220528165043770.jpeg"
    
    
    
    loading="lazy"
    
    
></p>
<p>ä¸Šè¿°ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">spring</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 	</span><span style="color:#000080">cloud</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 		</span><span style="color:#000080">gateway</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 			</span><span style="color:#000080">globalcors</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 				</span><span style="color:#000080">corsConfigurations</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">					</span><span style="color:#000080">&#39;[/**]&#39;</span>:<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">#åŒ¹é…æ‰€æœ‰è¯·æ±‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">           </span><span style="color:#000080">allowedOrigins</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;*&#34;</span><span style="color:#998;font-style:italic">#è·¨åŸŸå¤„ç†å…è®¸æ‰€æœ‰çš„åŸŸ</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">           </span><span style="color:#000080">allowedMethods</span>:<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">#æ”¯æŒçš„æ–¹æ³•</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>- GET<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>- POST<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>- PUT<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">              </span>- DELETE<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 	</span><span style="color:#000080">routes</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">			</span>- <span style="color:#000080">id</span>:<span style="color:#bbb"> </span>dongyimai_goods_route<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 			</span><span style="color:#000080">uri</span>:<span style="color:#bbb"> </span>lb://goods<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 			</span><span style="color:#000080">predicates</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">				</span>- <span style="color:#bbb">	</span>Path=/api/album/**,/api/brand/**,/api/cache/**,/api/categoryBrand/**,/api/category/**,/api/para/**,/api/pref/**,/api/sku/**,/api/spec/**,/api/spu/**,/api/stockBack/**,/api/template/**<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 			</span><span style="color:#000080">filters</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">				</span>- StripPrefix=1<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">				</span>- <span style="color:#000080">name</span>:<span style="color:#bbb"> </span>RequestRateLimiter<span style="color:#bbb"> </span><span style="color:#998;font-style:italic">#è¯·æ±‚æ•°é™æµåå­—ä¸èƒ½éšä¾¿å†™ï¼Œä½¿ç”¨é»˜è®¤çš„facatory</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 			</span><span style="color:#000080">args</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span><span style="color:#000080">key-resolver</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#34;#{@ipKeyResolver}&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span><span style="color:#000080">redis-rate-limiter.replenishRate</span>:<span style="color:#bbb"> </span><span style="color:#099">1</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">         </span><span style="color:#000080">redis-rate-limiter.burstCapacity</span>:<span style="color:#bbb"> </span><span style="color:#099">1</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#998;font-style:italic">#ç”¨æˆ·å¾®æœåŠ¡</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">			</span>- <span style="color:#000080">id</span>:<span style="color:#bbb"> </span>dongyimai_user_route<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 			</span><span style="color:#000080">uri</span>:<span style="color:#bbb"> </span>lb://user<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 			</span><span style="color:#000080">predicates</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">				</span>- Path=/api/user/**,/api/address/**,/api/areas/**,/api/cities/**,/api/provinces/**<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 			</span><span style="color:#000080">filters</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">				</span>- StripPrefix=1<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#000080">application</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 		</span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>gateway-web<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#998;font-style:italic">#Redisé…ç½®</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#000080">redis</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 		</span><span style="color:#000080">host</span>:<span style="color:#bbb"> </span><span style="color:#099">192.168.188.129</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 		</span><span style="color:#000080">port</span>:<span style="color:#bbb"> </span><span style="color:#099">6379</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">server</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 	</span><span style="color:#000080">port</span>:<span style="color:#bbb"> </span><span style="color:#099">8001</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">eureka</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 	</span><span style="color:#000080">client</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 		</span><span style="color:#000080">service-url</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 			</span><span style="color:#000080">defaultZone</span>:<span style="color:#bbb"> </span>http://localhost:8761/eureka<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 	</span><span style="color:#000080">instance</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 		</span><span style="color:#000080">prefer-ip-address</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000080">management</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 		</span><span style="color:#000080">endpoint</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 			</span><span style="color:#000080">gateway</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 				</span><span style="color:#000080">enabled</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#000080">web</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#000080">exposure</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span><span style="color:#000080">include</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">
</span></span></span></code></pre></div><p>æµ‹è¯•è®¿é—®<code>http://localhost:8001/api/user/login?username=dongyimai&amp;password=dongyimai</code>ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š
<img src="/posts/project-0/20220528162731/image-20220528165051182.jpeg"
    
    
    
    loading="lazy"
    
    
></p>
<p>æµ‹è¯•è®¿é—® http://localhost:8001/api/userï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="/posts/project-0/20220528162731/image-20220528165056416.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ç”¨postmanåœ¨è¯·æ±‚å¤´åŠ å…¥tokenï¼Œåœ¨æµ‹è¯•ï¼Œå¯ä»¥æ­£å¸¸è®¿é—®
<img src="/posts/project-0/20220528162731/image-20220528165126095.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>å‚è€ƒå®˜æ–¹æ‰‹å†Œï¼š</p>
<p><a class="link" href="/posts/project-0/https://cloud.spring.io/spring-cloud-gateway/spring-cloud-gateway.html#_stripprefix_gatewayfilter_factory"  target="_blank" rel="noopener"
    >https://cloud.spring.io/spring-cloud-gateway/spring-cloud-gateway.html#_stripprefix_gatewayfilter_factory</a></p>
<h3 id="46-ä¼šè¯ä¿æŒ">4.6 ä¼šè¯ä¿æŒ</h3>
<p>ç”¨æˆ·æ¯æ¬¡è¯·æ±‚çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½éœ€è¦è·å–ä»¤ç‰Œæ•°æ®ï¼Œæ–¹æ³•æœ‰å¤šé‡ï¼Œå¯ä»¥åœ¨æ¯æ¬¡æäº¤çš„æ—¶å€™ï¼Œå°†æ•°æ®æäº¤åˆ°å¤´æ–‡ä»¶ä¸­ï¼Œä¹Ÿå¯ä»¥å°†æ•°æ®å­˜å‚¨åˆ°Cookieä¸­ï¼Œæ¯æ¬¡ä»Cookieä¸­æ ¡éªŒæ•°æ®ï¼Œè¿˜å¯ä»¥æ¯æ¬¡å°†ä»¤ç‰Œæ•°æ®ä»¥å‚æ•°çš„æ–¹å¼æäº¤åˆ°ç½‘å…³ï¼Œè¿™é‡Œé¢é‡‡ç”¨Cookieçš„æ–¹å¼æ¯”è¾ƒå®¹æ˜“å®ç°ã€‚</p>
<h4 id="461-ç™»å½•å°è£…cookie">4.6.1 ç™»å½•å°è£…Cookie</h4>
<p>ä¿®æ”¹userå¾®æœåŠ¡ï¼Œæ¯æ¬¡ç™»å½•çš„æ—¶å€™ï¼Œæ·»åŠ ä»¤ç‰Œä¿¡æ¯åˆ°Cookieä¸­ï¼Œä¿®æ”¹dongyimai-user-serviceçš„<code>com.offcn.user.controller.UserController</code>çš„<code>login</code>æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š
<img src="/posts/project-0/20220528162731/image-20220528165133987.jpeg"
    
    
    
    loading="lazy"
    
    
></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/***
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     *ç”¨æˆ·ç™»å½•
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@RequestMapping</span><span style="color:#000;font-weight:bold">(</span>value <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;/login&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> Result <span style="color:#900;font-weight:bold">login</span><span style="color:#000;font-weight:bold">(</span>String username<span style="color:#000;font-weight:bold">,</span> String password<span style="color:#000;font-weight:bold">,</span> HttpServletResponse response<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        User user <span style="color:#000;font-weight:bold">=</span>  userService<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findByUsername</span><span style="color:#000;font-weight:bold">(</span>username<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>user<span style="color:#000;font-weight:bold">!=</span><span style="color:#000;font-weight:bold">null</span> <span style="color:#000;font-weight:bold">&amp;&amp;</span> BCrypt<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">checkpw</span><span style="color:#000;font-weight:bold">(</span>password<span style="color:#000;font-weight:bold">,</span>user<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getPassword</span><span style="color:#000;font-weight:bold">())){</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//è®¾ç½®ä»¤ç‰Œä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span>Object<span style="color:#000;font-weight:bold">&gt;</span> info<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">new</span> HashMap<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>            info<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;role&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;USER&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            info<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;success&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;SUCCESS&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            info<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;username&#34;</span><span style="color:#000;font-weight:bold">,</span>username<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//ç”Ÿæˆä»¤ç‰Œ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            String jwt <span style="color:#000;font-weight:bold">=</span> JwtUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createJWT</span><span style="color:#000;font-weight:bold">(</span>UUID<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">randomUUID</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">toString</span><span style="color:#000;font-weight:bold">(),</span> JSON<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">toJSONString</span><span style="color:#000;font-weight:bold">(</span>info<span style="color:#000;font-weight:bold">),</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//åˆ›å»ºCookieå¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            Cookie cookie <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Cookie<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Authorization&#34;</span><span style="color:#000;font-weight:bold">,</span>jwt<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//è®¾ç½®cookieçš„è·¯å¾„
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            cookie<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setPath</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;/&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//æŠŠcookieä½¿ç”¨å“åº”å¤´è®¾ç½®ç»™æµè§ˆå™¨
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            response<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addCookie</span><span style="color:#000;font-weight:bold">(</span>cookie<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">new</span> Result<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span>StatusCode<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">OK</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;ç™»å½•æˆåŠŸï¼&#34;</span><span style="color:#000;font-weight:bold">,</span>jwt<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span>  <span style="color:#000;font-weight:bold">new</span> Result<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">false</span><span style="color:#000;font-weight:bold">,</span>StatusCode<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">LOGINERROR</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;è´¦å·æˆ–è€…å¯†ç é”™è¯¯ï¼&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="462-è¿‡æ»¤å™¨è·å–ä»¤ç‰Œæ•°æ®">4.6.2 è¿‡æ»¤å™¨è·å–ä»¤ç‰Œæ•°æ®</h4>
<p>æ¯æ¬¡åœ¨ç½‘å…³ä¸­é€šè¿‡è¿‡æ»¤å™¨è·å–Cookieä¸­çš„ä»¤ç‰Œï¼Œç„¶åå¯¹ä»¤ç‰Œæ•°æ®è¿›è¡Œè§£æï¼Œä¿®æ”¹å¾®æœåŠ¡ç½‘å…³dongyimai-gateway-webä¸­çš„AuthorizeFilterï¼Œä»£ç å¦‚ä¸‹ï¼š
<img src="/posts/project-0/20220528162731/image-20220528165141292.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>ç™»å½•åæµ‹è¯•ï¼Œå¯ä»¥è¯†åˆ«ç”¨æˆ·èº«ä»½ï¼Œä¸ç™»å½•æ— æ³•è¯†åˆ«ã€‚å¦‚ä¸‹è®¿é—®<code>http://localhost:8001/api/user</code>ä¼šæºå¸¦ä»¤ç‰Œæ•°æ®ï¼š
<img src="/posts/project-0/20220528162731/image-20220528165147428.jpeg"
    
    
    
    loading="lazy"
    
    
></p>
<h4 id="463-æ·»åŠ headerä¿¡æ¯">4.6.3 æ·»åŠ Headerä¿¡æ¯</h4>
<p>æˆ‘ä»¬è¿˜å¯ä»¥åœ¨Gatewayçš„å…¨å±€è¿‡æ»¤å™¨ä¸­æ·»åŠ è¯·æ±‚å¤´ä¿¡æ¯ï¼Œä¾‹å¦‚å¯ä»¥å°†ä»¤ç‰Œä¿¡æ¯æ·»åŠ åˆ°è¯·æ±‚å¤´ä¸­ï¼Œåœ¨å¾®æœåŠ¡ä¸­è·å–å¤´ä¿¡æ¯ï¼Œå¦‚ä¸‹ä»£ç ï¼š</p>
<p>ä¿®æ”¹å¾®æœåŠ¡ç½‘å…³ä¸­çš„è¿‡æ»¤å™¨ï¼Œåœ¨ä»¤ç‰Œä¿¡æ¯æ ¡éªŒé‚£å—å°†ä»¤ç‰ŒåŠ å…¥åˆ°è¯·æ±‚å¤´ä¸­ï¼Œå¦‚ä¸‹ä»£ç ï¼š
<img src="/posts/project-0/20220528162731/image-20220528165152441.png"
    
    
    
    loading="lazy"
    
    
></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> Claims claims <span style="color:#000;font-weight:bold">=</span> JwtUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">parseJWT</span><span style="color:#000;font-weight:bold">(</span>token<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//æŠŠè§£æå‡ºæ¥çš„ä»¤ç‰Œæ·»åŠ åˆ°å¤´æ–‡ä»¶ä¸­
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>request<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mutate</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">header</span><span style="color:#000;font-weight:bold">(</span>AUTHORIZE_TOKEN<span style="color:#000;font-weight:bold">,</span>claims<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">toString</span><span style="color:#000;font-weight:bold">());</span>
</span></span></code></pre></div><p>åœ¨dongyimai-service-userå¾®æœåŠ¡çš„UserControllerçš„findAllæ–¹æ³•ä¸­è·å–è¯·æ±‚å¤´æµ‹è¯•ï¼Œä»£ç å¦‚ä¸‹ï¼š
<img src="/posts/project-0/20220528162731/image-20220528165159047.png"
    
    
    
    loading="lazy"
    
    
></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span> <span style="color:#998;font-style:italic">//è·å–è¯·æ±‚å¤´ä¸­å°è£…çš„ä»¤ç‰Œ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        String token <span style="color:#000;font-weight:bold">=</span> request<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getHeader</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Authorization&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;ä»¤ç‰Œä¿¡æ¯:&#34;</span><span style="color:#000;font-weight:bold">+</span>token<span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><p>æµ‹è¯•è¯·æ±‚åœ°å€:</p>
<p>http://localhost:8001/api/user/</p>
<p>åå°è¾“å‡ºä»¤ç‰Œæ•°æ®å¦‚ä¸‹ï¼š
<img src="/posts/project-0/20220528162731/image-20220528165205303.jpeg"
    
    
    
    loading="lazy"
    
    
></p>

    </div>

    

    


    <div class="container-prevnext">
    <div><a href="https://lovemjh.github.io/posts/project-0/20220528174166/">â† åˆ†å¸ƒå¼äº‹åŠ¡</a></div>
    <div><a href="https://lovemjh.github.io/posts/project-0/20220528171137/">æäº¤è®¢å•  â†’</a></div>
</div>
</div>

        </div>
        <div id="footer"><div class="container-footer">
    
    <a href="//beian.miit.gov.cn" target="_blank">
        
        è±«ICPå¤‡2022002918å·
        
    </a>
    <a id="s" href="/secrets">&nbsp;</a>
</div></div>
    </body>
</html>
