<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="Mybatis-1 - https://lovemjh.vercel.app/posts/java-frame/20220430230666/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>Mybatis-1</title>
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    <link rel="stylesheet" href="https://lovemjh.vercel.app/style.min.824365c118b34524ce845ac2a294220354719cca11af5b27a81b04c173bbba57.css">
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate cool">
        <div id="header"><div class="container-header">
    <div id="vars" class="container-vars" style="display: none;">
	{
		"hasFoldAllCodeBlocks": false,
		"svgColor": "#6c757d",
		"en": false,
		"dark": false
	}
</div>
    <h1 class="title">
        
            Mybatis-1
            
        
    </h1>

    <div class="container-breadcrumb-nav">
    
    <div class="breadcrumb-nav-bar">
        <div><a href="/"><svg t="1656411084410" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2954" width="16" height="16"><path d="M947.5 390.6l-377-290c-34.5-26.5-82.6-26.5-117.1 0l-377 290c-14 10.8-16.6 30.9-5.9 44.9 10.8 14 30.9 16.6 44.9 5.9l28.5-21.9V768c0 88.2 71.8 160 160 160h80c35.3 0 64-28.7 64-64V640c0-17.6 14.4-32 32-32h64c17.6 0 32 14.4 32 32v224c0 35.3 28.7 64 64 64h80c88.2 0 160-71.8 160-160V419.4l28.5 21.9c5.8 4.5 12.7 6.6 19.5 6.6 9.6 0 19.1-4.3 25.4-12.5 10.8-13.9 8.2-34-5.8-44.8zM816 768c0 52.9-43.1 96-96 96h-80V640c0-52.9-43.1-96-96-96h-64c-52.9 0-96 43.1-96 96v224h-80c-52.9 0-96-43.1-96-96V370.2l284.5-218.8c11.5-8.8 27.5-8.8 39 0L816 370.2V768z" fill=#6c757d p-id="2955"></path></svg></a></div>
        <div><a href="/nav"><svg t="1656411531924" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5827" width="16" height="16"><path d="M849.59197473 125.23018519L139.22930586 391.72854662a23.35052669 23.35052669 0 0 0-14.95414244 21.65490745c-0.12257519 9.70384955 5.61801843 18.46795771 14.40255493 22.04306141l318.42928099 129.25528056 119.51057092 320.39047893c3.06437293 8.23295069 10.35758221 13.89182751 18.7335381 14.87242563l2.7170774 0.14300521a22.79893918 22.79893918 0 0 0 21.20546682-15.36272638l259.51158924-729.54564933a23.8612558 23.8612558 0 0 0-5.31158128-24.55584682 22.3290685 22.3290685 0 0 0-23.9021142-5.43415649zM793.65694081 211.64552314l-196.63064161 552.75171747-91.91077952-246.37564122-253.62799211-102.96295445 542.16941324-203.4131218z" p-id="5828" fill=#6c757d></path></svg></a></div>
        <div><a href="/search"><svg t="1656411627509" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1730" width="14" height="14"><path d="M469.333333 85.333333c211.968 0 384 172.032 384 384s-172.032 384-384 384-384-172.032-384-384 172.032-384 384-384z m0 682.666667c164.992 0 298.666667-133.674667 298.666667-298.666667 0-165.034667-133.674667-298.666667-298.666667-298.666666-165.034667 0-298.666667 133.632-298.666666 298.666666 0 164.992 133.632 298.666667 298.666666 298.666667z m362.026667 3.029333l120.704 120.661334-60.373333 60.373333-120.661334-120.704 60.330667-60.330667z" p-id="1731" fill=#6c757d></path></svg></a></div>
        <div><a href="/posts"><svg t="1656411724198" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5655" width="12" height="12"><path d="M811.705761 1024H212.294239c-93.1199 0-174.823046-87.570975-174.823046-187.387854V162.322018C37.471193 69.776145 112.604921 0 212.294239 0H596.190595l7.015883 5.93161c111.74388 95.479788 185.857116 170.741078 279.614824 266.093304 29.65805 30.040735 61.165743 62.122454 96.436499 97.393211l7.271006 7.334787v459.859234c-0.063781 99.816879-81.703145 187.387854-174.823046 187.387854zM212.294239 49.94033c-72.391155 0-124.882716 47.261538-124.882716 112.381688v674.290128c0 71.94469 59.507443 137.383743 124.882716 137.383743h599.411522c65.311492 0 124.882716-65.439053 124.882716-137.383743V397.417876c-32.528184-32.464404-61.73977-62.250016-89.356836-90.377328-90.951355-92.418312-163.278729-165.957521-269.601245-257.163999H212.294239z" fill=#6c757d p-id="5656"></path><path d="M936.588477 449.526752h-212.326129c-99.753099 0-187.324073-81.703145-187.324073-174.823046V49.94033a25.002055 25.002055 0 0 1 49.94033 0v224.763376c0 65.311492 65.502834 124.882716 137.383743 124.882716h212.326129a25.002055 25.002055 0 1 1 0 49.94033z" fill=#6c757d p-id="5657"></path></svg></a></div>
        <div><a href="/archive"><svg t="1656411795742" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7334" width="12" height="12"><path d="M884.224 522.24H504.32V141.824c0-16.896-13.824-30.72-30.72-30.72-120.32 0-233.472 47.616-317.952 134.144S26.112 445.952 29.184 566.784c2.56 114.688 49.152 222.72 131.072 304.128 81.92 81.408 189.952 128 304.64 130.56h10.24c117.76 0 227.84-45.568 312.32-128.512 86.528-85.504 133.632-199.68 132.608-321.024-0.512-2.048-1.536-29.696-35.84-29.696z m-140.288 307.712c-74.752 73.728-173.056 112.64-277.504 110.592-205.824-4.608-370.688-169.472-375.296-374.784-3.072-104.448 35.84-202.752 108.544-277.504 65.536-67.072 151.552-107.52 243.712-114.688v378.88c0 16.896 13.824 30.72 30.72 30.72 129.024 0 311.296 0 382.976 0.512-6.144 93.184-46.08 179.712-113.152 246.272z" fill=#6c757d p-id="7335"></path><path d="M603.136 11.264c-8.192-0.512-15.872 3.072-22.016 8.704-5.632 5.632-9.216 13.824-9.216 22.016v378.88c0 16.896 13.824 30.72 30.72 30.72h378.88c16.896 0 30.72-13.824 30.72-30.72 0-223.744-183.808-407.552-409.088-409.6z m30.208 378.88V74.24c167.424 16.384 301.056 150.016 315.904 315.904h-315.904z" fill=#6c757d p-id="7336"></path></svg></a></div>
        <div id="light-dark" style="cursor: pointer;"><a><svg t="1656411842215" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5086" width="12" height="12"><path d="M1007.492874 384.513055c-8.795694-34.58307-21.189627-67.666874-36.682043-99.05151-2.698679-5.397358-10.894667-3.498287-10.894666 2.598728v0.299853c0 32.484098-6.896624 63.868734-19.890263 92.554691-10.694764 23.488501-25.487523 45.077933-43.978471 64.068635-41.779547 42.679107-99.05151 66.967217-158.722299 67.26707-61.869712 0.299853-119.941284-24.188159-162.920244-68.966238-40.280281-41.979449-62.56937-98.251902-62.269516-156.323473 0.399804-59.270984 23.588452-114.94373 65.567901-156.823229 19.59041-19.59041 42.179351-35.082826 66.667364-46.077443C672.956643 71.166451 704.041426 64.469729 736.125719 64.469729h1.299364c6.097015 0 8.096037-8.096037 2.598728-10.794715C708.739126 37.982696 675.655322 25.488812 641.172203 16.493216 599.492607 5.598549 555.714038-0.098662 510.536154 0.001289 222.37722 0.700947-7.41029 237.38508 0.185992 525.444064c7.096526 271.667008 225.889418 490.559851 497.456474 497.856279 287.559228 7.796183 524.14341-220.891864 525.842579-508.551044 0.299853-44.977981-5.297407-88.656599-15.992171-130.236244z m-83.15929 301.552378c-22.588942 53.27392-54.873137 101.250434-95.953027 142.330323-41.179841 41.179841-89.056403 73.464036-142.330324 95.953027-55.172991 23.288599-113.744317 35.182777-174.314666 35.182777s-119.141675-11.794226-174.314666-35.182777c-53.27392-22.588942-101.250434-54.873137-142.330323-95.953027-41.179841-41.179841-73.464036-89.056403-95.953027-142.330323C75.749001 630.892442 63.954774 572.221164 63.954774 511.750767s11.794226-119.141675 35.182777-174.314666c22.588942-53.27392 54.873137-101.250434 95.953027-142.330323 41.179841-41.179841 89.056403-73.464036 142.330323-95.953027C392.593892 75.7642 451.26517 63.969974 511.735567 63.969974c13.99315 0 27.886348 0.599706 41.679596 1.89907C489.246577 118.643209 448.266638 198.704016 448.266638 288.360126c0 159.022152 128.836929 287.859081 287.859081 287.859081 89.156354 0 168.817357-40.580134 221.691473-104.149015 1.099462 13.09359 1.699168 26.387082 1.699168 39.680575 0 60.470397-11.794226 119.141675-35.182776 174.314666z" p-id="5087" fill=#6c757d></path></svg></a></div>
        
    </div>

    
</div>

            <div id="toc">📜</div>
        
    
    
</div>
</div>
        <div id="content">












<div class="container-main 
     container-page 
">

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7409" width="12" height="12"><path d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z" p-id="7410" fill="#adb5bd"></path></svg>
            2022-03-20&nbsp;
        </span>
        <span>
            
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="23838" width="11" height="11"><path d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z" p-id="23839" fill="#adb5bd"></path></svg>
            2022-03-20&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="33866" width="12" height="12"><path d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z" fill="#adb5bd" p-id="33867"></path><path d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z" fill="#adb5bd" p-id="33868"></path></svg>
            9772 字</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="32892" width="12" height="12"><path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z" p-id="32893" fill="#adb5bd"></path><path d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z" p-id="32894" fill="#adb5bd"></path></svg>
            20 分钟</span><div class="container-ctgtag">
	<div class="taxonomy">
		
		<div class="ctg">
			
			
			<a href="/categories/"></a>
			
		</div>
		<div class="tag">
			
			 - 
			
			<a href="/tags/"></a>
			
		</div>
	</div>
</div>
    </div>
    
    <div class="toc">
        
        <div class="page-operation">
            <div><a href="#"><img src="/imgs/icons/arrow-up-circle.svg" alt=""></a></div>
            <div><a href="https://lovemjh.vercel.app/posts/blog/20220430231095/"><img src="/imgs/icons/arrow-left-circle.svg" alt=""></a></div>
            <div><a href="https://lovemjh.vercel.app/posts/java-frame/20220430230955/"><img src="/imgs/icons/arrow-right-circle.svg" alt=""></a></div>
        </div>
        
        <nav id="TableOfContents">
  <ul>
    <li><a href="#mybatis环境搭建">Mybatis环境搭建</a>
      <ul>
        <li><a href="#前期准备">前期准备</a>
          <ul>
            <li><a href="#创建数据库">创建数据库</a></li>
            <li><a href="#创建maven-java项目">创建maven Java项目</a></li>
            <li><a href="#导入依赖">导入依赖</a></li>
          </ul>
        </li>
        <li><a href="#搭建项目环境">搭建项目环境</a>
          <ul>
            <li><a href="#编写user实体类">编写User实体类</a></li>
            <li><a href="#编写持久层user接口">编写持久层User接口</a></li>
            <li><a href="#编写持久层user接口映射文件userdaoxml">编写持久层User接口映射文件UserDao.xml</a></li>
            <li><a href="#编写mybatis主配置文件sqlmapconfigxml">编写mybatis主配置文件SqlMapConfig.xml</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#mybatist入门案例">Mybatist入门案例</a>
      <ul>
        <li><a href="#入门案例编写">入门案例编写</a>
          <ul>
            <li><a href="#编写工具类读取配置文件">编写工具类读取配置文件</a></li>
            <li><a href="#使用代理对象操作数据库">使用代理对象操作数据库</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#mybatis执行原理分析">Mybatis执行原理分析</a>
      <ul>
        <li><a href="#配置文件分析">配置文件分析</a></li>
        <li><a href="#底层源码分析">底层源码分析</a></li>
        <li><a href="#执行原理图">执行原理图</a></li>
      </ul>
    </li>
    <li><a href="#mybatis基于代理dao实现crud操作">MyBatis基于代理Dao实现CRUD操作</a>
      <ul>
        <li><a href="#数据保存">数据保存</a>
          <ul>
            <li><a href="#定义数据添加的接口方法adduser">定义数据添加的接口方法addUser</a></li>
            <li><a href="#配置文件中配置对应的sql">配置文件中配置对应的sql</a></li>
            <li><a href="#添加测试方法">添加测试方法</a></li>
          </ul>
        </li>
        <li><a href="#数据更新">数据更新</a>
          <ul>
            <li><a href="#定义数据更新的接口方法updateuser">定义数据更新的接口方法updateUser</a></li>
            <li><a href="#配置文件中配置对应的sql-1">配置文件中配置对应的sql</a></li>
            <li><a href="#添加测试方法-1">添加测试方法</a></li>
          </ul>
        </li>
        <li><a href="#数据删除">数据删除</a>
          <ul>
            <li><a href="#定义数据删除的接口方法deleteuser">定义数据删除的接口方法deleteUser</a></li>
            <li><a href="#配置文件中配置对应的sql-2">配置文件中配置对应的sql</a></li>
            <li><a href="#添加测试方法-2">添加测试方法</a></li>
          </ul>
        </li>
        <li><a href="#和的区别">#{}和${}的区别</a></li>
        <li><a href="#mybatis实现模糊查询">MyBatis实现模糊查询</a>
          <ul>
            <li><a href="#添加模糊查询的接口方法likesearchusers">添加模糊查询的接口方法likeSearchUsers</a></li>
            <li><a href="#配置接口方法对应的sql文件">配置接口方法对应的sql文件</a>
              <ul>
                <li><a href="#配置占位符方式">配置占位符方式#</a></li>
                <li><a href="#配置拼接字符串方式">配置拼接字符串方式$</a></li>
                <li><a href="#配置mysql函数方式concat">配置mysql函数方式concat</a></li>
              </ul>
            </li>
            <li><a href="#模糊查询测试">模糊查询测试</a></li>
          </ul>
        </li>
        <li><a href="#mybatis的参数处理">MyBatis的参数处理</a>
          <ul>
            <li><a href="#parametertype-配置参数">parameterType 配置参数</a>
              <ul>
                <li><a href="#参数的使用说明">参数的使用说明</a></li>
                <li><a href="#参数配置的注意事项">参数配置的注意事项</a></li>
              </ul>
            </li>
            <li><a href="#传递-pojo-包装对象">传递 pojo 包装对象</a>
              <ul>
                <li><a href="#编写queryvo">编写QueryVo</a></li>
                <li><a href="#编写持久层接口usermapper">编写持久层接口UserMapper</a></li>
                <li><a href="#配置接口方法对应的sql文件-1">配置接口方法对应的sql文件</a></li>
                <li><a href="#测试queryvo对象作为参数">测试QueryVo对象作为参数</a></li>
              </ul>
            </li>
            <li><a href="#map集合数据作为参数的处理方式">map集合数据作为参数的处理方式</a>
              <ul>
                <li><a href="#添加接口方法参数使用map集合">添加接口方法参数使用map集合</a></li>
                <li><a href="#配置接口对应的sql配置">配置接口对应的sql配置</a></li>
                <li><a href="#测试map集合作为参数">测试map集合作为参数</a></li>
              </ul>
            </li>
            <li><a href="#param方式解决多参数处理">@Param方式解决多参数处理</a>
              <ul>
                <li><a href="#param注解的介绍">@Param注解的介绍</a></li>
                <li><a href="#添加接口方法参数使用map集合-1">添加接口方法参数使用map集合</a></li>
                <li><a href="#配置接口对应的sql配置-1">配置接口对应的sql配置</a></li>
                <li><a href="#测试注解方法">测试注解方法</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#mybatis查询结果封装">MyBatis查询结果封装</a>
          <ul>
            <li><a href="#resulttype结果类型">resultType结果类型</a>
              <ul>
                <li><a href="#resulttype属性介绍">resultType属性介绍</a></li>
                <li><a href="#resulttype属性的使用">resultType属性的使用</a>
                  <ul>
                    <li><a href="#基本类型">基本类型</a></li>
                    <li><a href="#实体类型">实体类型</a></li>
                    <li><a href="#特殊情况">特殊情况</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li><a href="#resultmap自定义结果类型">resultMap自定义结果类型</a>
              <ul>
                <li><a href="#resultmap标签介绍">resultMap标签介绍</a></li>
                <li><a href="#定义接口方法getuserbyid">定义接口方法getUserById</a></li>
                <li><a href="#在sql的配置文件中定义resultmap">在sql的配置文件中定义resultMap</a></li>
                <li><a href="#使用定义的resultmap配置查询的sql语句">使用定义的resultMap配置查询的sql语句</a></li>
                <li><a href="#测试查询结果">测试查询结果</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#sqlmapconfigxml配置文件内容解析">SqlMapConfig.xml配置文件内容解析</a>
          <ul>
            <li><a href="#标签的配置规范查看dtd规范文件">标签的配置规范，查看dtd规范文件</a></li>
            <li><a href="#properties标签详解">properties标签详解</a>
              <ul>
                <li><a href="#新建一个dbconfigproperties属性文件">新建一个dbconfig.properties属性文件</a></li>
                <li><a href="#在sqlmapperconfigxml中可以引用属性文件中key的值">在SqlMapperConfig.xml中可以引用属性文件中key的值</a></li>
              </ul>
            </li>
            <li><a href="#typealiases标签详解">typeAliases标签详解</a>
              <ul>
                <li><a href="#在sqlmapperconfigxml中定义别名">在SqlMapperConfig.xml中定义别名</a></li>
                <li><a href="#在usermapperxml中使用别名">在userMapper.xml中使用别名</a></li>
              </ul>
            </li>
            <li><a href="#mappers映射器标签详解">mappers映射器标签详解</a></li>
          </ul>
        </li>
        <li><a href="#mybatis自动返回主键值">MyBatis自动返回主键值</a>
          <ul>
            <li><a href="#返回主键值技术的业务应用场景">返回主键值技术的业务应用场景</a></li>
            <li><a href="#接口中编写adduser方法">接口中编写addUser方法</a></li>
            <li><a href="#在sql的配置文件中添加接口方法对应的sql配置">在sql的配置文件中添加接口方法对应的sql配置</a></li>
            <li><a href="#在sql标签上添加返回自增长的主键值的配置">在sql标签上添加返回自增长的主键值的配置</a></li>
            <li><a href="#测试">测试</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
    </div>

    <div class='content  content '>
        <h1 id="mybatis环境搭建">Mybatis环境搭建</h1>
<h2 id="前期准备">前期准备</h2>
<h3 id="创建数据库">创建数据库</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Sql" data-lang="Sql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">create</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">table</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">user</span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>id<span style="color:#bbb"> </span><span style="color:#0086b3">int</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">not</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span><span style="color:#bbb"> </span>auto_increment,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>name<span style="color:#bbb"> </span><span style="color:#0086b3">varchar</span>(<span style="color:#099">30</span>),<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>gender<span style="color:#bbb"> </span><span style="color:#0086b3">varchar</span>(<span style="color:#099">6</span>),<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>age<span style="color:#bbb"> </span><span style="color:#0086b3">int</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>birthday<span style="color:#bbb"> </span><span style="color:#0086b3">date</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">primary</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">key</span>(id)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>);<span style="color:#bbb"> 
</span></span></span></code></pre></div><h3 id="创建maven-java项目">创建maven Java项目</h3>
<blockquote>
<p>打开Idear&ndash;&gt;选择File&ndash;&gt;选择new&ndash;&gt;选择project</p>
</blockquote>
<h3 id="导入依赖">导入依赖</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span>dependencies<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">&lt;</span>dependency<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">&lt;</span>groupId<span style="color:#000;font-weight:bold">&gt;</span>org<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mybatis</span><span style="color:#000;font-weight:bold">&lt;/</span>groupId<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">&lt;</span>artifactId<span style="color:#000;font-weight:bold">&gt;</span>mybatis<span style="color:#000;font-weight:bold">&lt;/</span>artifactId<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">&lt;</span>version<span style="color:#000;font-weight:bold">&gt;</span>3<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">4</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">6</span><span style="color:#000;font-weight:bold">&lt;/</span>version<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">&lt;/</span>dependency<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">&lt;</span>dependency<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">&lt;</span>groupId<span style="color:#000;font-weight:bold">&gt;</span>mysql<span style="color:#000;font-weight:bold">&lt;/</span>groupId<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">&lt;</span>artifactId<span style="color:#000;font-weight:bold">&gt;</span>mysql<span style="color:#000;font-weight:bold">-</span>connector<span style="color:#000;font-weight:bold">-</span>java<span style="color:#000;font-weight:bold">&lt;/</span>artifactId<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">&lt;</span>version<span style="color:#000;font-weight:bold">&gt;</span>5<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">1</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">47</span><span style="color:#000;font-weight:bold">&lt;/</span>version<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">&lt;</span>scope<span style="color:#000;font-weight:bold">&gt;</span>runtime<span style="color:#000;font-weight:bold">&lt;/</span>scope<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">&lt;/</span>dependency<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">&lt;</span>dependency<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">&lt;</span>groupId<span style="color:#000;font-weight:bold">&gt;</span>junit<span style="color:#000;font-weight:bold">&lt;/</span>groupId<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">&lt;</span>artifactId<span style="color:#000;font-weight:bold">&gt;</span>junit<span style="color:#000;font-weight:bold">&lt;/</span>artifactId<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">&lt;</span>version<span style="color:#000;font-weight:bold">&gt;</span>4<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">12</span><span style="color:#000;font-weight:bold">&lt;/</span>version<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">&lt;</span>scope<span style="color:#000;font-weight:bold">&gt;</span>test<span style="color:#000;font-weight:bold">&lt;/</span>scope<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">&lt;/</span>dependency<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">&lt;</span>dependency<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">&lt;</span>groupId<span style="color:#000;font-weight:bold">&gt;</span>log4j<span style="color:#000;font-weight:bold">&lt;/</span>groupId<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">&lt;</span>artifactId<span style="color:#000;font-weight:bold">&gt;</span>log4j<span style="color:#000;font-weight:bold">&lt;/</span>artifactId<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">&lt;</span>version<span style="color:#000;font-weight:bold">&gt;</span>1<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">2</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">17</span><span style="color:#000;font-weight:bold">&lt;/</span>version<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">&lt;/</span>dependency<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;/</span>dependencies<span style="color:#000;font-weight:bold">&gt;</span>
</span></span></code></pre></div><h2 id="搭建项目环境">搭建项目环境</h2>
<h3 id="编写user实体类">编写User实体类</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">package</span> <span style="color:#555">cn.offcn.entity</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.io.Serializable</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.util.Date</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">User</span>  <span style="color:#000;font-weight:bold">implements</span> Serializable <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">private</span> Integer id<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">private</span> String name<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">private</span> String gender<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">private</span> Integer age<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">private</span> Date birthday<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#900;font-weight:bold">User</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#900;font-weight:bold">User</span><span style="color:#000;font-weight:bold">(</span>String name<span style="color:#000;font-weight:bold">,</span> String gender<span style="color:#000;font-weight:bold">,</span> Integer age<span style="color:#000;font-weight:bold">,</span> Date birthday<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">name</span> <span style="color:#000;font-weight:bold">=</span> name<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">gender</span> <span style="color:#000;font-weight:bold">=</span> gender<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">age</span> <span style="color:#000;font-weight:bold">=</span> age<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">birthday</span> <span style="color:#000;font-weight:bold">=</span> birthday<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//生成getter和setter方法
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="编写持久层user接口">编写持久层User接口</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">interface</span> <span style="color:#458;font-weight:bold">UserDao</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * 查询所有User对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @return 返回List集合
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> List<span style="color:#000;font-weight:bold">&lt;</span>User<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">queryAllUsers</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="编写持久层user接口映射文件userdaoxml">编写持久层User接口映射文件UserDao.xml</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Xml" data-lang="Xml"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">&lt;!DOCTYPE mapper
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">  PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">  &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;mapper</span> <span style="color:#008080">namespace=</span><span style="color:#d14">&#34;cn.offcn.dao.UserDao&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--配置查询的sql语句--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;select</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;queryAllUsers&#34;</span> <span style="color:#008080">resultType=</span><span style="color:#d14">&#34;cn.offcn.entity.User&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>   select * from user
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/select&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/mapper&gt;</span>
</span></span></code></pre></div><h3 id="编写mybatis主配置文件sqlmapconfigxml">编写mybatis主配置文件SqlMapConfig.xml</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Xml" data-lang="Xml"><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">&lt;!DOCTYPE configuration
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">  PUBLIC &#34;-//mybatis.org//DTD Config 3.0//EN&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#999;font-weight:bold;font-style:italic">  &#34;http://mybatis.org/dtd/mybatis-3-config.dtd&#34;&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- 配置 mybatis的环境 --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;environments</span> <span style="color:#008080">default=</span><span style="color:#d14">&#34;development&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">&lt;!-- 配置环境 --&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;environment</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;development&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#998;font-style:italic">&lt;!-- 配置事务的类型 --&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&lt;transactionManager</span> <span style="color:#008080">type=</span><span style="color:#d14">&#34;JDBC&#34;</span><span style="color:#000080">&gt;&lt;/transactionManager&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#998;font-style:italic">&lt;!-- 配置连接数据库的信息:用的是数据源【连接池】--&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&lt;dataSource</span> <span style="color:#008080">type=</span><span style="color:#d14">&#34;POOLED&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;driver&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;com.mysql.jdbc.Driver&#34;</span><span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;url&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;jdbc:mysql://localhost:3306/mybatis001&#34;</span><span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;username&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;root&#34;</span><span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;password&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;root&#34;</span><span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&lt;/dataSource&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;/environment&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/environments&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--  注册UserDao接品映射文件位置 --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;mappers&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&lt;mapper</span> <span style="color:#008080">resource=</span><span style="color:#d14">&#34;cn/offcn/dao/UserDao.xml&#34;</span><span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/mappers&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/configuration&gt;</span>
</span></span></code></pre></div><h1 id="mybatist入门案例">Mybatist入门案例</h1>
<h2 id="入门案例编写">入门案例编写</h2>
<h3 id="编写工具类读取配置文件">编写工具类读取配置文件</h3>
<p>利用Mybatis对数据库进行操作时，都需要产生Mybatis总配置文件的输入流对象、构建SqlSessionFactoryBuilder对象、调用build方法进产生SqlSessionFactory工厂对象、调用工厂类openSession()方法创建SqlSession对象，代码冗余量大，步聚颇有繁琐，所以我们对产生SqlSession对象利用工具类进行优化。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">package</span> <span style="color:#555">cn.offcn</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.apache.ibatis.io.Resources</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.apache.ibatis.session.SqlSession</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.apache.ibatis.session.SqlSessionFactory</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">org.apache.ibatis.session.SqlSessionFactoryBuilder</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">import</span> <span style="color:#555">java.io.InputStream</span><span style="color:#000;font-weight:bold">;</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">MyBatisUtils</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//定义静态变量sqlSessionFactory
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">static</span>  SqlSessionFactory sqlSessionFactory<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//创建静态块，当MyBatisUtils类被加载时，自动执行该静态块，始初数据。
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">static</span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">try</span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#998;font-style:italic">//获取mybatis主配置文件SqlMapperConfig.xml的输入流
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>      InputStream inputStream<span style="color:#000;font-weight:bold">=</span> Resources<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getResourceAsStream</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;SqlMapperConfig.xml&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>      <span style="color:#998;font-style:italic">//创建SqlSessionFactoryBuilder构建者对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>      SqlSessionFactoryBuilder sqlSessionFactoryBuilder <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> SqlSessionFactoryBuilder<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>      <span style="color:#998;font-style:italic">//调用build方法返回SqlSessionFactory工厂对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>      sqlSessionFactory <span style="color:#000;font-weight:bold">=</span> sqlSessionFactoryBuilder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">build</span><span style="color:#000;font-weight:bold">(</span>inputStream<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}</span><span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>Exception e<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>       e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">printStackTrace</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>      System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;初始化数据失失败&#34;</span><span style="color:#000;font-weight:bold">+</span>e<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMessage</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//创建getSqlSessionFactory方法返回SqlSessionFactory对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> SqlSessionFactory <span style="color:#900;font-weight:bold">getSqlSessionFactory</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> sqlSessionFactory<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//创建一个SqlSession对象并返回
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> SqlSession <span style="color:#900;font-weight:bold">getSession</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> sqlSessionFactory<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">openSession</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//关闭SqlSession方法
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">static</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">close</span><span style="color:#000;font-weight:bold">(</span>SqlSession session<span style="color:#000;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">if</span><span style="color:#000;font-weight:bold">(</span>session<span style="color:#000;font-weight:bold">!=</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> session<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">close</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="使用代理对象操作数据库">使用代理对象操作数据库</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">UserTest</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testQueryAllUsers</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span>  Exception<span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">//1.获取mybatis主配置文件SqlMapperConfig.xml的输入流
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  InputStream inputStream<span style="color:#000;font-weight:bold">=</span>Resources<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getResourceAsStream</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;SqlMapperConfig.xml&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">//2.创建SqlSessionFactoryBuilder构建者对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  SqlSessionFactoryBuilder sqlSessionFactoryBuilder <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> SqlSessionFactoryBuilder<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">//3.调用build方法返回SqlSessionFactory工厂对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  SqlSessionFactory sqlSessionFactory <span style="color:#000;font-weight:bold">=</span> sqlSessionFactoryBuilder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">build</span><span style="color:#000;font-weight:bold">(</span>inputStream<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">//4.调用sqlSessionFactory的openSession方法返回一个Session对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  SqlSession sqlSession <span style="color:#000;font-weight:bold">=</span> sqlSessionFactory<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">openSession</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">//5.调用SqlSession 创建 UserDao接口的代理对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  UserDao userDao <span style="color:#000;font-weight:bold">=</span> sqlSession<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMapper</span><span style="color:#000;font-weight:bold">(</span>UserDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">//6.调用代理对象的queryAllUsers方法查询所有User
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  List<span style="color:#000;font-weight:bold">&lt;</span>User<span style="color:#000;font-weight:bold">&gt;</span> users <span style="color:#000;font-weight:bold">=</span> userDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">queryAllUsers</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>  users<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">forEach</span><span style="color:#000;font-weight:bold">(</span>System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">::</span>print<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">//7.释放资源
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  sqlSession<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">close</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>  inputStream<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">close</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testQueryAllUsers2</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span>  Exception<span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span> <span style="color:#998;font-style:italic">//调用MyBatisUtils工具创建SqlSession对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  SqlSession sqlSession <span style="color:#000;font-weight:bold">=</span> MyBatisUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getSession</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">//调用SqlSession 创建 UserDao接口的代理对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  UserDao userDao <span style="color:#000;font-weight:bold">=</span> sqlSession<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMapper</span><span style="color:#000;font-weight:bold">(</span>UserDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">//调用代理对象的queryAllUsers方法查询所有User
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  List<span style="color:#000;font-weight:bold">&lt;</span>User<span style="color:#000;font-weight:bold">&gt;</span> users <span style="color:#000;font-weight:bold">=</span> userDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">queryAllUsers</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>  users<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">forEach</span><span style="color:#000;font-weight:bold">(</span>System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">::</span>print<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">//释放资源
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  sqlSession<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">close</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>  inputStream<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">close</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h1 id="mybatis执行原理分析">Mybatis执行原理分析</h1>
<h2 id="配置文件分析">配置文件分析</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span>1<span style="color:#000;font-weight:bold">.</span> 核心配置文件
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;?</span>xml version<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;1.0&#34;</span> encoding<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;UTF-8&#34;</span><span style="color:#000;font-weight:bold">?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!</span>DOCTYPE configuration
</span></span><span style="display:flex;"><span>        PUBLIC <span style="color:#d14">&#34;-//mybatis.org//DTD Config 3.0//EN&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#34;http://mybatis.org/dtd/mybatis-3-config.dtd&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span>configuration<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">&lt;!--</span> 配置 mybatis 的环境 <span style="color:#000;font-weight:bold">--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">&lt;</span>environments <span style="color:#000;font-weight:bold">default</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;development&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">&lt;!--</span> 配置的环境 <span style="color:#000;font-weight:bold">--&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">&lt;</span>environment id<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;development&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">&lt;!--</span> 配置事务的类型 <span style="color:#000;font-weight:bold">--&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">&lt;</span>transactionManager type<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;JDBC&#34;</span><span style="color:#000;font-weight:bold">&gt;&lt;/</span>transactionManager<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">&lt;!--</span> 配置连接数据库的信息<span style="color:#000;font-weight:bold">:</span>用的是数据源<span style="color:#a61717;background-color:#e3d2d2">【</span>连接池<span style="color:#000;font-weight:bold">)</span><span style="color:#a61717;background-color:#e3d2d2">】</span><span style="color:#000;font-weight:bold">--&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">&lt;</span>dataSource type<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;POOLED&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">&lt;</span>property name<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;driver&#34;</span> value<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;com.mysql.jdbc.Driver&#34;</span><span style="color:#000;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">&lt;</span>property name<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;url&#34;</span> value<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;jdbc:mysql://localhost:3306/mybatis001&#34;</span><span style="color:#000;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">&lt;</span>property name<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;username&#34;</span> value<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;root&#34;</span><span style="color:#000;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">&lt;</span>property name<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;password&#34;</span> value<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;root&#34;</span><span style="color:#000;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">&lt;/</span>dataSource<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">&lt;/</span>environment<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">&lt;/</span>environments<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">&lt;!--</span>  注册UserDao接品映射文件位置 <span style="color:#000;font-weight:bold">--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">&lt;</span>mappers<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">&lt;</span>mapper resource<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;cn/offcn/dao/UserDao.xml&#34;</span><span style="color:#000;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">&lt;/</span>mappers<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;/</span>configuration<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>核心配置文件参数详解<span style="color:#a61717;background-color:#e3d2d2">：</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">(</span>1<span style="color:#000;font-weight:bold">)</span>environment标签中的id属性值必须和environments标签中的default属性一致<span style="color:#a61717;background-color:#e3d2d2">。</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">(</span>2<span style="color:#000;font-weight:bold">)</span>事务管理器<span style="color:#a61717;background-color:#e3d2d2">：</span>
</span></span><span style="display:flex;"><span>    第一种采用JDBC事务类型<span style="color:#a61717;background-color:#e3d2d2">，</span>直接使用了 JDBC的提交和回滚设施<span style="color:#a61717;background-color:#e3d2d2">，</span>它依赖从数据源获得的连接来管理事务作用域<span style="color:#a61717;background-color:#e3d2d2">。</span>
</span></span><span style="display:flex;"><span>    第二种采用MANAGED事务类型<span style="color:#a61717;background-color:#e3d2d2">，</span>它从不提交或回滚一个连接<span style="color:#a61717;background-color:#e3d2d2">，</span>而是让容器来管理事务的整个生命周期<span style="color:#a61717;background-color:#e3d2d2">（</span>比如 JEE 应用服务器的上下文<span style="color:#a61717;background-color:#e3d2d2">）。</span>默认情况下它会关闭连接<span style="color:#a61717;background-color:#e3d2d2">。</span>然而一些容器并不希望连接被关闭<span style="color:#a61717;background-color:#e3d2d2">，</span>因此需要将 closeConnection 属性设置为 <span style="color:#000;font-weight:bold">false</span> 来阻止默认的关闭行为<span style="color:#a61717;background-color:#e3d2d2">。</span>例如<span style="color:#000;font-weight:bold">:</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">&lt;</span>transactionManager type<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;MANAGED&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>       <span style="color:#000;font-weight:bold">&lt;</span>property name<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;closeConnection&#34;</span> value<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;false&#34;</span><span style="color:#000;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">&lt;/</span>transactionManager<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">(</span>3<span style="color:#000;font-weight:bold">)</span> 数据源<span style="color:#a61717;background-color:#e3d2d2">（</span>dataSource<span style="color:#a61717;background-color:#e3d2d2">）</span>
</span></span><span style="display:flex;"><span>    dataSource元素使用标准的JDBC数据源接口来配置JDBC连接对象的资源<span style="color:#a61717;background-color:#e3d2d2">。</span>大多数 MyBatis 应用程序会按示例中的例子来配置数据源<span style="color:#a61717;background-color:#e3d2d2">。</span>     虽然数据源配置是可选的<span style="color:#a61717;background-color:#e3d2d2">，</span>但如果要启用延迟加载特性<span style="color:#a61717;background-color:#e3d2d2">，</span>就必须配置数据源<span style="color:#a61717;background-color:#e3d2d2">。</span>
</span></span><span style="display:flex;"><span>    有三种内建的数据源类型<span style="color:#a61717;background-color:#e3d2d2">（</span>也就是 type<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;[UNPOOLED|POOLED|JNDI]&#34;</span><span style="color:#a61717;background-color:#e3d2d2">）</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    UNPOOLED<span style="color:#a61717;background-color:#e3d2d2">–</span> 这个数据源的实现会每次请求时打开和关闭连接<span style="color:#a61717;background-color:#e3d2d2">。</span>虽然有点慢<span style="color:#a61717;background-color:#e3d2d2">，</span>但对那些数据库连接可用性要求不高的简单应用程序来说<span style="color:#a61717;background-color:#e3d2d2">，</span>是一个很好的选择<span style="color:#a61717;background-color:#e3d2d2">。</span> 性能表现则依赖于使用的数据库<span style="color:#a61717;background-color:#e3d2d2">，</span>对某些数据库来说<span style="color:#a61717;background-color:#e3d2d2">，</span>使用连接池并不重要<span style="color:#a61717;background-color:#e3d2d2">，</span>这个配置就很适合这种情形<span style="color:#a61717;background-color:#e3d2d2">。</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    POOLED<span style="color:#a61717;background-color:#e3d2d2">–</span> 这种数据源的实现利用<span style="color:#a61717;background-color:#e3d2d2">“</span>池<span style="color:#a61717;background-color:#e3d2d2">”</span>的概念将 JDBC 连接对象组织起来<span style="color:#a61717;background-color:#e3d2d2">，</span>避免了创建新的连接实例时所必需的初始化和认证时间<span style="color:#a61717;background-color:#e3d2d2">。</span> 这种处理方式很流行<span style="color:#a61717;background-color:#e3d2d2">，</span>能使并发 Web 应用快速响应请求<span style="color:#a61717;background-color:#e3d2d2">。</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    JNDI <span style="color:#a61717;background-color:#e3d2d2">–</span> 这个数据源实现是为了能在如 EJB 或应用服务器这类容器中使用<span style="color:#a61717;background-color:#e3d2d2">，</span>容器可以集中或在外部配置数据源<span style="color:#a61717;background-color:#e3d2d2">，</span>然后放置一个JNDI上下文的数据源引用<span style="color:#a61717;background-color:#e3d2d2">。</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">(</span>5<span style="color:#000;font-weight:bold">)</span> mapper中的resource属性用于指定映射文件的位置<span style="color:#a61717;background-color:#e3d2d2">。</span>mapper中有多个属性可以描述映射文件<span style="color:#a61717;background-color:#e3d2d2">，</span>分别为<span style="color:#a61717;background-color:#e3d2d2">：</span>
</span></span><span style="display:flex;"><span>        resource<span style="color:#000;font-weight:bold">=</span><span style="color:#a61717;background-color:#e3d2d2">“</span>cn<span style="color:#000;font-weight:bold">/</span>offcn<span style="color:#000;font-weight:bold">/</span>dao<span style="color:#000;font-weight:bold">/</span>UserDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">xml</span><span style="color:#a61717;background-color:#e3d2d2">”</span> 文件在多级目录中要用分隔符<span style="color:#a61717;background-color:#e3d2d2">“</span><span style="color:#000;font-weight:bold">/</span><span style="color:#a61717;background-color:#e3d2d2">”</span>隔开<span style="color:#a61717;background-color:#e3d2d2">。</span>
</span></span><span style="display:flex;"><span>        class<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;cn.offcn.dao.UserDao&#34;</span>  指定UserDao接口文件位置<span style="color:#a61717;background-color:#e3d2d2">，</span>但此时UserDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">xml必须和接口处在同一个包中并且文件名要</span> 相同<span style="color:#a61717;background-color:#e3d2d2">。</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>2<span style="color:#000;font-weight:bold">.</span> 映射文件
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span>mapper namespace<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;cn.offcn.dao.UserDao&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!--</span>配置查询的sql语句<span style="color:#000;font-weight:bold">--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span>select id<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;queryAllUsers&#34;</span> resultType<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;cn.offcn.entity.User&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>         select <span style="color:#000;font-weight:bold">*</span> from user
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;/</span>select<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;/</span>mapper<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>映射文件参数详解<span style="color:#a61717;background-color:#e3d2d2">：</span> 
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">(</span>1<span style="color:#000;font-weight:bold">)</span> namespace必须为接口的完全限定名<span style="color:#a61717;background-color:#e3d2d2">（</span>即包名<span style="color:#000;font-weight:bold">+</span>类名的格式<span style="color:#a61717;background-color:#e3d2d2">）。</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">(</span>2<span style="color:#000;font-weight:bold">)</span> select标签中的id必须和接口中声明的方法同名<span style="color:#a61717;background-color:#e3d2d2">。</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">(</span>3<span style="color:#000;font-weight:bold">)</span> 如果接口中方法有返回值<span style="color:#a61717;background-color:#e3d2d2">，</span>resyultType必须跟方法返回值一致并采用返回值的完全限定名来表示<span style="color:#a61717;background-color:#e3d2d2">。</span>
</span></span></code></pre></div><h2 id="底层源码分析">底层源码分析</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span>1<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">利用Resources的getResourceAsStream方法读取mybatis核心配置文件</span><span style="color:#a61717;background-color:#e3d2d2">，</span>该配置文件中注册数据源<span style="color:#a61717;background-color:#e3d2d2">【</span>dataSource<span style="color:#a61717;background-color:#e3d2d2">】</span>和映射文件的位置<span style="color:#a61717;background-color:#e3d2d2">【</span>mappers标签中的mapper子标签的resource属性<span style="color:#a61717;background-color:#e3d2d2">】。</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span>dataSource type<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;POOLED&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000;font-weight:bold">&lt;</span>property name<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;driver&#34;</span> value<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;com.mysql.jdbc.Driver&#34;</span><span style="color:#000;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000;font-weight:bold">&lt;</span>property name<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;url&#34;</span> value<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;jdbc:mysql://localhost:3306/mybatis001&#34;</span><span style="color:#000;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000;font-weight:bold">&lt;</span>property name<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;username&#34;</span> value<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;root&#34;</span><span style="color:#000;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000;font-weight:bold">&lt;</span>property name<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;password&#34;</span> value<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;root&#34;</span><span style="color:#000;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;/</span>dataSource<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span>mappers<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span>mapper resource<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;cn/offcn/dao/UserDao.xml&#34;</span><span style="color:#000;font-weight:bold">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;/</span>mappers<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>2<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">展开映射文件</span><span style="color:#a61717;background-color:#e3d2d2">【</span>UserDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">xml</span><span style="color:#a61717;background-color:#e3d2d2">】</span>中定义了查询方法<span style="color:#a61717;background-color:#e3d2d2">、</span>查询时所封装结果类型和所要执行的sql语句<span style="color:#a61717;background-color:#e3d2d2">。</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span>select id<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;queryAllUsers&#34;</span> resultType<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;cn.offcn.entity.User&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>   select <span style="color:#000;font-weight:bold">*</span> from user
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;/</span>select<span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>3<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">使用构建者模式SqlSessionFactoryBuilder类的build方法创建SqlSessionFactory对象</span><span style="color:#a61717;background-color:#e3d2d2">，</span>在build方法中从字节输入流中解析数据<span style="color:#a61717;background-color:#e3d2d2">。</span>
</span></span><span style="display:flex;"><span>SqlSessionFactoryBuilder sqlSessionFactoryBuilder <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> SqlSessionFactoryBuilder<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>sqlSessionFactory <span style="color:#000;font-weight:bold">=</span> sqlSessionFactoryBuilder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">build</span><span style="color:#000;font-weight:bold">(</span>inputStream<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//SqlSessionFactoryBuilder源码:
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//SqlSessionFactoryBuilder的build方法
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">public</span> SqlSessionFactory <span style="color:#900;font-weight:bold">build</span><span style="color:#000;font-weight:bold">(</span>InputStream inputStream<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">build</span><span style="color:#000;font-weight:bold">((</span>InputStream<span style="color:#000;font-weight:bold">)</span>inputStream<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">(</span>Properties<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> SqlSessionFactory <span style="color:#900;font-weight:bold">build</span><span style="color:#000;font-weight:bold">(</span>InputStream inputStream<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">build</span><span style="color:#000;font-weight:bold">((</span>InputStream<span style="color:#000;font-weight:bold">)</span>inputStream<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">(</span>String<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">(</span>Properties<span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> SqlSessionFactory <span style="color:#900;font-weight:bold">build</span><span style="color:#000;font-weight:bold">(</span>InputStream inputStream<span style="color:#000;font-weight:bold">,</span> String environment<span style="color:#000;font-weight:bold">,</span> Properties properties<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  SqlSessionFactory var5<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      XMLConfigBuilder parser <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> XMLConfigBuilder<span style="color:#000;font-weight:bold">(</span>inputStream<span style="color:#000;font-weight:bold">,</span> environment<span style="color:#000;font-weight:bold">,</span> properties<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>      var5 <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">build</span><span style="color:#000;font-weight:bold">(</span>parser<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">parse</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>Exception var14<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">throw</span> ExceptionFactory<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">wrapException</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Error building SqlSession.&#34;</span><span style="color:#000;font-weight:bold">,</span> var14<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">finally</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      ErrorContext<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">instance</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">reset</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          inputStream<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">close</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>IOException var13<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> var5<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> SqlSessionFactory <span style="color:#900;font-weight:bold">build</span><span style="color:#000;font-weight:bold">(</span>Configuration config<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">new</span> DefaultSqlSessionFactory<span style="color:#000;font-weight:bold">(</span>config<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//XMLConfigBuilder类的构造方法
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">public</span> <span style="color:#900;font-weight:bold">XMLConfigBuilder</span><span style="color:#000;font-weight:bold">(</span>InputStream inputStream<span style="color:#000;font-weight:bold">,</span> String environment<span style="color:#000;font-weight:bold">,</span> Properties props<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> XPathParser<span style="color:#000;font-weight:bold">(</span>inputStream<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span> props<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">new</span> XMLMapperEntityResolver<span style="color:#000;font-weight:bold">()),</span> environment<span style="color:#000;font-weight:bold">,</span>props<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#900;font-weight:bold">XPathParser</span><span style="color:#000;font-weight:bold">(</span>InputStream inputStream<span style="color:#000;font-weight:bold">,</span> <span style="color:#458;font-weight:bold">boolean</span> validation<span style="color:#000;font-weight:bold">,</span> Properties variables<span style="color:#000;font-weight:bold">,</span> EntityResolver entityResolver<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">commonConstructor</span><span style="color:#000;font-weight:bold">(</span>validation<span style="color:#000;font-weight:bold">,</span> variables<span style="color:#000;font-weight:bold">,</span> entityResolver<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">document</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">createDocument</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">new</span> InputSource<span style="color:#000;font-weight:bold">(</span>inputStream<span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>上述代码中我们可以看到创建了一个XMLConfigBuilder对象用来解析XML<span style="color:#a61717;background-color:#e3d2d2">，</span>把配置文件中所有标签及标签中属性值放封装到Configuration对象中并返回SqlSessionFactory对象<span style="color:#a61717;background-color:#e3d2d2">。</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>4<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">调用SqlSessionFactory对象的openSession方法返回一个SqlSession对象</span><span style="color:#a61717;background-color:#e3d2d2">，</span>SqlSessionFactory是一个接口<span style="color:#a61717;background-color:#e3d2d2">，</span>我们找到它的实现类
</span></span><span style="display:flex;"><span>DefaultSqlSessionFactory类<span style="color:#a61717;background-color:#e3d2d2">，</span>点击它的openSession方法<span style="color:#a61717;background-color:#e3d2d2">，</span>打开openSessionFromDataSource方法<span style="color:#a61717;background-color:#e3d2d2">。</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//DefaultSqlSessionFactory源码:
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">private</span> SqlSession <span style="color:#900;font-weight:bold">openSessionFromDataSource</span><span style="color:#000;font-weight:bold">(</span>ExecutorType execType<span style="color:#000;font-weight:bold">,</span> TransactionIsolationLevel level<span style="color:#000;font-weight:bold">,</span>      <span style="color:#458;font-weight:bold">boolean</span> autoCommit<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  Transaction tx <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  DefaultSqlSession var8<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      Environment environment <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">configuration</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getEnvironment</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>      TransactionFactory transactionFactory <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getTransactionFactoryFromEnvironment</span><span style="color:#000;font-weight:bold">(</span>environment<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>      <span style="color:#998;font-style:italic">//创建一个新事务，从环境中找到数据源。
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>      tx <span style="color:#000;font-weight:bold">=</span> transactionFactory<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">newTransaction</span><span style="color:#000;font-weight:bold">(</span>environment<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getDataSource</span><span style="color:#000;font-weight:bold">(),</span> level<span style="color:#000;font-weight:bold">,</span> autoCommit<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>      Executor executor <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">configuration</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">newExecutor</span><span style="color:#000;font-weight:bold">(</span>tx<span style="color:#000;font-weight:bold">,</span> execType<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>      <span style="color:#998;font-style:italic">//创建一个DefaultSqlSession对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>      var8 <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> DefaultSqlSession<span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">configuration</span><span style="color:#000;font-weight:bold">,</span> executor<span style="color:#000;font-weight:bold">,</span> autoCommit<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>Exception var12<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">closeTransaction</span><span style="color:#000;font-weight:bold">(</span>tx<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">throw</span> ExceptionFactory<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">wrapException</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Error opening session.  Cause: &#34;</span> <span style="color:#000;font-weight:bold">+</span> var12<span style="color:#000;font-weight:bold">,</span> var12<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">finally</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      ErrorContext<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">instance</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">reset</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> var8<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>5<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">调用sqlSession</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMapper</span><span style="color:#000;font-weight:bold">(</span>UserDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">)</span>方法返回一个UserDao接口的代理类对象<span style="color:#a61717;background-color:#e3d2d2">。</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//DefaultSqlSession源码:
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;</span> T <span style="color:#900;font-weight:bold">getMapper</span><span style="color:#000;font-weight:bold">(</span>Class<span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;</span> type<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">return</span> configuration<span style="color:#000;font-weight:bold">.&lt;</span>T<span style="color:#000;font-weight:bold">&gt;</span>getMapper<span style="color:#000;font-weight:bold">(</span>type<span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//Configuration类源码:
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;</span> T <span style="color:#900;font-weight:bold">getMapper</span><span style="color:#000;font-weight:bold">(</span>Class<span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;</span> type<span style="color:#000;font-weight:bold">,</span> SqlSession sqlSession<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">return</span> mapperRegistry<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMapper</span><span style="color:#000;font-weight:bold">(</span>type<span style="color:#000;font-weight:bold">,</span> sqlSession<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//MapperRegistry类源码:
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;</span> T <span style="color:#900;font-weight:bold">getMapper</span><span style="color:#000;font-weight:bold">(</span>Class<span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;</span> type<span style="color:#000;font-weight:bold">,</span> SqlSession sqlSession<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">final</span> MapperProxyFactory<span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;</span> mapperProxyFactory <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>MapperProxyFactory<span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;)</span> knownMappers<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span>type<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>mapperProxyFactory <span style="color:#000;font-weight:bold">==</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">throw</span> <span style="color:#000;font-weight:bold">new</span> BindingException<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Type &#34;</span> <span style="color:#000;font-weight:bold">+</span> type <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34; is not known to the MapperRegistry.&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">return</span> mapperProxyFactory<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">newInstance</span><span style="color:#000;font-weight:bold">(</span>sqlSession<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>Exception e<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">throw</span> <span style="color:#000;font-weight:bold">new</span> BindingException<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Error getting mapper instance. Cause: &#34;</span> <span style="color:#000;font-weight:bold">+</span> e<span style="color:#000;font-weight:bold">,</span> e<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//MapperProxyFactory类源码:
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">public</span> T <span style="color:#900;font-weight:bold">newInstance</span><span style="color:#000;font-weight:bold">(</span>SqlSession sqlSession<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">final</span> MapperProxy<span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;</span> mapperProxy <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> MapperProxy<span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;(</span>sqlSession<span style="color:#000;font-weight:bold">,</span> mapperInterface<span style="color:#000;font-weight:bold">,</span> methodCache<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">return</span> newInstance<span style="color:#000;font-weight:bold">(</span>mapperProxy<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//通过Proxy的newProxyInstance方法创建代理对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">protected</span> T <span style="color:#900;font-weight:bold">newInstance</span><span style="color:#000;font-weight:bold">(</span>MapperProxy<span style="color:#000;font-weight:bold">&lt;</span>T<span style="color:#000;font-weight:bold">&gt;</span> mapperProxy<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">(</span>T<span style="color:#000;font-weight:bold">)</span> Proxy<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">newProxyInstance</span><span style="color:#000;font-weight:bold">(</span>mapperInterface<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getClassLoader</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#000;font-weight:bold">new</span> Class<span style="color:#000;font-weight:bold">[]</span> <span style="color:#000;font-weight:bold">{</span> mapperInterface <span style="color:#000;font-weight:bold">},</span> mapperProxy<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//MapperProxy类源码:
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//invoke回调方法
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">public</span> Object <span style="color:#900;font-weight:bold">invoke</span><span style="color:#000;font-weight:bold">(</span>Object proxy<span style="color:#000;font-weight:bold">,</span> Method method<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">throws</span> Throwable <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">try</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>Object<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">equals</span><span style="color:#000;font-weight:bold">(</span>method<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getDeclaringClass</span><span style="color:#000;font-weight:bold">()))</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> method<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">invoke</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">,</span> args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>isDefaultMethod<span style="color:#000;font-weight:bold">(</span>method<span style="color:#000;font-weight:bold">))</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">return</span> invokeDefaultMethod<span style="color:#000;font-weight:bold">(</span>proxy<span style="color:#000;font-weight:bold">,</span> method<span style="color:#000;font-weight:bold">,</span> args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">catch</span> <span style="color:#000;font-weight:bold">(</span>Throwable t<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">throw</span> ExceptionUtil<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">unwrapThrowable</span><span style="color:#000;font-weight:bold">(</span>t<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">final</span> MapperMethod mapperMethod <span style="color:#000;font-weight:bold">=</span> cachedMapperMethod<span style="color:#000;font-weight:bold">(</span>method<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//调用执行器excute方法
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">return</span> mapperMethod<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">execute</span><span style="color:#000;font-weight:bold">(</span>sqlSession<span style="color:#000;font-weight:bold">,</span> args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//MapperMethod类源码:
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">public</span> Object <span style="color:#900;font-weight:bold">execute</span><span style="color:#000;font-weight:bold">(</span>SqlSession sqlSession<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">[]</span> args<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>Object result<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">switch</span> <span style="color:#000;font-weight:bold">(</span>command<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getType</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">case</span> INSERT<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>Object param <span style="color:#000;font-weight:bold">=</span> method<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">convertArgsToSqlCommandParam</span><span style="color:#000;font-weight:bold">(</span>args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  result <span style="color:#000;font-weight:bold">=</span> rowCountResult<span style="color:#000;font-weight:bold">(</span>sqlSession<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">insert</span><span style="color:#000;font-weight:bold">(</span>command<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getName</span><span style="color:#000;font-weight:bold">(),</span> param<span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">case</span> UPDATE<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  Object param <span style="color:#000;font-weight:bold">=</span> method<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">convertArgsToSqlCommandParam</span><span style="color:#000;font-weight:bold">(</span>args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  result <span style="color:#000;font-weight:bold">=</span> rowCountResult<span style="color:#000;font-weight:bold">(</span>sqlSession<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">update</span><span style="color:#000;font-weight:bold">(</span>command<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getName</span><span style="color:#000;font-weight:bold">(),</span> param<span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">case</span> DELETE<span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  Object param <span style="color:#000;font-weight:bold">=</span> method<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">convertArgsToSqlCommandParam</span><span style="color:#000;font-weight:bold">(</span>args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  result <span style="color:#000;font-weight:bold">=</span> rowCountResult<span style="color:#000;font-weight:bold">(</span>sqlSession<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">delete</span><span style="color:#000;font-weight:bold">(</span>command<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getName</span><span style="color:#000;font-weight:bold">(),</span> param<span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">case</span> SELECT<span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>method<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">returnsVoid</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">&amp;&amp;</span> method<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">hasResultHandler</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    executeWithResultHandler<span style="color:#000;font-weight:bold">(</span>sqlSession<span style="color:#000;font-weight:bold">,</span> args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    result <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">null</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>method<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">returnsMany</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    result <span style="color:#000;font-weight:bold">=</span> executeForMany<span style="color:#000;font-weight:bold">(</span>sqlSession<span style="color:#000;font-weight:bold">,</span> args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>method<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">returnsMap</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    result <span style="color:#000;font-weight:bold">=</span> executeForMap<span style="color:#000;font-weight:bold">(</span>sqlSession<span style="color:#000;font-weight:bold">,</span> args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>method<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">returnsCursor</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    result <span style="color:#000;font-weight:bold">=</span> executeForCursor<span style="color:#000;font-weight:bold">(</span>sqlSession<span style="color:#000;font-weight:bold">,</span> args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}</span> <span style="color:#000;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    Object param <span style="color:#000;font-weight:bold">=</span> method<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">convertArgsToSqlCommandParam</span><span style="color:#000;font-weight:bold">(</span>args<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    result <span style="color:#000;font-weight:bold">=</span> sqlSession<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">selectOne</span><span style="color:#000;font-weight:bold">(</span>command<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getName</span><span style="color:#000;font-weight:bold">(),</span> param<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">case</span> FLUSH<span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  result <span style="color:#000;font-weight:bold">=</span> sqlSession<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">flushStatements</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">break</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">default</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">throw</span> <span style="color:#000;font-weight:bold">new</span> BindingException<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Unknown execution method for: &#34;</span> <span style="color:#000;font-weight:bold">+</span> command<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getName</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span>result <span style="color:#000;font-weight:bold">==</span> <span style="color:#000;font-weight:bold">null</span> <span style="color:#000;font-weight:bold">&amp;&amp;</span> method<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getReturnType</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">isPrimitive</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">&amp;&amp;</span> <span style="color:#000;font-weight:bold">!</span>method<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">returnsVoid</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">throw</span> <span style="color:#000;font-weight:bold">new</span> BindingException<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;Mapper method &#39;&#34;</span> <span style="color:#000;font-weight:bold">+</span> command<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getName</span><span style="color:#000;font-weight:bold">()</span> 
</span></span><span style="display:flex;"><span>          <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34; attempted to return null from a method with a primitive return type (&#34;</span> <span style="color:#000;font-weight:bold">+</span> method<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getReturnType</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34;).&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> result<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="执行原理图">执行原理图</h2>
<p><img src="/posts/Java-frame/file:/D:/Meet/Documents/Java%E5%AD%A6%E4%B9%A0/java%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5/day01/01-%E7%AC%94%E8%AE%B0/images/mybatis%E6%89%A7%E8%A1%8C%E5%8E%9F%E7%90%86%E5%9B%BE.bmp?lastModify=1651586424"
    
    
    
    loading="lazy"
    
    
></p>
<h1 id="mybatis基于代理dao实现crud操作">MyBatis基于代理Dao实现CRUD操作</h1>
<h2 id="数据保存">数据保存</h2>
<h3 id="定义数据添加的接口方法adduser">定义数据添加的接口方法addUser</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">UserDao</span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">   新增添加用户方法
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">addUser</span><span style="color:#000;font-weight:bold">(</span>User user<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="配置文件中配置对应的sql">配置文件中配置对应的sql</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Xml" data-lang="Xml"><span style="display:flex;"><span><span style="color:#000080">&lt;insert</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;addUser&#34;</span> <span style="color:#008080">parameterType=</span><span style="color:#d14">&#34;cn.offcn.entity.User&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>insert into user(name,gender,age,birthday) values (#{name},#{gender},#{age},#{birthday})
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/insert&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#{}为mybatis的占位符，如果方法中传递的参数为实体类类型，#{实体类属性}
</span></span></code></pre></div><h3 id="添加测试方法">添加测试方法</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testAddUser</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span>  Exception<span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//获取SqlSession对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>SqlSession session <span style="color:#000;font-weight:bold">=</span> MyBatisUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getSession</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//调用SqlSession 创建 UserDao接口的代理对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>UserDao userDao <span style="color:#000;font-weight:bold">=</span> session<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMapper</span><span style="color:#000;font-weight:bold">(</span>UserDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//创建User对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>User user<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">new</span> User<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;何晓&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;男&#34;</span><span style="color:#000;font-weight:bold">,</span>22<span style="color:#000;font-weight:bold">,</span><span style="color:#000;font-weight:bold">new</span> Date<span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//调用addUser方法进行保存
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>userDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">addUser</span><span style="color:#000;font-weight:bold">(</span>user<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//关闭连接
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>MyBatisUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">close</span><span style="color:#000;font-weight:bold">(</span>session<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="数据更新">数据更新</h2>
<h3 id="定义数据更新的接口方法updateuser">定义数据更新的接口方法updateUser</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * 更新user对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param user
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">updateUser</span><span style="color:#000;font-weight:bold">(</span>User user<span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><h3 id="配置文件中配置对应的sql-1">配置文件中配置对应的sql</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Xml" data-lang="Xml"><span style="display:flex;"><span><span style="color:#000080">&lt;update</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;updateUser&#34;</span> <span style="color:#008080">parameterType=</span><span style="color:#d14">&#34;cn.offcn.entity.User&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>update user set name=#{name},gender=#{gender},age=#{age},birthday=#{birthday}  where id=#{id}
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/update&gt;</span>
</span></span></code></pre></div><h3 id="添加测试方法-1">添加测试方法</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>  
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testUpdateUser</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span>  Exception<span style="color:#000;font-weight:bold">{</span>  
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//获取SqlSession对象  
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>SqlSession session <span style="color:#000;font-weight:bold">=</span> MyBatisUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getSession</span><span style="color:#000;font-weight:bold">();</span>  
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//调用SqlSession 创建 UserDao接口的代理对象  
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>UserDao userDao <span style="color:#000;font-weight:bold">=</span> session<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMapper</span><span style="color:#000;font-weight:bold">(</span>UserDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>  
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//创建User对象  
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>User user<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">new</span> User<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;何晓飞&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;女&#34;</span><span style="color:#000;font-weight:bold">,</span>21<span style="color:#000;font-weight:bold">,</span><span style="color:#000;font-weight:bold">new</span> Date<span style="color:#000;font-weight:bold">());</span>  
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//指定要更新id  
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>user<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setId</span><span style="color:#000;font-weight:bold">(</span>1<span style="color:#000;font-weight:bold">);</span>  
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//调用updateUser方法进行修改  
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>userDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">updateUser</span><span style="color:#000;font-weight:bold">(</span>user<span style="color:#000;font-weight:bold">);</span>  
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//关闭连接  
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>MyBatisUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">close</span><span style="color:#000;font-weight:bold">(</span>session<span style="color:#000;font-weight:bold">);</span>  
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="数据删除">数据删除</h2>
<h3 id="定义数据删除的接口方法deleteuser">定义数据删除的接口方法deleteUser</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * 根据id删除指定user
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * @param id
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">deleteUser</span><span style="color:#000;font-weight:bold">(</span>Integer id<span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><h3 id="配置文件中配置对应的sql-2">配置文件中配置对应的sql</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Xml" data-lang="Xml"><span style="display:flex;"><span><span style="color:#000080">&lt;delete</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;deleteUser&#34;</span> <span style="color:#008080">parameterType=</span><span style="color:#d14">&#34;int&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>delete from user where id=#{id}
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/delete&gt;</span>
</span></span></code></pre></div><h3 id="添加测试方法-2">添加测试方法</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testDeleteUser</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span>  Exception<span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">//获取SqlSession对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  SqlSession session <span style="color:#000;font-weight:bold">=</span> MyBatisUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getSession</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">//调用SqlSession 创建 UserDao接口的代理对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  UserDao userDao <span style="color:#000;font-weight:bold">=</span> session<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMapper</span><span style="color:#000;font-weight:bold">(</span>UserDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">//调用deleteUser方法进行删除
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  userDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">deleteUser</span><span style="color:#000;font-weight:bold">(</span>2<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#998;font-style:italic">//关闭连接
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>  MyBatisUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">close</span><span style="color:#000;font-weight:bold">(</span>session<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="和的区别">#{}和${}的区别</h2>
<pre tabindex="0"><code>1.#{}是预编译处理，${}是字符串替换。  
2.Mybatis在处理${}时，就是把${}替换成变量的值。  
3.Mybatis在处理#{}时，会将 sql 中的#{}替换为?号，调用 PreparedStatement 的 set 方法来赋值。  
4.使用#{}可以有效的防止 SQL 注入，提高系统安全性。
</code></pre><h2 id="mybatis实现模糊查询">MyBatis实现模糊查询</h2>
<p>模糊查询在我们开发中是一项必不可缺少的重要内容。对于我们mybatis实现模糊查询有三种方式，以下具体的实现步聚：</p>
<h3 id="添加模糊查询的接口方法likesearchusers">添加模糊查询的接口方法likeSearchUsers</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * 根据name模糊查询  
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * @param name  
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    * @return  
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">    */</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> List<span style="color:#000;font-weight:bold">&lt;</span>User<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">likeSearcherUsers</span><span style="color:#000;font-weight:bold">(</span>String name<span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><h3 id="配置接口方法对应的sql文件">配置接口方法对应的sql文件</h3>
<h4 id="配置占位符方式">配置占位符方式#</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Xml" data-lang="Xml"><span style="display:flex;"><span><span style="color:#000080">&lt;select</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;likeSearcherUsers&#34;</span> <span style="color:#008080">parameterType=</span><span style="color:#d14">&#34;String&#34;</span> <span style="color:#008080">resultType=</span><span style="color:#d14">&#34;cn.offcn.entity.User&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>    select * from user where name like ’%‘ #{name} ’%‘
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/select&gt;</span>
</span></span></code></pre></div><h4 id="配置拼接字符串方式">配置拼接字符串方式$</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Xml" data-lang="Xml"><span style="display:flex;"><span><span style="color:#000080">&lt;select</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;likeSearcherUsers&#34;</span> <span style="color:#008080">parameterType=</span><span style="color:#d14">&#34;String&#34;</span> <span style="color:#008080">resultType=</span><span style="color:#d14">&#34;cn.offcn.entity.User&#34;</span><span style="color:#000080">&gt;</span>  
</span></span><span style="display:flex;"><span>    select * from user where name like &#39;%${value}%&#39;  
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/select&gt;</span>  
</span></span></code></pre></div><p>我们在上面将原来的#{}占位符，改成了<code>${value}</code>。注意如果用模糊查询的这种写法，那么<code>${value}</code>的写法就是固定的，不能写成其它名字。</p>
<h4 id="配置mysql函数方式concat">配置mysql函数方式concat</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Xml" data-lang="Xml"><span style="display:flex;"><span><span style="color:#000080">&lt;select</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;likeSearcherUsers&#34;</span> <span style="color:#008080">parameterType=</span><span style="color:#d14">&#34;String&#34;</span> <span style="color:#008080">resultType=</span><span style="color:#d14">&#34;cn.offcn.entity.User&#34;</span><span style="color:#000080">&gt;</span>  
</span></span><span style="display:flex;"><span>    select * from user where name like concat(&#39;%&#39;,#{name},&#39;%&#39;)  
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/select&gt;</span>
</span></span></code></pre></div><h3 id="模糊查询测试">模糊查询测试</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Test</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testSearcherUser</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span>  Exception<span style="color:#000;font-weight:bold">{</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//获取SqlSession对象  
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        SqlSession session <span style="color:#000;font-weight:bold">=</span> MyBatisUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getSession</span><span style="color:#000;font-weight:bold">();</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//调用SqlSession 创建 UserDao接口的代理对象  
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        UserDao userDao <span style="color:#000;font-weight:bold">=</span> session<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMapper</span><span style="color:#000;font-weight:bold">(</span>UserDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//调用likeSearcherUsersr方法进行模糊查询  
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        List<span style="color:#000;font-weight:bold">&lt;</span>User<span style="color:#000;font-weight:bold">&gt;</span> userList <span style="color:#000;font-weight:bold">=</span> userDao<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">likeSearcherUsers</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;张&#34;</span><span style="color:#000;font-weight:bold">);</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//遍历输出  
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        userList<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">forEach</span><span style="color:#000;font-weight:bold">(</span>System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">::</span>print<span style="color:#000;font-weight:bold">);</span>  
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//关闭连接  
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        MyBatisUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">close</span><span style="color:#000;font-weight:bold">(</span>session<span style="color:#000;font-weight:bold">);</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="mybatis的参数处理">MyBatis的参数处理</h2>
<h3 id="parametertype-配置参数">parameterType 配置参数</h3>
<h4 id="参数的使用说明">参数的使用说明</h4>
<p>上一章节中已经介绍了SQL语句传参，使用标签的 parameterType 属性来设定。该属性的取值可以是基本类型，引用类型（例如:String 类型），还可以是实体类类型（POJO 类）。同时也可以使用实体类的包装类，本章节将介绍如何使用实体类的包装类作为参数传递。</p>
<h4 id="参数配置的注意事项">参数配置的注意事项</h4>
<ul>
<li>基本类型和String可以直接写类型名称也可以使用包名.类名的方式，例如：java.lang.String。</li>
<li>实体类类型，目前我们只能使用全限定类名。</li>
<li>究其原因，是mybaits在加载时已经把常用的数据类型注册了别名，从而我们在使用时可以不写包名，而我们的是实体类并没有注册别名，所以必须写全限定类名。在今天课程的最后一个章节中将讲解如何注册实体类的别名。</li>
<li>mybatis 的官方文档的说明请参考下面表格数据。</li>
</ul>
<table>
<thead>
<tr>
<th><strong>别名</strong></th>
<th><strong>映射的类型</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>_byte</td>
<td>byte</td>
</tr>
<tr>
<td>_long</td>
<td>long</td>
</tr>
<tr>
<td>_short</td>
<td>short</td>
</tr>
<tr>
<td>_int</td>
<td>int</td>
</tr>
<tr>
<td>_integer</td>
<td>int</td>
</tr>
<tr>
<td>_double</td>
<td>double</td>
</tr>
<tr>
<td>_float</td>
<td>float</td>
</tr>
<tr>
<td>_boolean</td>
<td>boolean</td>
</tr>
<tr>
<td>string</td>
<td>String</td>
</tr>
<tr>
<td>byte</td>
<td>Byte</td>
</tr>
<tr>
<td>long</td>
<td>Long</td>
</tr>
<tr>
<td>short</td>
<td>Short</td>
</tr>
<tr>
<td>int</td>
<td>Integer</td>
</tr>
<tr>
<td>integer</td>
<td>Integer</td>
</tr>
<tr>
<td>double</td>
<td>Double</td>
</tr>
<tr>
<td>float</td>
<td>Float</td>
</tr>
<tr>
<td>boolean</td>
<td>Boolean</td>
</tr>
<tr>
<td>date</td>
<td>Date</td>
</tr>
<tr>
<td>decimal</td>
<td>BigDecimal</td>
</tr>
<tr>
<td>bigdecimal</td>
<td>BigDecimal</td>
</tr>
<tr>
<td>object</td>
<td>Object</td>
</tr>
<tr>
<td>map</td>
<td>Map</td>
</tr>
<tr>
<td>hashmap</td>
<td>HashMap</td>
</tr>
<tr>
<td>list</td>
<td>List</td>
</tr>
<tr>
<td>arraylist</td>
<td>ArrayList</td>
</tr>
<tr>
<td>collection</td>
<td>Collection</td>
</tr>
<tr>
<td>iterator</td>
<td>Iterator</td>
</tr>
</tbody>
</table>
<p>这些都是支持的默认别名。我们也可以从源码角度来看它们分别都是如何定义出来的。可以参考 TypeAliasRegistery.class 的源码</p>
<h3 id="传递-pojo-包装对象">传递 pojo 包装对象</h3>
<p>开发中通过 pojo 传递查询条件 ，查询条件是综合的查询条件，不仅包括用户查询条件还包括其它的查询条件（比如将用户购买商品信息也作为查询条件），这时可以使用包装对象传递输入参数，Pojo 类中包含 pojo。
需求：根据用户名查询用户信息，查询条件放到 QueryVo 的 user 属性中。</p>
<h4 id="编写queryvo">编写QueryVo</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">package</span> <span style="color:#555">cn.offcn.entity</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">QueryVo</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">private</span> User user<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> User <span style="color:#900;font-weight:bold">getUser</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">return</span> user<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setUser</span><span style="color:#000;font-weight:bold">(</span>User user<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">user</span> <span style="color:#000;font-weight:bold">=</span> user<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="编写持久层接口usermapper">编写持久层接口UserMapper</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">interface</span> <span style="color:#458;font-weight:bold">UserMapper</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> List<span style="color:#000;font-weight:bold">&lt;</span>User<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">getUserByLikeName</span><span style="color:#000;font-weight:bold">(</span>QueryVo queryVo<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="配置接口方法对应的sql文件-1">配置接口方法对应的sql文件</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Xml" data-lang="Xml"><span style="display:flex;"><span><span style="color:#000080">&lt;select</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;getUserByLikeName&#34;</span> <span style="color:#008080">parameterType=</span><span style="color:#d14">&#34;cn.offcn.entity.QueryVo&#34;</span> <span style="color:#008080">resultType=</span><span style="color:#d14">&#34;cn.offcn.entity.User&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>    select * from user where name like #{user.name}
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/select&gt;</span>
</span></span></code></pre></div><h4 id="测试queryvo对象作为参数">测试QueryVo对象作为参数</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testGetUserByLikeName</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span>  Exception<span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//获取SqlSession对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>SqlSession session <span style="color:#000;font-weight:bold">=</span> MyBatisUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getSession</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//调用SqlSession 创建 UserDao接口的代理对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>UserMapper userMapper <span style="color:#000;font-weight:bold">=</span> session<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMapper</span><span style="color:#000;font-weight:bold">(</span>UserMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//创建User对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>User user<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">new</span> User<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>user<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setName</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;%李%&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>QueryVo queryVo<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">new</span> QueryVo<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>queryVo<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setUser</span><span style="color:#000;font-weight:bold">(</span>user<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//调用deleteUser方法进行模糊查询
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>List<span style="color:#000;font-weight:bold">&lt;</span>User<span style="color:#000;font-weight:bold">&gt;</span> userList <span style="color:#000;font-weight:bold">=</span> userMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getUserByLikeName</span><span style="color:#000;font-weight:bold">(</span>queryVo<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>userList<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">forEach</span><span style="color:#000;font-weight:bold">(</span>System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">::</span>print<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//关闭连接
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>MyBatisUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">close</span><span style="color:#000;font-weight:bold">(</span>session<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="map集合数据作为参数的处理方式">map集合数据作为参数的处理方式</h3>
<h4 id="添加接口方法参数使用map集合">添加接口方法参数使用map集合</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> List<span style="color:#000;font-weight:bold">&lt;</span>User<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">getUserByGenderAndAge</span><span style="color:#000;font-weight:bold">(</span>Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span>Object<span style="color:#000;font-weight:bold">&gt;</span> map<span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><h4 id="配置接口对应的sql配置">配置接口对应的sql配置</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Xml" data-lang="Xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--#{}中参数必须和Map集合中的key保存一致，表示取Map集合中指定key的值。--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;select</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;getUserByGenderAndAge&#34;</span> <span style="color:#008080">parameterType=</span><span style="color:#d14">&#34;java.util.Map&#34;</span> <span style="color:#008080">resultType=</span><span style="color:#d14">&#34;cn.offcn.entity.User&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>    select * from user where gender=#{sex} and age=#{age}
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/select&gt;</span>
</span></span></code></pre></div><h4 id="测试map集合作为参数">测试map集合作为参数</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testGetUserByGenderAndAge</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span>  Exception<span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//获取SqlSession对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>SqlSession session <span style="color:#000;font-weight:bold">=</span> MyBatisUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getSession</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//调用SqlSession 创建 UserDao接口的代理对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>UserMapper userMapper <span style="color:#000;font-weight:bold">=</span> session<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMapper</span><span style="color:#000;font-weight:bold">(</span>UserMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span>Object<span style="color:#000;font-weight:bold">&gt;</span> map<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">new</span> HashMap<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span>Object<span style="color:#000;font-weight:bold">&gt;();</span>
</span></span><span style="display:flex;"><span>map<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;sex&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;男&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>map<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;age&#34;</span><span style="color:#000;font-weight:bold">,</span>22<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>List<span style="color:#000;font-weight:bold">&lt;</span>User<span style="color:#000;font-weight:bold">&gt;</span> userList <span style="color:#000;font-weight:bold">=</span> userMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getUserByGenderAndAge</span><span style="color:#000;font-weight:bold">(</span>map<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>userList<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">forEach</span><span style="color:#000;font-weight:bold">(</span>System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">::</span>print<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//关闭连接
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>MyBatisUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">close</span><span style="color:#000;font-weight:bold">(</span>session<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="param方式解决多参数处理">@Param方式解决多参数处理</h3>
<h4 id="param注解的介绍">@Param注解的介绍</h4>
<p><code>@Param</code>注解用于给方法内的参数取别名,当方法中拥有多个参数时，我们无法一次性将这些参数进行传递，尤其多个参数具有不同的数据类型时无法传递，所以我们利用<code>@Param</code>给每个方法中的参数取一个别名，在映射文件中使用别名进行取值。</p>
<h4 id="添加接口方法参数使用map集合-1">添加接口方法参数使用map集合</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> List<span style="color:#000;font-weight:bold">&lt;</span>User<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">getUserByGenderAndBirthday</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3c5d5d;font-weight:bold">@Param</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;gen&#34;</span><span style="color:#000;font-weight:bold">)</span> String gender<span style="color:#000;font-weight:bold">,</span>Param<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;birth&#34;</span><span style="color:#000;font-weight:bold">)</span> Date birthday<span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><h4 id="配置接口对应的sql配置-1">配置接口对应的sql配置</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Xml" data-lang="Xml"><span style="display:flex;"><span><span style="color:#000080">&lt;select</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;getUserByGenderAndBirthday&#34;</span> <span style="color:#008080">resultType=</span><span style="color:#d14">&#34;cn.offcn.entity.User&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>    select * from user where gender=#{gen} and age=#{birth}
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/select&gt;</span>
</span></span></code></pre></div><h4 id="测试注解方法">测试注解方法</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testGetUserByGenderAndBithday</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span>  Exception<span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//获取SqlSession对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>SqlSession session <span style="color:#000;font-weight:bold">=</span> MyBatisUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getSession</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//调用SqlSession 创建 UserDao接口的代理对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>UserMapper userMapper <span style="color:#000;font-weight:bold">=</span> session<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMapper</span><span style="color:#000;font-weight:bold">(</span>UserMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>Calendar calendar <span style="color:#000;font-weight:bold">=</span> Calendar<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getInstance</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>calendar<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">set</span><span style="color:#000;font-weight:bold">(</span>Calendar<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">YEAR</span><span style="color:#000;font-weight:bold">,</span>1997<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>calendar<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">set</span><span style="color:#000;font-weight:bold">(</span>Calendar<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">DAY_OF_MONTH</span><span style="color:#000;font-weight:bold">,</span>10<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>calendar<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">set</span><span style="color:#000;font-weight:bold">(</span>Calendar<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">DAY_OF_MONTH</span><span style="color:#000;font-weight:bold">,</span>12<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>Date birthday<span style="color:#000;font-weight:bold">=</span>calendar<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getTime</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>List<span style="color:#000;font-weight:bold">&lt;</span>User<span style="color:#000;font-weight:bold">&gt;</span> userList <span style="color:#000;font-weight:bold">=</span> userMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getUserByGenderAndBirthday</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;女&#34;</span><span style="color:#000;font-weight:bold">,</span>birthday<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>userList<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">forEach</span><span style="color:#000;font-weight:bold">(</span>System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">::</span>print<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//关闭连接
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>MyBatisUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">close</span><span style="color:#000;font-weight:bold">(</span>session<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="mybatis查询结果封装">MyBatis查询结果封装</h2>
<h3 id="resulttype结果类型">resultType结果类型</h3>
<h4 id="resulttype属性介绍">resultType属性介绍</h4>
<p>resultType 属性可以指定结果集的类型，它支持基本类型和实体类类型。我们在前面的 CRUD 案例中已经对此属性进行过应用了。需要注意的是，它和 parameterType 一样，如果注册过类型别名的，可以直接使用别名。没有注册过的必须使用全限定类名。例如：我们的实体类此时必须是全限定类名（今天最后一个章节会讲解如何配置实体类的别名）同时，当是实体类名称是，还有一个要求，实体类中的属性名称必须和查询语句中的列名保持一致，否则无法实现封装。</p>
<h4 id="resulttype属性的使用">resultType属性的使用</h4>
<h5 id="基本类型">基本类型</h5>
<ul>
<li>编写dao接口方法getTotalRecords参数是基本类型</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">* 统计所有记录数
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">* @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">getTotalRecords</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div><ul>
<li>配置接口方法对应的sql语句</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Xml" data-lang="Xml"><span style="display:flex;"><span><span style="color:#000080">&lt;select</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;getTotalRecords&#34;</span> <span style="color:#008080">resultType=</span><span style="color:#d14">&#34;int&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>    select count(*) from user
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/select&gt;</span>
</span></span></code></pre></div><ul>
<li>测试查询结果</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testGetTotalRecords</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span>  Exception<span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//获取SqlSession对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>SqlSession session <span style="color:#000;font-weight:bold">=</span> MyBatisUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getSession</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//调用SqlSession 创建 UserDao接口的代理对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>UserMapper userMapper <span style="color:#000;font-weight:bold">=</span> session<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMapper</span><span style="color:#000;font-weight:bold">(</span>UserMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//调用getTotalRecords统计记录数
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#458;font-weight:bold">int</span> totalRecords<span style="color:#000;font-weight:bold">=</span> userMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getTotalRecords</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//打印totalRecords
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;总记录数:&#34;</span><span style="color:#000;font-weight:bold">+</span>totalRecords<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//关闭连接
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>MyBatisUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">close</span><span style="color:#000;font-weight:bold">(</span>session<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h5 id="实体类型">实体类型</h5>
<ul>
<li>编写dao接口方法getAllInfo参数是对象类型</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> List<span style="color:#000;font-weight:bold">&lt;</span>User<span style="color:#000;font-weight:bold">&gt;</span> <span style="color:#900;font-weight:bold">getUsers</span><span style="color:#000;font-weight:bold">();</span>
</span></span></code></pre></div><ul>
<li>配置接口方法对应的sql语句</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Xml" data-lang="Xml"><span style="display:flex;"><span><span style="color:#000080">&lt;select</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;getUsers&#34;</span> <span style="color:#008080">resultType=</span><span style="color:#d14">&#34;cn.offcn.entity.User&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>    select * from user
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/select&gt;</span>
</span></span></code></pre></div><ul>
<li>测试查询结果</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testGetUser</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span>  Exception<span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//获取SqlSession对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>SqlSession session <span style="color:#000;font-weight:bold">=</span> MyBatisUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getSession</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//调用SqlSession 创建 UserDao接口的代理对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>UserMapper userMapper <span style="color:#000;font-weight:bold">=</span> session<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMapper</span><span style="color:#000;font-weight:bold">(</span>UserMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//调用getUsers查询所有记录
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>List<span style="color:#000;font-weight:bold">&lt;</span>User<span style="color:#000;font-weight:bold">&gt;</span> userList <span style="color:#000;font-weight:bold">=</span> userMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getUsers</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//遍历结果
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>userList<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">forEach</span><span style="color:#000;font-weight:bold">(</span>System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">::</span>print<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//关闭连接
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>MyBatisUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">close</span><span style="color:#000;font-weight:bold">(</span>session<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h5 id="特殊情况">特殊情况</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span>如果个修改了实体类User中的id属性值<span style="color:#a61717;background-color:#e3d2d2">，</span>比如修改成了userId<span style="color:#000;font-weight:bold">,</span>此时查询出的结果没有把表中的id值映射到userId属性中<span style="color:#a61717;background-color:#e3d2d2">，</span>因为属性和表中的列名不一致<span style="color:#a61717;background-color:#e3d2d2">，</span>内部无法用反射技术进行映射<span style="color:#a61717;background-color:#e3d2d2">，</span>所以为空<span style="color:#a61717;background-color:#e3d2d2">。</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">User</span>  <span style="color:#000;font-weight:bold">implements</span> Serializable <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">private</span> Integer userId<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">private</span> String userName<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">private</span> String gender<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">private</span> Integer age<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">private</span> Date userBirthday<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#900;font-weight:bold">User</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#900;font-weight:bold">User</span><span style="color:#000;font-weight:bold">(</span>String userName<span style="color:#000;font-weight:bold">,</span> String gender<span style="color:#000;font-weight:bold">,</span> Integer age<span style="color:#000;font-weight:bold">,</span> Date userBirthday<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">userName</span> <span style="color:#000;font-weight:bold">=</span> userName<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">gender</span> <span style="color:#000;font-weight:bold">=</span> gender<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">age</span> <span style="color:#000;font-weight:bold">=</span> age<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">birthday</span> <span style="color:#000;font-weight:bold">=</span> userBirthday<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> Integer <span style="color:#900;font-weight:bold">getUserId</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">return</span> userId<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setUserId</span><span style="color:#000;font-weight:bold">(</span>Integer userId<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">userId</span> <span style="color:#000;font-weight:bold">=</span> userId<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//生成其它属性的getter和setter方法
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testGetUser</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span>  Exception<span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//获取SqlSession对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>SqlSession session <span style="color:#000;font-weight:bold">=</span> MyBatisUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getSession</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//调用SqlSession 创建 UserDao接口的代理对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>UserMapper userMapper <span style="color:#000;font-weight:bold">=</span> session<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMapper</span><span style="color:#000;font-weight:bold">(</span>UserMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//调用getUsers查询所有记录
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>List<span style="color:#000;font-weight:bold">&lt;</span>User<span style="color:#000;font-weight:bold">&gt;</span> userList <span style="color:#000;font-weight:bold">=</span> userMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getUsers</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//遍历结果
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>userList<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">forEach</span><span style="color:#000;font-weight:bold">(</span>System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">::</span>print<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//关闭连接
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>MyBatisUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">close</span><span style="color:#000;font-weight:bold">(</span>session<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>经过上述测试结果发现userId属性为null<span style="color:#000;font-weight:bold">,</span>没有被赋上值<span style="color:#a61717;background-color:#e3d2d2">。</span>
</span></span><span style="display:flex;"><span>解决方案<span style="color:#a61717;background-color:#e3d2d2">：</span>修改映射配置<span style="color:#a61717;background-color:#e3d2d2">，</span>采用别名设置<span style="color:#a61717;background-color:#e3d2d2">，</span>让结果集中的列与实体类中的属性对应<span style="color:#a61717;background-color:#e3d2d2">。</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span>select id<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;getUsers&#34;</span> resultType<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;cn.offcn.entity.User&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>select id userId<span style="color:#000;font-weight:bold">,</span>name userName<span style="color:#000;font-weight:bold">,</span>gender gender<span style="color:#000;font-weight:bold">,</span>age age<span style="color:#000;font-weight:bold">,</span>birthday userBirthday from user
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;/</span>select<span style="color:#000;font-weight:bold">&gt;</span>
</span></span></code></pre></div><h3 id="resultmap自定义结果类型">resultMap自定义结果类型</h3>
<h4 id="resultmap标签介绍">resultMap标签介绍</h4>
<p>resultMap 标签可以建立查询的列名和实体类的属性名称不一致时建立对应关系。从而实现封装。在 select 标签中使用 resultMap 属性指定引用即可。同时 resultMap 可以实现将查询结果映射为复杂类型的 pojo，比如在查询结果映射对象中包括 pojo 和 list 实现一对一查询和一对多查询。</p>
<h4 id="定义接口方法getuserbyid">定义接口方法getUserById</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">* 根据id查询指定User对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">* @param id
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">* @return
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*/</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> User <span style="color:#900;font-weight:bold">getUserById</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> id<span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><h4 id="在sql的配置文件中定义resultmap">在sql的配置文件中定义resultMap</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Xml" data-lang="Xml"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;select</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;getUserById&#34;</span> <span style="color:#008080">parameterType=</span><span style="color:#d14">&#34;int&#34;</span> <span style="color:#008080">resultMap=</span><span style="color:#d14">&#34;UserResultMap&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>    select * from user where userId=#{id}
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/select&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;resultMap</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;UserResultMap&#34;</span> <span style="color:#008080">type=</span><span style="color:#d14">&#34;cn.offcn.entity.User&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/resultMap&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>此处我们使用resultMap而不是resultType, resultType是直接写结果类型，resultMap是映射结果集与类中属性对应关系。
</span></span><span style="display:flex;"><span>resultMap标签中的id表示一个唯一标记是resultMap的名称。
</span></span><span style="display:flex;"><span>type: 表示该resultMap返回的类型。
</span></span></code></pre></div><h4 id="使用定义的resultmap配置查询的sql语句">使用定义的resultMap配置查询的sql语句</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Xml" data-lang="Xml"><span style="display:flex;"><span><span style="color:#000080">&lt;resultMap</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;UserResultMap&#34;</span> <span style="color:#008080">type=</span><span style="color:#d14">&#34;cn.offcn.entity.User&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;id</span> <span style="color:#008080">column=</span><span style="color:#d14">&#34;id&#34;</span> <span style="color:#008080">property=</span><span style="color:#d14">&#34;userId&#34;</span><span style="color:#000080">&gt;&lt;/id&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;result</span> <span style="color:#008080">column=</span><span style="color:#d14">&#34;name&#34;</span> <span style="color:#008080">property=</span><span style="color:#d14">&#34;userName&#34;</span><span style="color:#000080">&gt;&lt;/result&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;result</span> <span style="color:#008080">column=</span><span style="color:#d14">&#34;gender&#34;</span> <span style="color:#008080">property=</span><span style="color:#d14">&#34;gender&#34;</span><span style="color:#000080">&gt;&lt;/result&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;result</span> <span style="color:#008080">column=</span><span style="color:#d14">&#34;age&#34;</span> <span style="color:#008080">property=</span><span style="color:#d14">&#34;age&#34;</span><span style="color:#000080">&gt;&lt;/result&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;result</span> <span style="color:#008080">column=</span><span style="color:#d14">&#34;birthday&#34;</span> <span style="color:#008080">property=</span><span style="color:#d14">&#34;userBirthday&#34;</span><span style="color:#000080">&gt;&lt;/result&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/resultMap&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>id 标签：用于指定主键字段
</span></span><span style="display:flex;"><span>result 标签：用于指定非主键字段
</span></span><span style="display:flex;"><span>column 属性：用于指定数据库列名
</span></span><span style="display:flex;"><span>property 属性：用于指定实体类属性名称
</span></span></code></pre></div><h4 id="测试查询结果">测试查询结果</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testGetUserById</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span>  Exception<span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//获取SqlSession对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>SqlSession session <span style="color:#000;font-weight:bold">=</span> MyBatisUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getSession</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//调用SqlSession 创建 UserDao接口的代理对象
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>UserMapper userMapper <span style="color:#000;font-weight:bold">=</span> session<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMapper</span><span style="color:#000;font-weight:bold">(</span>UserMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//查询user
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>User user <span style="color:#000;font-weight:bold">=</span> userMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getUserById</span><span style="color:#000;font-weight:bold">(</span>1<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//打印user
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>user<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//关闭连接
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>MyBatisUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">close</span><span style="color:#000;font-weight:bold">(</span>session<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="sqlmapconfigxml配置文件内容解析">SqlMapConfig.xml配置文件内容解析</h2>
<p>在主配置SqlMapConfig.xml中，定义了很多标签，我们现在只是使用了一部分标签 ，主配置文件中可以出现的标签 用dtd文 件进行约束。下面介绍其它标签的使用含义。</p>
<h3 id="标签的配置规范查看dtd规范文件">标签的配置规范，查看dtd规范文件</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dtd" data-lang="dtd"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">&lt;</span><span style="color:#000;font-weight:bold">?</span><span style="color:#a61717;background-color:#e3d2d2">xml</span> <span style="color:#a61717;background-color:#e3d2d2">version=</span><span style="color:#d14">&#34;1.0&#34;</span> <span style="color:#a61717;background-color:#e3d2d2">encoding=</span><span style="color:#d14">&#34;UTF-8&#34;</span> <span style="color:#000;font-weight:bold">?</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">Copyright 2009-2016 the original author or authors.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">you may not use this file except in compliance with the License.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">You may obtain a copy of the License at
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">http://www.apache.org/licenses/LICENSE-2.0
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">Unless required by applicable law or agreed to in writing, software
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">See the License for the specific language governing permissions and
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">limitations under the License.
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ELEMENT</span> <span style="color:#000080">configuration</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000080">properties</span><span style="color:#000;font-weight:bold">?,</span> <span style="color:#000080">settings</span><span style="color:#000;font-weight:bold">?,</span> <span style="color:#000080">typeAliases</span><span style="color:#000;font-weight:bold">?,</span> <span style="color:#000080">typeHandlers</span><span style="color:#000;font-weight:bold">?,</span> <span style="color:#000080">objectFactory</span><span style="color:#000;font-weight:bold">?,</span> <span style="color:#000080">objectWrapperFactory</span><span style="color:#000;font-weight:bold">?,</span> <span style="color:#000080">reflectorFactory</span><span style="color:#000;font-weight:bold">?,</span> <span style="color:#000080">plugins</span><span style="color:#000;font-weight:bold">?,</span> <span style="color:#000080">environments</span><span style="color:#000;font-weight:bold">?,</span> <span style="color:#000080">databaseIdProvider</span><span style="color:#000;font-weight:bold">?,</span> <span style="color:#000080">mappers</span><span style="color:#000;font-weight:bold">?)</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ELEMENT</span> <span style="color:#000080">databaseIdProvider</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000080">property</span><span style="color:#000;font-weight:bold">*)</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ATTLIST</span> <span style="color:#000080">databaseIdProvider</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">type</span> <span style="color:#000;font-weight:bold">CDATA</span> <span style="color:#000;font-weight:bold">#REQUIRED</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ELEMENT</span> <span style="color:#000080">properties</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000080">property</span><span style="color:#000;font-weight:bold">*)</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ATTLIST</span> <span style="color:#000080">properties</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">resource</span> <span style="color:#000;font-weight:bold">CDATA</span> <span style="color:#000;font-weight:bold">#IMPLIED</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">url</span> <span style="color:#000;font-weight:bold">CDATA</span> <span style="color:#000;font-weight:bold">#IMPLIED</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ELEMENT</span> <span style="color:#000080">property</span> <span style="color:#000;font-weight:bold">EMPTY</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ATTLIST</span> <span style="color:#000080">property</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">name</span> <span style="color:#000;font-weight:bold">CDATA</span> <span style="color:#000;font-weight:bold">#REQUIRED</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">value</span> <span style="color:#000;font-weight:bold">CDATA</span> <span style="color:#000;font-weight:bold">#REQUIRED</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ELEMENT</span> <span style="color:#000080">settings</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000080">setting</span><span style="color:#000;font-weight:bold">+)</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ELEMENT</span> <span style="color:#000080">setting</span> <span style="color:#000;font-weight:bold">EMPTY</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ATTLIST</span> <span style="color:#000080">setting</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">name</span> <span style="color:#000;font-weight:bold">CDATA</span> <span style="color:#000;font-weight:bold">#REQUIRED</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">value</span> <span style="color:#000;font-weight:bold">CDATA</span> <span style="color:#000;font-weight:bold">#REQUIRED</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ELEMENT</span> <span style="color:#000080">typeAliases</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000080">typeAlias</span><span style="color:#000;font-weight:bold">*,</span><span style="color:#000080">package</span><span style="color:#000;font-weight:bold">*)</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ELEMENT</span> <span style="color:#000080">typeAlias</span> <span style="color:#000;font-weight:bold">EMPTY</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ATTLIST</span> <span style="color:#000080">typeAlias</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">type</span> <span style="color:#000;font-weight:bold">CDATA</span> <span style="color:#000;font-weight:bold">#REQUIRED</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">alias</span> <span style="color:#000;font-weight:bold">CDATA</span> <span style="color:#000;font-weight:bold">#IMPLIED</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ELEMENT</span> <span style="color:#000080">typeHandlers</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000080">typeHandler</span><span style="color:#000;font-weight:bold">*,</span><span style="color:#000080">package</span><span style="color:#000;font-weight:bold">*)</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ELEMENT</span> <span style="color:#000080">typeHandler</span> <span style="color:#000;font-weight:bold">EMPTY</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ATTLIST</span> <span style="color:#000080">typeHandler</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">javaType</span> <span style="color:#000;font-weight:bold">CDATA</span> <span style="color:#000;font-weight:bold">#IMPLIED</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">jdbcType</span> <span style="color:#000;font-weight:bold">CDATA</span> <span style="color:#000;font-weight:bold">#IMPLIED</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">handler</span> <span style="color:#000;font-weight:bold">CDATA</span> <span style="color:#000;font-weight:bold">#REQUIRED</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ELEMENT</span> <span style="color:#000080">objectFactory</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000080">property</span><span style="color:#000;font-weight:bold">*)</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ATTLIST</span> <span style="color:#000080">objectFactory</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">type</span> <span style="color:#000;font-weight:bold">CDATA</span> <span style="color:#000;font-weight:bold">#REQUIRED</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ELEMENT</span> <span style="color:#000080">objectWrapperFactory</span> <span style="color:#000;font-weight:bold">EMPTY</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ATTLIST</span> <span style="color:#000080">objectWrapperFactory</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">type</span> <span style="color:#000;font-weight:bold">CDATA</span> <span style="color:#000;font-weight:bold">#REQUIRED</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ELEMENT</span> <span style="color:#000080">reflectorFactory</span> <span style="color:#000;font-weight:bold">EMPTY</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ATTLIST</span> <span style="color:#000080">reflectorFactory</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">type</span> <span style="color:#000;font-weight:bold">CDATA</span> <span style="color:#000;font-weight:bold">#REQUIRED</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ELEMENT</span> <span style="color:#000080">plugins</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000080">plugin</span><span style="color:#000;font-weight:bold">+)</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ELEMENT</span> <span style="color:#000080">plugin</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000080">property</span><span style="color:#000;font-weight:bold">*)</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ATTLIST</span> <span style="color:#000080">plugin</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">interceptor</span> <span style="color:#000;font-weight:bold">CDATA</span> <span style="color:#000;font-weight:bold">#REQUIRED</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ELEMENT</span> <span style="color:#000080">environments</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000080">environment</span><span style="color:#000;font-weight:bold">+)</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ATTLIST</span> <span style="color:#000080">environments</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">default</span> <span style="color:#000;font-weight:bold">CDATA</span> <span style="color:#000;font-weight:bold">#REQUIRED</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ELEMENT</span> <span style="color:#000080">environment</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000080">transactionManager</span><span style="color:#000;font-weight:bold">,</span><span style="color:#000080">dataSource</span><span style="color:#000;font-weight:bold">)</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ATTLIST</span> <span style="color:#000080">environment</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">id</span> <span style="color:#000;font-weight:bold">CDATA</span> <span style="color:#000;font-weight:bold">#REQUIRED</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ELEMENT</span> <span style="color:#000080">transactionManager</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000080">property</span><span style="color:#000;font-weight:bold">*)</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ATTLIST</span> <span style="color:#000080">transactionManager</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">type</span> <span style="color:#000;font-weight:bold">CDATA</span> <span style="color:#000;font-weight:bold">#REQUIRED</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ELEMENT</span> <span style="color:#000080">dataSource</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000080">property</span><span style="color:#000;font-weight:bold">*)</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ATTLIST</span> <span style="color:#000080">dataSource</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">type</span> <span style="color:#000;font-weight:bold">CDATA</span> <span style="color:#000;font-weight:bold">#REQUIRED</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ELEMENT</span> <span style="color:#000080">mappers</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000080">mapper</span><span style="color:#000;font-weight:bold">*,</span><span style="color:#000080">package</span><span style="color:#000;font-weight:bold">*)</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ELEMENT</span> <span style="color:#000080">mapper</span> <span style="color:#000;font-weight:bold">EMPTY</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ATTLIST</span> <span style="color:#000080">mapper</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">resource</span> <span style="color:#000;font-weight:bold">CDATA</span> <span style="color:#000;font-weight:bold">#IMPLIED</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">url</span> <span style="color:#000;font-weight:bold">CDATA</span> <span style="color:#000;font-weight:bold">#IMPLIED</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">class</span> <span style="color:#000;font-weight:bold">CDATA</span> <span style="color:#000;font-weight:bold">#IMPLIED</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ELEMENT</span> <span style="color:#000080">package</span> <span style="color:#000;font-weight:bold">EMPTY</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;!ATTLIST</span> <span style="color:#000080">package</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">name</span> <span style="color:#000;font-weight:bold">CDATA</span> <span style="color:#000;font-weight:bold">#REQUIRED</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span></code></pre></div><h3 id="properties标签详解">properties标签详解</h3>
<p>在使用 properties 标签配置时,在xml中可以引用properties属性文件中key的值，日后修改properties属性文 件中key的值时，不用修改xml文件，从而提高了效率。</p>
<h4 id="新建一个dbconfigproperties属性文件">新建一个dbconfig.properties属性文件</h4>
<pre tabindex="0"><code class="language-properties" data-lang="properties">jdbc.driver=com.mysql.jdbc.Driver
jdbc.url=jdbc:mysql:///mybatis001
jdbc.username=root
jdbc.password=root
</code></pre><h4 id="在sqlmapperconfigxml中可以引用属性文件中key的值">在SqlMapperConfig.xml中可以引用属性文件中key的值</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;properties</span> <span style="color:#008080">resource=</span><span style="color:#d14">&#34;dbconfig.properties&#34;</span><span style="color:#000080">&gt;&lt;/properties&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;dataSource</span> <span style="color:#008080">type=</span><span style="color:#d14">&#34;POOLED&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;driver&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;${jdbc.driver}&#34;</span><span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;url&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;${jdbc.url}&#34;</span><span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;username&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;${jdbc.username}&#34;</span><span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;property</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;password&#34;</span> <span style="color:#008080">value=</span><span style="color:#d14">&#34;${jdbc.password}&#34;</span><span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/dataSource&gt;</span>
</span></span></code></pre></div><h3 id="typealiases标签详解">typeAliases标签详解</h3>
<p>在前面我们讲的 Mybatis 支持的默认别名，我们也可以采用自定义别名方式来开发。</p>
<h4 id="在sqlmapperconfigxml中定义别名">在SqlMapperConfig.xml中定义别名</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;typeAliases&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- 单个别名定义 --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;typeAlias</span> <span style="color:#008080">alias=</span><span style="color:#d14">&#34;user&#34;</span> <span style="color:#008080">type=</span><span style="color:#d14">&#34;cn.offcn.entity.User&#34;</span><span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!-- 批量别名定义，扫描整个包下的类，别名为类名（首字母大写或小写都可以） --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;package</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34;cn.offcn.entity&#34;</span><span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;package</span> <span style="color:#008080">name=</span><span style="color:#d14">&#34; 其它包 &#34;</span><span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/typeAliases&gt;</span>
</span></span></code></pre></div><h4 id="在usermapperxml中使用别名">在userMapper.xml中使用别名</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;select</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;getUsers&#34;</span> <span style="color:#008080">resultType=</span><span style="color:#d14">&#34;user&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>select * from user
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/select&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;select</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;getUserById&#34;</span> <span style="color:#008080">parameterType=</span><span style="color:#d14">&#34;int&#34;</span> <span style="color:#008080">resultMap=</span><span style="color:#d14">&#34;UserResultMap&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span>select * from user where userId=#{id}
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/select&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;resultMap</span> <span style="color:#008080">id=</span><span style="color:#d14">&#34;UserResultMap&#34;</span> <span style="color:#008080">type=</span><span style="color:#d14">&#34;user&#34;</span><span style="color:#000080">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;id</span> <span style="color:#008080">column=</span><span style="color:#d14">&#34;id&#34;</span> <span style="color:#008080">property=</span><span style="color:#d14">&#34;userId&#34;</span><span style="color:#000080">&gt;&lt;/id&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;result</span> <span style="color:#008080">column=</span><span style="color:#d14">&#34;name&#34;</span> <span style="color:#008080">property=</span><span style="color:#d14">&#34;userName&#34;</span><span style="color:#000080">&gt;&lt;/result&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;result</span> <span style="color:#008080">column=</span><span style="color:#d14">&#34;gender&#34;</span> <span style="color:#008080">property=</span><span style="color:#d14">&#34;gender&#34;</span><span style="color:#000080">&gt;&lt;/result&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;result</span> <span style="color:#008080">column=</span><span style="color:#d14">&#34;age&#34;</span> <span style="color:#008080">property=</span><span style="color:#d14">&#34;age&#34;</span><span style="color:#000080">&gt;&lt;/result&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;result</span> <span style="color:#008080">column=</span><span style="color:#d14">&#34;birthday&#34;</span> <span style="color:#008080">property=</span><span style="color:#d14">&#34;userBirthday&#34;</span><span style="color:#000080">&gt;&lt;/result&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/resultMap&gt;</span>
</span></span></code></pre></div><h3 id="mappers映射器标签详解">mappers映射器标签详解</h3>
<p>mappers映射器用于指定映射文件的位置。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--使用相对于类路径的资源--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;mappers&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;mapper</span> <span style="color:#008080">resource=</span><span style="color:#d14">&#34;cn/offcn/dao/UserDao.xml&#34;</span><span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/mappers&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--使用mapper接口类路径--&gt;</span>
</span></span><span style="display:flex;"><span>如：<span style="color:#000080">&lt;mapper</span> <span style="color:#008080">class=</span><span style="color:#d14">&#34;cn.offcn.dao.UserDao&#34;</span><span style="color:#000080">/&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>注意：此种方法要求mapper接口名称和mapper映射文件名称相同，且放在同一个目录中。
</span></span></code></pre></div><h2 id="mybatis自动返回主键值">MyBatis自动返回主键值</h2>
<h3 id="返回主键值技术的业务应用场景">返回主键值技术的业务应用场景</h3>
<p>对于自增主键在某些业务中保存一个对象后，需要使用到这个主键完成后续的业务逻辑，比如：要保存订单后，还要保存订单项信息，订单项相信需要用到订单主键。所以应用场合很多，下面我们来应用一下返回主键值操作。</p>
<h3 id="接口中编写adduser方法">接口中编写addUser方法</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Java" data-lang="Java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**  
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">* 保存user对象  
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">* @param user  
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">*/</span>  
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">saveUser</span><span style="color:#000;font-weight:bold">(</span>User user<span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><h3 id="在sql的配置文件中添加接口方法对应的sql配置">在sql的配置文件中添加接口方法对应的sql配置</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Sql" data-lang="Sql"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>id<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;saveUser&#34;</span><span style="color:#bbb"> </span>parameterType<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;cn.offcn.entity.User&#34;</span><span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb">  
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">insert</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">into</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">user</span><span style="color:#bbb"> </span>(name,gender,age,birthday)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">values</span>(<span style="color:#000;font-weight:bold">#</span><span style="color:#a61717;background-color:#e3d2d2">{</span>name<span style="color:#a61717;background-color:#e3d2d2">}</span>,<span style="color:#000;font-weight:bold">#</span><span style="color:#a61717;background-color:#e3d2d2">{</span>gender<span style="color:#a61717;background-color:#e3d2d2">}</span>,<span style="color:#000;font-weight:bold">#</span><span style="color:#a61717;background-color:#e3d2d2">{</span>age<span style="color:#a61717;background-color:#e3d2d2">}</span>,<span style="color:#000;font-weight:bold">#</span><span style="color:#a61717;background-color:#e3d2d2">{</span>birthday<span style="color:#a61717;background-color:#e3d2d2">}</span>)<span style="color:#bbb">  
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#000;font-weight:bold">select</span><span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb">
</span></span></span></code></pre></div><h3 id="在sql标签上添加返回自增长的主键值的配置">在sql标签上添加返回自增长的主键值的配置</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Sql" data-lang="Sql"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">第一种方式</span>:<span style="color:#bbb">  
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#000;font-weight:bold">insert</span><span style="color:#bbb"> </span>id<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;saveUser&#34;</span><span style="color:#bbb"> </span>parameterType<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;cn.offcn.entity.User&#34;</span><span style="color:#bbb"> </span>useGeneratedKeys<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;true&#34;</span><span style="color:#bbb"> </span>keyProperty<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;id&#34;</span><span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb">  
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">insert</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">into</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">user</span><span style="color:#bbb"> </span>(name,gender,age,birthday)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">values</span>(<span style="color:#000;font-weight:bold">#</span><span style="color:#a61717;background-color:#e3d2d2">{</span>name<span style="color:#a61717;background-color:#e3d2d2">}</span>,<span style="color:#000;font-weight:bold">#</span><span style="color:#a61717;background-color:#e3d2d2">{</span>gender<span style="color:#a61717;background-color:#e3d2d2">}</span>,<span style="color:#000;font-weight:bold">#</span><span style="color:#a61717;background-color:#e3d2d2">{</span>age<span style="color:#a61717;background-color:#e3d2d2">}</span>,<span style="color:#000;font-weight:bold">#</span><span style="color:#a61717;background-color:#e3d2d2">{</span>birthday<span style="color:#a61717;background-color:#e3d2d2">}</span>)<span style="color:#bbb">  
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#000;font-weight:bold">insert</span><span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb">  
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>useGeneratedKeys:<span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">表示开启获取自增主键值。</span><span style="color:#bbb">  
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>keyProperty<span style="color:#a61717;background-color:#e3d2d2">：</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">表示从表中取到主键值后赋给</span>User类中的哪个属性<span style="color:#a61717;background-color:#e3d2d2">。</span><span style="color:#bbb">  
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#a61717;background-color:#e3d2d2">第二种方式</span>:<span style="color:#a61717;background-color:#e3d2d2">使用</span>selectKey标签和mysql内置函数<span style="color:#bbb">  
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#000;font-weight:bold">insert</span><span style="color:#bbb"> </span>id<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;saveUser&#34;</span><span style="color:#bbb"> </span>parameterType<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;cn.offcn.entity.User&#34;</span><span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb">  
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">&lt;</span>selectKey<span style="color:#bbb"> </span>keyColumn<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;id&#34;</span><span style="color:#bbb"> </span>keyProperty<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;id&#34;</span><span style="color:#bbb"> </span>resultType<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;int&#34;</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">order</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;AFTER&#34;</span><span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb">  
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">select</span><span style="color:#bbb"> </span>last_insert_id()<span style="color:#bbb">  
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">&lt;/</span>selectKey<span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb">  
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">insert</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">into</span><span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">user</span><span style="color:#bbb"> </span>(name,gender,age,birthday)<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">values</span>(<span style="color:#000;font-weight:bold">#</span><span style="color:#a61717;background-color:#e3d2d2">{</span>name<span style="color:#a61717;background-color:#e3d2d2">}</span>,<span style="color:#000;font-weight:bold">#</span><span style="color:#a61717;background-color:#e3d2d2">{</span>gender<span style="color:#a61717;background-color:#e3d2d2">}</span>,<span style="color:#000;font-weight:bold">#</span><span style="color:#a61717;background-color:#e3d2d2">{</span>age<span style="color:#a61717;background-color:#e3d2d2">}</span>,<span style="color:#000;font-weight:bold">#</span><span style="color:#a61717;background-color:#e3d2d2">{</span>birthday<span style="color:#a61717;background-color:#e3d2d2">}</span>)<span style="color:#bbb">  
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#000;font-weight:bold">insert</span><span style="color:#000;font-weight:bold">&gt;</span><span style="color:#bbb">  
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>keyColumn:<span style="color:#a61717;background-color:#e3d2d2">指定取数据库中哪一列的值（通常指主键列）。</span><span style="color:#bbb">  
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>keyProperty<span style="color:#a61717;background-color:#e3d2d2">：</span><span style="color:#bbb"> </span><span style="color:#a61717;background-color:#e3d2d2">表示取出主键值后赋值</span>User对象的哪个属性<span style="color:#a61717;background-color:#e3d2d2">。</span><span style="color:#bbb">  
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>resultType<span style="color:#a61717;background-color:#e3d2d2">：</span><span style="color:#bbb">  </span><span style="color:#a61717;background-color:#e3d2d2">表示对象的属性类型</span><span style="color:#bbb">  
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#000;font-weight:bold">order</span><span style="color:#a61717;background-color:#e3d2d2">：表示完后</span>sql语句之前还是之后把主键值赋给实体类对应属性<span style="color:#a61717;background-color:#e3d2d2">。</span><span style="color:#bbb">
</span></span></span></code></pre></div><h3 id="测试">测试</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>  
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testsaveUser</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span>  Exception<span style="color:#000;font-weight:bold">{</span>  
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//获取SqlSession对象  
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>SqlSession session <span style="color:#000;font-weight:bold">=</span> MyBatisUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getSession</span><span style="color:#000;font-weight:bold">();</span>  
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//调用SqlSession 创建 UserDao接口的代理对象  
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>UserMapper userMapper <span style="color:#000;font-weight:bold">=</span> session<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMapper</span><span style="color:#000;font-weight:bold">(</span>UserMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>  
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//创建User对象  
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>User user<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">new</span> User<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;刘备&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;男&#34;</span><span style="color:#000;font-weight:bold">,</span>30<span style="color:#000;font-weight:bold">,</span><span style="color:#000;font-weight:bold">new</span> Date<span style="color:#000;font-weight:bold">());</span>  
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//保存User对象  
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>userMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">saveUser</span><span style="color:#000;font-weight:bold">(</span>user<span style="color:#000;font-weight:bold">);</span>  
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//打印user的id属性值  
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>user<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getId</span><span style="color:#000;font-weight:bold">());</span>  
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//提交事务  
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>session<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">commit</span><span style="color:#000;font-weight:bold">();</span>  
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//关闭连接  
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>MyBatisUtils<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">close</span><span style="color:#000;font-weight:bold">(</span>session<span style="color:#000;font-weight:bold">);</span>  
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div>
    </div>

    

    


    <div class="container-prevnext">
    <div><a href="https://lovemjh.vercel.app/posts/blog/20220430231095/">← Hexo搭建</a></div>
    <div><a href="https://lovemjh.vercel.app/posts/java-frame/20220430230955/">框架概述  →</a></div>
</div>
</div>

        </div>
        <div id="footer"><div class="container-footer">
    
    <a href="//beian.miit.gov.cn" target="_blank">
        
        豫ICP备2022002918号
        
    </a>
    <a id="s" href="/secrets">&nbsp;</a>
</div></div>
    </body>
</html>
