<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="ElasticSearch - https://lovemjh.github.io/posts/tool/20220526220934/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>ElasticSearch</title>
    <link rel="icon" type="image/png" href="/favicon.ico">
    
    <link rel="stylesheet" href="https://lovemjh.github.io/style.min.824365c118b34524ce845ac2a294220354719cca11af5b27a81b04c173bbba57.css">
    
    <script type="text/javascript" src="/main.js" defer></script>
    
</head>
<body class="active-animate cool">
        <div id="header"><div class="container-header">
    <div id="vars" class="container-vars" style="display: none;">
	{
		"hasFoldAllCodeBlocks": false,
		"svgColor": "#6c757d",
		"en": false,
		"dark": false
	}
</div>
    <h1 class="title">
        
            ElasticSearch
            
        
    </h1>

    <div class="container-breadcrumb-nav">
    
    <div class="breadcrumb-nav-bar">
        <div><a href="/"><svg t="1656411084410" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2954" width="16" height="16"><path d="M947.5 390.6l-377-290c-34.5-26.5-82.6-26.5-117.1 0l-377 290c-14 10.8-16.6 30.9-5.9 44.9 10.8 14 30.9 16.6 44.9 5.9l28.5-21.9V768c0 88.2 71.8 160 160 160h80c35.3 0 64-28.7 64-64V640c0-17.6 14.4-32 32-32h64c17.6 0 32 14.4 32 32v224c0 35.3 28.7 64 64 64h80c88.2 0 160-71.8 160-160V419.4l28.5 21.9c5.8 4.5 12.7 6.6 19.5 6.6 9.6 0 19.1-4.3 25.4-12.5 10.8-13.9 8.2-34-5.8-44.8zM816 768c0 52.9-43.1 96-96 96h-80V640c0-52.9-43.1-96-96-96h-64c-52.9 0-96 43.1-96 96v224h-80c-52.9 0-96-43.1-96-96V370.2l284.5-218.8c11.5-8.8 27.5-8.8 39 0L816 370.2V768z" fill=#6c757d p-id="2955"></path></svg></a></div>
        <div><a href="/nav"><svg t="1656411531924" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5827" width="16" height="16"><path d="M849.59197473 125.23018519L139.22930586 391.72854662a23.35052669 23.35052669 0 0 0-14.95414244 21.65490745c-0.12257519 9.70384955 5.61801843 18.46795771 14.40255493 22.04306141l318.42928099 129.25528056 119.51057092 320.39047893c3.06437293 8.23295069 10.35758221 13.89182751 18.7335381 14.87242563l2.7170774 0.14300521a22.79893918 22.79893918 0 0 0 21.20546682-15.36272638l259.51158924-729.54564933a23.8612558 23.8612558 0 0 0-5.31158128-24.55584682 22.3290685 22.3290685 0 0 0-23.9021142-5.43415649zM793.65694081 211.64552314l-196.63064161 552.75171747-91.91077952-246.37564122-253.62799211-102.96295445 542.16941324-203.4131218z" p-id="5828" fill=#6c757d></path></svg></a></div>
        <div><a href="/search"><svg t="1656411627509" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1730" width="14" height="14"><path d="M469.333333 85.333333c211.968 0 384 172.032 384 384s-172.032 384-384 384-384-172.032-384-384 172.032-384 384-384z m0 682.666667c164.992 0 298.666667-133.674667 298.666667-298.666667 0-165.034667-133.674667-298.666667-298.666667-298.666666-165.034667 0-298.666667 133.632-298.666666 298.666666 0 164.992 133.632 298.666667 298.666666 298.666667z m362.026667 3.029333l120.704 120.661334-60.373333 60.373333-120.661334-120.704 60.330667-60.330667z" p-id="1731" fill=#6c757d></path></svg></a></div>
        <div><a href="/posts"><svg t="1656411724198" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5655" width="12" height="12"><path d="M811.705761 1024H212.294239c-93.1199 0-174.823046-87.570975-174.823046-187.387854V162.322018C37.471193 69.776145 112.604921 0 212.294239 0H596.190595l7.015883 5.93161c111.74388 95.479788 185.857116 170.741078 279.614824 266.093304 29.65805 30.040735 61.165743 62.122454 96.436499 97.393211l7.271006 7.334787v459.859234c-0.063781 99.816879-81.703145 187.387854-174.823046 187.387854zM212.294239 49.94033c-72.391155 0-124.882716 47.261538-124.882716 112.381688v674.290128c0 71.94469 59.507443 137.383743 124.882716 137.383743h599.411522c65.311492 0 124.882716-65.439053 124.882716-137.383743V397.417876c-32.528184-32.464404-61.73977-62.250016-89.356836-90.377328-90.951355-92.418312-163.278729-165.957521-269.601245-257.163999H212.294239z" fill=#6c757d p-id="5656"></path><path d="M936.588477 449.526752h-212.326129c-99.753099 0-187.324073-81.703145-187.324073-174.823046V49.94033a25.002055 25.002055 0 0 1 49.94033 0v224.763376c0 65.311492 65.502834 124.882716 137.383743 124.882716h212.326129a25.002055 25.002055 0 1 1 0 49.94033z" fill=#6c757d p-id="5657"></path></svg></a></div>
        <div><a href="/archive"><svg t="1656411795742" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7334" width="12" height="12"><path d="M884.224 522.24H504.32V141.824c0-16.896-13.824-30.72-30.72-30.72-120.32 0-233.472 47.616-317.952 134.144S26.112 445.952 29.184 566.784c2.56 114.688 49.152 222.72 131.072 304.128 81.92 81.408 189.952 128 304.64 130.56h10.24c117.76 0 227.84-45.568 312.32-128.512 86.528-85.504 133.632-199.68 132.608-321.024-0.512-2.048-1.536-29.696-35.84-29.696z m-140.288 307.712c-74.752 73.728-173.056 112.64-277.504 110.592-205.824-4.608-370.688-169.472-375.296-374.784-3.072-104.448 35.84-202.752 108.544-277.504 65.536-67.072 151.552-107.52 243.712-114.688v378.88c0 16.896 13.824 30.72 30.72 30.72 129.024 0 311.296 0 382.976 0.512-6.144 93.184-46.08 179.712-113.152 246.272z" fill=#6c757d p-id="7335"></path><path d="M603.136 11.264c-8.192-0.512-15.872 3.072-22.016 8.704-5.632 5.632-9.216 13.824-9.216 22.016v378.88c0 16.896 13.824 30.72 30.72 30.72h378.88c16.896 0 30.72-13.824 30.72-30.72 0-223.744-183.808-407.552-409.088-409.6z m30.208 378.88V74.24c167.424 16.384 301.056 150.016 315.904 315.904h-315.904z" fill=#6c757d p-id="7336"></path></svg></a></div>
        <div id="light-dark" style="cursor: pointer;"><a><svg t="1656411842215" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5086" width="12" height="12"><path d="M1007.492874 384.513055c-8.795694-34.58307-21.189627-67.666874-36.682043-99.05151-2.698679-5.397358-10.894667-3.498287-10.894666 2.598728v0.299853c0 32.484098-6.896624 63.868734-19.890263 92.554691-10.694764 23.488501-25.487523 45.077933-43.978471 64.068635-41.779547 42.679107-99.05151 66.967217-158.722299 67.26707-61.869712 0.299853-119.941284-24.188159-162.920244-68.966238-40.280281-41.979449-62.56937-98.251902-62.269516-156.323473 0.399804-59.270984 23.588452-114.94373 65.567901-156.823229 19.59041-19.59041 42.179351-35.082826 66.667364-46.077443C672.956643 71.166451 704.041426 64.469729 736.125719 64.469729h1.299364c6.097015 0 8.096037-8.096037 2.598728-10.794715C708.739126 37.982696 675.655322 25.488812 641.172203 16.493216 599.492607 5.598549 555.714038-0.098662 510.536154 0.001289 222.37722 0.700947-7.41029 237.38508 0.185992 525.444064c7.096526 271.667008 225.889418 490.559851 497.456474 497.856279 287.559228 7.796183 524.14341-220.891864 525.842579-508.551044 0.299853-44.977981-5.297407-88.656599-15.992171-130.236244z m-83.15929 301.552378c-22.588942 53.27392-54.873137 101.250434-95.953027 142.330323-41.179841 41.179841-89.056403 73.464036-142.330324 95.953027-55.172991 23.288599-113.744317 35.182777-174.314666 35.182777s-119.141675-11.794226-174.314666-35.182777c-53.27392-22.588942-101.250434-54.873137-142.330323-95.953027-41.179841-41.179841-73.464036-89.056403-95.953027-142.330323C75.749001 630.892442 63.954774 572.221164 63.954774 511.750767s11.794226-119.141675 35.182777-174.314666c22.588942-53.27392 54.873137-101.250434 95.953027-142.330323 41.179841-41.179841 89.056403-73.464036 142.330323-95.953027C392.593892 75.7642 451.26517 63.969974 511.735567 63.969974c13.99315 0 27.886348 0.599706 41.679596 1.89907C489.246577 118.643209 448.266638 198.704016 448.266638 288.360126c0 159.022152 128.836929 287.859081 287.859081 287.859081 89.156354 0 168.817357-40.580134 221.691473-104.149015 1.099462 13.09359 1.699168 26.387082 1.699168 39.680575 0 60.470397-11.794226 119.141675-35.182776 174.314666z" p-id="5087" fill=#6c757d></path></svg></a></div>
        
    </div>

    
</div>

            <div id="toc">ğŸ“œ</div>
        
    
    
</div>
</div>
        <div id="content">












<div class="container-main 
     container-page 
">

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7409" width="12" height="12"><path d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z" p-id="7410" fill="#adb5bd"></path></svg>
            2022-05-26&nbsp;
        </span>
        <span>
            
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="23838" width="11" height="11"><path d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z" p-id="23839" fill="#adb5bd"></path></svg>
            2022-05-26&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="33866" width="12" height="12"><path d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z" fill="#adb5bd" p-id="33867"></path><path d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z" fill="#adb5bd" p-id="33868"></path></svg>
            11088 å­—</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="32892" width="12" height="12"><path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z" p-id="32893" fill="#adb5bd"></path><path d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z" p-id="32894" fill="#adb5bd"></path></svg>
            23 åˆ†é’Ÿ</span><div class="container-ctgtag">
	<div class="taxonomy">
		
		<div class="ctg">
			
			
			<a href="/categories/"></a>
			
		</div>
		<div class="tag">
			
			 - 
			
			<a href="/tags/"></a>
			
		</div>
	</div>
</div>
    </div>
    
    <div class="toc">
        
        <div class="page-operation">
            <div><a href="#"><img src="/imgs/icons/arrow-up-circle.svg" alt=""></a></div>
            <div><a href="https://lovemjh.github.io/posts/tool/20220526204447/"><img src="/imgs/icons/arrow-left-circle.svg" alt=""></a></div>
            <div><a href="https://lovemjh.github.io/posts/java-frame/20220526214937/"><img src="/imgs/icons/arrow-right-circle.svg" alt=""></a></div>
        </div>
        
        <nav id="TableOfContents">
  <ul>
    <li><a href="#1-è®¤è¯†elasticsearch">1 è®¤è¯†ElasticSearch</a>
      <ul>
        <li><a href="#ä¸€åŸºäºæ•°æ®åº“æŸ¥è¯¢çš„é—®é¢˜">ï¼ˆä¸€ï¼‰åŸºäºæ•°æ®åº“æŸ¥è¯¢çš„é—®é¢˜</a></li>
        <li><a href="#äºŒå€’æ’ç´¢å¼•">ï¼ˆäºŒï¼‰å€’æ’ç´¢å¼•</a>
          <ul>
            <li><a href="#1-å€’æ’ç´¢å¼•æ¦‚å¿µ">1 å€’æ’ç´¢å¼•æ¦‚å¿µ</a></li>
            <li><a href="#2-å€’æ’ç´¢å¼•æ¡ˆä¾‹">2 å€’æ’ç´¢å¼•æ¡ˆä¾‹</a></li>
          </ul>
        </li>
        <li><a href="#ä¸‰elasticsearchå­˜å‚¨å’ŒæŸ¥è¯¢çš„åŸç†">ï¼ˆä¸‰ï¼‰ElasticSearchå­˜å‚¨å’ŒæŸ¥è¯¢çš„åŸç†</a></li>
        <li><a href="#å››elasticsearchæ¦‚å¿µè¯¦è§£">ï¼ˆå››ï¼‰ElasticSearchæ¦‚å¿µè¯¦è§£</a></li>
      </ul>
    </li>
    <li><a href="#2-å®‰è£…elasticsearch">2 å®‰è£…ElasticSearch</a>
      <ul>
        <li><a href="#ä¸€elasticsearchå®‰è£…">ï¼ˆä¸€ï¼‰ElasticSearchå®‰è£…</a>
          <ul>
            <li><a href="#1-ä¸Šä¼ elasticsearchå®‰è£…åŒ…">1 ä¸Šä¼ ElasticSearchå®‰è£…åŒ…</a></li>
            <li><a href="#2-æ‰§è¡Œè§£å‹æ“ä½œ">2 æ‰§è¡Œè§£å‹æ“ä½œ</a></li>
            <li><a href="#3-åˆ›å»ºæ™®é€šç”¨æˆ·">3 åˆ›å»ºæ™®é€šç”¨æˆ·</a></li>
            <li><a href="#4-ä¸ºæ–°ç”¨æˆ·æˆæƒå¦‚ä¸‹å›¾">4 ä¸ºæ–°ç”¨æˆ·æˆæƒï¼Œå¦‚ä¸‹å›¾</a></li>
            <li><a href="#5-ä¿®æ”¹elasticsearchymlæ–‡ä»¶">5 ä¿®æ”¹elasticsearch.ymlæ–‡ä»¶</a></li>
            <li><a href="#6-ä¿®æ”¹è™šæ‹Ÿæœºçš„é…ç½®æ–‡ä»¶">6 ä¿®æ”¹è™šæ‹Ÿæœºçš„é…ç½®æ–‡ä»¶</a></li>
            <li><a href="#7-å¯åŠ¨elasticsearch">7 å¯åŠ¨ElasticSearch</a></li>
            <li><a href="#8-æŸ¥çœ‹elasticsearchæ˜¯å¦å¯åŠ¨">8 æŸ¥çœ‹ElasticSearchæ˜¯å¦å¯åŠ¨</a></li>
          </ul>
        </li>
        <li><a href="#äºŒè®¿é—®elasticsearch">ï¼ˆäºŒï¼‰è®¿é—®ElasticSearch</a>
          <ul>
            <li><a href="#1-å…³é—­é˜²ç«å¢™">1 å…³é—­é˜²ç«å¢™</a></li>
            <li><a href="#2-æµè§ˆå™¨è®¿é—®">2 æµè§ˆå™¨è®¿é—®</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#3-elasticsearchè¾…åŠ©å·¥å…·å®‰è£…">3 ElasticSearchè¾…åŠ©å·¥å…·å®‰è£…</a>
      <ul>
        <li><a href="#ä¸€-postman-ä»‹ç»å’Œå®‰è£…">ï¼ˆä¸€ï¼‰ Postman ä»‹ç»å’Œå®‰è£…</a></li>
        <li><a href="#äºŒ-kibanaä»‹ç»å®‰è£…">ï¼ˆäºŒï¼‰ Kibanaä»‹ç»&amp;å®‰è£…</a>
          <ul>
            <li><a href="#1-ä»€ä¹ˆæ˜¯kibana">1 ä»€ä¹ˆæ˜¯Kibana</a></li>
            <li><a href="#2-kibanaå®‰è£…">2 Kibanaå®‰è£…</a>
              <ul>
                <li><a href="#21-ä¸Šä¼ kibana">2.1 ä¸Šä¼ kibana</a></li>
                <li><a href="#22-è§£å‹kibanaåˆ°å®‰è£…ç›®å½•">2.2 è§£å‹kibanaåˆ°å®‰è£…ç›®å½•</a></li>
                <li><a href="#23-ä¿®æ”¹kibanaé…ç½®">2.3 ä¿®æ”¹kibanaé…ç½®</a></li>
                <li><a href="#24-å¯åŠ¨kibana">2.4 å¯åŠ¨kibana</a></li>
                <li><a href="#25-è®¿é—®kibane">2.5 è®¿é—®kibane</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#ä¸‰ikåˆ†è¯å™¨å®‰è£…">ï¼ˆä¸‰ï¼‰IKåˆ†è¯å™¨å®‰è£…</a>
          <ul>
            <li><a href="#1-ç¯å¢ƒå‡†å¤‡">1 ç¯å¢ƒå‡†å¤‡</a>
              <ul>
                <li><a href="#11-è®¾ç½®java_home">1.1 è®¾ç½®JAVA_HOME</a></li>
                <li><a href="#12-ä¸‹è½½mavenå®‰è£…åŒ…">1.2 ä¸‹è½½mavenå®‰è£…åŒ…</a></li>
                <li><a href="#13-è§£å‹mavenå®‰è£…åŒ…">1.3 è§£å‹mavenå®‰è£…åŒ…</a></li>
                <li><a href="#14-è®¾ç½®è½¯è¿æ¥">1.4 è®¾ç½®è½¯è¿æ¥</a></li>
                <li><a href="#15-è®¾ç½®path">1.5 è®¾ç½®path</a></li>
                <li><a href="#16-éªŒè¯mavenæ˜¯å¦å®‰è£…æˆåŠŸ">1.6 éªŒè¯mavenæ˜¯å¦å®‰è£…æˆåŠŸ</a></li>
                <li><a href="#17-è®¾ç½®mavençš„é˜¿é‡Œäº‘é•œåƒ">1.7 è®¾ç½®mavençš„é˜¿é‡Œäº‘é•œåƒ</a></li>
              </ul>
            </li>
            <li><a href="#2-å®‰è£…ikåˆ†è¯å™¨">2 å®‰è£…IKåˆ†è¯å™¨</a>
              <ul>
                <li><a href="#21-ä¸‹è½½ikåˆ†è¯å™¨">2.1 ä¸‹è½½IKåˆ†è¯å™¨</a></li>
                <li><a href="#22-è§£å‹ikåˆ°æŒ‡å®šç›®å½•">2.2 è§£å‹IKåˆ°æŒ‡å®šç›®å½•</a></li>
                <li><a href="#23-ç¼–è¯‘jaråŒ…">2.3 ç¼–è¯‘jaråŒ…</a></li>
                <li><a href="#24-jaråŒ…ç§»åŠ¨">2.4 jaråŒ…ç§»åŠ¨</a></li>
                <li><a href="#25-æ‹·è´è¯å…¸">2.5 æ‹·è´è¯å…¸</a></li>
                <li><a href="#26-é‡æ–°å¯åŠ¨">2.6 é‡æ–°å¯åŠ¨</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#å››ä½¿ç”¨ikåˆ†è¯å™¨">ï¼ˆå››ï¼‰ä½¿ç”¨IKåˆ†è¯å™¨</a>
          <ul>
            <li><a href="#1-ikåˆ†è¯å™¨ä½¿ç”¨">1 IKåˆ†è¯å™¨ä½¿ç”¨</a>
              <ul>
                <li><a href="#11ik_max_word">1.1ik_max_word</a></li>
                <li><a href="#12-ik_smart">1.2 ik_smart</a></li>
                <li><a href="#13-ä½¿ç”¨ikåˆ†è¯å™¨æŸ¥è¯¢æ–‡æ¡£">1.3 ä½¿ç”¨IKåˆ†è¯å™¨æŸ¥è¯¢æ–‡æ¡£</a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#4-elasticsearchæ ¸å¿ƒæ¦‚å¿µ">4 ElasticSearchæ ¸å¿ƒæ¦‚å¿µ</a></li>
    <li><a href="#5-è„šæœ¬æ“ä½œelasticsearch">5 è„šæœ¬æ“ä½œElasticSearch</a>
      <ul>
        <li><a href="#ä¸€restfulé£æ ¼ä»‹ç»">ï¼ˆä¸€ï¼‰RESTfulé£æ ¼ä»‹ç»</a></li>
        <li><a href="#äºŒæ“ä½œç´¢å¼•">ï¼ˆäºŒï¼‰æ“ä½œç´¢å¼•</a>
          <ul>
            <li><a href="#1-åˆ›å»ºç´¢å¼•put">1 åˆ›å»ºç´¢å¼•ï¼ˆPUTï¼‰</a></li>
            <li><a href="#2-æŸ¥è¯¢ç´¢å¼•get">2 æŸ¥è¯¢ç´¢å¼•ï¼ˆGETï¼‰</a></li>
            <li><a href="#3-åˆ é™¤ç´¢å¼•delete">3 åˆ é™¤ç´¢å¼•ï¼ˆDELETEï¼‰</a></li>
            <li><a href="#4-å…³é—­æ‰“å¼€ç´¢å¼•äº†è§£">4 å…³é—­ã€æ‰“å¼€ç´¢å¼•ï¼ˆäº†è§£ï¼‰</a></li>
          </ul>
        </li>
        <li><a href="#ä¸‰elasticsearch-æ•°æ®ç±»å‹">ï¼ˆä¸‰ï¼‰ElasticSearch æ•°æ®ç±»å‹</a>
          <ul>
            <li><a href="#1-ç®€å•æ•°æ®ç±»å‹">1 ç®€å•æ•°æ®ç±»å‹</a></li>
            <li><a href="#2-å¤æ‚æ•°æ®ç±»å‹">2 å¤æ‚æ•°æ®ç±»å‹</a></li>
          </ul>
        </li>
        <li><a href="#å››æ“ä½œæ˜ å°„">ï¼ˆå››ï¼‰æ“ä½œæ˜ å°„</a>
          <ul>
            <li><a href="#1-æŸ¥è¯¢æ˜ å°„">1 æŸ¥è¯¢æ˜ å°„</a></li>
            <li><a href="#2-åˆ›å»ºæ˜ å°„">2 åˆ›å»ºæ˜ å°„</a>
              <ul>
                <li><a href="#21-åˆ›å»ºç´¢å¼•åæ·»åŠ æ˜ å°„">2.1 åˆ›å»ºç´¢å¼•åæ·»åŠ æ˜ å°„</a></li>
                <li><a href="#22-åˆ›å»ºç´¢å¼•å¹¶æ·»åŠ æ˜ å°„">2.2 åˆ›å»ºç´¢å¼•å¹¶æ·»åŠ æ˜ å°„</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#äº”-æ“ä½œæ–‡æ¡£">ï¼ˆäº”ï¼‰ æ“ä½œæ–‡æ¡£</a>
          <ul>
            <li><a href="#1-æŸ¥è¯¢æ–‡æ¡£">1 æŸ¥è¯¢æ–‡æ¡£</a></li>
            <li><a href="#2-æ·»åŠ æ–‡æ¡£æŒ‡å®šid">2 æ·»åŠ æ–‡æ¡£ï¼ŒæŒ‡å®šid</a></li>
            <li><a href="#3-åˆ é™¤æ–‡æ¡£">3 åˆ é™¤æ–‡æ¡£</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#7-elasticsearch-javaapi">7 ElasticSearch JavaAPI</a>
      <ul>
        <li><a href="#ä¸€springbootæ•´åˆelasticsearchç¯å¢ƒæ­å»º">ï¼ˆä¸€ï¼‰SpringBootæ•´åˆElasticSearchç¯å¢ƒæ­å»º</a>
          <ul>
            <li><a href="#1-æ­å»ºspringbootå·¥ç¨‹">1 æ­å»ºSpringBootå·¥ç¨‹</a></li>
            <li><a href="#2-å¼•å…¥elasticsearchç›¸å…³åæ ‡">2 å¼•å…¥ElasticSearchç›¸å…³åæ ‡</a></li>
            <li><a href="#3-ç¼–å†™æ ¸å¿ƒé…ç½®ç±»">3 ç¼–å†™æ ¸å¿ƒé…ç½®ç±»</a></li>
            <li><a href="#4-æµ‹è¯•å®¢æˆ·ç«¯å¯¹è±¡">4 æµ‹è¯•å®¢æˆ·ç«¯å¯¹è±¡</a></li>
          </ul>
        </li>
        <li><a href="#äºŒæ“ä½œelasticsearch">ï¼ˆäºŒï¼‰æ“ä½œElasticSearch</a>
          <ul>
            <li><a href="#1-æ·»åŠ ç´¢å¼•">1 æ·»åŠ ç´¢å¼•</a></li>
            <li><a href="#2--æ·»åŠ ç´¢å¼•å¹¶æ·»åŠ æ˜ å°„">2  æ·»åŠ ç´¢å¼•ï¼Œå¹¶æ·»åŠ æ˜ å°„</a></li>
            <li><a href="#3-æŸ¥è¯¢åˆ é™¤åˆ¤æ–­ç´¢å¼•">3 æŸ¥è¯¢ã€åˆ é™¤ã€åˆ¤æ–­ç´¢å¼•</a>
              <ul>
                <li><a href="#31-æŸ¥è¯¢ç´¢å¼•">3.1 æŸ¥è¯¢ç´¢å¼•</a></li>
                <li><a href="#32-åˆ é™¤ç´¢å¼•">3.2 åˆ é™¤ç´¢å¼•</a></li>
                <li><a href="#33-ç´¢å¼•æ˜¯å¦å­˜åœ¨">3.3 ç´¢å¼•æ˜¯å¦å­˜åœ¨</a></li>
              </ul>
            </li>
            <li><a href="#4-æ“ä½œæ–‡æ¡£">4 æ“ä½œæ–‡æ¡£</a>
              <ul>
                <li><a href="#41--æ·»åŠ æ–‡æ¡£">4.1  æ·»åŠ æ–‡æ¡£</a></li>
                <li><a href="#42-ä¿®æ”¹æ–‡æ¡£æ·»åŠ æ–‡æ¡£æ—¶å¦‚æœidå­˜åœ¨åˆ™ä¿®æ”¹idä¸å­˜åœ¨åˆ™æ·»åŠ ">4.2 ä¿®æ”¹æ–‡æ¡£ï¼šæ·»åŠ æ–‡æ¡£æ—¶ï¼Œå¦‚æœidå­˜åœ¨åˆ™ä¿®æ”¹ï¼Œidä¸å­˜åœ¨åˆ™æ·»åŠ </a></li>
                <li><a href="#43-æ ¹æ®idæŸ¥è¯¢æ–‡æ¡£">4.3 æ ¹æ®idæŸ¥è¯¢æ–‡æ¡£</a></li>
                <li><a href="#44-æ ¹æ®idåˆ é™¤æ–‡æ¡£">4.4 æ ¹æ®idåˆ é™¤æ–‡æ¡£</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#ä¸‰elasticsearchçš„æ‰¹é‡æ“ä½œ">ï¼ˆä¸‰ï¼‰ElasticSearchçš„æ‰¹é‡æ“ä½œ</a>
          <ul>
            <li><a href="#1-bulk-æ‰¹é‡æ“ä½œè„šæœ¬å®ç°">1 bulk æ‰¹é‡æ“ä½œè„šæœ¬å®ç°</a></li>
            <li><a href="#2-bulkæ‰¹é‡æ“ä½œjavaapi-å®ç°">2 bulkæ‰¹é‡æ“ä½œJavaAPI å®ç°</a></li>
            <li><a href="#3-å¯¼å…¥æ•°æ®åˆ†æåˆ›å»ºç´¢å¼•">3 å¯¼å…¥æ•°æ®åˆ†æ&amp;åˆ›å»ºç´¢å¼•</a></li>
            <li><a href="#4-å¯¼å…¥æ•°æ®ä»£ç å®ç°">4 å¯¼å…¥æ•°æ®ä»£ç å®ç°</a></li>
          </ul>
        </li>
        <li><a href="#å››elasticsearché«˜çº§æŸ¥è¯¢">ï¼ˆå››ï¼‰ElasticSearché«˜çº§æŸ¥è¯¢</a>
          <ul>
            <li><a href="#1-matchallè„šæœ¬å®ç°">1 matchAllè„šæœ¬å®ç°</a></li>
            <li><a href="#2-matchall-javaapi">2 matchAll-JavaAPI</a></li>
            <li><a href="#3-termquery-è¯æ¡æŸ¥è¯¢">3 termQuery è¯æ¡æŸ¥è¯¢</a></li>
            <li><a href="#4-matchquery">4 matchQuery</a></li>
            <li><a href="#5-æ¨¡ç³ŠæŸ¥è¯¢è„šæœ¬å®ç°">5 æ¨¡ç³ŠæŸ¥è¯¢è„šæœ¬å®ç°</a></li>
            <li><a href="#6-æ¨¡ç³ŠæŸ¥è¯¢javaapi">6 æ¨¡ç³ŠæŸ¥è¯¢javaAPI</a></li>
            <li><a href="#7-èŒƒå›´æŸ¥è¯¢è„šæœ¬å®ç°">7 èŒƒå›´æŸ¥è¯¢è„šæœ¬å®ç°</a></li>
            <li><a href="#8-èŒƒå›´æŸ¥è¯¢apiå®ç°">8 èŒƒå›´æŸ¥è¯¢APIå®ç°</a></li>
            <li><a href="#9-querystring-æŸ¥è¯¢">9 queryString æŸ¥è¯¢</a></li>
            <li><a href="#10-querystring-javaapiä»£ç å®ç°">10 queryString javaAPIä»£ç å®ç°ï¼š</a></li>
            <li><a href="#11-èšåˆæŸ¥è¯¢è„šæœ¬å®ç°">11 èšåˆæŸ¥è¯¢è„šæœ¬å®ç°</a></li>
            <li><a href="#12-èšåˆæŸ¥è¯¢javaapi">12 èšåˆæŸ¥è¯¢JavaAPI</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
    </div>

    <div class='content  content '>
        <h1 id="1-è®¤è¯†elasticsearch">1 è®¤è¯†ElasticSearch</h1>
<h2 id="ä¸€åŸºäºæ•°æ®åº“æŸ¥è¯¢çš„é—®é¢˜">ï¼ˆä¸€ï¼‰åŸºäºæ•°æ®åº“æŸ¥è¯¢çš„é—®é¢˜</h2>
<p><img src="/posts/tool/20220526220934/image-20220526221044127.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>éœ€æ±‚ï¼š æŸ¥è¯¢titleä¸­åŒ…å«â€˜æ‰‹æœºâ€™ çš„ä¿¡æ¯ï¼Ÿ</p>
<p>å®ç°ï¼šSELECT * FROM tb_item WHERE title LIKE &lsquo;%æ‰‹æœº%&rsquo;;</p>
<p>é—®é¢˜ï¼š</p>
<p>ï¼ˆ1ï¼‰æ€§èƒ½ä½ï¼šå¦‚æœæ˜¯æ¨¡ç³ŠæŸ¥è¯¢ï¼Œåæ ‡æœ‰é€šé…ç¬¦ï¼Œä¸ä¼šèµ°ç´¢å¼•ï¼Œä¼šè¿›è¡Œå…¨è¡¨æ‰«æï¼Œæ€§èƒ½ä½ã€‚</p>
<p>ï¼ˆ2ï¼‰åŠŸèƒ½å¼±ï¼šå¦‚æœä»¥â€åä¸ºæ‰‹æœºâ€œä½œä¸ºæ¡ä»¶ï¼ŒæŸ¥è¯¢ä¸å‡ºæ¥æ•°æ®ã€‚</p>
<p>è§£å†³ï¼šä½¿ç”¨ESå°±å¯ä»¥<strong>å€’æ’ç´¢å¼•</strong>å°±å¯ä»¥è§£å†³ä¸Šè¿°å­˜åœ¨çš„é—®é¢˜</p>
<h2 id="äºŒå€’æ’ç´¢å¼•">ï¼ˆäºŒï¼‰å€’æ’ç´¢å¼•</h2>
<h3 id="1-å€’æ’ç´¢å¼•æ¦‚å¿µ">1 å€’æ’ç´¢å¼•æ¦‚å¿µ</h3>
<p><strong>å€’æ’ç´¢å¼•</strong>ï¼šå°†æ–‡æ¡£è¿›è¡Œåˆ†è¯ï¼Œå½¢æˆè¯æ¡å’Œidçš„å¯¹åº”å…³ç³»å³ä¸ºåå‘ç´¢å¼•ã€‚</p>
<h3 id="2-å€’æ’ç´¢å¼•æ¡ˆä¾‹">2 å€’æ’ç´¢å¼•æ¡ˆä¾‹</h3>
<p>ä»¥å”è¯—ä¸ºä¾‹ï¼Œæ‰€å¤„åŒ…å«â€œå‰â€çš„è¯—å¥ï¼Ÿ</p>
<p>æ­£å‘ç´¢å¼•ï¼šç”±ã€Šé™å¤œæ€ã€‹&ndash;&gt;åºŠå‰æ˜æœˆå…‰&mdash;&gt;â€œå‰â€å­—</p>
<table>
<thead>
<tr>
<th>key</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr>
<td>&laquo;é™å¤œæ€&raquo;</td>
<td>çª—å‰æ˜æœˆå…‰ï¼Œç–‘æ˜¯åœ°ä¸Šéœœ&hellip;</td>
</tr>
<tr>
<td>&laquo;æ°´è°ƒæ­Œå¤´&raquo;</td>
<td>æ˜æœˆå‡ æ—¶æœ‰ï¼ŒæŠŠé…’é—®é’å¤©&hellip;</td>
</tr>
<tr>
<td>&laquo;æ˜¥æ™“&raquo;</td>
<td>æ˜¥çœ ä¸è§‰æ™“ï¼Œå¤„å¤„é—»å•¼é¸Ÿ&hellip;</td>
</tr>
</tbody>
</table>
<p>åå‘ç´¢å¼•ï¼š</p>
<p>â€œåºŠå‰æ˜æœˆå…‰â€&ndash;&gt; åˆ†è¯</p>
<p>å°†ä¸€æ®µæ–‡æœ¬æŒ‰ç…§ä¸€å®šçš„è§„åˆ™ï¼Œæ‹†åˆ†ä¸ºä¸åŒçš„è¯æ¡ï¼ˆtermï¼‰
<img src="/posts/tool/20220526220934/image-20220526221103534.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>æ¡ˆä¾‹ï¼šæ˜æœˆå‡ æ—¶æœ‰ï¼Œåˆ†è¯ã€‚åˆ†è¯æ•ˆæœå¦‚ä¸‹
<img src="/posts/tool/20220526220934/image-20220526221111950.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="ä¸‰elasticsearchå­˜å‚¨å’ŒæŸ¥è¯¢çš„åŸç†">ï¼ˆä¸‰ï¼‰ElasticSearchå­˜å‚¨å’ŒæŸ¥è¯¢çš„åŸç†</h2>
<p><strong>indexï¼ˆç´¢å¼•ï¼‰</strong>ï¼šç›¸å½“äºmysqlçš„åº“</p>
<p><strong>æ˜ å°„</strong>ï¼šç›¸å½“äºmysql çš„è¡¨ç»“æ„</p>
<p><strong>document(æ–‡æ¡£)</strong>ï¼šç›¸å½“äºmysqlçš„è¡¨ä¸­çš„æ•°æ®</p>
<p>Esä½¿ç”¨å€’æ’ç´¢å¼•ï¼Œå¯¹title è¿›è¡Œåˆ†è¯
<img src="/posts/tool/20220526220934/image-20220526221139841.png"
    
    
    
    loading="lazy"
    
    
></p>
<ol>
<li>
<p>ä½¿ç”¨â€œæ‰‹æœºâ€ä½œä¸ºå…³é”®å­—æŸ¥è¯¢</p>
<p>ç”Ÿæˆçš„å€’æ’ç´¢å¼•ä¸­ï¼Œè¯æ¡ä¼šæ’åºï¼Œå½¢æˆä¸€é¢—æ ‘å½¢ç»“æ„ï¼Œæå‡è¯æ¡çš„æŸ¥è¯¢é€Ÿåº¦</p>
</li>
<li>
<p>ä½¿ç”¨â€œåä¸ºæ‰‹æœºâ€ä½œä¸ºå…³é”®å­—æŸ¥è¯¢</p>
<p>åä¸ºï¼š1,3</p>
<p>æ‰‹æœºï¼š1,2,3
<img src="/posts/tool/20220526220934/image-20220526221146485.png"
    
    
    
    loading="lazy"
    
    
></p>
</li>
</ol>
<h2 id="å››elasticsearchæ¦‚å¿µè¯¦è§£">ï¼ˆå››ï¼‰ElasticSearchæ¦‚å¿µè¯¦è§£</h2>
<p>ElasticSearchæ˜¯ä¸€ä¸ªåŸºäºLuceneçš„æœç´¢æœåŠ¡å™¨
<img src="/posts/tool/20220526220934/image-20220526221155547.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€é«˜æ‰©å±•ã€é«˜å®æ—¶çš„æœç´¢ä¸æ•°æ®åˆ†æå¼•æ“</p>
<p>åŸºäºRESTful webæ¥å£</p>
<p>Elasticsearchæ˜¯ç”¨Javaè¯­è¨€å¼€å‘çš„ï¼Œå¹¶ä½œä¸ºApacheè®¸å¯æ¡æ¬¾ä¸‹çš„å¼€æ”¾æºç å‘å¸ƒï¼Œæ˜¯ä¸€ç§æµè¡Œçš„ä¼ä¸šçº§æœç´¢å¼•æ“</p>
<p>å®˜ç½‘ï¼šhttps://www.elastic.co/</p>
<p>åº”ç”¨åœºæ™¯</p>
<p>æœç´¢ï¼šæµ·é‡æ•°æ®çš„æŸ¥è¯¢</p>
<p>æ—¥å¿—æ•°æ®åˆ†æ</p>
<p>å®æ—¶æ•°æ®åˆ†æ</p>
<h1 id="2-å®‰è£…elasticsearch">2 å®‰è£…ElasticSearch</h1>
<h2 id="ä¸€elasticsearchå®‰è£…">ï¼ˆä¸€ï¼‰ElasticSearchå®‰è£…</h2>
<h3 id="1-ä¸Šä¼ elasticsearchå®‰è£…åŒ…">1 ä¸Šä¼ ElasticSearchå®‰è£…åŒ…</h3>
<p><img src="/posts/tool/20220526220934/image-20220526221228208.png"
    
    
    
    loading="lazy"
    
    
></p>
<h3 id="2-æ‰§è¡Œè§£å‹æ“ä½œ">2 æ‰§è¡Œè§£å‹æ“ä½œ</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span> <span style="color:#998;font-style:italic">#åˆ›å»ºä¸€ä¸ªå®‰è£…ç›®å½• </span>
</span></span><span style="display:flex;"><span> mkdir /usr/local/es
</span></span><span style="display:flex;"><span> <span style="color:#998;font-style:italic">#å°†elasticsearch-7.4.0-linux-x86_64.tar.gzè§£å‹åˆ°/usr/local/es ç›®å½•ä¸‹. -C å¤§å†™</span>
</span></span><span style="display:flex;"><span> tar -zxvf elasticsearch-7.4.0-linux-x86_64.tar.gz  -C /usr/local/es
</span></span></code></pre></div><h3 id="3-åˆ›å»ºæ™®é€šç”¨æˆ·">3 åˆ›å»ºæ™®é€šç”¨æˆ·</h3>
<p>å› ä¸ºå®‰å…¨é—®é¢˜ï¼ŒElasticsearch ä¸å…è®¸rootç”¨æˆ·ç›´æ¥è¿è¡Œï¼Œæ‰€ä»¥è¦åˆ›å»ºæ–°ç”¨æˆ·ï¼Œåœ¨rootç”¨æˆ·ä¸­åˆ›å»ºæ–°ç”¨æˆ·,æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>useradd offcn  <span style="color:#998;font-style:italic">#æ–°å¢offcnè´¦æˆ·</span>
</span></span><span style="display:flex;"><span>passwd offcn   <span style="color:#998;font-style:italic">#ä¸ºoffcnè´¦æˆ·è®¾ç½®å¯†ç </span>
</span></span></code></pre></div><h3 id="4-ä¸ºæ–°ç”¨æˆ·æˆæƒå¦‚ä¸‹å›¾">4 ä¸ºæ–°ç”¨æˆ·æˆæƒï¼Œå¦‚ä¸‹å›¾</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>chown -R offcn:offcn /usr/local/es/elasticsearch-7.4.0 <span style="color:#998;font-style:italic">#æ–‡ä»¶å¤¹æ‰€æœ‰è€…</span>
</span></span></code></pre></div><p><img src="/posts/tool/20220526220934/image-20220526221241011.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>å°† /usr/local/es/elasticsearch-7.4.0æ–‡ä»¶å¤¹æˆæƒç»™offcnç”¨æˆ·ï¼Œç”±ä¸Šå›¾å¯è§ï¼Œæˆ‘ä»¬çš„æ–‡ä»¶å¤¹æƒé™èµ‹ç»™äº†offcn</p>
<h3 id="5-ä¿®æ”¹elasticsearchymlæ–‡ä»¶">5 ä¿®æ”¹elasticsearch.ymlæ–‡ä»¶</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>vim /usr/local/es/elasticsearch-7.4.0/config/elasticsearch.yml 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ======================== Elasticsearch Configuration =========================</span>
</span></span><span style="display:flex;"><span>cluster.name: my-application
</span></span><span style="display:flex;"><span>node.name: node-1
</span></span><span style="display:flex;"><span>network.host: 0.0.0.0
</span></span><span style="display:flex;"><span>http.port: <span style="color:#099">9200</span>
</span></span><span style="display:flex;"><span>cluster.initial_master_nodes: <span style="color:#000;font-weight:bold">[</span><span style="color:#d14">&#34;node-1&#34;</span><span style="color:#000;font-weight:bold">]</span>
</span></span></code></pre></div><p>cluster.nameï¼šé…ç½®elasticsearchçš„é›†ç¾¤åç§°ï¼Œé»˜è®¤æ˜¯elasticsearchã€‚å»ºè®®ä¿®æ”¹æˆä¸€ä¸ªæœ‰æ„ä¹‰çš„åç§°</p>
<p>node.nameï¼šèŠ‚ç‚¹åï¼Œelasticsearchä¼šé»˜è®¤éšæœºæŒ‡å®šä¸€ä¸ªåå­—ï¼Œå»ºè®®æŒ‡å®šä¸€ä¸ªæœ‰æ„ä¹‰çš„åç§°ï¼Œæ–¹ä¾¿ç®¡ç†</p>
<p>network.hostï¼šè®¾ç½®ä¸º0.0.0.0å…è®¸å¤–ç½‘è®¿é—®</p>
<p>http.portï¼šElasticsearchçš„httpè®¿é—®ç«¯å£</p>
<p>cluster.initial_master_nodesï¼šåˆå§‹åŒ–æ–°çš„é›†ç¾¤æ—¶éœ€è¦æ­¤é…ç½®æ¥é€‰ä¸¾master</p>
<h3 id="6-ä¿®æ”¹è™šæ‹Ÿæœºçš„é…ç½®æ–‡ä»¶">6 ä¿®æ”¹è™šæ‹Ÿæœºçš„é…ç½®æ–‡ä»¶</h3>
<p>æ–°åˆ›å»ºçš„offcnç”¨æˆ·æœ€å¤§å¯åˆ›å»ºæ–‡ä»¶æ•°å¤ªå°ï¼Œæœ€å¤§è™šæ‹Ÿå†…å­˜å¤ªå°ï¼Œåˆ‡æ¢åˆ°rootç”¨æˆ·ï¼Œç¼–è¾‘ä¸‹åˆ—é…ç½®æ–‡ä»¶ï¼Œ æ·»åŠ ç±»ä¼¼å¦‚ä¸‹å†…å®¹</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># åˆ‡æ¢åˆ°rootç”¨æˆ·</span>
</span></span><span style="display:flex;"><span>su root 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#1. ===æœ€å¤§å¯åˆ›å»ºæ–‡ä»¶æ•°å¤ªå°=======</span>
</span></span><span style="display:flex;"><span>vim /etc/security/limits.conf 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># åœ¨æ–‡ä»¶æœ«å°¾ä¸­å¢åŠ ä¸‹é¢å†…å®¹</span>
</span></span><span style="display:flex;"><span>offcn soft nofile <span style="color:#099">65536</span>
</span></span><span style="display:flex;"><span>offcn hard nofile <span style="color:#099">65536</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#===========</span>
</span></span><span style="display:flex;"><span>vim /etc/security/limits.d/20-nproc.conf
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># åœ¨æ–‡ä»¶æœ«å°¾ä¸­å¢åŠ ä¸‹é¢å†…å®¹</span>
</span></span><span style="display:flex;"><span>offcn soft nofile <span style="color:#099">65536</span>
</span></span><span style="display:flex;"><span>offcn hard nofile <span style="color:#099">65536</span>
</span></span><span style="display:flex;"><span>*  hard    nproc     <span style="color:#099">4096</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># æ³¨ï¼š* ä»£è¡¨Linuxæ‰€æœ‰ç”¨æˆ·åç§°</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#2. ===æœ€å¤§è™šæ‹Ÿå†…å­˜å¤ªå°=======</span>
</span></span><span style="display:flex;"><span>vim /etc/sysctl.conf
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># åœ¨æ–‡ä»¶ä¸­å¢åŠ ä¸‹é¢å†…å®¹</span>
</span></span><span style="display:flex;"><span>vm.max_map_count<span style="color:#000;font-weight:bold">=</span><span style="color:#099">655360</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># é‡æ–°åŠ è½½ï¼Œè¾“å…¥ä¸‹é¢å‘½ä»¤ï¼š</span>
</span></span><span style="display:flex;"><span>sysctl -p
</span></span></code></pre></div><h3 id="7-å¯åŠ¨elasticsearch">7 å¯åŠ¨ElasticSearch</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>su offcn    <span style="color:#998;font-style:italic">#åˆ‡æ¢åˆ°offcn ç”¨æˆ·å¯åŠ¨</span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">cd</span> /usr/local/es/elasticsearch-7.4.0/bin
</span></span><span style="display:flex;"><span>./elasticsearch <span style="color:#998;font-style:italic">#å¯åŠ¨</span>
</span></span></code></pre></div><p><img src="/posts/tool/20220526220934/image-20220526221256705.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>é€šè¿‡ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°elasticsearchå·²ç»æˆåŠŸå¯åŠ¨</p>
<h3 id="8-æŸ¥çœ‹elasticsearchæ˜¯å¦å¯åŠ¨">8 æŸ¥çœ‹ElasticSearchæ˜¯å¦å¯åŠ¨</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>ps -ef|grep elastic
</span></span></code></pre></div><h2 id="äºŒè®¿é—®elasticsearch">ï¼ˆäºŒï¼‰è®¿é—®ElasticSearch</h2>
<h3 id="1-å…³é—­é˜²ç«å¢™">1 å…³é—­é˜²ç«å¢™</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#æš‚æ—¶å…³é—­é˜²ç«å¢™</span>
</span></span><span style="display:flex;"><span>systemctl  stop  firewalld.service
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># æˆ–è€…</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#æ°¸ä¹…è®¾ç½®é˜²ç«å¢™çŠ¶æ€</span>
</span></span><span style="display:flex;"><span>systemctl <span style="color:#0086b3">enable</span> firewalld.service  <span style="color:#998;font-style:italic">#æ‰“å¼€é˜²ç«å¢™æ°¸ä¹…æ€§ç”Ÿæ•ˆï¼Œé‡å¯åä¸ä¼šå¤åŸ </span>
</span></span><span style="display:flex;"><span>systemctl disable firewalld.service <span style="color:#998;font-style:italic">#å…³é—­é˜²ç«å¢™ï¼Œæ°¸ä¹…æ€§ç”Ÿæ•ˆï¼Œé‡å¯åä¸ä¼šå¤åŸ </span>
</span></span></code></pre></div><h3 id="2-æµè§ˆå™¨è®¿é—®">2 æµè§ˆå™¨è®¿é—®</h3>
<p><img src="/posts/tool/20220526220934/image-20220526221313772.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>è¯´æ˜ï¼š æ­¤æ—¶elasticsearchå·²æˆåŠŸå¯åŠ¨</p>
<pre tabindex="0"><code>é‡ç‚¹å‡ ä¸ªå…³æ³¨ä¸‹å³å¯:
number&#34; : &#34;7.4.0&#34;   è¡¨ç¤ºelasticsearchç‰ˆæœ¬
lucene_version&#34; : &#34;8.2.0&#34;  è¡¨ç¤ºluceneç‰ˆæœ¬
name ï¼š é»˜è®¤å¯åŠ¨çš„æ—¶å€™æŒ‡å®šäº† ES å®ä¾‹åç§°
cluster_name ï¼š é»˜è®¤åä¸º elasticsearch
</code></pre><h1 id="3-elasticsearchè¾…åŠ©å·¥å…·å®‰è£…">3 ElasticSearchè¾…åŠ©å·¥å…·å®‰è£…</h1>
<h2 id="ä¸€-postman-ä»‹ç»å’Œå®‰è£…">ï¼ˆä¸€ï¼‰ Postman ä»‹ç»å’Œå®‰è£…</h2>
<p>Postmanæ˜¯ä¸€ä¸ªhttpæ¨¡æ‹Ÿè¯·æ±‚çš„å·¥å…·ã€‚</p>
<p>å®˜ç½‘ä»‹ç»ï¼šâ€œModern software is built on APIsï¼ŒPostman helps you develop APIs fasterâ€</p>
<p>çœ‹å¾—å‡ºæ¥ï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸“é—¨æµ‹è¯• API çš„å·¥å…·ï¼ŒPostman æä¾›åŠŸèƒ½å¼ºå¤§çš„ Web API å’Œ HTTP è¯·æ±‚çš„è°ƒè¯•ï¼Œå®ƒèƒ½å¤Ÿå‘é€ä»»ä½•ç±»å‹çš„HTTP è¯·æ±‚ (GET, POST, PUT, DELETEâ€¦)ï¼Œå¹¶ä¸”èƒ½é™„å¸¦ä»»ä½•æ•°é‡çš„å‚æ•°å’Œ Headersã€‚ä¸ä»…å¦‚æ­¤ï¼Œå®ƒè¿˜æä¾›æµ‹è¯•æ•°æ®å’Œç¯å¢ƒé…ç½®æ•°æ®çš„å¯¼å…¥å¯¼å‡ºã€‚</p>
<p>è¿›å…¥å®˜ç½‘www.getpostman.comï¼Œä¸‹è½½</p>
<h2 id="äºŒ-kibanaä»‹ç»å®‰è£…">ï¼ˆäºŒï¼‰ Kibanaä»‹ç»&amp;å®‰è£…</h2>
<h3 id="1-ä»€ä¹ˆæ˜¯kibana">1 ä»€ä¹ˆæ˜¯Kibana</h3>
<p>Kibanaæ˜¯ä¸€ä¸ªé’ˆå¯¹Elasticsearchçš„å¼€æºåˆ†æåŠå¯è§†åŒ–å¹³å°ï¼Œç”¨æ¥æœç´¢ã€æŸ¥çœ‹äº¤äº’å­˜å‚¨åœ¨Elasticsearchç´¢å¼•ä¸­çš„æ•°æ®ã€‚ä½¿ç”¨Kibanaï¼Œå¯ä»¥é€šè¿‡å„ç§å›¾è¡¨è¿›è¡Œé«˜çº§æ•°æ®åˆ†æåŠå±•ç¤ºã€‚</p>
<p>Kibanaè®©æµ·é‡æ•°æ®æ›´å®¹æ˜“ç†è§£ã€‚å®ƒæ“ä½œç®€å•ï¼ŒåŸºäºæµè§ˆå™¨çš„ç”¨æˆ·ç•Œé¢å¯ä»¥å¿«é€Ÿåˆ›å»ºä»ªè¡¨æ¿ï¼ˆdashboardï¼‰å®æ—¶æ˜¾ç¤ºElasticsearchæŸ¥è¯¢åŠ¨æ€ã€‚</p>
<h3 id="2-kibanaå®‰è£…">2 Kibanaå®‰è£…</h3>
<h4 id="21-ä¸Šä¼ kibana">2.1 ä¸Šä¼ kibana</h4>
<p><img src="/posts/tool/C:%5cUsers%5cAdministrator%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5c1615536058337.png"
    
    
    
    loading="lazy"
    
    
></p>
<h4 id="22-è§£å‹kibanaåˆ°å®‰è£…ç›®å½•">2.2 è§£å‹kibanaåˆ°å®‰è£…ç›®å½•</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#åˆ›å»ºå®‰è£…ç›®å½•</span>
</span></span><span style="display:flex;"><span>mkdir /usr/local/kibana
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#å°†kibanaè§£å‹åˆ°å®‰è£…ç›®å½•</span>
</span></span><span style="display:flex;"><span>tar -zxvf kibana-7.4.0-linux-x86_64.tar.gz -C /usr/local/kibana
</span></span></code></pre></div><h4 id="23-ä¿®æ”¹kibanaé…ç½®">2.3 ä¿®æ”¹kibanaé…ç½®</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>vim /usr/local/kibana/kibana-7.4.0-linux-x86_64/config/kibana.yml
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>server.port: <span style="color:#099">5601</span>
</span></span><span style="display:flex;"><span>server.host: <span style="color:#d14">&#34;0.0.0.0&#34;</span>
</span></span><span style="display:flex;"><span>server.name: <span style="color:#d14">&#34;kibana-offcn&#34;</span>
</span></span><span style="display:flex;"><span>elasticsearch.hosts: <span style="color:#000;font-weight:bold">[</span><span style="color:#d14">&#34;http://127.0.0.1:9200&#34;</span><span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>elasticsearch.requestTimeout: <span style="color:#099">99999</span>
</span></span></code></pre></div><p>server.portï¼šhttpè®¿é—®ç«¯å£</p>
<p>server.hostï¼šipåœ°å€ï¼Œ0.0.0.0è¡¨ç¤ºå¯è¿œç¨‹è®¿é—®</p>
<p>server.nameï¼škibanaæœåŠ¡å</p>
<p>elasticsearch.hostsï¼šelasticsearchåœ°å€</p>
<p>elasticsearch.requestTimeoutï¼šè¯·æ±‚elasticsearchè¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º30000ï¼Œæ­¤å¤„å¯æ ¹æ®æƒ…å†µè®¾ç½®</p>
<h4 id="24-å¯åŠ¨kibana">2.4 å¯åŠ¨kibana</h4>
<p>ç”±äºkibanaä¸å»ºè®®ä½¿ç”¨rootç”¨æˆ·å¯åŠ¨ï¼Œå¦‚æœç”¨rootå¯åŠ¨ï¼Œéœ€è¦åŠ &ndash;allow-rootå‚æ•°</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># åˆ‡æ¢åˆ°kibanaçš„binç›®å½•</span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">cd</span> /usr/local/kibana/kibana-7.4.0-linux-x86_64/bin
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># å¯åŠ¨</span>
</span></span><span style="display:flex;"><span>./kibana --allow-root
</span></span></code></pre></div><p><img src="/posts/tool/20220526220934/image-20220526221325710.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>å¯åŠ¨æˆåŠŸã€‚</p>
<h4 id="25-è®¿é—®kibane">2.5 è®¿é—®kibane</h4>
<pre tabindex="0"><code>è®¿é—®åœ°å€ï¼š http://192.168.126.20:5601/
</code></pre><p><img src="/posts/tool/20220526220934/image-20220526221331884.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="ä¸‰ikåˆ†è¯å™¨å®‰è£…">ï¼ˆä¸‰ï¼‰IKåˆ†è¯å™¨å®‰è£…</h2>
<h3 id="1-ç¯å¢ƒå‡†å¤‡">1 ç¯å¢ƒå‡†å¤‡</h3>
<p>Elasticsearch è¦ä½¿ç”¨ ikï¼Œå°±è¦å…ˆæ„å»º ik çš„ jaråŒ…ï¼Œè¿™é‡Œè¦ç”¨åˆ° maven åŒ…ç®¡ç†å·¥å…·ï¼Œè€Œ maven éœ€è¦java ç¯å¢ƒï¼Œè€Œ Elasticsearch å†…ç½®äº†jdkï¼Œ æ‰€ä»¥å¯ä»¥å°†JAVA_HOMEè®¾ç½®ä¸ºElasticsearch å†…ç½®çš„jdk</p>
<h4 id="11-è®¾ç½®java_home">1.1 è®¾ç½®JAVA_HOME</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>vim /etc/profile
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># åœ¨profileæ–‡ä»¶æœ«å°¾æ·»åŠ </span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#java environment</span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">export</span> <span style="color:#008080">JAVA_HOME</span><span style="color:#000;font-weight:bold">=</span>/usr/local/es/elasticsearch-7.4.0/jdk
</span></span><span style="display:flex;"><span><span style="color:#0086b3">export</span> <span style="color:#008080">PATH</span><span style="color:#000;font-weight:bold">=</span><span style="color:#008080">$PATH</span>:<span style="color:#d14">${</span><span style="color:#008080">JAVA_HOME</span><span style="color:#d14">}</span>/bin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># ä¿å­˜é€€å‡ºåï¼Œé‡æ–°åŠ è½½profile</span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">source</span> /etc/profile
</span></span></code></pre></div><h4 id="12-ä¸‹è½½mavenå®‰è£…åŒ…">1.2 ä¸‹è½½mavenå®‰è£…åŒ…</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#å®‰è£…åŒ…è¾ƒå°ï¼Œç›´æ¥ä½¿ç”¨wgetå‘½ä»¤ä¸‹è½½ï¼Œä¸‹è½½çš„é»˜è®¤ä½ç½®ï¼Œå½“å‰æ‰€åœ¨çš„ä½ç½®</span>
</span></span><span style="display:flex;"><span>wget http://mirror.cc.columbia.edu/pub/software/apache/maven/maven-3/3.1.1/binaries/apache-maven-3.1.1-bin.tar.gz 
</span></span></code></pre></div><h4 id="13-è§£å‹mavenå®‰è£…åŒ…">1.3 è§£å‹mavenå®‰è£…åŒ…</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#åˆ›å»ºmavençš„å®‰è£…åŒ…</span>
</span></span><span style="display:flex;"><span>mkdir /usr/local/maven/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#è§£å‹åˆ°æŒ‡å®šçš„ç›®å½•</span>
</span></span><span style="display:flex;"><span>tar -zxvf apache-maven-3.1.1-bin.tar.gz -C /usr/local/maven/
</span></span></code></pre></div><h4 id="14-è®¾ç½®è½¯è¿æ¥">1.4 è®¾ç½®è½¯è¿æ¥</h4>
<pre tabindex="0"><code>ln -s apache-maven-3.1.1 maven 
</code></pre><h4 id="15-è®¾ç½®path">1.5 è®¾ç½®path</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#æ‰“å¼€æ–‡ä»¶ </span>
</span></span><span style="display:flex;"><span>vim  /etc/profile.d/maven.sh
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#å°†ä¸‹é¢çš„å†…å®¹å¤åˆ¶åˆ°æ–‡ä»¶ï¼Œä¿å­˜ </span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">export</span> <span style="color:#008080">MAVEN_HOME</span><span style="color:#000;font-weight:bold">=</span>/usr/local/maven/maven  
</span></span><span style="display:flex;"><span><span style="color:#0086b3">export</span> <span style="color:#008080">PATH</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">${</span><span style="color:#008080">MAVEN_HOME</span><span style="color:#d14">}</span>/bin:<span style="color:#d14">${</span><span style="color:#008080">PATH</span><span style="color:#d14">}</span> 
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#è®¾ç½®å¥½Mavençš„è·¯å¾„ä¹‹åï¼Œéœ€è¦è¿è¡Œä¸‹é¢çš„å‘½ä»¤ä½¿å…¶ç”Ÿæ•ˆ</span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">source</span> /etc/profile.d/maven.sh
</span></span></code></pre></div><h4 id="16-éªŒè¯mavenæ˜¯å¦å®‰è£…æˆåŠŸ">1.6 éªŒè¯mavenæ˜¯å¦å®‰è£…æˆåŠŸ</h4>
<pre tabindex="0"><code>mvn -v
</code></pre><h4 id="17-è®¾ç½®mavençš„é˜¿é‡Œäº‘é•œåƒ">1.7 è®¾ç½®mavençš„é˜¿é‡Œäº‘é•œåƒ</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#000080">&lt;mirror&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;id&gt;</span>alimaven<span style="color:#000080">&lt;/id&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;name&gt;</span>aliyun maven<span style="color:#000080">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;url&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span style="color:#000080">&lt;/url&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;mirrorOf&gt;</span>central<span style="color:#000080">&lt;/mirrorOf&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/mirror&gt;</span> 
</span></span></code></pre></div><h3 id="2-å®‰è£…ikåˆ†è¯å™¨">2 å®‰è£…IKåˆ†è¯å™¨</h3>
<h4 id="21-ä¸‹è½½ikåˆ†è¯å™¨">2.1 ä¸‹è½½IKåˆ†è¯å™¨</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>wget https://github.com/medcl/elasticsearch-analysis-ik/archive/v7.4.0.zip
</span></span></code></pre></div><h4 id="22-è§£å‹ikåˆ°æŒ‡å®šç›®å½•">2.2 è§£å‹IKåˆ°æŒ‡å®šç›®å½•</h4>
<p>ç”±äºè¿™é‡Œæ˜¯zipåŒ…ä¸æ˜¯gzåŒ…ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨unzipå‘½ä»¤è¿›è¡Œè§£å‹ï¼Œå¦‚æœæœ¬æœºç¯å¢ƒæ²¡æœ‰å®‰è£…unzipï¼Œè¯·æ‰§è¡Œï¼š</p>
<pre tabindex="0"><code>yum install zip 
yum install unzip
</code></pre><p>è§£å‹IK</p>
<pre tabindex="0"><code>unzip v7.4.0.zip
</code></pre><h4 id="23-ç¼–è¯‘jaråŒ…">2.3 ç¼–è¯‘jaråŒ…</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># åˆ‡æ¢åˆ° elasticsearch-analysis-ik-7.4.0ç›®å½•</span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">cd</span> elasticsearch-analysis-ik-7.4.0/
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#æ‰“åŒ…ï¼Œæ³¨æ„ç¬¬ä¸€æ¬¡ä½¿ç”¨mavenä¼šæ¯”è¾ƒæ…¢ï¼Œæå‰é…ç½®å¥½é˜¿é‡Œäº‘é•œåƒ</span>
</span></span><span style="display:flex;"><span>mvn package
</span></span></code></pre></div><h4 id="24-jaråŒ…ç§»åŠ¨">2.4 jaråŒ…ç§»åŠ¨</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic">#åˆ‡æ¢ç›®å½•</span>
</span></span><span style="display:flex;"><span><span style="color:#0086b3">cd</span> /usr/local/es/elasticsearch-7.4.0/plugins/
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#æ–°å»ºç›®å½•</span>
</span></span><span style="display:flex;"><span>mkdir analysis-ik
</span></span><span style="display:flex;"><span><span style="color:#0086b3">cd</span> analysis-ik
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#æ‰§è¡Œæ‹·è´</span>
</span></span><span style="display:flex;"><span>cp -R /opt/elasticsearch-analysis-ik-7.4.0/target/releases/elasticsearch-analysis-ik-7.4.0.zip      /usr/local/es/elasticsearch-7.4.0/plugins/analysis-ik
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">#æ‰§è¡Œè§£å‹</span>
</span></span><span style="display:flex;"><span>unzip  /usr/local/es/elasticsearch-7.4.0/plugins/analysis-ik/elasticsearch-analysis-ik-7.4.0.zip
</span></span></code></pre></div><h4 id="25-æ‹·è´è¯å…¸">2.5 æ‹·è´è¯å…¸</h4>
<p>å°†elasticsearch-analysis-ik-7.4.0ç›®å½•ä¸‹çš„configç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶ æ‹·è´åˆ°elasticsearchçš„configç›®å½•</p>
<pre tabindex="0"><code>cp -R /opt/elasticsearch-analysis-ik-7.4.0/config/*   /usr/local/es/elasticsearch-7.4.0/config
</code></pre><h4 id="26-é‡æ–°å¯åŠ¨">2.6 é‡æ–°å¯åŠ¨</h4>
<p>é…ç½®æˆåŠŸä¹‹åï¼Œé‡æ–°å¯åŠ¨ESï¼Œé‡æ–°å¯åŠ¨Kibanaï¼Œä½¿ç”¨IKåˆ†è¯å™¨ã€‚</p>
<h2 id="å››ä½¿ç”¨ikåˆ†è¯å™¨">ï¼ˆå››ï¼‰ä½¿ç”¨IKåˆ†è¯å™¨</h2>
<h3 id="1-ikåˆ†è¯å™¨ä½¿ç”¨">1 IKåˆ†è¯å™¨ä½¿ç”¨</h3>
<p>IKåˆ†è¯å™¨æœ‰ä¸¤ç§åˆ†è¯æ¨¡å¼ï¼šik_max_wordå’Œik_smartæ¨¡å¼ã€‚</p>
<h4 id="11ik_max_word">1.1ik_max_word</h4>
<p>ä¼šå°†æ–‡æœ¬åšæœ€ç»†ç²’åº¦çš„æ‹†åˆ†ï¼Œæ¯”å¦‚ä¼šå°†â€œä¹’ä¹“çƒæ˜å¹´æ€»å† å†›â€æ‹†åˆ†ä¸ºâ€œä¹’ä¹“çƒã€ä¹’ä¹“ã€çƒã€æ˜å¹´ã€æ€»å† å†›ã€å† å†›ã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">#æ–¹å¼ä¸€</span> <span style="color:#a61717;background-color:#e3d2d2">ik_max_word</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">/_analyze</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;analyzer&#34;</span>: <span style="color:#d14">&#34;ik_max_word&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;text&#34;</span>: <span style="color:#d14">&#34;ä¹’ä¹“çƒæ˜å¹´æ€»å† å†›&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ik_max_wordåˆ†è¯å™¨æ‰§è¡Œå¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;tokens&#34;</span> : [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;token&#34;</span> : <span style="color:#d14">&#34;ä¹’ä¹“çƒ&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;start_offset&#34;</span> : <span style="color:#099">0</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;end_offset&#34;</span> : <span style="color:#099">3</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;type&#34;</span> : <span style="color:#d14">&#34;CN_WORD&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;position&#34;</span> : <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;token&#34;</span> : <span style="color:#d14">&#34;ä¹’ä¹“&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;start_offset&#34;</span> : <span style="color:#099">0</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;end_offset&#34;</span> : <span style="color:#099">2</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;type&#34;</span> : <span style="color:#d14">&#34;CN_WORD&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;position&#34;</span> : <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;token&#34;</span> : <span style="color:#d14">&#34;çƒ&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;start_offset&#34;</span> : <span style="color:#099">2</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;end_offset&#34;</span> : <span style="color:#099">3</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;type&#34;</span> : <span style="color:#d14">&#34;CN_CHAR&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;position&#34;</span> : <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;token&#34;</span> : <span style="color:#d14">&#34;æ˜å¹´&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;start_offset&#34;</span> : <span style="color:#099">3</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;end_offset&#34;</span> : <span style="color:#099">5</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;type&#34;</span> : <span style="color:#d14">&#34;CN_WORD&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;position&#34;</span> : <span style="color:#099">3</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;token&#34;</span> : <span style="color:#d14">&#34;æ€»å† å†›&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;start_offset&#34;</span> : <span style="color:#099">5</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;end_offset&#34;</span> : <span style="color:#099">8</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;type&#34;</span> : <span style="color:#d14">&#34;CN_WORD&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;position&#34;</span> : <span style="color:#099">4</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;token&#34;</span> : <span style="color:#d14">&#34;å† å†›&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;start_offset&#34;</span> : <span style="color:#099">6</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;end_offset&#34;</span> : <span style="color:#099">8</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;type&#34;</span> : <span style="color:#d14">&#34;CN_WORD&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;position&#34;</span> : <span style="color:#099">5</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="12-ik_smart">1.2 ik_smart</h4>
<p>ä¼šåšæœ€ç²—ç²’åº¦çš„æ‹†åˆ†ï¼Œæ¯”å¦‚ä¼šå°†â€œä¹’ä¹“çƒæ˜å¹´æ€»å† å†›â€æ‹†åˆ†ä¸ºä¹’ä¹“çƒã€æ˜å¹´ã€æ€»å† å†›ã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">#æ–¹å¼äºŒik_smart</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">/_analyze</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;analyzer&#34;</span>: <span style="color:#d14">&#34;ik_smart&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;text&#34;</span>: <span style="color:#d14">&#34;ä¹’ä¹“çƒæ˜å¹´æ€»å† å†›&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ik_smartåˆ†è¯å™¨æ‰§è¡Œå¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;tokens&#34;</span> : [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;token&#34;</span> : <span style="color:#d14">&#34;ä¹’ä¹“çƒ&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;start_offset&#34;</span> : <span style="color:#099">0</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;end_offset&#34;</span> : <span style="color:#099">3</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;type&#34;</span> : <span style="color:#d14">&#34;CN_WORD&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;position&#34;</span> : <span style="color:#099">0</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;token&#34;</span> : <span style="color:#d14">&#34;æ˜å¹´&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;start_offset&#34;</span> : <span style="color:#099">3</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;end_offset&#34;</span> : <span style="color:#099">5</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;type&#34;</span> : <span style="color:#d14">&#34;CN_WORD&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;position&#34;</span> : <span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;token&#34;</span> : <span style="color:#d14">&#34;æ€»å† å†›&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;start_offset&#34;</span> : <span style="color:#099">5</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;end_offset&#34;</span> : <span style="color:#099">8</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;type&#34;</span> : <span style="color:#d14">&#34;CN_WORD&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;position&#34;</span> : <span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ç”±æ­¤å¯è§  ä½¿ç”¨ik_smartå¯ä»¥å°†æ–‡æœ¬&quot;text&quot;: &ldquo;ä¹’ä¹“çƒæ˜å¹´æ€»å† å†›&quot;åˆ†æˆäº†ã€ä¹’ä¹“çƒã€‘ã€æ˜å¹´ã€‘ã€æ€»å† å†›ã€‘</p>
<p>è¿™æ ·çœ‹çš„è¯ï¼Œè¿™æ ·çš„åˆ†è¯æ•ˆæœè¾¾åˆ°äº†æˆ‘ä»¬çš„è¦æ±‚ã€‚</p>
<h4 id="13-ä½¿ç”¨ikåˆ†è¯å™¨æŸ¥è¯¢æ–‡æ¡£">1.3 ä½¿ç”¨IKåˆ†è¯å™¨æŸ¥è¯¢æ–‡æ¡£</h4>
<p>è¯æ¡æŸ¥è¯¢ï¼šterm</p>
<p>â€‹			è¯æ¡æŸ¥è¯¢ä¸ä¼šåˆ†ææŸ¥è¯¢æ¡ä»¶ï¼Œåªæœ‰å½“è¯æ¡å’ŒæŸ¥è¯¢å­—ç¬¦ä¸²å®Œå…¨åŒ¹é…æ—¶æ‰åŒ¹é…æœç´¢</p>
<p>å…¨æ–‡æŸ¥è¯¢ï¼šmatch</p>
<p>â€‹           å…¨æ–‡æŸ¥è¯¢ä¼šåˆ†ææŸ¥è¯¢æ¡ä»¶ï¼Œå…ˆå°†æŸ¥è¯¢æ¡ä»¶è¿›è¡Œåˆ†è¯ï¼Œç„¶åæŸ¥è¯¢ï¼Œæ±‚å¹¶é›†</p>
<p>1.åˆ›å»ºç´¢å¼•ï¼Œæ·»åŠ æ˜ å°„ï¼Œå¹¶æŒ‡å®šåˆ†è¯å™¨ä¸ºikåˆ†è¯å™¨</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">PUT</span> <span style="color:#a61717;background-color:#e3d2d2">person</span><span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;name&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#d14">&#34;keyword&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;address&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#d14">&#34;text&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&#34;analyzer&#34;</span>: <span style="color:#d14">&#34;ik_max_word&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&#34;age&#34;</span>:{
</span></span><span style="display:flex;"><span>         <span style="color:#000080">&#34;type&#34;</span>:<span style="color:#d14">&#34;integer&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>2.æ·»åŠ æ–‡æ¡£</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">POST</span> <span style="color:#a61717;background-color:#e3d2d2">/person</span><span style="color:#099">2</span><span style="color:#a61717;background-color:#e3d2d2">/_doc/</span><span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;name&#34;</span>:<span style="color:#d14">&#34;å¼ ä¸‰&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;age&#34;</span>:<span style="color:#099">18</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;address&#34;</span>:<span style="color:#d14">&#34;åŒ—äº¬æµ·æ·€åŒº&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">POST</span> <span style="color:#a61717;background-color:#e3d2d2">/person</span><span style="color:#099">2</span><span style="color:#a61717;background-color:#e3d2d2">/_doc/</span><span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;name&#34;</span>:<span style="color:#d14">&#34;æå››&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;age&#34;</span>:<span style="color:#099">18</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;address&#34;</span>:<span style="color:#d14">&#34;åŒ—äº¬æœé˜³åŒº&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">POST</span> <span style="color:#a61717;background-color:#e3d2d2">/person</span><span style="color:#099">2</span><span style="color:#a61717;background-color:#e3d2d2">/_doc/</span><span style="color:#099">3</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;name&#34;</span>:<span style="color:#d14">&#34;ç‹äº”&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;age&#34;</span>:<span style="color:#099">18</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;address&#34;</span>:<span style="color:#d14">&#34;åŒ—äº¬æ˜Œå¹³åŒº&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">POST</span> <span style="color:#a61717;background-color:#e3d2d2">/person</span><span style="color:#099">2</span><span style="color:#a61717;background-color:#e3d2d2">/_doc/</span><span style="color:#099">4</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;name&#34;</span>:<span style="color:#d14">&#34;èµµå…­&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;age&#34;</span>:<span style="color:#099">18</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;address&#34;</span>:<span style="color:#d14">&#34;æ˜Œå¹³åŒºæ…§èªå›­&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>3.æŸ¥è¯¢æ˜ å°„</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">person</span><span style="color:#099">2</span>
</span></span></code></pre></div><p><img src="/posts/tool/20220526220934/image-20220526221919810.png"
    
    
    
    loading="lazy"
    
    
></p>
<p>4.æŸ¥çœ‹åˆ†è¯æ•ˆæœ</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">_analyze</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;analyzer&#34;</span>: <span style="color:#d14">&#34;ik_max_word&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;text&#34;</span>: <span style="color:#d14">&#34;åŒ—äº¬æµ·æ·€&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>5.è¯æ¡æŸ¥è¯¢ï¼šterm</p>
<p>æŸ¥è¯¢person2ä¸­åŒ¹é…åˆ°&quot;åŒ—äº¬&quot;ä¸¤å­—çš„è¯æ¡</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">/person</span><span style="color:#099">2</span><span style="color:#a61717;background-color:#e3d2d2">/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&#34;term&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;address&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&#34;value&#34;</span>: <span style="color:#d14">&#34;åŒ—äº¬&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>6.å…¨æ–‡æŸ¥è¯¢ï¼šmatch</p>
<p>å…¨æ–‡æŸ¥è¯¢ä¼šåˆ†ææŸ¥è¯¢æ¡ä»¶ï¼Œå…ˆå°†æŸ¥è¯¢æ¡ä»¶è¿›è¡Œåˆ†è¯ï¼Œç„¶åæŸ¥è¯¢ï¼Œæ±‚å¹¶é›†</p>
<pre tabindex="0"><code>GET /person2/_search
{
  &#34;query&#34;: {
    &#34;match&#34;: {
      &#34;address&#34;:&#34;åŒ—äº¬æ˜Œå¹³&#34;
    }
  }
}
</code></pre><h1 id="4-elasticsearchæ ¸å¿ƒæ¦‚å¿µ">4 ElasticSearchæ ¸å¿ƒæ¦‚å¿µ</h1>
<p><strong>ç´¢å¼•ï¼ˆindexï¼‰</strong></p>
<p>ElasticSearchå­˜å‚¨æ•°æ®çš„åœ°æ–¹ï¼Œå¯ä»¥ç†è§£æˆå…³ç³»å‹æ•°æ®åº“ä¸­çš„æ•°æ®åº“æ¦‚å¿µã€‚</p>
<p><strong>æ˜ å°„ï¼ˆmappingï¼‰</strong></p>
<p>mappingå®šä¹‰äº†æ¯ä¸ªå­—æ®µçš„ç±»å‹ã€å­—æ®µæ‰€ä½¿ç”¨çš„åˆ†è¯å™¨ç­‰ã€‚ç›¸å½“äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„è¡¨ç»“æ„ã€‚</p>
<p><strong>æ–‡æ¡£ï¼ˆdocumentï¼‰</strong></p>
<p>Elasticsearchä¸­çš„æœ€å°æ•°æ®å•å…ƒï¼Œå¸¸ä»¥jsonæ ¼å¼æ˜¾ç¤ºã€‚ä¸€ä¸ªdocumentç›¸å½“äºå…³ç³»å‹æ•°æ®åº“ä¸­çš„ä¸€è¡Œæ•°æ®ã€‚</p>
<p><strong>å€’æ’ç´¢å¼•</strong></p>
<p>ä¸€ä¸ªå€’æ’ç´¢å¼•ç”±æ–‡æ¡£ä¸­æ‰€æœ‰ä¸é‡å¤è¯çš„åˆ—è¡¨æ„æˆï¼Œå¯¹äºå…¶ä¸­æ¯ä¸ªè¯ï¼Œå¯¹åº”ä¸€ä¸ªåŒ…å«å®ƒçš„æ–‡æ¡£idåˆ—è¡¨ã€‚</p>
<p><strong>ç±»å‹ï¼ˆtypeï¼‰</strong></p>
<p>ä¸€ç§typeå°±åƒä¸€ç±»è¡¨ã€‚å¦‚ç”¨æˆ·è¡¨ã€è§’è‰²è¡¨ç­‰ã€‚åœ¨Elasticsearch7.Xé»˜è®¤typeä¸º_doc</p>
<pre><code>ES 5.xä¸­ä¸€ä¸ªindexå¯ä»¥æœ‰å¤šç§typeã€‚
ES 6.xä¸­ä¸€ä¸ªindexåªèƒ½æœ‰ä¸€ç§typeã€‚
ES 7.xä»¥åï¼Œå°†é€æ­¥ç§»é™¤typeè¿™ä¸ªæ¦‚å¿µï¼Œç°åœ¨çš„æ“ä½œå·²ç»ä¸å†ä½¿ç”¨ï¼Œé»˜è®¤_doc
</code></pre>
<h1 id="5-è„šæœ¬æ“ä½œelasticsearch">5 è„šæœ¬æ“ä½œElasticSearch</h1>
<h2 id="ä¸€restfulé£æ ¼ä»‹ç»">ï¼ˆä¸€ï¼‰RESTfulé£æ ¼ä»‹ç»</h2>
<p>Restfulå°±æ˜¯ä¸€ä¸ªèµ„æºå®šä½åŠèµ„æºæ“ä½œçš„é£æ ¼ã€‚ä¸æ˜¯æ ‡å‡†ä¹Ÿä¸æ˜¯åè®®ï¼Œåªæ˜¯ä¸€ç§é£æ ¼ã€‚åŸºäºè¿™ä¸ªé£æ ¼è®¾è®¡çš„è½¯ä»¶å¯ä»¥æ›´ç®€æ´ï¼Œæ›´æœ‰å±‚æ¬¡ï¼Œå¯ä»¥é™ä½å¼€å‘çš„å¤æ‚æ€§ï¼Œæé«˜ç³»ç»Ÿçš„å¯ä¼¸ç¼©æ€§ã€‚</p>
<p>ç‰¹ç‚¹ï¼š</p>
<p>1.åŸºäºhttpåè®®</p>
<p>2.ä½¿ç”¨XMLæ ¼å¼å®šä¹‰æˆ–JSONæ ¼å¼å®šä¹‰</p>
<p>3.æ¯ä¸€ä¸ªURIä»£è¡¨1ç§èµ„æºã€‚</p>
<p>4.å®¢æˆ·ç«¯ä½¿ç”¨GETã€POSTã€PUTã€DELETE 4ä¸ªè¡¨ç¤ºæ“ä½œæ–¹å¼çš„åŠ¨è¯å¯¹æœåŠ¡ç«¯èµ„æºè¿›è¡Œæ“ä½œï¼š</p>
<p>GETï¼šç”¨æ¥è·å–èµ„æº</p>
<p>POSTï¼šç”¨æ¥æ–°å»ºèµ„æºï¼ˆä¹Ÿå¯ä»¥ç”¨äºæ›´æ–°èµ„æºï¼‰</p>
<p>PUTï¼šç”¨æ¥æ›´æ–°èµ„æº</p>
<p>DELETEï¼šç”¨æ¥åˆ é™¤èµ„æº
<img src="/posts/tool/20220526220934/image-20220526221419329.png"
    
    
    
    loading="lazy"
    
    
></p>
<h2 id="äºŒæ“ä½œç´¢å¼•">ï¼ˆäºŒï¼‰æ“ä½œç´¢å¼•</h2>
<h3 id="1-åˆ›å»ºç´¢å¼•put">1 åˆ›å»ºç´¢å¼•ï¼ˆPUTï¼‰</h3>
<pre tabindex="0"><code>http://ip:ç«¯å£/ç´¢å¼•åç§°
æ¡ˆä¾‹ï¼š 
http://192.168.126.20:9200/index_01
</code></pre><h3 id="2-æŸ¥è¯¢ç´¢å¼•get">2 æŸ¥è¯¢ç´¢å¼•ï¼ˆGETï¼‰</h3>
<pre tabindex="0"><code>GET http://ip:ç«¯å£/ç´¢å¼•åç§°  # æŸ¥è¯¢å•ä¸ªç´¢å¼•ä¿¡æ¯
GET http://ip:ç«¯å£/ç´¢å¼•åç§°1,ç´¢å¼•åç§°2...  # æŸ¥è¯¢å¤šä¸ªç´¢å¼•ä¿¡æ¯
GET http://ip:ç«¯å£/_all  # æŸ¥è¯¢æ‰€æœ‰ç´¢å¼•ä¿¡æ¯
</code></pre><h3 id="3-åˆ é™¤ç´¢å¼•delete">3 åˆ é™¤ç´¢å¼•ï¼ˆDELETEï¼‰</h3>
<pre tabindex="0"><code>DELETE http://ip:ç«¯å£/ç´¢å¼•åç§°
</code></pre><h3 id="4-å…³é—­æ‰“å¼€ç´¢å¼•äº†è§£">4 å…³é—­ã€æ‰“å¼€ç´¢å¼•ï¼ˆäº†è§£ï¼‰</h3>
<pre tabindex="0"><code>POST http://ip:ç«¯å£/ç´¢å¼•åç§°/_close  
POST http://ip:ç«¯å£/ç´¢å¼•åç§°/_open 
</code></pre><h2 id="ä¸‰elasticsearch-æ•°æ®ç±»å‹">ï¼ˆä¸‰ï¼‰ElasticSearch æ•°æ®ç±»å‹</h2>
<h3 id="1-ç®€å•æ•°æ®ç±»å‹">1 ç®€å•æ•°æ®ç±»å‹</h3>
<table>
<thead>
<tr>
<th>æ•°æ®ç±»å‹</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>å­—ç¬¦ä¸²</td>
<td>text ï¼šä¼šåˆ†è¯ï¼Œä¸æ”¯æŒèšåˆ    ç›¸å½“äºmysql ä¸­çš„sumï¼ˆæ±‚å’Œï¼‰</td>
</tr>
<tr>
<td></td>
<td>keywordï¼šä¸ä¼šåˆ†è¯ï¼Œå°†å…¨éƒ¨å†…å®¹ä½œä¸ºä¸€ä¸ªè¯æ¡ï¼Œæ”¯æŒèšåˆ</td>
</tr>
<tr>
<td>æ•°å€¼</td>
<td>byte, short, integer, long, float, double</td>
</tr>
<tr>
<td>å¸ƒå°”</td>
<td>boolean</td>
</tr>
<tr>
<td>èŒƒå›´ç±»å‹</td>
<td>integer_range, float_range, long_range, double_range, date_range</td>
</tr>
<tr>
<td>æ—¥æœŸ</td>
<td>date</td>
</tr>
</tbody>
</table>
<h3 id="2-å¤æ‚æ•°æ®ç±»å‹">2 å¤æ‚æ•°æ®ç±»å‹</h3>
<table>
<thead>
<tr>
<th>æ•°æ®ç±»å‹</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ•°ç»„:  [ ]</td>
<td>nested (for arrays of JSON objects æ•°ç»„ç±»å‹çš„JSONå¯¹è±¡)</td>
</tr>
<tr>
<td>å¯¹è±¡ï¼š{ }</td>
<td>object(for single JSON objects å•ä¸ªJSONå¯¹è±¡)</td>
</tr>
</tbody>
</table>
<h2 id="å››æ“ä½œæ˜ å°„">ï¼ˆå››ï¼‰æ“ä½œæ˜ å°„</h2>
<h3 id="1-æŸ¥è¯¢æ˜ å°„">1 æŸ¥è¯¢æ˜ å°„</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">/ç´¢å¼•çš„åç§°/_mapping</span>
</span></span></code></pre></div><h3 id="2-åˆ›å»ºæ˜ å°„">2 åˆ›å»ºæ˜ å°„</h3>
<h4 id="21-åˆ›å»ºç´¢å¼•åæ·»åŠ æ˜ å°„">2.1 åˆ›å»ºç´¢å¼•åæ·»åŠ æ˜ å°„</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">#åˆ›å»ºä¸€ä¸ªperson</span> <span style="color:#a61717;background-color:#e3d2d2">ç´¢å¼•</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">PUT</span> <span style="color:#a61717;background-color:#e3d2d2">person</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">#æŸ¥è¯¢person</span> <span style="color:#a61717;background-color:#e3d2d2">ç´¢å¼•çš„mapping</span> <span style="color:#a61717;background-color:#e3d2d2">æ˜¯ç©º</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">/person/_mapping</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">#ç»™person</span> <span style="color:#a61717;background-color:#e3d2d2">æ·»åŠ ç´¢å¼•</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">PUT</span> <span style="color:#a61717;background-color:#e3d2d2">/person/_mapping</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;properties&#34;</span>:{
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&#34;name&#34;</span>:{
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;type&#34;</span>:<span style="color:#d14">&#34;text&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&#34;age&#34;</span>:{
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;type&#34;</span>:<span style="color:#d14">&#34;integer&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="22-åˆ›å»ºç´¢å¼•å¹¶æ·»åŠ æ˜ å°„">2.2 åˆ›å»ºç´¢å¼•å¹¶æ·»åŠ æ˜ å°„</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">#åˆ›å»ºç´¢å¼•å¹¶ä¸”æ·»åŠ æ˜ å°„</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">PUT</span> <span style="color:#a61717;background-color:#e3d2d2">person</span><span style="color:#099">2</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;name&#34;</span>:{
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&#34;type&#34;</span>:<span style="color:#d14">&#34;text&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;age&#34;</span>:{
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#d14">&#34;integer&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">#æŸ¥è¯¢æ˜ å°„</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">person</span><span style="color:#099">2</span><span style="color:#a61717;background-color:#e3d2d2">/_mapping</span>
</span></span></code></pre></div><p>æ·»åŠ å­—æ®µ</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">#ç»™åˆ›å»ºå¥½çš„ç´¢å¼•æ·»åŠ å­—æ®µ</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">PUT</span> <span style="color:#a61717;background-color:#e3d2d2">/person</span><span style="color:#099">2</span><span style="color:#a61717;background-color:#e3d2d2">/_mapping</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;properties&#34;</span>:{
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&#34;address&#34;</span>:{
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;type&#34;</span>:<span style="color:#d14">&#34;text&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>æ€»ç»“ï¼šåœ¨å®é™…å½“ä¸­ ï¼Œæˆ‘ä»¬å¾ˆå°‘æ“ä½œæ˜ å°„ï¼Œä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨APIæ–¹å¼æ“ä½œæ–‡æ¡£ï¼Œæ‰€ä»¥ä»¥ä¸Šçš„æ“ä½œåªéœ€è¦èƒ½çœ‹æ‡‚å°±å¯ä»¥ã€‚</p>
<h2 id="äº”-æ“ä½œæ–‡æ¡£">ï¼ˆäº”ï¼‰ æ“ä½œæ–‡æ¡£</h2>
<h3 id="1-æŸ¥è¯¢æ–‡æ¡£">1 æŸ¥è¯¢æ–‡æ¡£</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">#æ ¹æ®idæŸ¥è¯¢å…·ä½“çš„æ–‡æ¡£</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">è¯­æ³•ï¼š</span> <span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">/ç´¢å¼•çš„åç§°/_doc/ç´¢å¼•çš„id</span> 
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">æ¡ˆä¾‹ï¼š</span> <span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">/person</span><span style="color:#099">1</span><span style="color:#a61717;background-color:#e3d2d2">/_doc/</span><span style="color:#099">1</span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">#æŸ¥è¯¢æ‰€æœ‰çš„æ–‡æ¡£</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">è¯­æ³•ï¼šGET</span> <span style="color:#a61717;background-color:#e3d2d2">/ç´¢å¼•åç§°/_search</span> 
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">æ¡ˆä¾‹ï¼šGET</span> <span style="color:#a61717;background-color:#e3d2d2">/person</span><span style="color:#099">1</span><span style="color:#a61717;background-color:#e3d2d2">/_search</span>
</span></span></code></pre></div><h3 id="2-æ·»åŠ æ–‡æ¡£æŒ‡å®šid">2 æ·»åŠ æ–‡æ¡£ï¼ŒæŒ‡å®šid</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">#è¯­æ³•ï¼šPOST</span> <span style="color:#a61717;background-color:#e3d2d2">/ç´¢å¼•çš„åç§°/æ–‡æ¡£çš„ç±»å‹/æ–‡æ¡£çš„id</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">POST</span> <span style="color:#a61717;background-color:#e3d2d2">/person</span><span style="color:#099">2</span><span style="color:#a61717;background-color:#e3d2d2">/_doc/</span><span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;name&#34;</span>:<span style="color:#d14">&#34;å¼ ä¸‰&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;age&#34;</span>:<span style="color:#099">18</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;address&#34;</span>:<span style="color:#d14">&#34;åŒ—äº¬&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">#æŸ¥è¯¢æ–‡æ¡£</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">/person</span><span style="color:#099">1</span><span style="color:#a61717;background-color:#e3d2d2">/_doc/</span><span style="color:#099">1</span>
</span></span></code></pre></div><p>æ·»åŠ æ–‡æ¡£ï¼Œä¸æŒ‡å®šid</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">#æ·»åŠ æ–‡æ¡£ï¼Œä¸æŒ‡å®šid</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">POST</span> <span style="color:#a61717;background-color:#e3d2d2">/person</span><span style="color:#099">1</span><span style="color:#a61717;background-color:#e3d2d2">/_doc/</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;name&#34;</span>:<span style="color:#d14">&#34;å¼ ä¸‰&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;age&#34;</span>:<span style="color:#099">18</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;address&#34;</span>:<span style="color:#d14">&#34;åŒ—äº¬&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">#æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">/person</span><span style="color:#099">1</span><span style="color:#a61717;background-color:#e3d2d2">/_search</span>
</span></span></code></pre></div><h3 id="3-åˆ é™¤æ–‡æ¡£">3 åˆ é™¤æ–‡æ¡£</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">#åˆ é™¤æŒ‡å®šidæ–‡æ¡£</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">DELETE</span> <span style="color:#a61717;background-color:#e3d2d2">/person</span><span style="color:#099">1</span><span style="color:#a61717;background-color:#e3d2d2">/_doc/</span><span style="color:#099">1</span>
</span></span></code></pre></div><h1 id="7-elasticsearch-javaapi">7 ElasticSearch JavaAPI</h1>
<h2 id="ä¸€springbootæ•´åˆelasticsearchç¯å¢ƒæ­å»º">ï¼ˆä¸€ï¼‰SpringBootæ•´åˆElasticSearchç¯å¢ƒæ­å»º</h2>
<h3 id="1-æ­å»ºspringbootå·¥ç¨‹">1 æ­å»ºSpringBootå·¥ç¨‹</h3>
<h3 id="2-å¼•å…¥elasticsearchç›¸å…³åæ ‡">2 å¼•å…¥ElasticSearchç›¸å…³åæ ‡</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#998;font-style:italic">&lt;!--å¼•å…¥esçš„åæ ‡--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;groupId&gt;</span>org.elasticsearch.client<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;artifactId&gt;</span>elasticsearch-rest-high-level-client<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;version&gt;</span>7.4.0<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;groupId&gt;</span>org.elasticsearch.client<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;artifactId&gt;</span>elasticsearch-rest-client<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;version&gt;</span>7.4.0<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;groupId&gt;</span>org.elasticsearch<span style="color:#000080">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;artifactId&gt;</span>elasticsearch<span style="color:#000080">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&lt;version&gt;</span>7.4.0<span style="color:#000080">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000080">&lt;/dependency&gt;</span>
</span></span></code></pre></div><h3 id="3-ç¼–å†™æ ¸å¿ƒé…ç½®ç±»">3 ç¼–å†™æ ¸å¿ƒé…ç½®ç±»</h3>
<p>ç¼–å†™æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#000080">elasticsearch</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">hostname</span>:<span style="color:#bbb"> </span><span style="color:#099">192.168.126.20</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#000080">port</span>:<span style="color:#bbb"> </span><span style="color:#099">9200</span><span style="color:#bbb">
</span></span></span></code></pre></div><p>ç¼–å†™æ ¸å¿ƒé…ç½®ç±»</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@ConfigurationProperties</span><span style="color:#000;font-weight:bold">(</span>prefix<span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;elasticsearch&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">ElasticSearchConfig</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> String host<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> <span style="color:#458;font-weight:bold">int</span> port<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> RestHighLevelClient <span style="color:#900;font-weight:bold">client</span><span style="color:#000;font-weight:bold">(){</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">new</span> RestHighLevelClient<span style="color:#000;font-weight:bold">(</span>RestClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">builder</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000;font-weight:bold">new</span> HttpHost<span style="color:#000;font-weight:bold">(</span>host<span style="color:#000;font-weight:bold">,</span>port<span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;http&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>  
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> String <span style="color:#900;font-weight:bold">getHost</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> host<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setHost</span><span style="color:#000;font-weight:bold">(</span>String host<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">host</span> <span style="color:#000;font-weight:bold">=</span> host<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">int</span> <span style="color:#900;font-weight:bold">getPort</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">return</span> port<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">setPort</span><span style="color:#000;font-weight:bold">(</span><span style="color:#458;font-weight:bold">int</span> port<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">port</span> <span style="color:#000;font-weight:bold">=</span> port<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="4-æµ‹è¯•å®¢æˆ·ç«¯å¯¹è±¡">4 æµ‹è¯•å®¢æˆ·ç«¯å¯¹è±¡</h3>
<p>æ³¨æ„ï¼šä½¿ç”¨@Autowiredæ³¨å…¥RestHighLevelClient å¦‚æœæŠ¥çº¢çº¿ï¼Œåˆ™æ˜¯å› ä¸ºé…ç½®ç±»æ‰€åœ¨çš„åŒ…å’Œæµ‹è¯•ç±»æ‰€åœ¨çš„åŒ…ï¼ŒåŒ…åä¸ä¸€è‡´é€ æˆçš„</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@SpringBootTest</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">class</span> <span style="color:#458;font-weight:bold">SpringElasticsearchApplicationTests</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">private</span> RestHighLevelClient restHighLevelClient<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">contextLoads</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>restHighLevelClient<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="äºŒæ“ä½œelasticsearch">ï¼ˆäºŒï¼‰æ“ä½œElasticSearch</h2>
<h3 id="1-æ·»åŠ ç´¢å¼•">1 æ·»åŠ ç´¢å¼•</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * æ·»åŠ ç´¢å¼•ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> * @throws Exception
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">addIndex</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span> Exception<span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>   <span style="color:#998;font-style:italic">//1ï¼šä½¿ç”¨restHighLevelClientè·å–æ“ä½œç´¢å¼•çš„å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>   IndicesClient indices <span style="color:#000;font-weight:bold">=</span> restHighLevelClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">indices</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>   <span style="color:#998;font-style:italic">//2: å…·ä½“æ“ä½œç´¢å¼•ï¼Œå¹¶ä¸”è·å¾—è¿”å›å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>   <span style="color:#998;font-style:italic">//2.1 åˆ›å»ºç´¢å¼•å¯¹è±¡ï¼Œè®¾ç½®ç´¢å¼•çš„åç§°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>   CreateIndexRequest createIndexRequest <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> CreateIndexRequest<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;offcn&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>   <span style="color:#998;font-style:italic">//2.2 åˆ›å»ºç´¢å¼•ï¼Œè·å¾—è¿”å›å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>   CreateIndexResponse createIndexResponse <span style="color:#000;font-weight:bold">=</span> indices<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">create</span><span style="color:#000;font-weight:bold">(</span>createIndexRequest<span style="color:#000;font-weight:bold">,</span> RequestOptions<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">DEFAULT</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>   <span style="color:#998;font-style:italic">//3:æ ¹æ®è¿”å›å€¼åˆ¤æ–­è¿”å›ç»“æœ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>   System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>createIndexResponse<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">isAcknowledged</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="2--æ·»åŠ ç´¢å¼•å¹¶æ·»åŠ æ˜ å°„">2  æ·»åŠ ç´¢å¼•ï¼Œå¹¶æ·»åŠ æ˜ å°„</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * åˆ›å»ºç´¢å¼•å¹¶ä¸”æ·»åŠ æ˜ å°„
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * @throws IOException
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  */</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">addIndexAndMapping</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span> IOException <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//1.ä½¿ç”¨clientè·å–æ“ä½œç´¢å¼•çš„å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    IndicesClient indicesClient <span style="color:#000;font-weight:bold">=</span> restHighLevelClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">indices</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//2.å…·ä½“æ“ä½œï¼Œè·å–è¿”å›å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    CreateIndexRequest createRequest <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> CreateIndexRequest<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;offcn&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//2.1 è®¾ç½®mappings
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    String mapping <span style="color:#000;font-weight:bold">=</span> <span style="color:#d14">&#34;{\n&#34;</span> <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#34;      \&#34;properties\&#34; : {\n&#34;</span> <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#34;        \&#34;address\&#34; : {\n&#34;</span> <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#34;          \&#34;type\&#34; : \&#34;text\&#34;,\n&#34;</span> <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#34;          \&#34;analyzer\&#34; : \&#34;ik_max_word\&#34;\n&#34;</span> <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#34;        },\n&#34;</span> <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#34;        \&#34;age\&#34; : {\n&#34;</span> <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#34;          \&#34;type\&#34; : \&#34;long\&#34;\n&#34;</span> <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#34;        },\n&#34;</span> <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#34;        \&#34;name\&#34; : {\n&#34;</span> <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#34;          \&#34;type\&#34; : \&#34;keyword\&#34;\n&#34;</span> <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#34;        }\n&#34;</span> <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#34;      }\n&#34;</span> <span style="color:#000;font-weight:bold">+</span>
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#34;    }&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    createRequest<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">mapping</span><span style="color:#000;font-weight:bold">(</span>mapping<span style="color:#000;font-weight:bold">,</span> XContentType<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">JSON</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//2.2æ‰§è¡Œåˆ›å»ºï¼Œè¿”å›å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    CreateIndexResponse response <span style="color:#000;font-weight:bold">=</span> indicesClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">create</span><span style="color:#000;font-weight:bold">(</span>createRequest<span style="color:#000;font-weight:bold">,</span> RequestOptions<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">DEFAULT</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//3.æ ¹æ®è¿”å›å€¼åˆ¤æ–­ç»“æœ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>response<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">isAcknowledged</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="3-æŸ¥è¯¢åˆ é™¤åˆ¤æ–­ç´¢å¼•">3 æŸ¥è¯¢ã€åˆ é™¤ã€åˆ¤æ–­ç´¢å¼•</h3>
<h4 id="31-æŸ¥è¯¢ç´¢å¼•">3.1 æŸ¥è¯¢ç´¢å¼•</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * æŸ¥è¯¢ç´¢å¼•
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  */</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">queryIndex</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span> IOException <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//1:ä½¿ç”¨clientè·å–æ“ä½œç´¢å¼•çš„å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    IndicesClient indices <span style="color:#000;font-weight:bold">=</span> restHighLevelClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">indices</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//2:è·å¾—å¯¹è±¡ï¼Œæ‰§è¡Œå…·ä½“çš„æ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#998;font-style:italic">//2.1 åˆ›å»ºè·å–ç´¢å¼•çš„è¯·æ±‚å¯¹è±¡ï¼Œè®¾ç½®ç´¢å¼•åç§°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    GetIndexRequest getReqeust <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> GetIndexRequest<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;offcn&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//2.2 æ‰§è¡ŒæŸ¥è¯¢ï¼Œè·å¾—è¿”å›å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    GetIndexResponse response <span style="color:#000;font-weight:bold">=</span> indices<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span>getReqeust<span style="color:#000;font-weight:bold">,</span> RequestOptions<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">DEFAULT</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//3ï¼šè·å–ç»“æœ,éå†
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> MappingMetaData<span style="color:#000;font-weight:bold">&gt;</span> mappings <span style="color:#000;font-weight:bold">=</span> response<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getMappings</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>String key <span style="color:#000;font-weight:bold">:</span> mappings<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">keySet</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>key <span style="color:#000;font-weight:bold">+</span> <span style="color:#d14">&#34;:&#34;</span> <span style="color:#000;font-weight:bold">+</span> mappings<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span>key<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">getSourceAsMap</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>  
</span></span></code></pre></div><h4 id="32-åˆ é™¤ç´¢å¼•">3.2 åˆ é™¤ç´¢å¼•</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * åˆ é™¤ç´¢å¼•
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  */</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">deleteIndex</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span> IOException <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    IndicesClient indices <span style="color:#000;font-weight:bold">=</span> restHighLevelClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">indices</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    DeleteIndexRequest deleteRequest <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> DeleteIndexRequest<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;offcn&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    AcknowledgedResponse response <span style="color:#000;font-weight:bold">=</span> indices<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">delete</span><span style="color:#000;font-weight:bold">(</span>deleteRequest<span style="color:#000;font-weight:bold">,</span> RequestOptions<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">DEFAULT</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>response<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">isAcknowledged</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="33-ç´¢å¼•æ˜¯å¦å­˜åœ¨">3.3 ç´¢å¼•æ˜¯å¦å­˜åœ¨</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * åˆ¤æ–­ç´¢å¼•æ˜¯å¦å­˜åœ¨
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  */</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">existIndex</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span> IOException <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    IndicesClient indices <span style="color:#000;font-weight:bold">=</span> restHighLevelClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">indices</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    GetIndexRequest getRequest <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> GetIndexRequest<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;person&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#458;font-weight:bold">boolean</span> exists <span style="color:#000;font-weight:bold">=</span> indices<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">exists</span><span style="color:#000;font-weight:bold">(</span>getRequest<span style="color:#000;font-weight:bold">,</span> RequestOptions<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">DEFAULT</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>exists<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="4-æ“ä½œæ–‡æ¡£">4 æ“ä½œæ–‡æ¡£</h3>
<h4 id="41--æ·»åŠ æ–‡æ¡£">4.1  æ·»åŠ æ–‡æ¡£</h4>
<p>æ·»åŠ æ–‡æ¡£,ä½¿ç”¨mapä½œä¸ºæ•°æ®</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * æ·»åŠ æ–‡æ¡£,ä½¿ç”¨mapä½œä¸ºæ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  */</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">addDoc</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span> IOException <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//æ•°æ®å¯¹è±¡ï¼Œmap
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Map data <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> HashMap<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    data<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;address&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;åŒ—äº¬æ˜Œå¹³&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    data<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;name&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;é©¬åŒå¿—&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    data<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;age&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#099">20</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//1ï¼šè·å–æ“ä½œæ–‡æ¡£çš„å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    IndexRequest request <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> IndexRequest<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;offcn&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">id</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;1&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">source</span><span style="color:#000;font-weight:bold">(</span>data<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//2ï¼šæ·»åŠ æ•°æ®ï¼Œè·å–ç»“æœ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    IndexResponse response <span style="color:#000;font-weight:bold">=</span> restHighLevelClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">index</span><span style="color:#000;font-weight:bold">(</span>request<span style="color:#000;font-weight:bold">,</span> RequestOptions<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">DEFAULT</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//3ï¼šæ‰“å°å“åº”ç»“æœ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>response<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getId</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><p>æ·»åŠ æ–‡æ¡£,ä½¿ç”¨å¯¹è±¡ä½œä¸ºæ•°æ®</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * æ·»åŠ æ–‡æ¡£,ä½¿ç”¨å¯¹è±¡ä½œä¸ºæ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  */</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">addDoc2</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span> IOException <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//æ•°æ®å¯¹è±¡ï¼ŒjavaObject
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Person p <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> Person<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    p<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setId</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;2&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    p<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setName</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;å°èƒ–2222&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    p<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setAge</span><span style="color:#000;font-weight:bold">(</span><span style="color:#099">30</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    p<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setAddress</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;é™•è¥¿è¥¿å®‰&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//å°†å¯¹è±¡è½¬ä¸ºjson
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    String data <span style="color:#000;font-weight:bold">=</span> JSON<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">toJSONString</span><span style="color:#000;font-weight:bold">(</span>p<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//1:è·å–æ“ä½œæ–‡æ¡£çš„å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    IndexRequest request <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> IndexRequest<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;offcn&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">id</span><span style="color:#000;font-weight:bold">(</span>p<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getId</span><span style="color:#000;font-weight:bold">()).</span><span style="color:#008080">source</span><span style="color:#000;font-weight:bold">(</span>data<span style="color:#000;font-weight:bold">,</span> XContentType<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">JSON</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//2:æ·»åŠ æ•°æ®ï¼Œè·å–ç»“æœ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    IndexResponse response <span style="color:#000;font-weight:bold">=</span> restHighLevelClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">index</span><span style="color:#000;font-weight:bold">(</span>request<span style="color:#000;font-weight:bold">,</span> RequestOptions<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">DEFAULT</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//3:æ‰“å°å“åº”ç»“æœ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>response<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getId</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="42-ä¿®æ”¹æ–‡æ¡£æ·»åŠ æ–‡æ¡£æ—¶å¦‚æœidå­˜åœ¨åˆ™ä¿®æ”¹idä¸å­˜åœ¨åˆ™æ·»åŠ ">4.2 ä¿®æ”¹æ–‡æ¡£ï¼šæ·»åŠ æ–‡æ¡£æ—¶ï¼Œå¦‚æœidå­˜åœ¨åˆ™ä¿®æ”¹ï¼Œidä¸å­˜åœ¨åˆ™æ·»åŠ </h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * ä¿®æ”¹æ–‡æ¡£ï¼šæ·»åŠ æ–‡æ¡£æ—¶ï¼Œå¦‚æœidå­˜åœ¨åˆ™ä¿®æ”¹ï¼Œidä¸å­˜åœ¨åˆ™æ·»åŠ 
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  */</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">updateDoc</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span> IOException <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//æ•°æ®å¯¹è±¡ï¼Œmap
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Map data <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> HashMap<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    data<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;address&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;åŒ—äº¬æ˜Œå¹³&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    data<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;name&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;æœ±åŒå¿—&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    data<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;age&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#099">20</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//1ï¼šè·å–æ“ä½œæ–‡æ¡£çš„å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    IndexRequest request <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> IndexRequest<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;offcn&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">id</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;1&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">source</span><span style="color:#000;font-weight:bold">(</span>data<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//2ï¼šæ·»åŠ æ•°æ®ï¼Œè·å–ç»“æœ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    IndexResponse response <span style="color:#000;font-weight:bold">=</span> restHighLevelClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">index</span><span style="color:#000;font-weight:bold">(</span>request<span style="color:#000;font-weight:bold">,</span> RequestOptions<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">DEFAULT</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//3ï¼šæ‰“å°å“åº”ç»“æœ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>response<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getId</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="43-æ ¹æ®idæŸ¥è¯¢æ–‡æ¡£">4.3 æ ¹æ®idæŸ¥è¯¢æ–‡æ¡£</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * æ ¹æ®idæŸ¥è¯¢æ–‡æ¡£
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  */</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">findDocById</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span> IOException <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    GetRequest getReqeust <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> GetRequest<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;offcn&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;1&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//getReqeust.id(&#34;1&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    GetResponse response <span style="color:#000;font-weight:bold">=</span> restHighLevelClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span>getReqeust<span style="color:#000;font-weight:bold">,</span> RequestOptions<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">DEFAULT</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//è·å–æ•°æ®å¯¹åº”çš„json
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>response<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getSourceAsString</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="44-æ ¹æ®idåˆ é™¤æ–‡æ¡£">4.4 æ ¹æ®idåˆ é™¤æ–‡æ¡£</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  * æ ¹æ®idåˆ é™¤æ–‡æ¡£
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">  */</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">delDoc</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span> IOException <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    DeleteRequest deleteRequest <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> DeleteRequest<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;offcn&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;1&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    DeleteResponse response <span style="color:#000;font-weight:bold">=</span> restHighLevelClient<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">delete</span><span style="color:#000;font-weight:bold">(</span>deleteRequest<span style="color:#000;font-weight:bold">,</span> RequestOptions<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">DEFAULT</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>response<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getId</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="ä¸‰elasticsearchçš„æ‰¹é‡æ“ä½œ">ï¼ˆä¸‰ï¼‰ElasticSearchçš„æ‰¹é‡æ“ä½œ</h2>
<h3 id="1-bulk-æ‰¹é‡æ“ä½œè„šæœ¬å®ç°">1 bulk æ‰¹é‡æ“ä½œè„šæœ¬å®ç°</h3>
<p>éœ€æ±‚ï¼šåŒæ—¶å®Œæˆåˆ é™¤ï¼Œæ›´æ–°ï¼Œæ·»åŠ æ“ä½œ</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">POST</span> <span style="color:#a61717;background-color:#e3d2d2">_bulk</span>
</span></span><span style="display:flex;"><span>{<span style="color:#000080">&#34;delete&#34;</span>:{<span style="color:#000080">&#34;_index&#34;</span>:<span style="color:#d14">&#34;person1&#34;</span>,<span style="color:#000080">&#34;_id&#34;</span>:<span style="color:#d14">&#34;4&#34;</span>}}
</span></span><span style="display:flex;"><span>{<span style="color:#000080">&#34;create&#34;</span>:{<span style="color:#000080">&#34;_index&#34;</span>:<span style="color:#d14">&#34;person1&#34;</span>,<span style="color:#000080">&#34;_id&#34;</span>:<span style="color:#d14">&#34;5&#34;</span>}}
</span></span><span style="display:flex;"><span>{<span style="color:#000080">&#34;name&#34;</span>:<span style="color:#d14">&#34;å…«å·&#34;</span>,<span style="color:#000080">&#34;age&#34;</span>:<span style="color:#099">18</span>,<span style="color:#000080">&#34;address&#34;</span>:<span style="color:#d14">&#34;åŒ—äº¬&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="color:#000080">&#34;update&#34;</span>:{<span style="color:#000080">&#34;_index&#34;</span>:<span style="color:#d14">&#34;person1&#34;</span>,<span style="color:#000080">&#34;_id&#34;</span>:<span style="color:#d14">&#34;2&#34;</span>}}
</span></span><span style="display:flex;"><span>{<span style="color:#000080">&#34;doc&#34;</span>:{<span style="color:#000080">&#34;name&#34;</span>:<span style="color:#d14">&#34;2å·&#34;</span>}}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">æŸ¥è¯¢è¿è¡Œç»“æœ~</span> 
</span></span></code></pre></div><h3 id="2-bulkæ‰¹é‡æ“ä½œjavaapi-å®ç°">2 bulkæ‰¹é‡æ“ä½œJavaAPI å®ç°</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     *  Bulk æ‰¹é‡æ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">test2</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span> IOException <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//åˆ›å»ºbulkrequestå¯¹è±¡ï¼Œæ•´åˆæ‰€æœ‰æ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        BulkRequest bulkRequest <span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">new</span> BulkRequest<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>           <span style="color:#998;font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">        # 1. åˆ é™¤5å·è®°å½•
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">        # 2. æ·»åŠ 6å·è®°å½•
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">        # 3. ä¿®æ”¹3å·è®°å½• åç§°ä¸º â€œä¸‰å·â€
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">         */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//æ·»åŠ å¯¹åº”æ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//1. åˆ é™¤5å·è®°å½•
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        DeleteRequest deleteRequest<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">new</span> DeleteRequest<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;person1&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;5&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        bulkRequest<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>deleteRequest<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//2. æ·»åŠ 6å·è®°å½•
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">&gt;</span> map<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">new</span> HashMap<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>        map<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;name&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;å…­å·&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        IndexRequest indexRequest<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">new</span> IndexRequest<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;person1&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">id</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;6&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">source</span><span style="color:#000;font-weight:bold">(</span>map<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        bulkRequest<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>indexRequest<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//3. ä¿®æ”¹3å·è®°å½• åç§°ä¸º â€œä¸‰å·â€
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Object<span style="color:#000;font-weight:bold">&gt;</span> mapUpdate<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">new</span> HashMap<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>        mapUpdate<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;name&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;ä¸‰å·&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        UpdateRequest updateRequest<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">new</span> UpdateRequest<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;person1&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;3&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">doc</span><span style="color:#000;font-weight:bold">(</span>mapUpdate<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        bulkRequest<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>updateRequest<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//æ‰§è¡Œæ‰¹é‡æ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>        BulkResponse response <span style="color:#000;font-weight:bold">=</span> client<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">bulk</span><span style="color:#000;font-weight:bold">(</span>bulkRequest<span style="color:#000;font-weight:bold">,</span> RequestOptions<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">DEFAULT</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>response<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">status</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="3-å¯¼å…¥æ•°æ®åˆ†æåˆ›å»ºç´¢å¼•">3 å¯¼å…¥æ•°æ®åˆ†æ&amp;åˆ›å»ºç´¢å¼•</h3>
<p>éœ€æ±‚ï¼š  å°†æ•°æ®åº“ä¸­Goodè¡¨çš„æ•°æ®å¯¼å…¥åˆ°ElasticSearchå½“ä¸­</p>
<p>å®ç°æ­¥éª¤ï¼š</p>
<p>åˆ†ægoodsè¡¨ç»“æ„</p>
<p>åˆ›å»ºgoodsç´¢å¼•</p>
<p>æŸ¥è¯¢Goodsè¡¨æ•°æ®</p>
<p>æ‰¹é‡æ·»åŠ åˆ°ElasticSearchä¸­</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Json" data-lang="Json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">PUT</span> <span style="color:#a61717;background-color:#e3d2d2">goods</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>	<span style="color:#000080">&#34;mappings&#34;</span>: {
</span></span><span style="display:flex;"><span>		<span style="color:#000080">&#34;properties&#34;</span>: {
</span></span><span style="display:flex;"><span>			<span style="color:#000080">&#34;title&#34;</span>: {
</span></span><span style="display:flex;"><span>				<span style="color:#000080">&#34;type&#34;</span>: <span style="color:#d14">&#34;text&#34;</span>,
</span></span><span style="display:flex;"><span>				<span style="color:#000080">&#34;analyzer&#34;</span>: <span style="color:#d14">&#34;ik_smart&#34;</span>
</span></span><span style="display:flex;"><span>			},
</span></span><span style="display:flex;"><span>			<span style="color:#000080">&#34;price&#34;</span>: { 
</span></span><span style="display:flex;"><span>				<span style="color:#000080">&#34;type&#34;</span>: <span style="color:#d14">&#34;double&#34;</span>
</span></span><span style="display:flex;"><span>			},
</span></span><span style="display:flex;"><span>			<span style="color:#000080">&#34;createTime&#34;</span>: {
</span></span><span style="display:flex;"><span>				<span style="color:#000080">&#34;type&#34;</span>: <span style="color:#d14">&#34;date&#34;</span>
</span></span><span style="display:flex;"><span>			},
</span></span><span style="display:flex;"><span>			<span style="color:#000080">&#34;categoryName&#34;</span>: {	
</span></span><span style="display:flex;"><span>				<span style="color:#000080">&#34;type&#34;</span>: <span style="color:#d14">&#34;keyword&#34;</span>
</span></span><span style="display:flex;"><span>			},
</span></span><span style="display:flex;"><span>			<span style="color:#000080">&#34;brandName&#34;</span>: {	
</span></span><span style="display:flex;"><span>				<span style="color:#000080">&#34;type&#34;</span>: <span style="color:#d14">&#34;keyword&#34;</span>
</span></span><span style="display:flex;"><span>			},
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>			<span style="color:#000080">&#34;spec&#34;</span>: {		
</span></span><span style="display:flex;"><span>				<span style="color:#000080">&#34;type&#34;</span>: <span style="color:#d14">&#34;object&#34;</span>
</span></span><span style="display:flex;"><span>			},
</span></span><span style="display:flex;"><span>			<span style="color:#000080">&#34;saleNum&#34;</span>: {	
</span></span><span style="display:flex;"><span>				<span style="color:#000080">&#34;type&#34;</span>: <span style="color:#d14">&#34;integer&#34;</span>
</span></span><span style="display:flex;"><span>			},
</span></span><span style="display:flex;"><span>			
</span></span><span style="display:flex;"><span>			<span style="color:#000080">&#34;stock&#34;</span>: {	
</span></span><span style="display:flex;"><span>				<span style="color:#000080">&#34;type&#34;</span>: <span style="color:#d14">&#34;integer&#34;</span>
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>title:å•†å“æ ‡é¢˜</p>
<p>price:å•†å“ä»·æ ¼</p>
<p>createTime:åˆ›å»ºæ—¶é—´</p>
<p>categoryName:åˆ†ç±»åç§°ã€‚å¦‚ï¼šå®¶ç”µï¼Œæ‰‹æœº</p>
<p>brandName:å“ç‰Œåç§°ã€‚å¦‚ï¼šåä¸ºï¼Œå°ç±³</p>
<p>spec: å•†å“è§„æ ¼ã€‚å¦‚ï¼š spec:{&ldquo;å±å¹•å°ºå¯¸&rdquo;,&ldquo;5å¯¸&rdquo;ï¼Œ&ldquo;å†…å­˜å¤§å°&rdquo;,&ldquo;128G&rdquo;}</p>
<p>saleNum:é”€é‡</p>
<p>stock:åº“å­˜é‡</p>
<p>æ’å…¥ä¸€æ¡æµ‹è¯•æ•°æ®</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Json" data-lang="Json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">POST</span> <span style="color:#a61717;background-color:#e3d2d2">goods/_doc/</span><span style="color:#099">1</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;title&#34;</span>:<span style="color:#d14">&#34;å°ç±³æ‰‹æœº&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;price&#34;</span>:<span style="color:#099">1000</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;createTime&#34;</span>:<span style="color:#d14">&#34;2021-12-01&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;categoryName&#34;</span>:<span style="color:#d14">&#34;æ‰‹æœº&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;brandName&#34;</span>:<span style="color:#d14">&#34;å°ç±³&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;saleNum&#34;</span>:<span style="color:#099">3000</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;stock&#34;</span>:<span style="color:#099">10000</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;spec&#34;</span>:{
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&#34;ç½‘ç»œåˆ¶å¼&#34;</span>:<span style="color:#d14">&#34;ç§»åŠ¨4G&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&#34;å±å¹•å°ºå¯¸&#34;</span>:<span style="color:#d14">&#34;4.5&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="4-å¯¼å…¥æ•°æ®ä»£ç å®ç°">4 å¯¼å…¥æ•°æ®ä»£ç å®ç°</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * ä»Mysql æ‰¹é‡å¯¼å…¥ elasticSearch
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">test3</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span> IOException <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//1.æŸ¥è¯¢æ‰€æœ‰æ•°æ®ï¼Œmysql
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        List<span style="color:#000;font-weight:bold">&lt;</span>Goods<span style="color:#000;font-weight:bold">&gt;</span> goodsList <span style="color:#000;font-weight:bold">=</span> goodsMapper<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">findAll</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//2.bulkå¯¼å…¥
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        BulkRequest bulkRequest<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">new</span> BulkRequest<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//2.1 å¾ªç¯goodsListï¼Œåˆ›å»ºIndexRequestæ·»åŠ æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>Goods goods <span style="color:#000;font-weight:bold">:</span> goodsList<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//2.2 è®¾ç½®specè§„æ ¼ä¿¡æ¯ Mapçš„æ•°æ®   specStr:{}
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            String specStr <span style="color:#000;font-weight:bold">=</span> goods<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getSpecStr</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//å°†jsonæ ¼å¼å­—ç¬¦ä¸²è½¬ä¸ºMapé›†åˆ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            Map map <span style="color:#000;font-weight:bold">=</span> JSON<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">parseObject</span><span style="color:#000;font-weight:bold">(</span>specStr<span style="color:#000;font-weight:bold">,</span> Map<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//è®¾ç½®spec map
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            goods<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">setSpec</span><span style="color:#000;font-weight:bold">(</span>map<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//å°†goodså¯¹è±¡è½¬æ¢ä¸ºjsonå­—ç¬¦ä¸²
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            String data <span style="color:#000;font-weight:bold">=</span> JSON<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">toJSONString</span><span style="color:#000;font-weight:bold">(</span>goods<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            IndexRequest indexRequest<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">new</span> IndexRequest<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;goods&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">source</span><span style="color:#000;font-weight:bold">(</span>data<span style="color:#000;font-weight:bold">,</span>XContentType<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">JSON</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            bulkRequest<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>indexRequest<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        BulkResponse response <span style="color:#000;font-weight:bold">=</span> client<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">bulk</span><span style="color:#000;font-weight:bold">(</span>bulkRequest<span style="color:#000;font-weight:bold">,</span> RequestOptions<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">DEFAULT</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>response<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">status</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="å››elasticsearché«˜çº§æŸ¥è¯¢">ï¼ˆå››ï¼‰ElasticSearché«˜çº§æŸ¥è¯¢</h2>
<h3 id="1-matchallè„šæœ¬å®ç°">1 matchAllè„šæœ¬å®ç°</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">#</span> <span style="color:#a61717;background-color:#e3d2d2">é»˜è®¤æƒ…å†µä¸‹ï¼Œesä¸€æ¬¡å±•ç¤º</span><span style="color:#099">10</span><span style="color:#a61717;background-color:#e3d2d2">æ¡æ•°æ®,é€šè¿‡fromå’Œsizeæ¥æ§åˆ¶åˆ†é¡µ</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">#</span> <span style="color:#a61717;background-color:#e3d2d2">æŸ¥è¯¢ç»“æœè¯¦è§£</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">goods/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&#34;match_all&#34;</span>: {}
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;from&#34;</span>: <span style="color:#099">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;size&#34;</span>: <span style="color:#099">100</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">goods</span>
</span></span></code></pre></div><h3 id="2-matchall-javaapi">2 matchAll-JavaAPI</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * æŸ¥è¯¢æ‰€æœ‰
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     *  1. matchAll
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     *  2. å°†æŸ¥è¯¢ç»“æœå°è£…ä¸ºGoodså¯¹è±¡ï¼Œè£…è½½åˆ°Listä¸­
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     *  3. åˆ†é¡µã€‚é»˜è®¤æ˜¾ç¤º10æ¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">matchAll</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span> IOException <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//2. æ„å»ºæŸ¥è¯¢è¯·æ±‚å¯¹è±¡ï¼ŒæŒ‡å®šæŸ¥è¯¢çš„ç´¢å¼•åç§°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        SearchRequest searchRequest<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">new</span> SearchRequest<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;goods&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//4. åˆ›å»ºæŸ¥è¯¢æ¡ä»¶æ„å»ºå™¨SearchSourceBuilder
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        SearchSourceBuilder sourceBuilder<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">new</span> SearchSourceBuilder<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//6. æŸ¥è¯¢æ¡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        QueryBuilder queryBuilder<span style="color:#000;font-weight:bold">=</span> QueryBuilders<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">matchAllQuery</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//5. æŒ‡å®šæŸ¥è¯¢æ¡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        sourceBuilder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">query</span><span style="color:#000;font-weight:bold">(</span>queryBuilder<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//3. æ·»åŠ æŸ¥è¯¢æ¡ä»¶æ„å»ºå™¨ SearchSourceBuilder
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        searchRequest<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">source</span><span style="color:#000;font-weight:bold">(</span>sourceBuilder<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">// 8 . æ·»åŠ åˆ†é¡µä¿¡æ¯  ä¸è®¾ç½® é»˜è®¤10æ¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//        sourceBuilder.from(0);
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//        sourceBuilder.size(100);
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#998;font-style:italic">//1. æŸ¥è¯¢,è·å–æŸ¥è¯¢ç»“æœ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>        SearchResponse searchResponse <span style="color:#000;font-weight:bold">=</span> client<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">search</span><span style="color:#000;font-weight:bold">(</span>searchRequest<span style="color:#000;font-weight:bold">,</span> RequestOptions<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">DEFAULT</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//7. è·å–å‘½ä¸­å¯¹è±¡ SearchHits
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        SearchHits hits <span style="color:#000;font-weight:bold">=</span> searchResponse<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getHits</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//7.1 è·å–æ€»è®°å½•æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>      Long total<span style="color:#000;font-weight:bold">=</span> hits<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getTotalHits</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">value</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;æ€»æ•°ï¼š&#34;</span><span style="color:#000;font-weight:bold">+</span>total<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//7.2 è·å–Hitsæ•°æ®  æ•°ç»„
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        SearchHit<span style="color:#000;font-weight:bold">[]</span> hits1 <span style="color:#000;font-weight:bold">=</span> hits<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getHits</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//è·å–jsonå­—ç¬¦ä¸²æ ¼å¼çš„æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        List<span style="color:#000;font-weight:bold">&lt;</span>Goods<span style="color:#000;font-weight:bold">&gt;</span> goodsList <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> ArrayList<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>SearchHit searchHit <span style="color:#000;font-weight:bold">:</span> hits1<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            String sourceAsString <span style="color:#000;font-weight:bold">=</span> searchHit<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getSourceAsString</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//è½¬ä¸ºjavaå¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            Goods goods <span style="color:#000;font-weight:bold">=</span> JSON<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">parseObject</span><span style="color:#000;font-weight:bold">(</span>sourceAsString<span style="color:#000;font-weight:bold">,</span> Goods<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            goodsList<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>goods<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>Goods goods <span style="color:#000;font-weight:bold">:</span> goodsList<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>goods<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="3-termquery-è¯æ¡æŸ¥è¯¢">3 termQuery è¯æ¡æŸ¥è¯¢</h3>
<p>termæŸ¥è¯¢å’Œå­—æ®µç±»å‹æœ‰å…³ç³»ï¼Œé¦–å…ˆå›é¡¾ä¸€ä¸‹ElasticSearchä¸¤ä¸ªæ•°æ®ç±»å‹</p>
<p>ElasticSearchä¸¤ä¸ªæ•°æ®ç±»å‹ï¼š</p>
<pre tabindex="0"><code>textï¼šä¼šåˆ†è¯ï¼Œä¸æ”¯æŒèšåˆ
keywordï¼šä¸ä¼šåˆ†è¯ï¼Œå°†å…¨éƒ¨å†…å®¹ä½œä¸ºä¸€ä¸ªè¯æ¡ï¼Œæ”¯æŒèšåˆ
</code></pre><p>è„šæœ¬å®ç°ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">#termæŸ¥è¯¢ï¼š</span> <span style="color:#a61717;background-color:#e3d2d2">æŸ¥è¯¢titleå½“ä¸­åŒ…å«</span>  <span style="color:#a61717;background-color:#e3d2d2">åä¸º</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">/goods/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&#34;term&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;title&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&#34;value&#34;</span>: <span style="color:#d14">&#34;åä¸º&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>javaAPIä»£ç å®ç°ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * termQuery:è¯æ¡æŸ¥è¯¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testTermQuery</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span> IOException <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        SearchRequest searchRequest <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> SearchRequest<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;goods&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        SearchSourceBuilder sourceBulider <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> SearchSourceBuilder<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        QueryBuilder query <span style="color:#000;font-weight:bold">=</span> QueryBuilders<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">termQuery</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;title&#34;</span><span style="color:#000;font-weight:bold">,</span><span style="color:#d14">&#34;åä¸º&#34;</span><span style="color:#000;font-weight:bold">);</span><span style="color:#998;font-style:italic">//termè¯æ¡æŸ¥è¯¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        sourceBulider<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">query</span><span style="color:#000;font-weight:bold">(</span>query<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        searchRequest<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">source</span><span style="color:#000;font-weight:bold">(</span>sourceBulider<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        SearchResponse searchResponse <span style="color:#000;font-weight:bold">=</span> client<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">search</span><span style="color:#000;font-weight:bold">(</span>searchRequest<span style="color:#000;font-weight:bold">,</span> RequestOptions<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">DEFAULT</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        SearchHits searchHits <span style="color:#000;font-weight:bold">=</span> searchResponse<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getHits</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#998;font-style:italic">//è·å–è®°å½•æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>        <span style="color:#458;font-weight:bold">long</span> value <span style="color:#000;font-weight:bold">=</span> searchHits<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getTotalHits</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">value</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;æ€»è®°å½•æ•°ï¼š&#34;</span><span style="color:#000;font-weight:bold">+</span>value<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        List<span style="color:#000;font-weight:bold">&lt;</span>Goods<span style="color:#000;font-weight:bold">&gt;</span> goodsList <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">new</span> ArrayList<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>        SearchHit<span style="color:#000;font-weight:bold">[]</span> hits <span style="color:#000;font-weight:bold">=</span> searchHits<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getHits</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>SearchHit hit <span style="color:#000;font-weight:bold">:</span> hits<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            String sourceAsString <span style="color:#000;font-weight:bold">=</span> hit<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getSourceAsString</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#998;font-style:italic">//è½¬ä¸ºjava
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>            Goods goods <span style="color:#000;font-weight:bold">=</span> JSON<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">parseObject</span><span style="color:#000;font-weight:bold">(</span>sourceAsString<span style="color:#000;font-weight:bold">,</span> Goods<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">class</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            goodsList<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">add</span><span style="color:#000;font-weight:bold">(</span>goods<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>Goods goods <span style="color:#000;font-weight:bold">:</span> goodsList<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>goods<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="4-matchquery">4 matchQuery</h3>
<p>matchæŸ¥è¯¢ï¼Œä¼šå¯¹æŸ¥è¯¢æ¡ä»¶åˆ†è¯ï¼Œç„¶åå°†åˆ†è¯åçš„æŸ¥è¯¢æ¡ä»¶å’Œè¯æ¡è¿›è¡Œç­‰å€¼åŒ¹é…,é»˜è®¤å–å¹¶é›†ï¼ˆORï¼‰</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">#</span> <span style="color:#a61717;background-color:#e3d2d2">matchæŸ¥è¯¢</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">goods/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&#34;match&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;title&#34;</span>: <span style="color:#d14">&#34;åä¸ºæ‰‹æœº&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;size&#34;</span>: <span style="color:#099">500</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>match çš„é»˜è®¤æœç´¢ï¼ˆor å¹¶é›†ï¼‰</p>
<p>ä¾‹å¦‚ï¼šåä¸ºæ‰‹æœºï¼Œä¼šåˆ†è¯ä¸º â€œåä¸ºâ€ï¼Œâ€œæ‰‹æœºâ€ åªè¦å‡ºç°å…¶ä¸­ä¸€ä¸ªè¯æ¡éƒ½ä¼šæœç´¢åˆ°</p>
<p>matchçš„ andï¼ˆäº¤é›†ï¼‰ æœç´¢</p>
<p>ä¾‹å¦‚ï¼šä¾‹å¦‚ï¼šåä¸ºæ‰‹æœºï¼Œä¼šåˆ†è¯ä¸º â€œåä¸ºâ€ï¼Œâ€œæ‰‹æœºâ€  ä½†è¦æ±‚â€œåä¸ºâ€ï¼Œå’Œâ€œæ‰‹æœºâ€åŒæ—¶å‡ºç°åœ¨è¯æ¡</p>
<p><strong>æ€»ç»“ï¼š</strong></p>
<p>term queryä¼šå»å€’æ’ç´¢å¼•ä¸­å¯»æ‰¾ç¡®åˆ‡çš„termï¼Œå®ƒå¹¶ä¸çŸ¥é“åˆ†è¯å™¨çš„å­˜åœ¨ã€‚è¿™ç§æŸ¥è¯¢é€‚åˆ<strong>keyword</strong> ã€<strong>numeric</strong>ã€<strong>date</strong></p>
<p>match queryçŸ¥é“åˆ†è¯å™¨çš„å­˜åœ¨ã€‚å¹¶ä¸”ç†è§£æ˜¯å¦‚ä½•è¢«åˆ†è¯çš„</p>
<h3 id="5-æ¨¡ç³ŠæŸ¥è¯¢è„šæœ¬å®ç°">5 æ¨¡ç³ŠæŸ¥è¯¢è„šæœ¬å®ç°</h3>
<pre tabindex="0"><code>é€šé…ç¬¦ä½¿ç”¨ï¼Œ?ä»£è¡¨ä»»æ„å•ä¸ªå­—ç¬¦ï¼Œ*ä»£è¡¨0ä¸ªæˆ–è€…æ˜¯å¤šä¸ªå­—ç¬¦
æ¡ˆä¾‹ï¼š 
&#34;*å*&#34;  åŒ…å«åå­—çš„
&#34;å*&#34;   åå­—åè¾¹å¤šä¸ªå­—ç¬¦
&#34;å?&#34;  åå­—åè¾¹å•ä¸ªå­—ç¬¦
&#34;*å&#34;æˆ–&#34;?å&#34; ä¼šå¼•å‘å…¨è¡¨ï¼ˆå…¨ç´¢å¼•ï¼‰æ‰«æ æ³¨æ„æ•ˆç‡é—®é¢˜
</code></pre><pre tabindex="0"><code># wildcard æŸ¥è¯¢ã€‚æŸ¥è¯¢æ¡ä»¶åˆ†è¯ï¼Œæ¨¡ç³ŠæŸ¥è¯¢
GET goods/_search
{
  &#34;query&#34;: {
    &#34;wildcard&#34;: {
      &#34;title&#34;: {
        &#34;value&#34;: &#34;å*&#34;
      }
    }
  }
}
</code></pre><h3 id="6-æ¨¡ç³ŠæŸ¥è¯¢javaapi">6 æ¨¡ç³ŠæŸ¥è¯¢javaAPI</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">//æ¨¡ç³ŠæŸ¥è¯¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>WildcardQueryBuilder query <span style="color:#000;font-weight:bold">=</span> QueryBuilders<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">wildcardQuery</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;title&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;å*&#34;</span><span style="color:#000;font-weight:bold">);</span><span style="color:#998;font-style:italic">//ååå¤šä¸ªå­—ç¬¦
</span></span></span></code></pre></div><h3 id="7-èŒƒå›´æŸ¥è¯¢è„šæœ¬å®ç°">7 èŒƒå›´æŸ¥è¯¢è„šæœ¬å®ç°</h3>
<pre tabindex="0"><code># èŒƒå›´æŸ¥è¯¢
GET goods/_search
{
  &#34;query&#34;: {
    &#34;range&#34;: {
      &#34;price&#34;: {
        &#34;gte&#34;: 2000,
        &#34;lte&#34;: 3000
      }
    }
  },
  &#34;sort&#34;: [
    {
      &#34;price&#34;: {
        &#34;order&#34;: &#34;desc&#34;
      }
    }
  ]
}
</code></pre><h3 id="8-èŒƒå›´æŸ¥è¯¢apiå®ç°">8 èŒƒå›´æŸ¥è¯¢APIå®ç°</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">//èŒƒå›´æŸ¥è¯¢ ä»¥price ä»·æ ¼ä¸ºæ¡ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>RangeQueryBuilder query <span style="color:#000;font-weight:bold">=</span> QueryBuilders<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">rangeQuery</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;price&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//æŒ‡å®šä¸‹é™
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>query<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">gte</span><span style="color:#000;font-weight:bold">(</span><span style="color:#099">2000</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//æŒ‡å®šä¸Šé™
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>query<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">lte</span><span style="color:#000;font-weight:bold">(</span><span style="color:#099">3000</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>sourceBuilder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">query</span><span style="color:#000;font-weight:bold">(</span>query<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">//æ’åº  ä»·æ ¼ é™åºæ’åˆ—
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>sourceBuilder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">sort</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;price&#34;</span><span style="color:#000;font-weight:bold">,</span>SortOrder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">DESC</span><span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><h3 id="9-querystring-æŸ¥è¯¢">9 queryString æŸ¥è¯¢</h3>
<p>queryString å¤šæ¡ä»¶æŸ¥è¯¢</p>
<p>ä¼šå¯¹æŸ¥è¯¢æ¡ä»¶è¿›è¡Œåˆ†è¯ã€‚</p>
<p>ç„¶åå°†åˆ†è¯åçš„æŸ¥è¯¢æ¡ä»¶å’Œè¯æ¡è¿›è¡Œç­‰å€¼åŒ¹é…</p>
<p>é»˜è®¤å–å¹¶é›†ï¼ˆORï¼‰</p>
<p>å¯ä»¥æŒ‡å®šå¤šä¸ªæŸ¥è¯¢å­—æ®µ</p>
<p>query_stringï¼šè¯†åˆ«queryä¸­çš„è¿æ¥ç¬¦ï¼ˆor ã€andï¼‰</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">#</span> <span style="color:#a61717;background-color:#e3d2d2">queryString</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">goods/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&#34;query_string&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;fields&#34;</span>: [<span style="color:#d14">&#34;title&#34;</span>,<span style="color:#d14">&#34;categoryName&#34;</span>,<span style="color:#d14">&#34;brandName&#34;</span>], 
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;query&#34;</span>: <span style="color:#d14">&#34;åä¸º AND æ‰‹æœº&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>simple_query_stringï¼šä¸è¯†åˆ«queryä¸­çš„è¿æ¥ç¬¦ï¼ˆor ã€andï¼‰ï¼ŒæŸ¥è¯¢æ—¶ä¼šå°† â€œåä¸ºâ€ã€&ldquo;and&rdquo;ã€â€œæ‰‹æœºâ€åˆ†åˆ«è¿›è¡ŒæŸ¥è¯¢</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">goods/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&#34;simple_query_string&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;fields&#34;</span>: [<span style="color:#d14">&#34;title&#34;</span>,<span style="color:#d14">&#34;categoryName&#34;</span>,<span style="color:#d14">&#34;brandName&#34;</span>], 
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;query&#34;</span>: <span style="color:#d14">&#34;åä¸º AND æ‰‹æœº&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="10-querystring-javaapiä»£ç å®ç°">10 queryString javaAPIä»£ç å®ç°ï¼š</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>QueryStringQueryBuilder query <span style="color:#000;font-weight:bold">=</span> QueryBuilders<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">queryStringQuery</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;åä¸ºæ‰‹æœº&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">field</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;title&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">field</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;categoryName&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">field</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;brandName&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">defaultOperator</span><span style="color:#000;font-weight:bold">(</span>Operator<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">AND</span><span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><h3 id="11-èšåˆæŸ¥è¯¢è„šæœ¬å®ç°">11 èšåˆæŸ¥è¯¢è„šæœ¬å®ç°</h3>
<p>æŒ‡æ ‡èšåˆï¼šç›¸å½“äºMySQLçš„èšåˆå‡½æ•°ã€‚maxã€minã€avgã€sumç­‰</p>
<p>æ¡¶èšåˆï¼šç›¸å½“äºMySQLçš„ group by æ“ä½œã€‚ä¸è¦å¯¹textç±»å‹çš„æ•°æ®è¿›è¡Œåˆ†ç»„ï¼Œä¼šå¤±è´¥</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">#</span> <span style="color:#a61717;background-color:#e3d2d2">èšåˆæŸ¥è¯¢</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">#</span> <span style="color:#a61717;background-color:#e3d2d2">æŒ‡æ ‡èšåˆ</span> <span style="color:#a61717;background-color:#e3d2d2">èšåˆå‡½æ•°</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">goods/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&#34;match&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;title&#34;</span>: <span style="color:#d14">&#34;æ‰‹æœº&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&#34;max_price&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;max&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&#34;field&#34;</span>: <span style="color:#d14">&#34;price&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">#</span> <span style="color:#a61717;background-color:#e3d2d2">æ¡¶èšåˆ</span>  <span style="color:#a61717;background-color:#e3d2d2">åˆ†ç»„</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">goods/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&#34;match&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;title&#34;</span>: <span style="color:#d14">&#34;æ‰‹æœº&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#000080">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#000080">&#34;goods_brands&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#000080">&#34;terms&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&#34;field&#34;</span>: <span style="color:#d14">&#34;brandName&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#000080">&#34;size&#34;</span>: <span style="color:#099">100</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="12-èšåˆæŸ¥è¯¢javaapi">12 èšåˆæŸ¥è¯¢JavaAPI</h3>
<p>èšåˆæŸ¥è¯¢ï¼šæ¡¶èšåˆï¼Œåˆ†ç»„æŸ¥è¯¢</p>
<ol>
<li>
<p>æŸ¥è¯¢titleåŒ…å«æ‰‹æœºçš„æ•°æ®</p>
</li>
<li>
<p>æŸ¥è¯¢å“ç‰Œåˆ—è¡¨</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#998;font-style:italic">/**
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * èšåˆæŸ¥è¯¢ï¼šæ¡¶èšåˆï¼Œåˆ†ç»„æŸ¥è¯¢
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * 1. æŸ¥è¯¢titleåŒ…å«æ‰‹æœºçš„æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     * 2. æŸ¥è¯¢å“ç‰Œåˆ—è¡¨
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic">     */</span>
</span></span><span style="display:flex;"><span><span style="color:#3c5d5d;font-weight:bold">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">public</span> <span style="color:#458;font-weight:bold">void</span> <span style="color:#900;font-weight:bold">testAggQuery</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">throws</span> IOException <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    SearchRequest searchRequest<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">new</span> SearchRequest<span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;goods&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    SearchSourceBuilder sourceBuilder<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">new</span> SearchSourceBuilder<span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//1. æŸ¥è¯¢titleåŒ…å«æ‰‹æœºçš„æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    MatchQueryBuilder queryBuilder <span style="color:#000;font-weight:bold">=</span> QueryBuilders<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">matchQuery</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;title&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;æ‰‹æœº&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    sourceBuilder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">query</span><span style="color:#000;font-weight:bold">(</span>queryBuilder<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//2. æŸ¥è¯¢å“ç‰Œåˆ—è¡¨  åªå±•ç¤ºå‰100æ¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    AggregationBuilder aggregation<span style="color:#000;font-weight:bold">=</span>AggregationBuilders<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">terms</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;goods_brands&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">field</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;brandName&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">size</span><span style="color:#000;font-weight:bold">(</span><span style="color:#099">100</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    sourceBuilder<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">aggregation</span><span style="color:#000;font-weight:bold">(</span>aggregation<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    searchRequest<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">source</span><span style="color:#000;font-weight:bold">(</span>sourceBuilder<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    SearchResponse searchResponse <span style="color:#000;font-weight:bold">=</span> client<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">search</span><span style="color:#000;font-weight:bold">(</span>searchRequest<span style="color:#000;font-weight:bold">,</span> RequestOptions<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">DEFAULT</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//7. è·å–å‘½ä¸­å¯¹è±¡ SearchHits
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    SearchHits hits <span style="color:#000;font-weight:bold">=</span> searchResponse<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getHits</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//7.1 è·å–æ€»è®°å½•æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Long total<span style="color:#000;font-weight:bold">=</span> hits<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getTotalHits</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">value</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;æ€»æ•°ï¼š&#34;</span><span style="color:#000;font-weight:bold">+</span>total<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">// aggregations å¯¹è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Aggregations aggregations <span style="color:#000;font-weight:bold">=</span> searchResponse<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getAggregations</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//å°†aggregations è½¬åŒ–ä¸ºmap
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span> Aggregation<span style="color:#000;font-weight:bold">&gt;</span> aggregationMap <span style="color:#000;font-weight:bold">=</span> aggregations<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">asMap</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//é€šè¿‡keyè·å–goods_brands å¯¹è±¡ ä½¿ç”¨Aggregationçš„å­ç±»æ¥æ”¶  bucketså±æ€§åœ¨Termsæ¥å£ä¸­ä½“ç°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//        Aggregation goods_brands1 = aggregationMap.get(&#34;goods_brands&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    Terms goods_brands <span style="color:#000;font-weight:bold">=(</span>Terms<span style="color:#000;font-weight:bold">)</span> aggregationMap<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">get</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;goods_brands&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//è·å–buckets æ•°ç»„é›†åˆ
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    List<span style="color:#000;font-weight:bold">&lt;?</span> <span style="color:#000;font-weight:bold">extends</span> Terms<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Bucket</span><span style="color:#000;font-weight:bold">&gt;</span> buckets <span style="color:#000;font-weight:bold">=</span> goods_brands<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getBuckets</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Map<span style="color:#000;font-weight:bold">&lt;</span>String<span style="color:#000;font-weight:bold">,</span>Object<span style="color:#000;font-weight:bold">&gt;</span>map<span style="color:#000;font-weight:bold">=</span><span style="color:#000;font-weight:bold">new</span> HashMap<span style="color:#000;font-weight:bold">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#998;font-style:italic">//éå†buckets   key å±æ€§åï¼Œdoc_count ç»Ÿè®¡èšåˆæ•°
</span></span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"></span>    <span style="color:#000;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span>Terms<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">Bucket</span> bucket <span style="color:#000;font-weight:bold">:</span> buckets<span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>bucket<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getKey</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>        map<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">put</span><span style="color:#000;font-weight:bold">(</span>bucket<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getKeyAsString</span><span style="color:#000;font-weight:bold">(),</span>bucket<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">getDocCount</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    System<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">out</span><span style="color:#000;font-weight:bold">.</span><span style="color:#008080">println</span><span style="color:#000;font-weight:bold">(</span>map<span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div></li>
</ol>

    </div>

    

    


    <div class="container-prevnext">
    <div><a href="https://lovemjh.github.io/posts/tool/20220526204447/">â† Dubbo</a></div>
    <div><a href="https://lovemjh.github.io/posts/java-frame/20220526214937/">Mybatis-Plus  â†’</a></div>
</div>
</div>

        </div>
        <div id="footer"><div class="container-footer">
    
    <a href="//beian.miit.gov.cn" target="_blank">
        
        è±«ICPå¤‡2022002918å·
        
    </a>
    <a id="s" href="/secrets">&nbsp;</a>
</div></div>
    </body>
</html>
